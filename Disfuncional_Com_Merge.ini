[.]
.dirignore=.git
	.venv
	__pycache__
	*.pyc
	temp
	uploads
	mapa_diretorio.ini
	mapa_conteudo.ini
	gerar_mapa_diretorio.py
.gitignore=.qodo
	__pycache__/
	__pycache__
	**/__pycache__
	venv/
	base_jp_lab/
	jp_bd.sql
	# Ignorar toda a pasta uploads
	uploads/*
	
	# Exceto o arquivo marcador
	!uploads/UPLOADS_DE_PDFS_VEM_AQUI
	
Dockerfile=FROM python:3.12.7
	
	# Instala√ß√£o de depend√™ncias do sistema operacional
	RUN apt-get update && apt-get install -y \
	    gcc \
	    libpq-dev \
	    python3-dev \
	    build-essential \
	    ghostscript \
	&& rm -rf /var/lib/apt/lists/*
	
	WORKDIR /app
	
	COPY requirements.txt ./
	# Atualiza o pip e instala as depend√™ncias do requirements.txt
	RUN pip install --no-cache-dir --upgrade pip && \
	    pip install --no-cache-dir -r requirements.txt
	
	
	COPY . /app
	# Instala seu pacote local
	RUN pip install --no-cache-dir ./base_jp_lab
	RUN pip install --no-cache-dir uwsgi ghostscript
	
	EXPOSE 8345
	
	# CMD ["gunicorn", "-w", "4", "-k", "gevent", "-b", "0.0.0.0:8345", "main:app"]
	
	# Comando para iniciar a aplica√ß√£o com uWSGI
	# Voc√™ precisar√° ajustar 'main:app' para o caminho correto do seu aplicativo WSGI.
	# Por exemplo, se sua aplica√ß√£o Flask/Django √© um objeto chamado 'app' dentro de 'main.py',
	# ent√£o 'main:app' est√° correto.
	
	CMD ["uwsgi", "--http", ":8345", "--module", "main", "--callable", "app", "--master", "--processes", "1", "--threads", "1", "--enable-threads", "--vacuum", "--buffer-size", "20971520", "--harakiri", "300"]
	# "--buffer-size", "20971520" (Tamanho do arquivo definido at√© 20MB)
	# "--harakiri", "300" (Timeout definido para 5 minutos)
README.md=<p align="center">
	  <a href="https://wakatime.com/@db4a2800-e564-4201-9406-b98e170a6764">
	    <img src="https://wakatime.com/badge/user/db4a2800-e564-4201-9406-b98e170a6764/project/96ca3246-1153-4315-882c-4663d870ca5c.svg" alt="WakaTime" height="40"/>
	  </a>
	  <img src="https://img.shields.io/badge/made%20with-%F0%9F%92%9C-red" alt="Made with Love" height="40"/>
	  <img src="https://img.shields.io/badge/status-active-success" alt="Status" height="40"/>
	</p>
	
	# AgendamentosWeb
	
	Sistema de Agendamentos WEB desenvolvido exclusivamente para a **Ja√∫ Pesca**.
	
	> **Aviso Importante** ‚ö†Ô∏è  
	> Este c√≥digo √© de **uso restrito** e **exclusivo** da equipe de **Gest√£o de TI da Ja√∫ Pesca**.  
	> **N√£o √© permitido**:
	> - Utilizar, copiar ou modificar este c√≥digo, total ou parcialmente.
	> - Reutilizar trechos, estruturas, l√≥gicas ou qualquer componente deste sistema.
	> - Distribuir, publicar ou compartilhar qualquer parte deste projeto sem autoriza√ß√£o expressa e por escrito da **Ja√∫ Pesca**.
	
	Qualquer uso n√£o autorizado ser√° considerado **viola√ß√£o de direitos** e poder√° resultar em **medidas legais**.
	
	---
	
	> **Observa√ß√£o:** Este reposit√≥rio √© mantido com o √∫nico objetivo de servir como **backup interno** da equipe de TI.
	
build.sh=#!/bin/bash
	set -euo pipefail
	
	IP="192.168.15.121"
	REG_PORT="5000"          # Porta do Registry
	NAME="agendamentos-web"
	VERSION="latest"
	IMAGE_NAME="${IP}:${REG_PORT}/${NAME}:${VERSION}"
	APP_PORT="8345"          # Porta do app Flask
	
	echo "‚è≥ Iniciando build da imagem: ${IMAGE_NAME}..."
	docker build -t "${IMAGE_NAME}" .
	echo "‚úÖ Build finalizado."
	
	echo "üì¶ Enviando imagem para o registry privado em ${IP}:${REG_PORT}..."
	docker push "${IMAGE_NAME}"
	echo "üöÄ Enviado com sucesso!"
	
	echo
	echo "üîó Para rodar o container do app:"
	echo "    docker run -d --name ${NAME} -p ${APP_PORT}:${APP_PORT} ${IMAGE_NAME}"
	
exceptions.py=from werkzeug.exceptions import HTTPException
	
	class ParametroInvalido(HTTPException):
	    code = 1
	    description = "Par√¢metro inv√°lido///Sempre navegue pelo site atrav√©s dos bot√µes dispon√≠veis!///Caso n√£o tenha alterado a URL, entre em contato com um supervisor e informe o c√≥digo do erro."
	    # ? "///" est√° sendo us√°do para que possamos separar essa string futuramente
	    
	class MetodoInvalido(HTTPException):
	    code = 2
	    description = "M√©todo inv√°lido///M√©todo n√£o pode ser usado nesse endpoint.///Navegue sempre por dentro do site, n√£o utilize outras ferramentas para extrair dados!"
	    
	class LimiteRequests(HTTPException):
	    code = 3
	    description = "Muitos requests///Muitos requests foram feitos e a API te desconectou.///Espere alguns segundos e tente novamente."
	    
	class ArquivoInvalido(HTTPException):
	    code = 4
	    description = "Arquivo inv√°lido///Algo no arquivo n√£o o deixa ser baixado.///Insira apenas PDFs de agendamento do Mercado Livre."
git=      PID    PPID    PGID     WINPID   TTY         UID    STIME COMMAND
	      58       1      58       2132  cons0    1049750 07:42:25 /usr/bin/bash
	      366      58     366       1512  cons0    1049750 07:42:42 /usr/bin/PS
	
main.py=from flask import (
	    Flask, render_template, request, flash, redirect, url_for, session,
	    jsonify, send_from_directory, send_file, after_this_request, abort, Response
	)
	from flask import session as flask_session, request as flask_request, redirect as flask_redirect, url_for as flask_url_for
	
	from base_jp_lab import Access, Caller
	from classes import AgendamentoController, DatabaseController
	from flask_cors import CORS
	import pandas as pd
	from exceptions import ParametroInvalido, MetodoInvalido, LimiteRequests, ArquivoInvalido
	# Remova SocketIO se n√£o for usar agora:
	# from flask_socketio import SocketIO, join_room, emit
	
	UPLOAD_FOLDER = "uploads"
	ALLOWED_EXTENSIONS = {"pdf", "csv", "xlsx"}
	
	app = Flask(__name__)
	CORS(app)
	
	app.secret_key = "test_key"  # TODO: mover para vari√°vel de ambiente
	app.config["UPLOAD_FOLDER"] = UPLOAD_FOLDER
	
	# -------------------------------
	# Health check simples
	# -------------------------------
	@app.route("/health", methods=["GET"])
	def health_check():
	    return "ok", 200
	
	# -------------------------------
	# Prote√ß√£o de rotas por login
	# -------------------------------
	@app.before_request
	def require_login():
	    # libera apenas login, est√°ticos e nossas APIs REST de bipagem
	    open_endpoints = {
	        'auth.login',               # rota de login
	        'static',                   # arquivos est√°ticos
	        'retirado.api_bipar',       # POST /api/bipar
	        'retirado.api_bipados_agend',  # GET /api/bipados/<id_agend>  <-- v√≠rgula aqui
	        'health_check'              # rota de health check
	    }
	    ep = flask_request.endpoint or ''
	    if ep not in open_endpoints and 'id_usuario' not in flask_session:
	        return flask_redirect(flask_url_for('auth.login'))
	# -------------------------------
	
	# 1) conex√£o DB (mantenho como est√°; ideal: ler de env)
	access = Access(
	    "Bruno_Lallo",
	    "ji}dx(v{M,z2j+f>[/}%_Vr-0?nI}W*@Dw68NnHJ+tMu&ZkF",
	    "192.168.15.200",
	    "3306",
	    "jp_bd",
	)
	
	# 2) Caller Tiny usando a MESMA inst√¢ncia de Access
	caller = Caller(access, "tiny")
	
	# # =====================================================================
	# # === IN√çCIO DO C√ìDIGO DE TESTE (TEMPOR√ÅRIO) \===
	# # =====================================================================
	# print("\n--- SIMULANDO TOKEN EXPIRADO ---")
	# # For√ßa um token inv√°lido no header da sess√£o do Caller.
	# # Isso far√° com que a primeira requisi√ß√£o falhe com erro 403.
	# caller.session.headers.update({'Authorization': 'Bearer aaaa'}) 
	# print(f"Header de autoriza√ß√£o foi for√ßado para: {caller.session.headers['Authorization']}")
	# print("--- FIM DA SIMULA√á√ÉO ---\n")
	# # =====================================================================
	# # === FIM DO C√ìDIGO DE TESTE ===
	# # =====================================================================
	
	
	# 3) Controllers
	db_controller = DatabaseController(access)
	agendamento_controller = AgendamentoController(db_controller, caller)
	
	app.config.update({
	    'ACCESS': access,
	    'CALLER': caller,
	    'AG_CTRL': agendamento_controller,
	    'DB_CTRL': db_controller
	})
	
	# Blueprints
	from rotas.auth import bp_auth
	app.register_blueprint(bp_auth)
	
	from rotas.retiradoEstoque import bp_retirado
	app.register_blueprint(bp_retirado)
	
	from rotas.embalar import bp_embalar
	app.register_blueprint(bp_embalar)
	
	# >>> recupera funcionalidades antigas <<<
	from rotas.expedicao import bp_expedicao
	app.register_blueprint(bp_expedicao)
	
	from rotas.relatorio import bp_relatorio
	app.register_blueprint(bp_relatorio)
	
	# Demais rotas (home, agendamentos, etc.)
	from rotas import *
	
	if __name__ == "__main__":
	    # debug opcional; ajuste a gosto
	    app.run(host='0.0.0.0', port=8345, debug=True)
	    
	# -----------------------------------------------------------------------------
	# SOBRE O USO DE SocketIO (opcional)
	# -----------------------------------------------------------------------------
	# O que √©:
	#   - Flask-SocketIO habilita comunica√ß√£o em tempo real (WebSocket/fallbacks).
	#   - √ötil para: progresso ao vivo, notifica√ß√µes instant√¢neas, contadores, sala
	#     de "expedi√ß√£o" recebendo eventos de bipagem, etc.
	#
	# Quando manter:
	#   - S√≥ se voc√™ TIVER eventos em tempo real (emit/on) no back e front.
	#   - Se hoje n√£o h√° nenhum "emit"/"socketio.on" no projeto, voc√™ pode REMOVER
	#     os imports e o run com SocketIO sem preju√≠zo.
	#
	# O que fazer AGORA:
	#   ‚Ä¢ N√ÉO vai usar tempo real agora:
	#       - Remova: `from flask_socketio import SocketIO, join_room, emit`
	#       - Mantenha: `app.run(host="0.0.0.0", port=8345, debug=True)`
	#
	#   ‚Ä¢ Vai usar tempo real (dev/local):
	#       1) from flask_socketio import SocketIO
	#       2) socketio = SocketIO(app, cors_allowed_origins="*")  # em prod, restrinja CORS!
	#       3) Substitua o app.run(...) por:
	#             socketio.run(app, host="0.0.0.0", port=8345, debug=True)
	#
	#   ‚Ä¢ Deploy em produ√ß√£o com tempo real:
	#       - Use Gunicorn com eventlet (ou gevent) para suportar WebSockets:
	#           gunicorn -k eventlet -w 1 -b 0.0.0.0:8345 main:app
	#         (assumindo que seu arquivo √© main.py e o objeto Flask se chama `app`)
	#
	#       - V√ÅRIOS workers/containers? Use fila (Redis) para sincronizar eventos:
	#           socketio = SocketIO(app, message_queue="redis://redis:6379/0",
	#                                cors_allowed_origins=["https://seu-dominio"])
	#           gunicorn -k eventlet -w 4 -b 0.0.0.0:8345 main:app
	#
	#       - Observa√ß√µes:
	#           ‚Ä¢ Prefira eventlet/gevent; uWSGI padr√£o n√£o lida bem com WebSockets.
	#           ‚Ä¢ Defina `app.secret_key` via vari√°vel de ambiente em produ√ß√£o.
	#           ‚Ä¢ Restrinja CORS (N√ÉO deixe "*" em prod).
	#
	# Resumo:
	#   - Se n√£o houver necessidade de "tempo real" agora, remova SocketIO e siga
	#     com `app.run(...)`. Se precisar no futuro, ative conforme indicado acima.
	# -----------------------------------------------------------------------------
patch=      PID    PPID    PGID     WINPID   TTY         UID    STIME COMMAND
	      294      58     294       2932  cons0    1049750 07:42:40 /usr/bin/PS
	      58       1      58       2132  cons0    1049750 07:42:25 /usr/bin/bash
	
requirements.txt=anyio==4.9.0
	asgiref==3.8.1
	attrs==25.3.0
	bidict==0.23.1
	blinker==1.9.0
	cachetools==5.5.2
	camelot-py==1.0.0
	certifi==2025.4.26
	cffi==1.17.1
	chardet==5.2.0
	charset-normalizer==3.4.2
	click==8.2.1
	cryptography==43.0.3
	dnspython==2.7.0
	et_xmlfile==2.0.0
	eventlet==0.40.0
	Flask==3.1.1
	flask-cors==6.0.0
	Flask-SocketIO==5.5.1
	gevent==25.5.1
	ghostscript==0.8.1
	google-auth==2.40.3
	google-auth-oauthlib==1.2.2
	greenlet==3.2.3
	grequests==0.7.0
	gspread==6.1.4
	gunicorn==23.0.0
	h11==0.16.0
	httpcore==1.0.9
	httplib2==0.22.0
	httpx==0.28.1
	idna==3.10
	itsdangerous==2.2.0
	Jinja2==3.1.6
	MarkupSafe==3.0.2
	mysql-connector==2.2.9
	numpy==2.3.0
	oauth2client==4.1.3
	oauthlib==3.2.2
	opencv-python-headless==4.11.0.86
	openpyxl==3.1.5
	outcome==1.3.0.post0
	packaging==25.0
	pandas==2.2.3
	pdfminer.six==20250506
	pyasn1==0.6.1
	pyasn1_modules==0.4.2
	pycparser==2.22
	pyparsing==3.2.3
	pypdf==5.6.0
	pypdfium2==4.30.1
	PySocks==1.7.1
	python-dateutil==2.9.0.post0
	python-engineio==4.12.2
	python-socketio==5.13.0
	pytz==2025.2
	pyuwsgi==2.0.29
	requests==2.32.3
	requests-oauthlib==2.0.0
	rsa==4.9.1
	selenium==4.24.0
	setuptools==80.9.0
	simple-websocket==1.1.0
	six==1.17.0
	sniffio==1.3.1
	sortedcontainers==2.4.0
	tabulate==0.9.0
	trio==0.30.0
	trio-websocket==0.12.2
	typing_extensions==4.14.0
	tzdata==2025.2
	urllib3==2.4.0
	uWSGI==2.0.30
	waitress==3.0.2
	websocket-client==1.8.0
	Werkzeug==3.1.3
	wsproto==1.2.0
	zope.event==5.0
	zope.interface==7.2
	psycopg2-binary==2.9.10
teste.js=document.addEventListener("DOMContentLoaded", async () => {
	    // 1) Dados iniciais e imagem padr√£o
	    const raw = document.getElementById("js-data").dataset.comps;
	    const produtos = JSON.parse(raw);
	    const placeholderImage = document.getElementById("placeholder-image").dataset.url;
	    const headerBar = document.querySelector(".header-bar");
	    const idAgendMl = headerBar ? headerBar.dataset.idMl : null;
	    const idAgendBd = headerBar ? headerBar.dataset.idBd : null;
	
	    // Vari√°veis de estado para as caixas e impressora
	    let caixas = [];
	    let caixaAtivaIndex = -1;
	    let caixaStartTime = null;
	    let impressoraSelecionada; // Vari√°vel para guardar a impressora
	
	    if (!idAgendMl) {
	        console.error("N√£o foi poss√≠vel encontrar o ID do Agendamento (id_agend_ml) no HTML.");
	        Swal.fire("Erro Cr√≠tico", "N√£o foi poss√≠vel identificar o agendamento. A p√°gina n√£o funcionar√° corretamente.", "error");
	        return;
	    }
	
	    // 2) Inst√¢ncias dos modais (Bootstrap 5)
	    const modalSelecione = new bootstrap.Modal(document.getElementById("modalSelecioneAnuncio"));
	    const modalConfirme = new bootstrap.Modal(document.getElementById("modalConfirmeAnuncio"));
	
	    // 3) Elementos da UI
	    const inputSku = document.getElementById("input-embalar");
	    const bodySelecione = document.getElementById("modalSelecioneAnuncioBody");
	    const bodyConfirme = document.getElementById("modalConfirmeAnuncioBody");
	    const btnConfirmar = document.getElementById("btnConfirmarAnuncio");
	    const caixasContainer = document.getElementById("caixas-container");
	    const caixaActionsContainer = document.getElementById("caixa-actions-container");
	    const contadorFinalizadosEl = document.getElementById("finalizadosP");
	    const listaPrincipalEl = document.getElementById("lista-anuncios");
	    const templateNovaCaixa = document.getElementById("template-nova-caixa");
	    const templateFinalizar = document.getElementById("template-finalizar-embalagem");
	
	    // ===================================================================
	    // NOVA L√ìGICA DE IMPRESS√ÉO DIRETA
	    // ===================================================================
	    /**
	     * Configura a comunica√ß√£o com o Zebra Browser Print e define a impressora padr√£o.
	     */
	    function setupImpressora() {
	        BrowserPrint.getDefaultDevice("printer", (device) => {
	            impressoraSelecionada = device;
	            console.log("Impressora padr√£o encontrada:", device);
	            if (!impressoraSelecionada) {
	                 Swal.fire('Impressora n√£o encontrada', 'Verifique se a impressora Zebra est√° conectada e se o Zebra Browser Print est√° em execu√ß√£o.', 'warning');
	            }
	        }, (error) => {
	            console.error("Erro ao buscar impressora padr√£o:", error);
	            Swal.fire('Erro de Comunica√ß√£o', 'N√£o foi poss√≠vel se conectar ao Zebra Browser Print. Verifique se ele est√° instalado e em execu√ß√£o.', 'error');
	        });
	    }
	
	    /**
	     * Envia o c√≥digo ZPL para a impressora selecionada.
	     * @param {string} zpl - O c√≥digo ZPL a ser impresso.
	     */
	    function enviarParaImpressora(zpl) {
	        if (!impressoraSelecionada) {
	            Swal.fire('Impressora Indispon√≠vel', 'A impressora padr√£o n√£o foi encontrada. A impress√£o n√£o pode continuar.', 'error');
	            return;
	        }
	        impressoraSelecionada.send(zpl,
	            () => { console.log("Impress√£o enviada com sucesso."); },
	            (error) => { console.error("Erro ao imprimir:", error); Swal.fire('Falha na Impress√£o', error, 'error'); }
	        );
	    }
	    
	    // ===================================================================
	    // FUN√á√ïES DE ETIQUETA MODIFICADAS
	    // ===================================================================
	
	    function gerarEtiqueta(sku) {
	        const anuncio = produtos.find((p) => p.sku === sku);
	        if (!anuncio) return;
	
	        let xColunaEsquerda = 30;
	        let xColunaDireita = 350;
	        let etiquetasGeradas = 0;
	        let linhasNecessarias = Math.ceil(anuncio.unidades / 2);
	
	        const zplAndamento = [];
	
	        for (let linha = 0; linha < linhasNecessarias; linha++) {
	            zplAndamento.push("^XA^CI28");
	            zplAndamento.push("^LH0,0");
	
	            if (etiquetasGeradas < anuncio.unidades) {
	                zplAndamento.push(`^FO${xColunaEsquerda},15^BY2,,0^BCN,54,N,N^FD${anuncio.id_ml}^FS`);
	                zplAndamento.push(`^FO${xColunaEsquerda + 75},75^A0N,20,25^FH^FD${anuncio.id_ml}^FS`);
	                zplAndamento.push(`^FO${xColunaEsquerda + 75},76^A0N,20,25^FH^FD${anuncio.id_ml}^FS`);
	                zplAndamento.push(`^FO${xColunaEsquerda - 14},115^A0N,18,18^FB300,3,2,L^FH^FD${anuncio.nome}^FS`);
	                zplAndamento.push(`^FO${xColunaEsquerda - 14},180^A0N,18,18^FH^FDSKU: ${anuncio.sku}^FS`);
	                etiquetasGeradas++;
	            }
	
	            if (etiquetasGeradas < anuncio.unidades) {
	                zplAndamento.push(`^FO${xColunaDireita},15^BY2,,0^BCN,54,N,N^FD${anuncio.id_ml}^FS`);
	                zplAndamento.push(`^FO${xColunaDireita + 75},75^A0N,20,25^FH^FD${anuncio.id_ml}^FS`);
	                zplAndamento.push(`^FO${xColunaDireita + 75},76^A0N,20,25^FH^FD${anuncio.id_ml}^FS`);
	                zplAndamento.push(`^FO${xColunaDireita - 14},115^A0N,18,18^FB300,3,2,L^FH^FD${anuncio.nome}^FS`);
	                zplAndamento.push(`^FO${xColunaDireita - 14},180^A0N,18,18^FH^FDSKU: ${anuncio.sku}^FS`);
	                etiquetasGeradas++;
	            }
	
	            zplAndamento.push("^XZ");
	        }
	
	        const zplCompleto = zplAndamento.join('\n');
	        console.log("Enviando ZPL da etiqueta para a impressora:", zplCompleto);
	        
	        // MODIFICADO: Em vez de baixar, envia para a impressora
	        enviarParaImpressora(zplCompleto);
	    }
	
	    function gerarEtiquetaCaixa(caixa) {
	        const headerBar = document.querySelector('.header-bar');
	        const freteId = headerBar.dataset.idMl;
	        const dataStr = caixa.startTime.toLocaleDateString('pt-BR');
	        const horaIni = caixa.startTime.toLocaleTimeString('pt-BR', { hour12: false });
	        const horaFim = caixa.endTime.toLocaleTimeString('pt-BR', { hour12: false });
	
	        const linhas = [
	            '^XA^CI28',
	            '^LH0,0',
	            `^FO30,30^BQN,2,15^FDLA,${freteId}^FS`,
	            `^FO390,40^A0N,32,32^FDFrete: ${freteId}^FS`,
	            `^FO390,90^A0N,32,32^FDData: ${dataStr}^FS`,
	            `^FO390,140^A0N,32,32^FDInicio: ${horaIni}^FS`,
	            `^FO390,190^A0N,32,32^FDTermino: ${horaFim}^FS`,
	            '^FO620,225^GFA,0,4150,30,,::::::::::::::::::::::::::::::::::::::::::Y03KFE,W01OF8,V01JF800JFC,U01FFEM03FFC,U0FF8O01FF8,T07F8Q01FF,S03FCS01FC,S0FEU03F8,R07FW07E,R0F8W01F8,Q03EY07E,Q0F8Y01F8,P03EgG07C,P078gG01F,O01FP03IFO078,O03CO01KFN03C,O07CO07F807FCN0F,O0FF8M01F8I03F8M0F8,N03CFFM03EK0FEL07FC,N0781FEK03F8K01FCJ03F8E,N0F003FEI03FEM07FE007FE07,M01EI07FE03FFCN0LF0038,M03CJ0LF8N01JFI01C,M038K0IF87X0E,M07P0EI03F8R07,M0EO01CI0FFER07,L01CO038003F1FR038,L01CO07I07807CQ01C,L038O0E001E001ER0C,L03O01C003CI0FR0E,L07O0380078I038Q06,L06O03001EJ01CQ07,L0EO03003CK0FQ03,L0CO03C0F8K078P038,K01CO01FFEL03CP018,K018P07F8M0EP018,K018g07P01C,K038g03CP0C,K038g01EP0C,K03CgG0FP0C,K03FCg078N07E,K03FFCY01CM07FE,K031FFCY0EL07FFE,K0301FF8X07K03FF0E,K03001FFX03CI01FF80E,K03I01FCW01EI0FF800E,K03J03F8W0F003FCI0E,K03K0FEW0381FEJ0E,K03K01F8FCQ04001C7FK0E,K038K07IF7FO06I0FF8K0E,K038K01F87FFCN03I07CL0E,K038L0E03C1EN0180038K01E,K038L0E01807FN0E001CK01E,K03CL0E01007FCM07001CK01C,K03CL0EJ031EM03801CK01C,K03CL0EL07M01C01CK03C,K01EL06L03N0E01CK03C,K01EL07L038I03I07038K078,K01FL03FCJ018I018003FFL078,L0FL01FCJ018J0C001FEL0F8,L0F8L07CJ03FJ0E001F8K01F8,L0FCM0EJ03FCI070018L01F,L07CM06J031EI038038L03F,L07EM078K07I01C038L07E,L03FM03EEJ031800E0FM07E,L03F8L01FEJ038C007FEM0FC,L01FCM07FJ0187007FCL01FC,L01FEN07J0183803FM03F8,M0FFN03C700181C07N07F,M07F8M01FF00380E0FN0FF,M03FCN07F003007BEM03FE,M03FEO03807807FCM07FC,M01FF8N01C0FE0FFN0FF8,N0FFCO0KFEN03FF8,N07FFO07F87F8N07FF,N03FF8N01EQ01FFE,N01FFEgG03FFC,O0IF8g0IF8,O07FFEY03FFE,O03IF8W01IFC,P0IFEW07IF8,P07IFCU03IFE,P01JF8S01JFC,Q0KF8R0KF,Q03KF8P0KFE,R0LFCM01LF8,R03MFCI03MFE,S0YF,S01WFC,T07UFE,U0UF,V0SF8,W0QF,X03MFE,gG0IF8,,:::::::::::::::::::::::::::::::::::::::::^FS',
	            '^FO30,380^GB750,2,2^FS',
	            '^FO30,400^A0N,40,40^FDEtiqueta/UN^FS',
	            `^FO600,400^A0N,40,40^FDCaixa: ${caixa.id}^FS`,
	            '^FO30,450^GB750,2,2^FS'
	        ];
	
	        let y = 480;
	        const step = 50;
	        Object.entries(caixa.itens).forEach(([sku, qtd]) => {
	            linhas.push(`^FO25,${y}^A0N,30,30^FD ${sku} / ${qtd}^FS`);
	            y += step;
	        });
	
	        linhas.push('^XZ');
	        const zpl = linhas.join('\n');
	        
	        console.log("Enviando ZPL da caixa para a impressora:", zpl);
	        // MODIFICADO: Em vez de baixar, envia para a impressora
	        enviarParaImpressora(zpl);
	    }
	    
	    // O RESTANTE DO SEU C√ìDIGO `embalar.js` PERMANECE IGUAL...
	    // COLE AS FUN√á√ïES `fecharCaixaAtiva`, `abrirNovaCaixa`, `biparEmbalagem`, etc., aqui.
	    // A √∫nica altera√ß√£o necess√°ria foi nas duas fun√ß√µes acima.
	    // ...
	    // ...COLE O RESTANTE DO C√ìDIGO AQUI...
	    // ...
	
	    // NO FINAL DO ARQUIVO, DENTRO DO EVENTO DOMContentLoaded, ADICIONE A INICIALIZA√á√ÉO DA IMPRESSORA
	    
	    // Inicializa√ß√£o
	    setupImpressora(); // <<< NOVA LINHA
	    inicializarPopoversDeImagem();
	    await carregarCaixasSalvas();
	    await buscarDadosEmbalagem(); 
	    setInterval(buscarDadosEmbalagem, 10000); // Aumentei o intervalo para 10s para n√£o sobrecarregar
	    
	    // ... (cole o restante do seu c√≥digo, como a fun√ß√£o handleFinalizarEmbalagem)
	});

[migrations]

[classes]
__init__.py=from .controllers import AgendamentoController, DatabaseController
	from .models import Agendamento, Produto, Composicao
	from .views import AgendamentoView
	from .services import PdfService

[classes/models]
AgendamentoModel.py=# agendamentos_web/classes/models/AgendamentoModel.py
	
	from .ProdutoModel import Produto
	from datetime import datetime
	
	class Agendamento:
	    """ Classe feita para gerenciar os dados de um agendamento """
	    def __init__(self, 
	                id_bd:int = 0, 
	                id_agend_ml:str = '', 
	                id_tipo:int = 0,
	                empresa:int = 0,
	                id_mktp:int = 0,
	                colaborador = '',
	                entrada:datetime = datetime.now(),
	                centro_distribuicao: str = ''):
	        """
	        Instancia um objeto da classe Agendamento
	
	        Args
	        -----------    
	            id_bd (int): ID da composi√ß√£o no Banco de dados.
	            id_agend_ml (str): ID do agendamento no ML.
	            id_tipo (int): ID do tipo do agendamento.
	            empresa (int): ID da empresa do agendamento.
	            colaborador (str): Nome do colaborador.
	
	        Vars
	        -----------
	            produtos (list[Produto]): Lista com todos os produtos do agendamento.
	        """
	        self.id_bd = id_bd
	        self.id_agend_ml = id_agend_ml
	        self.id_tipo = id_tipo
	        self.empresa = empresa
	        self.id_mktp = id_mktp
	        self.colaborador = colaborador
	        self.centro_distribuicao = centro_distribuicao
	        if isinstance(entrada, str):
	            try:
	                # Tenta converter a string para datetime (ajuste o formato se o do seu BD for diferente)
	                self.entrada = datetime.strptime(entrada, '%Y-%m-%d %H:%M:%S')
	            except (ValueError, TypeError):
	                # Se a convers√£o falhar, usa a data/hora atual como fallback.
	                self.entrada = datetime.now()
	        elif entrada is None:
	            # Se a entrada for None (valor padr√£o ou do BD), usa a data/hora atual.
	            self.entrada = datetime.now()
	        else:
	            # Se j√° for um objeto datetime, apenas o atribui.
	            self.entrada = entrada
	
	
	        self.produtos:list[Produto] = []
	        self.expedicao_inicio = None
	        self.expedicao_fim = None
	        
	    def __repr__(self):
	        """ Formata como o objeto deve ser transformado em uma string """
	        return f"Agendamento\
	                \n\tID BD: {self.id_bd}\
	                \n\tID agendamento: {self.id_agend_ml}\
	                \n\tID tipo: {self.id_tipo}"
	
	    def to_dict(self):
	        """ Transforma o objeto num dicion√°rio """
	        return {
	            "id_bd": self.id_bd,
	            "id_agend_ml": self.id_agend_ml,
	            "id_tipo": self.id_tipo,
	            "empresa": self.empresa,
	            "id_mktp": self.id_mktp,
	            "colaborador": self.colaborador,
	            "entrada_agend": self.entrada,
	            "produtos": []
	        }
	    
	    def to_tuple(self):
	        """ Transforma o objeto num tuple """
	        return (
	            self.id_agend_ml,
	            self.id_tipo,
	            self.empresa,
	            self.id_mktp,
	            self.colaborador,
	            self.centro_distribuicao,
	            self.entrada
	        )
	
	    def insert_produto(self, produto_obj:Produto = None):
	        """ Insere um produto ao agendamento """
	        self.produtos.append(produto_obj)
	
	    def search_produto(self, att_name:str = '', att_value:str = ''):
	        """ Busca por um produto baseado em um atributo e um valor """
	        return next((i for i in self.produtos if getattr(i, att_name) == att_value), None)
	    
	    def set_id_bd(self, id_bd:int = 0):
	        """ Insere o id do agendamento """
	        self.id_bd = id_bd
	
	    def set_colaborador(self, colaborador:str = ''):
	        """ Insere o colaborador do agendamento """
	        self.colaborador = colaborador
	
	    def set_empresa(self, empresa:int = 0):
	        """ Insere o id da empresa do agendamento """
	        self.empresa = empresa
	        
	    def set_mktp(self, id_mktp:int = 0):
	        """ Insere o id da empresa do agendamento """
	        self.id_mktp = id_mktp
	        
	    def set_id_agend_for_produtos(self):
	        """ Insere o id do agendamento a todos os produtos dentro dele """
	        for produto in self.produtos:
	            produto.set_id_agend(self.id_bd)
	            
	    def set_tipo(self, tipo:int = 0):
	        """ Insere o tipo do agendamento """
	        self.id_tipo = tipo
	
	    # --- CORRE√á√ÉO ADICIONADA AQUI ---
	    def set_centro(self, centro_distribuicao: str = ''):
	        """ Insere o centro de distribui√ß√£o do agendamento """
	        self.centro_distribuicao = centro_distribuicao
	    # --- FIM DA CORRE√á√ÉO ---
	
	    def return_produtos_in_tuple(self):
	        """ Retorna todos os produtos em tuples """
	        return [produto.to_tuple() for produto in self.produtos]
	    
	    def return_all_composicoes_in_tuple(self):
	        """ Retorna todas as composi√ß√µes em tuples """
	        temp_list = []
	        for produto in self.produtos:
	            temp_list += produto.return_composicao_in_tuple()
	        return temp_list
	    
	    def update_pdf_agendamento(self, id_bd: int, pdf_path: str):
	        """
	        Atualiza o PDF de um agendamento existente, deletando dados antigos
	        e inserindo os novos a partir do novo PDF.
	        """
	        try:
	            # 1. Confirma que o agendamento existe
	            agend_data = self.db_controller.get_agendamento_by_bd_id(id_bd)
	            if not agend_data:
	                raise ValueError(f"Agendamento com ID {id_bd} n√£o encontrado.")
	
	            agendamento = Agendamento(id_bd=id_bd) # Objeto simplificado para o processo
	
	            # 2. Deleta produtos e composi√ß√µes antigos (importante a ordem)
	            self.db_controller.delete_composicoes_by_agend_id(id_bd)
	            self.db_controller.delete_produtos_by_agend_id(id_bd)
	
	            # 3. Processa o novo PDF
	            product_data_list = self.pdf_service.parse_pdf_to_dict(pdf_path)
	            
	            for product_data in product_data_list:
	                produto = Produto(
	                    id_agend=agendamento.id_bd, # Vincula ao agendamento existente
	                    id_ml=product_data.get('id_ml', ''),
	                    sku=product_data.get('sku', ''),
	                    nome=product_data.get('nome', ''),
	                    unidades=product_data.get('unidades', 0),
	                    gtin=product_data.get('codigo_uni', ''),
	                    etiqueta=product_data.get('etiqueta', '')
	                )
	                agendamento.insert_produto(produto)
	
	            # 4. Busca dados do Tiny para os novos produtos
	            self.get_prod_data_tiny(agendamento)
	            self.get_comp_tiny(agendamento)
	            self.get_comp_data_tiny(agendamento)
	
	            # 5. Insere os novos produtos e composi√ß√µes no BD
	            self.insert_produto_in_bd(agendamento)
	            
	            # Recarrega o agendamento com os produtos rec√©m-inseridos para obter os IDs
	            # corretos, necess√°rios para inserir as composi√ß√µes.
	            agendamento.produtos = [] # Limpa a lista tempor√°ria
	            self.create_agendamento_from_bd_data(agendamento)
	            
	            self.insert_composicao_in_bd(agendamento)
	
	            # 6. Atualiza as flags de erro de estoque
	            self.set_error_flags_composicoes(agendamento)
	            
	            return True, "PDF atualizado com sucesso."
	
	        except Exception as e:
	            self.view.show_error(f"Falha ao atualizar o PDF do agendamento: {str(e)}")
	            return False, f"Falha ao atualizar o PDF: {str(e)}"
ComposicaoModel.py=class Composicao:
	    """ Classe feita para gerenciar os dados de uma composi√ß√£o """
	    def __init__(self, 
	                id_bd:int = 0, 
	                fk_id_prod:int = 0, 
	                nome:str = '', 
	                sku:str = '',
	                prod_sku:str = '',
	                id_tiny:str = '',
	                gtin:str = '',
	                prod_gtin:str = '',
	                unidades_por_kit:int = 0,
	                unidades_de_kits:int = 0,
	                estoque_tiny:int = 0,
	                localizacao:str = '',
	                estoque_error_flag:str = '',
	                imagem_url:str = ''):
	        """
	        Instancia um objeto da classe Composicao
	
	        Args
	        -----------   
	            id_bd (int): ID da composi√ß√£o no Banco de dados.
	            fk_id_prod (int): ID do produto no Banco de dados.
	            nome (str): Nome da composi√ß√£o.
	            sku (str): Sku da composi√ß√£o.
	            prod_sku (str): Sku do produto que √© pai dessa composi√ß√£o.
	            id_tiny (str): ID da composi√ß√£o no Tiny.
	            gtin (str): GTIN/EAN da composi√ß√£o.
	            prod_gtin (Str): GTIN/EAN do produto que √© pai dessa composi√ß√£o.
	            unidades_por_kit (int): Unidades da composi√ß√£o por unidade do produto.
	            unidades_de_kits (int): Unidades do produto.
	            etiqueta (str): Etiqueta da composi√ß√£o.
	            estoque_error_flag (str): Bandeira que diz se h√° algum erro na quantia de estoque.
	            imagem_url (str): Imagem do anuncio do produto
	
	        Vars
	        -----------
	            unidades_totais (int): Quantidade total de unidades da composi√ß√£o (un. por kit * un. de kits)
	        """
	        self.id_bd = id_bd
	        self.fk_id_prod = fk_id_prod
	        self.nome = nome
	        self.sku = sku
	        self.prod_sku = prod_sku
	        self.id_tiny = id_tiny
	        self.gtin = gtin
	        self.prod_gtin = prod_gtin
	        self.unidades_por_kit = unidades_por_kit  
	        self.unidades_de_kits = unidades_de_kits
	        self.unidades_totais:int = unidades_de_kits * unidades_por_kit 
	        self.estoque_tiny = estoque_tiny
	        self.localizacao = localizacao
	        self.estoque_error_flag = estoque_error_flag
	        self.imagem_url = imagem_url
	
	    def __repr__(self):
	        """ Formata como o objeto deve ser transformado em uma string """
	        return f"\n\t -- Composic√£o -- \
	                \n\t\tID BD: {self.id_bd}\
	                \n\t\tID Prod BD: {self.fk_id_prod}\
	                \n\t\tNome: {self.nome}\
	                \n\t\tSKU: {self.sku}\
	                \n\t\tGTIN: {self.gtin}\
	                \n\t\tLocaliza√ß√£o: {self.localizacao}\
	                \n\t\tUnidades por kit: {self.unidades_por_kit}\
	                \n\t\tUnidades de Kit: {self.unidades_de_kits}\
	                \n\t\tUnidades Totais: {self.unidades_totais}"
	                
	    
	    def to_dict(self):
	        """ Transforma o objeto num dicion√°rio """
	        return {
	            "id_bd": self.id_bd,
	            "fk_id_prod": self.fk_id_prod,
	            "nome": self.nome,
	            "sku": self.sku,
	            "id_tiny": self.id_tiny,
	            "gtin": self.gtin,
	            "unidades_por_kit": self.unidades_por_kit,
	            "unidades_de_kits": self.unidades_de_kits,
	            "unidades_totais": self.unidades_totais,
	            "estoque_tiny": self.estoque_tiny,
	            "localizacao": self.localizacao,
	            "estoque_error_flag": self.estoque_error_flag,
	            "imagem_url": self.imagem_url
	        }
	        
	    def to_dict_for_api(self, attrs:list = []):
	        temp_dict = {}
	        for attr in attrs:
	            temp_dict.update({attr: getattr(self, attr)})
	        return temp_dict
	        
	    def to_tuple(self):
	        """ Transforma o objeto num tuple """
	        return (
	            self.fk_id_prod,
	            self.id_tiny,
	            self.gtin,
	            self.sku,
	            self.nome,
	            self.unidades_por_kit,
	            self.unidades_totais, 
	            self.estoque_tiny, 
	            self.localizacao,
	            self.estoque_error_flag,
	            self.imagem_url
	        )
	    
	    def to_tuple_alteracao(self):
	        """ Transforma o objeto num tuple para enviar √† tabela de altera√ß√£o """
	        return (
	            self.id_bd,
	            self.fk_id_prod,
	            self.id_tiny,
	            self.gtin,
	            self.sku,
	            self.nome
	            )
	        
	    def to_tuple_compra(self):
	        """ Transforma o objeto num tuple para enviar √† tabela de compras """
	        return (
	            self.id_bd,
	            self.fk_id_prod,
	            self.id_tiny,
	            self.gtin,
	            self.sku,
	            self.nome,
	            self.unidades_totais
	            )
	
	    def set_gtin(self, gtin:str = ''):
	        """ Insere o GTIN da composi√ß√£o """
	        if gtin != '':
	            self.gtin = gtin
	        else:
	            self.gtin = "GTIN/EAN n√£o encontrado"
	
	    def set_unidades_por_kit(self, unidades_por_kit:int = 0):
	        """ Insere a quantidade de unidades por kit da composi√ß√£o """
	        self.unidades_por_kit = unidades_por_kit
	
	    def set_estoque_tiny(self, estoque_tiny:int = 0):
	        """ Insere o estoque do tiny da composi√ß√£o """
	        self.estoque_tiny = estoque_tiny
	
	    def set_id_bd(self, id_bd:int = 0):
	        """ Insere o ID da composi√ß√£o """
	        self.id_bd = id_bd
	
	    def set_fk_id_prod(self, fk_id_prod:int = 0):
	        """ Insere o ID do produto pai da composi√ß√£o """
	        self.fk_id_prod = fk_id_prod
	    
	    def set_localizacao(self, localizacao:str = ''):
	        self.localizacao = localizacao
	
	    def set_estoque_error_flag(self, estoque_error_flag):
	        """ Insere a bandeira de estoque da composi√ß√£o """
	        if estoque_error_flag in ['green', 'yellow', 'red']:
	            self.estoque_error_flag = estoque_error_flag
	        else:
	            print("Valor de bandeira inv√°lido")
	            return
	    
	    def set_imagem_url(self, url: str): # NOVO M√âTODO
	        """ Define a URL da imagem para esta composi√ß√£o. """
	        self.imagem_url = url if url else ''
DatabaseModel.py=import mysql.connector
	
	class Database:
	    def __init__(self, user:str, password:str, host:str, port:str, name:str):
	        self.user = user
	        self.password = password
	        self.host = host
	        self.port = port
	        self.name = name
	        self.con = None
	        self.cursor = None
	    
	    def __enter__(self):
	        self.con = mysql.connector.connect(
	            host=self.host, 
	            user = self.user,
	            password=self.password,
	            database=self.name,
	            port=self.port)
	        self.cursor = self.con.cursor()
	
	    def __exit__(self, exc_type, exc_value, exc_traceback):
	        self.cursor.close()
	        self.con.close()
	
	        self.cursor = None
	        self.con = None
	
	    def custom_select_query(self, query:str) -> list|dict:
	        """
	        Processa uma query inteiramente feita pelo usu√°rio
	        
	        Args
	        ----------
	            query (str): Query feita pelo usu√°rio.
	        """
	        if self.con is not None:
	            self.con.cursor.execute(query)
	            return_val = self.con.cursor.fetchall()
	            return return_val
	        
	    def custom_i_u_query(self, query:str, data:list) -> None:
	        """
	        Insere ou altera dados no banco baseado na query e nos dados enviados pelo usu√°rio
	        
	        Args
	        ----------
	            query (str): Query feita pelo usu√°rio.
	            data (list): Lista com os dados que ser√£o inseridos
	        """
	        self.con.cursor.executemany(query, data)
	        self.con.db.commit()
	        print('Dados inseridos/alterados')
	        return
JoinedAgendamentoModel.py=from .AgendamentoModel import Agendamento
	from .JoinedComposicaoModel import JoinedComposicao
	from .ComposicaoModel import Composicao
	
	class JoinedAgendamento:
	    def __init__(self):
	        self.agend_origem = []
	        self.produtos = []
	        self.joined_comps = []
	
	    def insert_agendamento(self, agendamento:Agendamento = None):
	        self.agend_origem.append(agendamento)
	
	    def set_produtos(self):
	        if len(self.agend_origem) > 0:
	            for agend in self.agend_origem:
	                self.produtos += agend.produtos
	
	    def return_comp_grouped(self) -> list[Composicao]:
	        composicoes_dict = {}
	        
	        for produto in self.produtos:
	            for composicao in produto.composicoes:
	                # Usando SKU como chave para agrupamento (pode ser id_tiny ou outro campo √∫nico)
	                key = composicao.sku
	                
	                if key in composicoes_dict:
	                    # Se j√° existe, soma as unidades
	                    existing = composicoes_dict[key]
	                    existing.unidades_totais += composicao.unidades_totais
	                    existing.insert_comp_origem(composicao)
	                    existing.insert_produto_origem(produto)
	                else:
	                    # Se n√£o existe, adiciona ao dicion√°rio
	                    composicoes_dict[key] = JoinedComposicao(composicao.sku, composicao.id_tiny, composicao.estoque_tiny)
	                    composicoes_dict[key].unidades_totais += composicao.unidades_totais
	                    composicoes_dict[key].insert_comp_origem(composicao)
	                    composicoes_dict[key].insert_produto_origem(produto)
	        
	        return list(composicoes_dict.values())
	        
JoinedComposicaoModel.py=from .ComposicaoModel import Composicao
	from .ProdutoModel import Produto
	
	class JoinedComposicao:
	    """ Classe feita para gerenciar os dados da uni√£o de v√°rias composi√ß√µes """
	    def __init__(self,
	                sku:str = '',
	                id_tiny:str = '',
	                estoque_tiny:int = 0):
	        self.sku = sku
	        self.id_tiny = id_tiny
	        self.estoque_tiny = estoque_tiny
	        self.unidades_totais:int = 0
	        self.comp_origem:list[Composicao] = []
	        self.produto_origem:list[Produto] = []
	        self.estoque_error_flag:str = ''
	
	    def __repr__(self):
	        return f"\n\t -- Jun√ß√£o de Composic√µes -- \
	                    \n\t\tSKU: {self.sku}\
	                    \n\t\tUnidades Totais: {self.unidades_totais}"
	    
	    def to_dict(self):
	        return {
	                "sku": self.sku,
	                "id_tiny": self.id_tiny,
	                "unidades_totais": self.unidades_totais,
	                "composicao": [i.to_dict() for i in self.comp_origem],
	                "produtos_origem": [i.to_dict() for i in self.produto_origem],
	                "estoque_error_flag": self.estoque_error_flag
	            }
	
	    def insert_comp_origem(self, composicao:Composicao = None):
	        self.comp_origem.append(composicao)
	
	    def insert_produto_origem(self, produto:Produto = None):
	        self.produto_origem.append(produto)
	
	    def set_flag_in_joined_comp(self):
	        joined_comp_flag = ''
	        if self.unidades_totais > self.estoque_tiny:
	            joined_comp_flag = 'red'
	        elif self.unidades_totais < self.estoque_tiny:
	            joined_comp_flag = 'green'
	
	        if joined_comp_flag == 'green':
	            for i in self.comp_origem:
	                i.set_estoque_error_flag('green')
	        else:
	            for composicao in self.comp_origem:
	                if composicao.unidades_totais > composicao.estoque_tiny:
	                    composicao.set_estoque_error_flag('red')
	                elif composicao.unidades_totais == composicao.estoque_tiny:
	                    composicao.set_estoque_error_flag('yellow')            
ProdutoModel.py=from .ComposicaoModel import Composicao
	
	class Produto:
	    """ Classe feita para gerenciar os dados de um produto """
	    def __init__(self, 
	                id_agend:int = 0,
	                id_bd:int = 0,
	                id_tiny:str = '',
	                id_ml:str = '',
	                nome:str = '',
	                sku:str = '',
	                gtin:str = '',
	                etiqueta:str = '',
	                unidades:int = 0,
	                estoque_error_flag:str = '',
	                imagem_url:str = '',
	                id_prod_ml:str = '' # <--- Novo
	                ):
	        """
	        Instancia um objeto da classe Produto
	
	        Args
	        -----------   
	            id_agend (int): ID do agendamento no Banco de dados.
	            id_bd (int): ID do produto no Banco de dados.
	            id_tiny (str): ID do produto no Tiny.
	            id_ml (str): ID do produto no ML.
	            nome (str): Nome do produto.
	            sku (str): Sku do produto.
	            gtin (str): GTIN/EAN do produto.
	            etiqueta (str): Etiqueta do produto.
	            unidades (int): Unidades do produto.
	            estoque_error_flag (str): Bandeira que diz se h√° algum erro na quantia de estoque.
	
	        Vars
	        -----------
	            is_kit (bool): √â ou n√£o um kit
	        """
	        self.id_agend = id_agend
	        self.id_bd = id_bd
	        self.id_tiny = id_tiny
	        self.id_ml = id_ml
	        self.nome = nome
	        self.sku = sku
	        self.gtin = gtin
	        self.etiqueta = etiqueta
	        self.unidades = unidades
	        self.estoque_error_flag = estoque_error_flag
	        self.is_kit:bool = False 
	        self.imagem_url = imagem_url
	        self.id_prod_ml = id_prod_ml # <--- Novo
	        
	        self.composicoes:list[Composicao] = []
	
	    def __repr__(self):
	        """ Formata como o objeto deve ser transformado em uma string """
	        return f"\n -- Produto -- \
	                \n\tID BD: {self.id_bd}\
	                \n\tID Agend BD: {self.id_agend}\
	                \n\tID Tiny: {self.id_tiny}\
	                \n\tNome: {self.nome}\
	                \n\tSKU: {self.sku}\
	                \n\tGTIN: {self.gtin}\
	                \n\tEtiqueta: {self.etiqueta}\
	                \n\t√â kit: {self.is_kit}\
	                \n\tUnidades: {self.unidades}"
	    
	    def to_dict(self):
	        """ Transforma o objeto num dicion√°rio """
	        return {
	            "id_bd": self.id_bd,
	            "id_tiny": self.id_tiny,
	            "id_ml": self.id_ml,
	            "nome": self.nome,
	            "sku": self.sku,
	            "gtin": self.gtin,
	            "etiqueta": self.etiqueta,
	            "unidades": self.unidades,
	            "estoque_error_flag": self.estoque_error_flag,
	            "imagem_url": self.imagem_url,
	            "id_prod_ml": self.id_prod_ml, # <--- Novo
	            "composicao": []
	        }
	        
	    def to_tuple(self):
	        """ Transforma o objeto num tuple """
	        return (
	            self.id_agend,           # id_agend_prod
	            self.id_ml,              # id_prod_ml  (campo geral, ML ou Shopee)
	            self.id_tiny,            # id_prod_tiny
	            self.sku,                # sku_prod
	            self.gtin,               # gtin_prod
	            self.unidades,           # unidades_prod
	            self.is_kit,             # e_kit_prod
	            self.nome,               # nome_prod
	            self.estoque_error_flag, # estoque_flag_prod
	            self.imagem_url          # imagem_url_prod
	        )
	
	    
	    
	    def set_id_tiny(self, id_tiny:str = ''):
	        """ Insere o id do produto no Tiny """
	        self.id_tiny = id_tiny
	
	    def set_gtin(self, gtin:str = ''):
	        """ Insere o GTIN/EAN """
	        if gtin != '':
	            self.gtin = gtin
	        else:
	            self.gtin = "GTIN/EAN n√£o encontrado"
	
	    def set_is_kit(self, is_kit:bool = False):
	        """ Insere se √© ou n√£o um kit  """
	        if is_kit == 'K':
	            self.is_kit = True
	        else:
	            self.is_kit = False
	
	    def insert_composicao(self, composicao_obj:Composicao = None):
	        """ Insere uma composi√ß√£o no objeto """
	        self.composicoes.append(composicao_obj)
	
	    def search_composicao(self, att_name:str = '', att_value:str = ''):
	        """ Busca por uma composi√ß√£o baseado em um atributo e um valor """
	        return next((i for i in self.composicoes if getattr(i, att_name) == att_value), None)
	    
	    def set_id_bd(self, id_bd:int = 0):
	        """ Insere o id do produto no banco de dados """
	        self.id_bd = id_bd
	
	    def set_id_agend(self, id_agend:int = 0):
	        """ Insere o id do agendamento """
	        self.id_agend = id_agend
	
	    def set_estoque_error_flag(self):
	        """ V√™ as bandeiras em sua composi√ß√£o e, a partir delas, decide qual ser√° a sua """
	        flags = [i.estoque_error_flag for i in self.composicoes]
	        if 'red' in flags:
	            self.estoque_error_flag = 'red'
	        elif 'yellow' in flags:
	            self.estoque_error_flag = 'yellow'
	        else:
	            self.estoque_error_flag = 'green'
	
	    def set_imagem_url(self, url: str): # <-- NOVO M√âTODO
	        """ Define a URL da imagem para este produto. """
	        self.imagem_url = url if url else ''
	        
	    def set_id_bd_for_composicoes(self):
	        """ Insere o id_bd do produto em todas as suas composi√ß√µes """
	        for composicao in self.composicoes:
	            composicao.set_fk_id_prod(self.id_bd)
	    
	    def return_composicao_in_tuple(self):
	        """ Retorna toda a composi√ß√£o do produto numa lista de tuples """
	        return [comp.to_tuple() for comp in self.composicoes]
	
__init__.py=from .AgendamentoModel import Agendamento
	from .ProdutoModel import Produto
	from .ComposicaoModel import Composicao
	from .JoinedComposicaoModel import JoinedComposicao
	from .DatabaseModel import Database
	from .JoinedAgendamentoModel import JoinedAgendamento

[classes/services]
PdfService.py=# PdfService.py
	import os
	import pandas as pd
	import camelot
	from typing import Dict, List
	
	class PdfService:
	    """Handles all PDF parsing and raw data extraction"""
	    TEMP_FOLDER = 'temp'
	
	    @staticmethod
	    def parse_pdf_to_dict(pdf_path: str, delete_pdf: bool = False) -> List[Dict]:
	        """
	        Extract product data from PDF and return as list of dicts.
	
	        - Tenta usar colunas 'PRODUTO', 'UNIDADES' e 'ETIQUETA #' (ou varia√ß√µes).
	        - Faz fallback para parsing do texto de 'PRODUTO' quando necess√°rio.
	        """
	        try:
	            os.makedirs(PdfService.TEMP_FOLDER, exist_ok=True)
	
	            # L√™ o PDF e exporta CSVs tempor√°rios (mant√©m seu fluxo atual)
	            tables = camelot.read_pdf(pdf_path, pages='all')
	            if tables.n == 0:
	                raise ValueError("Nenhuma tabela reconhecida no PDF.")
	
	            base = os.path.join(PdfService.TEMP_FOLDER, 'pdf_data')
	            tables.export(base + '.csv', f='csv')
	
	            # Junta todas as p√°ginas
	            dfs = []
	            for i in range(1, tables.n + 1):
	                csv_path = f'{PdfService.TEMP_FOLDER}/pdf_data-page-{i}-table-1.csv'
	                if not os.path.exists(csv_path):
	                    # Em alguns PDFs o √≠ndice pode variar; ignore se faltar
	                    continue
	                df = pd.read_csv(csv_path, thousands=',')
	                dfs.append(df)
	                os.remove(csv_path)
	
	            if not dfs:
	                raise ValueError("Falha ao montar DataFrame: nenhum CSV intermedi√°rio gerado.")
	
	            combined_df = pd.concat(dfs, ignore_index=True)
	
	            # Normaliza nomes de colunas (case-insensitive)
	            norm_map = {c: str(c).strip().upper().replace('  ', ' ') for c in combined_df.columns}
	            inv_map = {v: k for k, v in norm_map.items()}  # valor normalizado -> nome original
	
	            def get_col(*candidates: str):
	                for cand in candidates:
	                    if cand in inv_map:
	                        return inv_map[cand]
	                return None
	
	            col_produto  = get_col('PRODUTO')
	            col_unidades = get_col('UNIDADES', 'QTD', 'QUANTIDADE')
	            col_etiqueta = get_col('ETIQUETA #', 'ETIQUETA#', 'ETIQUETA')
	
	            if col_produto is None:
	                raise ValueError("Coluna 'PRODUTO' n√£o encontrada no PDF.")
	
	            products: List[Dict] = []
	
	            for _, row in combined_df.iterrows():
	                raw_prod = str(row.get(col_produto, '') or '')
	                # Original: substitui quebras por espa√ßo e espa√ßos por v√≠rgula, depois split
	                product_str = raw_prod.replace('\n', ' ').replace(' ', ',')
	                parts = product_str.split(',')
	
	                # Campos com fallback seguro
	                id_ml = parts[2] if len(parts) > 2 else ''
	                codigo_uni = parts[5] if len(parts) > 5 else ''
	                sku = parts[7] if len(parts) > 7 else ''
	                nome = ' '.join(parts[8:]).replace(',', ' ').strip() if len(parts) > 8 else raw_prod.strip()
	
	                # UNIDADES
	                unidades_val = 0
	                if col_unidades is not None:
	                    try:
	                        unidades_val = int(str(row[col_unidades]).strip().replace(',', ''))
	                    except Exception:
	                        # tenta como float, depois int
	                        try:
	                            unidades_val = int(float(str(row[col_unidades]).replace(',', '.')))
	                        except Exception:
	                            unidades_val = 0
	
	                # ETIQUETA (preferir coluna expl√≠cita; fallback para parts[2])
	                etiqueta_val = id_ml
	                if col_etiqueta is not None:
	                    etq_raw = str(row[col_etiqueta])
	                    # se vier no formato "ETIQUETA #12345"
	                    if '#' in etq_raw:
	                        etiqueta_val = etq_raw.split('#')[-1].strip()
	                    else:
	                        etiqueta_val = etq_raw.strip() or id_ml
	
	                product_data = {
	                    'id_ml': id_ml,
	                    'codigo_uni': codigo_uni,
	                    'sku': sku,
	                    'nome': nome,
	                    'unidades': unidades_val,
	                    'etiqueta': etiqueta_val,
	                }
	
	                products.append(product_data)
	
	            if delete_pdf and os.path.exists(pdf_path):
	                os.remove(pdf_path)
	
	            return products
	
	        except Exception as e:
	            raise ValueError(f"PDF parsing failed: {str(e)}")
	
SpreadsheetService.py=import os
	import pandas as pd
	from typing import List, Dict, Any
	
	class SpreadsheetService:
	    """Manipula a leitura e processamento de planilhas (Excel, CSV Magalu, etc.)."""
	
	    @staticmethod
	    def parse_spreadsheet_to_dict(path: str) -> List[Dict[str, Any]]:
	        """
	        Retorna uma lista de dicts com esquema unificado:
	        {
	          item_id, sku, sku_variacao, sku_principal,
	          produto, nome_variacao, unidades (int), id_prod_ml
	        }
	        """
	        ext = os.path.splitext(path)[1].lower()
	
	        if ext in (".xls", ".xlsx"):
	            # ---- Excel (marketplaces) ----
	            try:
	                df = pd.read_excel(path, engine="openpyxl")
	            except Exception:
	                df = pd.read_excel(path)
	
	            # normaliza nomes (lower)
	            norm = {c: str(c).strip().lower() for c in df.columns}
	            df.rename(columns={orig: norm for orig, norm in norm.items()}, inplace=True)
	
	            def pick(*cands):
	                for c in cands:
	                    if c in df.columns:
	                        return c
	                return None
	
	            col_item_id      = pick('id do item', 'item_id', 'itemid')
	            col_produto      = pick('produto', 'nome do produto', 'product')
	            col_variacao_id  = pick('id da varia√ß√£o', 'id da variacao', 'variacao_id')
	            col_nome_var     = pick('nome da varia√ß√£o', 'nome da variacao', 'nome_variacao')
	            col_sku_var      = pick('sku da varia√ß√£o', 'sku da variacao', 'sku_variacao', 'sku')
	            col_sku_princ    = pick('sku principle', 'sku principal', 'sku_principal')
	            col_unidades     = pick('unidades (pedido pago)', 'unidades', 'qtd', 'quantidade', 'mandar')
	            col_etiqueta     = pick('etiqueta #', 'etiqueta#', 'etiqueta', 'etiqueta full', 'id_prod_ml')
	
	            if col_unidades is None:
	                raise ValueError("Coluna de quantidade n√£o encontrada no Excel.")
	
	            df = df[df[col_unidades].notna()].copy()
	
	            # unidades -> int robusto (suporta "1.234" / "1,5")
	            df['_unidades'] = (
	                pd.to_numeric(
	                    df[col_unidades].astype(str)
	                    .str.replace('.', '', regex=False)    # milhar
	                    .str.replace(',', '.', regex=False),  # decimal
	                    errors='coerce'
	                ).fillna(0).astype(int)
	            )
	
	            # id_prod_ml da coluna Etiqueta (prefer√™ncia), com fallback
	            if col_etiqueta is not None:
	                df['_id_prod_ml'] = (
	                    df[col_etiqueta].astype(str)
	                    .apply(lambda s: s.split('#')[-1].strip() if '#' in s else s.strip())
	                )
	            else:
	                df['_id_prod_ml'] = ''  # ser√° vazio se n√£o existir no Excel
	
	            # agrega por chaves presentes
	            group_cols = [c for c in [col_item_id, col_sku_var, col_sku_princ, col_produto, col_nome_var] if c]
	            if group_cols:
	                df_agg = df.groupby(group_cols, as_index=False).agg({
	                    '_unidades': 'sum',
	                    '_id_prod_ml': 'first'
	                })
	            else:
	                # sem colunas-chave, evita groupby
	                df_agg = df.copy()
	                df_agg['_id_prod_ml'] = df_agg['_id_prod_ml']
	                df_agg['_unidades']   = df_agg['_unidades']
	
	            # sku can√¥nico: prioriza varia√ß√£o > principal
	            def canonical_sku(row):
	                if col_sku_var and str(row.get(col_sku_var, '')).strip():
	                    return str(row[col_sku_var]).strip()
	                if col_sku_princ and str(row.get(col_sku_princ, '')).strip():
	                    return str(row[col_sku_princ]).strip()
	                return ''
	
	            out = []
	            for _, r in df_agg.iterrows():
	                out.append({
	                    'item_id':      (str(r[col_item_id]).strip() if col_item_id and pd.notna(r.get(col_item_id)) else ''),
	                    'sku':          canonical_sku(r),
	                    'sku_variacao': (str(r[col_sku_var]).strip() if col_sku_var and pd.notna(r.get(col_sku_var)) else ''),
	                    'sku_principal':(str(r[col_sku_princ]).strip() if col_sku_princ and pd.notna(r.get(col_sku_princ)) else ''),
	                    'produto':      (str(r[col_produto]).strip() if col_produto and pd.notna(r.get(col_produto)) else ''),
	                    'nome_variacao':(str(r[col_nome_var]).strip() if col_nome_var and pd.notna(r.get(col_nome_var)) else ''),
	                    'unidades':     int(r['_unidades']),
	                    'id_prod_ml':   str(r['_id_prod_ml']).strip(),
	                })
	            return out
	
	        elif ext == ".csv":
	            # ---- CSV Magalu ----
	            try:
	                df = pd.read_csv(path, sep=';')
	            except UnicodeDecodeError:
	                df = pd.read_csv(path, sep=';', encoding='latin-1')
	
	            norm = {c: str(c).strip().lower() for c in df.columns}
	            df.rename(columns={orig: norm for orig, norm in norm.items()}, inplace=True)
	
	            col_sku      = 'sku' if 'sku' in df.columns else None
	            col_produto  = 'nome do produto' if 'nome do produto' in df.columns else ('produto' if 'produto' in df.columns else None)
	            col_unidades = 'mandar' if 'mandar' in df.columns else ('unidades' if 'unidades' in df.columns else None)
	
	            if not all([col_sku, col_produto, col_unidades]):
	                raise ValueError("CSV Magalu precisa de: SKU, Nome do Produto, e mandar/unidades.")
	
	            df['_unidades'] = pd.to_numeric(df[col_unidades], errors='coerce').fillna(0).astype(int)
	            df = df[df['_unidades'] > 0].copy()
	
	            out = [{
	                'item_id':      '',
	                'sku':          str(r[col_sku]).strip(),
	                'sku_variacao': '',
	                'sku_principal':'',
	                'produto':      str(r[col_produto]).strip(),
	                'nome_variacao':'',
	                'unidades':     int(r['_unidades']),
	                'id_prod_ml':   ''  # CSV padr√£o n√£o traz Etiqueta
	            } for _, r in df.iterrows()]
	            return out
	
	        else:
	            raise ValueError(f"Formato n√£o suportado pelo parser: {ext}")
	
__init__.py=from .PdfService import PdfService
	from .SpreadsheetService import SpreadsheetService

[classes/controllers]
AgendamentoController.py=from classes.models import Agendamento, Produto, Composicao, JoinedComposicao, JoinedAgendamento
	from classes.views import AgendamentoView
	from classes.services import PdfService, SpreadsheetService
	from .DatabaseController import DatabaseController
	from datetime import datetime
	import time, json
	from base_jp_lab import Caller
	from uuid import uuid4
	
	class AgendamentoController:
	    def __init__(self, db_controller:DatabaseController = None, caller_obj:Caller = None):
	        self.agendamentos = []
	        self.view = AgendamentoView()
	        self.pdf_service = PdfService()
	        self.csv_service = SpreadsheetService
	        self.db_controller = db_controller
	        self.caller = caller_obj
	
	    #Busca nova chave Access Token
	    #print(api_token_db(access_obj,))
	
	    def insert_agendamento(self, id_bd:int = 0, id_agend_ml:str = '', id_tipo:int = 0, empresa:int = 0, id_mktp:int = 0, colaborador = '', entrada:datetime = None, centro_distribuicao:str = ''):
	        self.agendamentos.append(Agendamento(id_bd, id_agend_ml, id_tipo, empresa, id_mktp, colaborador, entrada, centro_distribuicao))
	
	    def insert_agendamento_in_bd(self, agendamento:Agendamento = None):
	        self.db_controller.insert_agendamento_in_bd(agendamento.to_tuple())
	
	    def search_agendamento(self, att_name:str = '', att_value:str = ''):
	        return next((i for i in self.agendamentos if str(getattr(i, att_name)) == att_value), None)
	    
	    def insert_produto(self, agendamento:Agendamento = None,
	                    id_bd:int = 0, 
	                    id_tiny:str = '', 
	                    id_ml:str = '', 
	                    nome:str = '', 
	                    sku:str = '', 
	                    gtin:str = '', 
	                    unidades:int = 0, 
	                    estoque_error_flag:str = '',
	                    imagem_url:str = ''):
	        produto = Produto(id_agend=agendamento.id_bd, id_bd=id_bd, id_tiny=id_tiny, id_ml=id_ml, nome=nome, sku=sku, gtin=gtin, unidades=unidades, estoque_error_flag=estoque_error_flag, imagem_url=imagem_url) 
	        agendamento.insert_produto(produto)
	
	    def insert_produto_in_bd(self, agendamento:Agendamento = None):
	        self.db_controller.insert_produto_in_bd(agendamento.return_produtos_in_tuple())
	
	    def search_produto(self, agendamento:Agendamento, att_name:str = '', att_value:str = ''):
	        return next((i for i in agendamento.produtos if str(getattr(i, att_name)) == att_value), None)
	
	    def insert_composicao(self, produto:Produto = None, 
	                        id_bd:int = 0, 
	                        fk_id_prod:int = 0, 
	                        nome:str = '', 
	                        sku:str = '',
	                        id_tiny:str = '',
	                        gtin:str = '',
	                        unidades_por_kit:int = 0,
	                        unidades_de_kits:int = 0,
	                        estoque_tiny:int = 0,
	                        localizacao:str = '',
	                        estoque_error_flag:str = ''):
	        composicao = Composicao(id_bd=id_bd, fk_id_prod=fk_id_prod, nome=nome, sku=sku, prod_sku=produto.sku, id_tiny=id_tiny, gtin=gtin, prod_gtin=produto.gtin, unidades_por_kit=unidades_por_kit, unidades_de_kits=unidades_de_kits, estoque_tiny=estoque_tiny, localizacao=localizacao, estoque_error_flag=estoque_error_flag)
	        produto.insert_composicao(composicao)
	
	    def insert_composicao_in_bd(self, agendamento:Agendamento = None):
	        self.db_controller.insert_composicao_in_bd(agendamento.return_all_composicoes_in_tuple())
	
	    def insert_composicao_alteracao_in_bd(self, produto:Produto = None, comp_list_dict:list[dict] = []):
	        comp_to_change = [produto.search_composicao('id_bd', i['id_bd']) for i in comp_list_dict]
	        self.db_controller.insert_alteracao_in_bd([i.to_tuple_alteracao() for i in comp_to_change])
	
	    def insert_composicao_compras_in_bd(self, produto:Produto = None, comp_list_dict:list[dict] = []):
	        comp_to_change = [produto.search_composicao('id_bd', i['id_bd']) for i in comp_list_dict]
	        self.db_controller.insert_compras_in_bd([i.to_tuple_compra() for i in comp_to_change])
	
	    def search_composicao(self, produto:Produto, att_name:str = '', att_value:str = ''):
	        return next((i for i in produto.composicoes if str(getattr(i, att_name)) == att_value), None)
	
	    def create_agendamento_from_pdf(self, 
	                                    pdf_path: str, 
	                                    id_agend_ml: str, 
	                                    id_tipo: int, 
	                                    empresa: int, 
	                                    id_mktp: int,
	                                    colaborador: str,
	                                    centro_distribuicao: None) -> Agendamento:
	        """Create complete Agendamento with Produtos from PDF"""
	        try:
	            # Create base agendamento
	            agendamento = Agendamento(
	                id_agend_ml=id_agend_ml,
	                id_tipo=id_tipo,
	                empresa=empresa,
	                id_mktp=id_mktp,
	                centro_distribuicao=centro_distribuicao,
	                colaborador=colaborador
	            )
	            
	            # Parse PDF
	            product_data_list = self.pdf_service.parse_pdf_to_dict(pdf_path)
	            
	            # Create products and add to agendamento
	            for product_data in product_data_list:
	                produto = Produto(
	                    id_ml=product_data['id_ml'],
	                    sku=product_data['sku'],
	                    nome=product_data['nome'],
	                    unidades=product_data['unidades'],
	                    gtin=product_data['codigo_uni'],
	                    etiqueta=product_data['etiqueta']
	                )
	                agendamento.insert_produto(produto)
	                
	                # For now assume simple products (no composition)
	                # You would add composition logic here if needed
	            
	            self.agendamentos.append(agendamento)
	            self.view.show_agendamento_created(agendamento)
	            return agendamento
	            
	        except Exception as e:
	            self.view.show_error(f"Failed to create agendamento: {str(e)}")
	            raise
	        
	    
	    def create_agendamento_from_excel(self,
	                                  excel_path: str,
	                                  id_tipo: int,
	                                  empresa: int,
	                                  id_mktp: int,
	                                  colaborador: str,
	                                  upload_uuid: str) -> Agendamento:
	        """
	        Cria um Agendamento com Produtos e Composi√ß√µes a partir de um arquivo
	        (Excel ou CSV Magalu).
	        """
	        try:
	            agendamento = Agendamento(
	                id_agend_ml=upload_uuid,
	                id_tipo=id_tipo,
	                empresa=empresa,
	                id_mktp=id_mktp,
	                colaborador=colaborador
	            )
	
	            # Parse gen√©rico (detecta extens√£o)
	            rows = SpreadsheetService.parse_spreadsheet_to_dict(excel_path)
	            print(">>> DEBUG primeira linha:", rows[0])   # DEBUG
	            for row in rows:
	                # --- fluxo Excel (.xlsx/.xls) ---
	                if 'sku_variacao' in row:
	                    sku       = row['sku_variacao'] if row['sku_variacao'] != '-' else (row.get('sku_principal') or 'SKU n√£o encontrado')
	                    nome      = row.get('produto', '')
	                    unidades  = int(row.get('unidades', 0))
	                    # UNIFICA√á√ÉO: tenta usar etiqueta (Shopee); se n√£o tiver, cai pro item_id
	                    id_ml     = str(row.get('id_prod_ml') or row.get('Etiqueta Full') or row.get('item_id') or '').strip()
	
	                # --- fluxo CSV Magalu (.csv) ---
	                elif 'sku' in row:
	                    sku       = row['sku']
	                    nome      = row.get('produto', '')
	                    unidades  = int(row.get('unidades', 0))
	                    id_ml     = ''  # CSV n√£o tem etiqueta/id do item
	                else:
	                    # linha inesperada: pula
	                    continue
	
	                produto = Produto(
	                    id_ml    = id_ml,   # <--- sempre preenche o campo √∫nico
	                    nome     = nome,
	                    sku      = sku,
	                    unidades = unidades
	                )
	                agendamento.insert_produto(produto)
	
	
	            self.agendamentos.append(agendamento)
	            self.view.show_agendamento_created(agendamento)
	            return agendamento
	
	        except Exception as e:
	            self.view.show_error(f"Failed to create agendamento: {str(e)}")
	            raise
	
	    def create_agendamento_from_bd_data(self, agendamento:Agendamento = None):
	        if agendamento is None:
	            db_resp = self.db_controller.get_all_agendamentos()
	            if type(db_resp) is tuple:
	                # Este caso provavelmente n√£o acontece, mas mantendo a l√≥gica
	                self.insert_agendamento(db_resp[0], db_resp[1], db_resp[2], db_resp[3], db_resp[4], db_resp[5], db_resp[7], db_resp[6])
	            elif type(db_resp) is list:
	                for tuple_data in db_resp:
	                    # CORRE√á√ÉO: Passando todos os par√¢metros do banco de dados com os nomes corretos.
	                    self.insert_agendamento(
	                        id_bd=tuple_data[0],
	                        id_agend_ml=tuple_data[1],
	                        id_tipo=tuple_data[2],
	                        empresa=tuple_data[3],
	                        id_mktp=tuple_data[4],
	                        colaborador=tuple_data[5],
	                        centro_distribuicao=tuple_data[6],
	                        entrada=tuple_data[7]
	                    )
	        else:
	            db_resp = self.get_agendamento_by_id(agendamento)[0]
	            agendamento.id_agend_ml = db_resp[1]
	            agendamento.id_tipo = db_resp[2]
	            agendamento.empresa = db_resp[3]
	            agendamento.id_mktp = db_resp[4]
	            agendamento.colaborador = db_resp[5]
	            agendamento.centro_distribuicao = db_resp[6]
	            entrada_db = db_resp[7] 
	            if isinstance(entrada_db, str):
	                try:
	                    agendamento.entrada = datetime.strptime(entrada_db, '%Y-%m-%d %H:%M:%S')
	                except (ValueError, TypeError):
	                    agendamento.entrada = datetime.now()
	            elif entrada_db is None: # Adiciona esta verifica√ß√£o
	                agendamento.entrada = datetime.now()
	            else:
	                agendamento.entrada = entrada_db
	            produtos = self.return_all_produtos_from_agendamento(agendamento)
	            for prod_bd in produtos:
	                self.insert_produto(agendamento=agendamento, 
	                                    id_bd=prod_bd[0],
	                                    id_tiny=prod_bd[3],
	                                    id_ml=prod_bd[2],
	                                    nome=prod_bd[8],
	                                    sku=prod_bd[4],
	                                    gtin=prod_bd[5],
	                                    unidades=prod_bd[6],
	                                    estoque_error_flag=prod_bd[9],
	                                    imagem_url=prod_bd[10]
	                                    )
	                produto:Produto = agendamento.produtos[-1]
	                composicoes = self.return_all_composicoes_from_produto(produto)
	                for comp_bd in composicoes:
	                    self.insert_composicao(produto=produto,
	                                        id_bd=comp_bd[0],
	                                        fk_id_prod=produto.id_bd,
	                                        nome=comp_bd[5],
	                                        sku=comp_bd[4],
	                                        id_tiny=comp_bd[2],
	                                        gtin=comp_bd[3],
	                                        unidades_por_kit=comp_bd[6],
	                                        unidades_de_kits=produto.unidades,
	                                        estoque_tiny=comp_bd[8],
	                                        localizacao=comp_bd[9],
	                                        estoque_error_flag=comp_bd[10])
	                    
	    def create_agendamento_for_alteracao(self):
	        db_resp = self.db_controller.get_all_agendamentos_in_alteracoes()
	        for resp in db_resp:
	            self.insert_agendamento(resp[0], resp[1], resp[2], resp[3], resp[4], resp[5], resp[6])
	            agendamento = self.get_last_made_agendamento()
	
	            produtos = self.get_produtos_from_alteracoes(agendamento)
	            print(produtos)
	            for prod_bd in produtos:
	                self.insert_produto(agendamento=agendamento, 
	                                    id_bd=prod_bd[0],
	                                    id_tiny=prod_bd[3],
	                                    id_ml=prod_bd[2],
	                                    nome=prod_bd[8],
	                                    sku=prod_bd[4],
	                                    gtin=prod_bd[5],
	                                    unidades=prod_bd[6],
	                                    estoque_error_flag=prod_bd[9]
	                                    )
	                produto:Produto = agendamento.produtos[-1]
	                self.view.display_produto(produto)
	                composicoes = self.get_composicao_from_alteracoes(produto)
	                for comp_bd in composicoes:
	                    self.insert_composicao(produto=produto,
	                                        id_bd=comp_bd[0],
	                                        fk_id_prod=produto.id_bd,
	                                        nome=comp_bd[5],
	                                        sku=comp_bd[4],
	                                        id_tiny=comp_bd[2],
	                                        gtin=comp_bd[3],
	                                        unidades_por_kit=comp_bd[6],
	                                        unidades_de_kits=produto.unidades,
	                                        estoque_tiny=comp_bd[8],
	                                        estoque_error_flag=comp_bd[9])
	                    
	    def create_agendamento_for_compras(self):
	        db_resp = self.db_controller.get_all_agendamentos_in_compras()
	        for resp in db_resp:
	            self.insert_agendamento(resp[0], resp[1], resp[2], resp[3], resp[4], resp[5], resp[6])
	            agendamento = self.get_last_made_agendamento()
	
	            produtos = self.get_produtos_from_compras(agendamento)
	            for prod_bd in produtos:
	                self.insert_produto(agendamento=agendamento, 
	                                    id_bd=prod_bd[0],
	                                    id_tiny=prod_bd[3],
	                                    id_ml=prod_bd[2],
	                                    nome=prod_bd[8],
	                                    sku=prod_bd[4],
	                                    gtin=prod_bd[5],
	                                    unidades=prod_bd[6],
	                                    estoque_error_flag=prod_bd[9]
	                                    )
	                produto:Produto = agendamento.produtos[-1]
	                composicoes = self.get_composicao_from_compras(produto)
	                for comp_bd in composicoes:
	                    self.insert_composicao(produto=produto,
	                                        id_bd=comp_bd[0],
	                                        fk_id_prod=produto.id_bd,
	                                        nome=comp_bd[5],
	                                        sku=comp_bd[4],
	                                        id_tiny=comp_bd[2],
	                                        gtin=comp_bd[3],
	                                        unidades_por_kit=comp_bd[6],
	                                        unidades_de_kits=produto.unidades,
	                                        estoque_tiny=comp_bd[8],
	                                        estoque_error_flag=comp_bd[9])
	                    
	    def create_joined_agendamento(self):
	        join_agend = JoinedAgendamento()
	        for agendamento in self.agendamentos:
	            join_agend.insert_agendamento(agendamento)
	        join_agend.set_produtos()
	        return join_agend
	    
	    def return_joined_composicoes_from_joined_agend(self, join_agend:JoinedAgendamento = None):
	        return join_agend.return_comp_grouped()
	
	    def set_empresa_colaborador_agend(self, agendamento:Agendamento, empresa:int = 0, colaborador:str = ''):
	        agendamento.set_colaborador(colaborador)
	        agendamento.set_empresa(empresa)
	        
	    def get_compras_data(self):
	        return self.db_controller.get_composicoes_from_compras()
	
	    def get_produtos_from_alteracoes(self, agendamento:Agendamento = None):
	        return self.db_controller.get_produtos_from_alteracoes(agendamento.id_bd)
	
	    def get_composicao_from_alteracoes(self, produto:Produto = None):
	        return self.db_controller.get_composicao_from_alteracoes(produto.id_bd)
	
	    def get_produtos_from_compras(self, agendamento:Agendamento = None):
	        return self.db_controller.get_produtos_from_compras(agendamento.id_bd)
	
	    def get_composicao_from_compras(self, produto:Produto = None):
	        return self.db_controller.get_composicao_from_compras(produto.id_bd)
	
	    def get_last_made_agendamento(self) -> Agendamento:
	        return self.agendamentos[-1]
	    
	    def get_last_made_agendamento_in_bd(self):
	        return self.db_controller.get_last_agendamento()
	
	    def get_agendamento_by_id(self, agendamento:Agendamento = None):
	        return self.db_controller.get_agendamento_by_bd_id(agendamento.id_bd)
	
	    def get_prod_data_tiny(self, agendamento:Agendamento = None):
	        for produto in agendamento.produtos:
	            # Faz a chamada √† API
	            resp = self.caller.make_call('produtos', params_add={'codigo': produto.sku})
	            time.sleep(1.25)
	
	            # --- CORRE√á√ÉO IN√çCIO ---
	            # Verifica se a resposta √© um dicion√°rio e se cont√©m a chave 'itens'
	            if isinstance(resp, dict) and 'itens' in resp:
	                itens = resp['itens']
	                if len(itens) == 1 : 
	                    produto.set_gtin(itens[0].get('gtin'))
	                    produto.set_id_tiny(itens[0].get('id'))
	                    produto.set_is_kit(itens[0].get('tipo'))
	                elif len(itens) > 1:
	                    item_ativo = next((i for i in itens if i.get('situacao') == 'A'), None)
	                    if item_ativo is not None:
	                        produto.set_gtin(item_ativo.get('gtin'))
	                        produto.set_id_tiny(item_ativo.get('id'))
	                        produto.set_is_kit(item_ativo.get('tipo'))
	            else:
	                # Se a chamada falhou, loga um aviso e continua para o pr√≥ximo produto
	                print(f"AVISO: Falha ao buscar dados do produto com SKU {produto.sku} no Tiny. Resposta: {resp}")
	            # --- CORRE√á√ÉO FIM ---
	
	
	    def get_comp_tiny(self, agendamento:Agendamento = None):
	        for produto in agendamento.produtos:
	            if produto.is_kit:
	                resp = self.caller.make_call(f'produtos/{produto.id_tiny}/kit')
	                time.sleep(1.25)
	                for r_comp in resp:
	                    self.insert_composicao(produto, fk_id_prod=produto.id_bd, nome=r_comp['produto']['descricao'], sku=r_comp['produto']['sku'], id_tiny=r_comp['produto']['id'], unidades_por_kit=r_comp['quantidade'], unidades_de_kits=produto.unidades)
	            else:
	                self.insert_composicao(produto, 0, produto.id_bd, produto.nome, produto.sku, produto.id_tiny, produto.gtin, 1, produto.unidades, 0, '')
	
	
	    def get_comp_data_tiny(self, agendamento:Agendamento = None):
	        composicoes_dict = self.get_all_composicoes_grouped(agendamento)
	        for id_tiny in composicoes_dict:
	            resp = self.caller.make_call(f'produtos/{id_tiny}')
	            time.sleep(1.25)
	            
	            # --- CORRE√á√ÉO IN√çCIO ---
	            # Verifica se a resposta da API foi bem-sucedida (√© um dicion√°rio)
	            if not isinstance(resp, dict):
	                print(f"AVISO: Falha ao buscar dados da composi√ß√£o com id_tiny {id_tiny}. Resposta: {resp}")
	                # Pula para a pr√≥xima itera√ß√£o do loop
	                continue
	
	            gtin_value = resp.get('gtin')
	            estoque_info = resp.get('estoque')
	
	            # Aplica os valores para todas as composi√ß√µes com o mesmo id_tiny
	            for composicao in composicoes_dict[id_tiny]:
	                composicao.set_gtin(gtin_value if gtin_value is not None else '')
	
	                if estoque_info:
	                    composicao.set_estoque_tiny(estoque_info.get('quantidade', 0))
	                    composicao.set_localizacao(estoque_info.get('localizacao', ''))
	                else:
	                    composicao.set_estoque_tiny(0)
	                    composicao.set_localizacao('Indefinido')
	            # --- CORRE√á√ÉO FIM ---
	
	    def set_id_bd_for_all(self, agendamento:Agendamento = None, last_id_agend:int = 0):
	        agendamento.set_id_bd(last_id_agend)
	        agendamento.set_id_agend_for_produtos()
	
	    def get_all_composicoes_grouped(self, agendamento:Agendamento = None) -> dict:
	        composicoes_dict = {}
	        
	        for produto in agendamento.produtos:
	            for composicao in produto.composicoes:
	                key = composicao.id_tiny
	                
	                if key in composicoes_dict:
	                    composicoes_dict[key].append(composicao)
	                else:
	                    composicoes_dict[key] = [composicao]
	        
	        return composicoes_dict
	    
	    def return_all_produtos_from_agendamento(self, agendamento:Agendamento = None):
	        return self.db_controller.get_all_produtos_from_agendamento(agendamento.id_bd)
	
	    def return_all_composicoes_from_produto(self, produto:Produto = None):
	        return self.db_controller.get_all_composicoes_from_produto(produto.id_bd)
	
	    def return_comp_grouped(self, agendamento:Agendamento = None) -> list[Composicao]:
	        composicoes_dict = {}
	        
	        for produto in agendamento.produtos:
	            for composicao in produto.composicoes:
	                # Usando SKU como chave para agrupamento (pode ser id_tiny ou outro campo √∫nico)
	                key = composicao.sku
	                
	                if key in composicoes_dict:
	                    # Se j√° existe, soma as unidades
	                    existing = composicoes_dict[key]
	                    existing.unidades_totais += composicao.unidades_totais
	                    existing.insert_comp_origem(composicao)
	                    existing.insert_produto_origem(produto)
	                else:
	                    # Se n√£o existe, adiciona ao dicion√°rio
	                    composicoes_dict[key] = JoinedComposicao(composicao.sku, composicao.id_tiny, composicao.estoque_tiny)
	                    composicoes_dict[key].unidades_totais += composicao.unidades_totais
	                    composicoes_dict[key].insert_comp_origem(composicao)
	                    composicoes_dict[key].insert_produto_origem(produto)
	        
	        return list(composicoes_dict.values())
	    
	    def set_error_flags_composicoes(self, agendamento:Agendamento = None):
	        comp_list:list[Composicao] = self.return_comp_grouped(agendamento)
	        for i in comp_list:
	            i.set_flag_in_joined_comp()
	        for i in agendamento.produtos:
	            i.set_estoque_error_flag()
	
	    def update_empresa_colaborador_bd(self, agendamento:Agendamento = None):
	        self.db_controller.update_empresa_colaborador_agend(agendamento.id_bd, agendamento.empresa, agendamento.colaborador)
	    
	
	    def update_agendamento(self, agendamento:Agendamento = None):
	        self.db_controller.update_agendamento(agendamento.id_bd, agendamento.id_agend_ml, agendamento.id_tipo, agendamento.empresa, agendamento.id_mktp, agendamento.colaborador, agendamento.centro_distribuicao)
	
	    def update_quant_compra(self, id_comp:int = 0, quant:int = 0):
	        self.db_controller.update_quant_total_compras(id_comp, quant)
	        self.db_controller.clean_compras(id_comp)
	
	    def return_agend_in_dict(self, agendamento:Agendamento = None):
	        return agendamento.to_dict()
	    
	    def return_produtos_agend_in_dict(self, agendamento:Agendamento = None):
	        return [i.to_dict() for i in agendamento.produtos]
	    
	    def return_comp_produtos_in_dict(self, produto:Produto = None):
	        return [i.to_dict() for i in produto.composicoes]
	    
	    def return_comp_produtos_in_dict_for_api(self, produto:Produto = None, attrs:list = []):
	        return [i.to_dict_for_api(attrs) for i in produto.composicoes]
	    
	    def return_all_in_dict(self, agendamento:Agendamento = None):
	        temp_dict = self.return_agend_in_dict(agendamento)
	        temp_dict['produtos'] = self.return_produtos_agend_in_dict(agendamento)
	        for produto in temp_dict['produtos']:
	            produto['composicao'] = self.return_comp_produtos_in_dict(self.search_produto(agendamento, 'id_bd', str(produto['id_bd'])))
	        return temp_dict
	    
	    def return_joined_agend_in_dict(self, joined_agend:JoinedAgendamento = None):
	        joined_agend_list = []
	        for agendamento in joined_agend.agend_origem:
	            joined_agend_list.append(self.return_all_in_dict(agendamento))
	        return joined_agend_list
	    
	    def return_agend_in_tuple(self, agendamento:Agendamento = None):
	        return agendamento.to_tuple()
	    
	    def return_produtos_agend_in_tuple(self, agendamento:Agendamento = None):
	        return [i.to_tuple() for i in agendamento.produtos]
	    
	    def return_comp_produtos_in_tuple(self, produto:Produto = None):
	        return [i.to_tuple() for i in produto.composicoes]
	    
	    def return_all_composicoes_to_tuple(self, agendamento:Agendamento = None):
	        temp_list = []
	        for produto in agendamento.produtos:
	            temp_list += produto.return_composicao_in_tuple()
	        return temp_list
	    
	    def return_composicoes_to_alteracao(self, comp_list:list[Composicao] = []):
	        return [i.to_tuple_alteracao() for i in comp_list]
	
	    def clear_agendamentos(self):
	        self.agendamentos = []
	
	    def test_connection(self):
	        return self.db_controller.test_connection()
	    
	    
	    def update_pdf_agendamento(self, id_bd: int, colaborador: str, empresa: int, id_mktp: int, id_tipo: int, pdf_path: str, new_id_agend_ml: str, centro_distribuicao: None):
	        try:
	            # 1) carrega todos os agendamentos do DB em mem√≥ria
	            self.create_agendamento_from_bd_data()
	            agendamento_original = self.search_agendamento("id_bd", str(id_bd))
	            if not agendamento_original:
	                return False, f"Agendamento com id_bd={id_bd} n√£o encontrado."
	
	            # --- IN√çCIO DA CORRE√á√ÉO ---
	            # Guarda o centro de distribui√ß√£o original antes de qualquer modifica√ß√£o
	            centro_final = centro_distribuicao if centro_distribuicao is not None else agendamento_original.centro_distribuicao
	            # --- FIM DA CORRE√á√ÉO ---
	
	            # 2) atualiza meta-dados em mem√≥ria, incluindo o novo n√∫mero do pedido
	            agendamento_original.id_agend_ml = new_id_agend_ml
	            agendamento_original.set_colaborador(colaborador)
	            agendamento_original.set_empresa(empresa)
	            agendamento_original.set_mktp(id_mktp)
	            agendamento_original.set_tipo(id_tipo)
	            # --- CORRE√á√ÉO ---
	            # Usa o valor original que acabamos de guardar
	            agendamento_original.set_centro(centro_final)
	
	            # 3) limpa produtos e composi√ß√µes antigas do banco
	            self.db_controller.delete_composicoes_by_agendamento(id_bd)
	            self.db_controller.delete_produtos_by_agendamento(id_bd)
	
	            # 4) reprocessa o PDF usando o novo id_agend_ml
	            self.create_agendamento_from_pdf(
	                pdf_path=pdf_path,
	                id_agend_ml=new_id_agend_ml,
	                id_tipo=id_tipo,
	                empresa=empresa,
	                id_mktp=id_mktp,
	                # --- CORRE√á√ÉO ---
	                # Passa o valor original para o novo agendamento que ser√° criado
	                centro_distribuicao=centro_final,
	                colaborador=colaborador
	            )
	            novo = self.agendamentos[-1]
	            # mant√©m o mesmo id_bd
	            self.set_id_bd_for_all(novo, id_bd)
	
	            # 5) refaz integra√ß√£o com Tiny e reinser√ß√£o no banco
	            self.get_prod_data_tiny(novo)
	            self.get_comp_tiny(novo)
	            self.get_comp_data_tiny(novo)
	            self.insert_produto_in_bd(novo)
	            for tpl in self.return_all_produtos_from_agendamento(novo):
	                produto = self.search_produto(novo, 'etiqueta', tpl[2])
	                if produto:
	                    produto.set_id_bd(tpl[0])
	                    produto.set_id_bd_for_composicoes()
	            self.set_error_flags_composicoes(novo)
	            self.insert_composicao_in_bd(novo)
	
	            # 6) finalmente atualiza o registro de agendamento com o novo n√∫mero
	            self.db_controller.update_agendamento(
	                id_agend_bd=novo.id_bd,
	                id_agend_ml=novo.id_agend_ml,
	                id_agend_tipo=novo.id_tipo,
	                empresa=novo.empresa,
	                id_mktp=novo.id_mktp,
	                colaborador=novo.colaborador,
	                # --- CORRE√á√ÉO ---
	                # Garante que o valor final salvo no banco √© o correto
	                centro_distribuicao=novo.centro_distribuicao
	            )
	
	            return True, "Atualizado com sucesso."
	
	        except Exception as e:
	            return False, f"Erro ao atualizar agendamento: {str(e)}"
	
	
	    def insert_agendamento_in_bd(self, agendamento: Agendamento):
	        if self.db_controller.exists_agendamento_ml(agendamento.id_agend_ml):
	            self.view.show_error(f"J√° existe um agendamento com o n√∫mero {agendamento.id_agend_ml}.")
	            return False
	        self.db_controller.insert_agendamento_in_bd(agendamento.to_tuple())
	        return True
	
	    def get_product_image_url(self, sku: str) -> str:
	        """
	        Busca a URL da imagem de um produto no Tiny a partir do SKU.
	        Retorna uma string vazia se n√£o encontrar.
	        """
	        imagem_url = ""
	        if not sku:
	            return imagem_url
	            
	        try:
	            # Etapa 1: Buscar o ID do produto pelo SKU, considerando apenas produtos ativos
	            params = {'codigo': sku, 'situacao': 'A'}
	            resp_sku = self.caller.make_call("produtos", params_add=params)
	            time.sleep(1.25)
	
	            if resp_sku.get('itens') and len(resp_sku['itens']) > 0:
	                id_tiny = resp_sku['itens'][0].get('id')
	                
	                if id_tiny:
	                    # Etapa 2: Buscar os detalhes do produto pelo ID
	                    resp_details = self.caller.make_call(f"produtos/{id_tiny}")
	                    time.sleep(1.25)
	                    
	                    # Etapa 3: Extrair a URL do primeiro anexo, se existir
	                    if resp_details.get('anexos') and len(resp_details['anexos']) > 0:
	                        print(resp_details)
	                        imagem_url = resp_details['anexos'][0].get('url', "")
	        except Exception as e:
	            # Em um ambiente de produ√ß√£o, seria ideal logar este erro
	            print(f"CONTROLADOR: Erro ao buscar imagem para o SKU {sku}: {e}")
	            return "" # Retorna vazio em caso de qualquer erro
	            
	        return imagem_url
	
	    def excluir_agendamento_completo(self, id_agend_bd: int) -> bool:
	        """
	        Orquestra a exclus√£o de um agendamento e todos os seus dados relacionados.
	        """
	        try:
	            self.db_controller.delete_agendamento_completo(id_agend_bd)
	            return True
	        except Exception as e:
	            print(f"Erro ao excluir agendamento completo (ID: {id_agend_bd}): {e}")
	            return False
	    
	    # --- EXPEDI√á√ÉO: iniciar/finalizar ---
	    def iniciar_expedicao(self, id_agend_bd: int) -> datetime:
	        """
	        Marca o in√≠cio da expedi√ß√£o no BD (se ainda n√£o marcado) e
	        retorna o timestamp usado.
	        """
	        if not self.db_controller:
	            raise RuntimeError("DatabaseController n√£o configurado no AgendamentoController.")
	
	        # Usa timezone do servidor; ajuste se preferir tz expl√≠cita
	        ts = datetime.now()
	        # Atualiza se estiver nulo (sua query j√° tem '... IS NULL')
	        self.db_controller.update_expedicao_inicio(id_agend_bd)
	        return ts
	
	    def finalizar_expedicao(self, id_agend_bd: int):
	        agendamento = self.search_agendamento("id_bd", str(id_agend_bd))
	        if not agendamento:
	            # Se n√£o estiver em mem√≥ria, carrega do banco
	            self.insert_agendamento(id_bd=id_agend_bd)
	            agendamento = self.get_last_made_agendamento()
	            self.create_agendamento_from_bd_data(agendamento)
	        
	        agendamento.set_tipo(2) # 2 = Finalizado
	        self.update_agendamento(agendamento)
	        self.db_controller.update_expedicao_fim(id_agend_bd)
	    
	    def gerar_e_salvar_relatorio_expedicao(self, agendamento_obj):
	        """
	        Busca o relat√≥rio de confer√™ncia, adiciona os dados da expedi√ß√£o
	        e salva o relat√≥rio final e completo no banco de dados.
	        """
	        if not agendamento_obj:
	            return
	
	        # 1. Busca o relat√≥rio de confer√™ncia existente
	        relatorio_str = self.db_controller.get_relatorio_by_agendamento_ml(agendamento_obj.id_agend_ml)
	        
	        # Converte o JSON para um dicion√°rio Python. Se n√£o existir, come√ßa com um vazio.
	        payload = json.loads(relatorio_str) if relatorio_str else {}
	
	        # 2. Adiciona/Atualiza as informa√ß√µes da expedi√ß√£o
	        inicio_exp = agendamento_obj.expedicao_inicio
	        fim_exp = datetime.now() # O fim √© o momento atual
	
	        # Calcula a dura√ß√£o da expedi√ß√£o
	        duracao_exp_str = "N√£o iniciado"
	        if inicio_exp:
	            duracao = fim_exp - inicio_exp
	            duracao_exp_str = f"{duracao.seconds//3600:02d}h {(duracao.seconds%3600)//60:02d}m {duracao.seconds%60:02d}s"
	
	        # Adiciona uma nova se√ß√£o ao relat√≥rio para a expedi√ß√£o
	        payload['InformacoesExpedicao'] = {
	            "DataInicioExpedicao": inicio_exp.strftime("%d/%m/%Y %Hh %Mm %Ss") if inicio_exp else "N√£o registrado",
	            "DataTerminoExpedicao": fim_exp.strftime("%d/%m/%Y %Hh %Mm %Ss"),
	            "DuracaoExpedicao": duracao_exp_str
	        }
	
	        # 3. Adiciona os detalhes das caixas ao relat√≥rio
	        caixas_data = self.db_controller.get_caixas_by_agendamento_ml(agendamento_obj.id_agend_ml)
	        payload['RelatorioExpedicao'] = {
	            "TotalCaixas": len(caixas_data),
	            "Caixas": caixas_data # Salva a lista completa de caixas e seus itens
	        }
	
	        # Garante que as informa√ß√µes gerais tamb√©m estejam presentes, caso n√£o exista relat√≥rio anterior
	        if 'Informacoes' not in payload:
	            payload['Informacoes'] = {
	                "Agendamento": agendamento_obj.id_agend_ml,
	                "Empresa": {1:"Ja√∫ Pesca",2:"Ja√∫ Fishing",3:"L.T. Sports"}.get(agendamento_obj.empresa, ""),
	            }
	        if 'Colaboradores' not in payload:
	            payload['Colaboradores'] = [{"Colaborador": agendamento_obj.colaborador}]
	
	
	        # 4. Converte o dicion√°rio completo de volta para uma string JSON
	        relatorio_final_json = json.dumps(payload, ensure_ascii=False, indent=4) # indent=4 para facilitar a leitura no BD
	
	        # 5. Salva o relat√≥rio final no banco de dados
	        self.db_controller.salvar_relatorio(agendamento_obj.id_agend_ml, relatorio_final_json)
DatabaseController.py=from base_jp_lab import Access
	from datetime import datetime
	class DatabaseController:
	    def __init__(self, access_obj:Access = None):
	        self.access = access_obj
	
	    def get_all_agendamentos(self):
	        return self.access.custom_select_query("SELECT * FROM agendamento")
	    
	    def get_agendamento_by_bd_id(self, id_agend_bd:int = 0):
	        return self.access.custom_select_query("SELECT * FROM agendamento WHERE id_agend = %s", (id_agend_bd,))
	        
	    def insert_agendamento_in_bd(self, agendamento_tuple:tuple = ()):
	        self.access.custom_i_u_query(
	        "INSERT INTO agendamento (id_agend_ml, id_tipo_agend, empresa_agend, id_mktp, colaborador_agend, centro_distribuicao, entrada_agend) VALUES (%s, %s, %s, %s, %s, %s, %s);",
	        [agendamento_tuple])
	
	    def insert_produto_in_bd(self, produtos:list[tuple] = []):
	        self.access.custom_i_u_query("INSERT INTO produtos_agend (id_agend_prod, id_prod_ml, id_prod_tiny, sku_prod, gtin_prod, unidades_prod, e_kit_prod, nome_prod, estoque_flag_prod, imagem_url_prod) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s);", produtos)
	
	    def insert_composicao_in_bd(self, composicoes:list[tuple] = []):
	        self.access.custom_i_u_query("INSERT INTO comp_agend (id_prod_comp, id_comp_tiny, gtin_comp, sku_comp, nome_comp, unidades_por_kit_comp, unidades_totais_comp, estoque_tiny_comp, localizacao_comp, estoque_flag_comp, imagem_url_comp) VALUES (%s, %s, %s, %s, %s, %s, %s, %s, %s, %s, %s);", composicoes)
	
	    def insert_alteracao_in_bd(self, composicoes:list[tuple] = []):
	        print(composicoes)
	        self.access.custom_i_u_query("INSERT IGNORE INTO alteracoes_agend (id_comp_alt, id_prod_alt, id_tiny, gtin_alt, sku_alt, nome_alt) VALUES (%s, %s, %s, %s, %s, %s);", composicoes)
	
	    def insert_compras_in_bd(self, composicoes:list[tuple] = []):
	        print(composicoes)
	        self.access.custom_i_u_query("INSERT INTO compras_agend (id_comp_compra, id_prod_compra, id_tiny, gtin_compra, sku_compra, nome_compra, quant_comprar) VALUES (%s, %s, %s, %s, %s, %s, %s) ON DUPLICATE KEY UPDATE quant_comprar = (quant_comprar + VALUES(quant_comprar));", composicoes)
	
	    def update_empresa_colaborador_agend(self, id_agend_bd:int = 0, id_mktp:int = 0, empresa:int = 0, colaborador:str = ''):
	        self.access.custom_i_u_query("UPDATE agendamento SET empresa_agend = %s, id_mktp = %s, colaborador_agend = %s WHERE id_agend = %s;", [(empresa, id_mktp, colaborador, id_agend_bd)])
	
	    def update_agendamento(self, id_agend_bd:int = 0, id_agend_ml:str = '', id_agend_tipo:int = 0, empresa:int = 0, id_mktp:int = 0, colaborador:str = '', centro_distribuicao:str = ''):
	        self.access.custom_i_u_query(
	            "UPDATE agendamento SET id_agend_ml = %s, id_tipo_agend = %s, empresa_agend = %s, id_mktp = %s, colaborador_agend = %s, centro_distribuicao = %s WHERE id_agend = %s;",
	            (id_agend_ml, id_agend_tipo, empresa, id_mktp, colaborador, centro_distribuicao, id_agend_bd)
	        )
	
	    def update_quant_total_compras(self, id_comp:int = 0, quant:id = 0):
	        self.access.custom_i_u_query("UPDATE compras_agend SET quant_comprar = quant_comprar - %s WHERE id_compra = %s;", [(quant, id_comp)])
	
	    def clean_compras(self, id_comp:int = 0):
	        self.access.custom_i_u_query("DELETE FROM compras_agend WHERE id_compra = %s AND quant_comprar <= 0;", [(id_comp,)])
	
	    # ADICIONAR CONDI√á√ÉO PARA CASO NADA SEJA ENCONTRADO
	
	    def get_last_agendamento(self):
	        return self.access.custom_select_query("SELECT * FROM agendamento ORDER BY id_agend DESC LIMIT 1;")[0]
	    
	    def get_last_produto(self):
	        return self.access.custom_select_query("SELECT * FROM produtos_agend ORDER BY id_prod DESC LIMIT 1;")[0]
	    
	    def get_last_composicao(self):
	        return self.access.custom_select_query("SELECT * FROM comp_agend ORDER BY id_comp DESC LIMIT 1;")[0]
	    
	    def get_all_produtos_from_agendamento(self, id_agendamento:int = 0):
	        return self.access.custom_select_query("SELECT * FROM produtos_agend WHERE id_agend_prod = %s;", (id_agendamento,))
	    
	    def get_all_composicoes_from_produto(self, id_produto:int = 0):
	        return self.access.custom_select_query("SELECT * FROM comp_agend WHERE id_prod_comp = %s;", (id_produto,))
	    
	    def get_all_agendamentos_in_alteracoes(self):
	        return self.access.custom_select_query("SELECT DISTINCT a.*\
	                                                 FROM alteracoes_agend al\
	                                                 JOIN produtos_agend p\
	                                                 JOIN agendamento a\
	                                                 ON al.id_prod_alt = p.id_prod AND p.id_agend_prod = a.id_agend;")
	    
	    def get_produtos_from_alteracoes(self, id_agendamento:int = 0):
	        return self.access.custom_select_query("SELECT DISTINCT p.*\
	                                                 FROM alteracoes_agend al\
	                                                 JOIN produtos_agend p\
	                                                 JOIN agendamento a\
	                                                 ON al.id_prod_alt = p.id_prod AND p.id_agend_prod = a.id_agend\
	                                                 WHERE a.id_agend = %s;", (id_agendamento,))
	    
	    def get_composicao_from_alteracoes(self, id_produto:int = 0):
	        return self.access.custom_select_query("SELECT DISTINCT c.*\
	                                                 FROM alteracoes_agend al\
	                                                 JOIN produtos_agend p\
	                                                 JOIN agendamento a\
	                                                 JOIN comp_agend c\
	                                                 ON al.id_prod_alt = p.id_prod AND p.id_agend_prod = a.id_agend AND al.id_comp_alt = c.id_comp\
	                                                 WHERE p.id_prod = %s;", (id_produto,))
	    
	    def get_all_agendamentos_in_compras(self):
	        return self.access.custom_select_query("SELECT DISTINCT a.*\
	                                                 FROM compras_agend ca\
	                                                 JOIN produtos_agend p\
	                                                 JOIN agendamento a\
	                                                 ON ca.id_prod_compra = p.id_prod AND p.id_agend_prod = a.id_agend;")
	    
	    def get_produtos_from_compras(self, id_agendamento:int = 0):
	        return self.access.custom_select_query("SELECT DISTINCT p.*\
	                                                 FROM compras_agend ca\
	                                                 JOIN produtos_agend p\
	                                                 JOIN agendamento a\
	                                                 ON ca.id_prod_compra = p.id_prod AND p.id_agend_prod = a.id_agend\
	                                                 WHERE a.id_agend = %s;", (id_agendamento,))
	    
	    def get_composicao_from_compras(self, id_produto:int = 0):
	        return self.access.custom_select_query("SELECT DISTINCT c.*\
	                                                 FROM compras_agend ca\
	                                                 JOIN produtos_agend p\
	                                                 JOIN agendamento a\
	                                                 JOIN comp_agend c\
	                                                 ON ca.id_prod_compra = p.id_prod AND p.id_agend_prod = a.id_agend AND ca.id_comp_compra = c.id_comp\
	                                                 WHERE p.id_prod = %s;", (id_produto,))
	        
	    def get_composicoes_from_compras(self):
	        return self.access.custom_select_query("SELECT * FROM compras_agend;")
	    
	    def insert_excel_upload(self, upload_tuple: tuple):
	        """Insere um registro de upload de Excel"""
	        self.access.custom_i_u_query(
	            "INSERT INTO excel_uploads (uuid, filename) VALUES (%s, %s);",
	            [upload_tuple]
	        )
	
	    def get_excel_upload(self, uuid: str):
	        """Busca um registro de upload pelo uuid"""
	        return self.access.custom_select_query(
	            "SELECT * FROM excel_uploads WHERE uuid = %s;", (uuid,)
	        )[0]
	
	    
	    def test_connection(self):
	        return self.access
	    
	    def delete_composicoes_by_agendamento(self, id_agendamento: int):
	        return self.access.custom_i_u_query(
	            """
	            DELETE FROM comp_agend 
	            WHERE id_prod_comp IN (
	                SELECT id_prod 
	                FROM produtos_agend 
	                WHERE id_agend_prod = %s
	            );
	            """, [(id_agendamento,)]
	        )
	
	    def delete_produtos_by_agendamento(self, id_agendamento: int):
	        return self.access.custom_i_u_query(
	            "DELETE FROM produtos_agend WHERE id_agend_prod = %s;", [(id_agendamento,)]
	        )
	        
	    def exists_agendamento_ml(self, ml_id: str) -> bool:
	        """Verifica se um agendamento com um id_agend_ml espec√≠fico j√° existe."""
	        # CORRE√á√ÉO: Usa um placeholder (%s) em vez de f-string para seguran√ßa.
	        sql = f"SELECT 1 FROM agendamento WHERE id_agend_ml = %s LIMIT 1"
	        return bool(self.access.custom_select_query(sql, (ml_id,)))
	
	    def delete_agendamento_completo(self, id_agend_bd: int):
	        """
	        Executa a exclus√£o em cascata de um agendamento e todos os seus dados associados.
	        A ordem das queries √© fundamental para respeitar as chaves estrangeiras.
	        """
	        
	        # Pega o id_agend_ml antes de excluir, para limpar tabelas que usam ele
	        id_ml_result = self.access.custom_select_query("SELECT id_agend_ml FROM agendamento WHERE id_agend = %s;", (id_agend_bd,))
	        id_agend_ml = id_ml_result[0][0] if id_ml_result else None
	
	        # Lista de produtos associados ao agendamento
	        produtos_result = self.access.custom_select_query("SELECT id_prod FROM produtos_agend WHERE id_agend_prod = %s;", (id_agend_bd,))
	        id_produtos = tuple([row[0] for row in produtos_result])
	
	        # # --- IN√çCIO DA CORRE√á√ÉO ---
	        # if id_produtos:
	        #     # Cria a string de placeholders, ex: "(%s, %s, %s)"
	        #     placeholders = ', '.join(['%s'] * len(id_produtos))
	
	        #     # 1. Limpa tabelas de logs/tracking usando a nova query formatada
	        #     #    Limpa tabelas filhas que dependem dos produtos
	        #     query_alteracoes = f"DELETE FROM alteracoes_agend WHERE id_prod_alt IN ({placeholders})"
	        #     # O m√©todo custom_i_u_query espera uma lista de tuplas, ent√£o passamos [id_produtos]
	        #     self.access.custom_i_u_query(query_alteracoes, [id_produtos])
	
	        #     query_compras = f"DELETE FROM compras_agend WHERE id_prod_compra IN ({placeholders})"
	        #     self.access.custom_i_u_query(query_compras, [id_produtos])
	            
	        #     # 2. Limpa as composi√ß√µes dos produtos
	        #     query_composicoes = f"DELETE FROM comp_agend WHERE id_prod_comp IN ({placeholders})"
	        #     self.access.custom_i_u_query(query_composicoes, [id_produtos])
	
	        #     # 4. Limpa os produtos do agendamento (este DELETE estava correto, mas movemos para o final do bloco)
	        #     self.access.custom_i_u_query("DELETE FROM produtos_agend WHERE id_agend_prod = %s;", [(id_agend_bd,)])
	        # # --- FIM DA CORRE√á√ÉO ---
	
	
	        # if id_agend_ml:
	        #     # 3. Limpa tabelas que usam o id_agend_ml (esta parte j√° estava correta)
	        #     self.access.custom_i_u_query("DELETE FROM agendamento_produto_bipagem WHERE id_agend_ml = %s;", [(id_agend_ml,)])
	        #     self.access.custom_i_u_query("DELETE FROM relatorio_agend WHERE id_agend_ml = %s;", [(id_agend_ml,)])
	        
	        # # 5. Finalmente, exclui o agendamento principal (esta parte j√° estava correta)
	        # self.access.custom_i_u_query("DELETE FROM agendamento WHERE id_agend = %s;", [(id_agend_bd,)])
	        
	        # return True
	        
	        # L√ìGICA CORRIGIDA APLICADA
	        if id_produtos:
	            placeholders = ', '.join(['%s'] * len(id_produtos))
	            self.access.custom_i_u_query(f"DELETE FROM alteracoes_agend WHERE id_prod_alt IN ({placeholders})", [id_produtos])
	            self.access.custom_i_u_query(f"DELETE FROM compras_agend WHERE id_prod_compra IN ({placeholders})", [id_produtos])
	            self.access.custom_i_u_query(f"DELETE FROM comp_agend WHERE id_prod_comp IN ({placeholders})", [id_produtos])
	            self.access.custom_i_u_query("DELETE FROM produtos_agend WHERE id_agend_prod = %s;", [(id_agend_bd,)])
	
	        if id_agend_ml:
	            self.access.custom_i_u_query("DELETE FROM agendamento_produto_bipagem WHERE id_agend_ml = %s;", [(id_agend_ml,)])
	            self.access.custom_i_u_query("DELETE FROM relatorio_agend WHERE id_agend_ml = %s;", [(id_agend_ml,)])
	        
	        self.access.custom_i_u_query("DELETE FROM agendamento WHERE id_agend = %s;", [(id_agend_bd,)])
	        
	        return True
	    
	    def update_expedicao_inicio(self, id_agend_bd: int):
	        if not self.access:
	            raise RuntimeError("Access n√£o configurado no DatabaseController.")
	        self.access.custom_i_u_query(
	            "UPDATE agendamento SET expedicao_inicio = NOW() WHERE id_agend = %s AND expedicao_inicio IS NULL;",
	            [(id_agend_bd,)]
	        )
	        
	    def update_expedicao_fim(self, id_agend_bd: int):
	        if not self.access:
	            raise RuntimeError("Access n√£o configurado no DatabaseController.")
	        self.access.custom_i_u_query(
	            "UPDATE agendamento SET expedicao_fim = NOW() WHERE id_agend = %s;",
	            [(id_agend_bd,)]
	        )
	        
	    def get_relatorio_by_agendamento_ml(self, id_agend_ml: str):
	        """ Busca um relat√≥rio existente na tabela pelo id_agend_ml. """
	        query = "SELECT relatorio FROM relatorio_agend WHERE id_agend_ml = %s;"
	        result = self.access.custom_select_query(query, (id_agend_ml,))
	        # Retorna o conte√∫do do JSON (primeira coluna da primeira linha) ou None se n√£o encontrar
	        return result[0][0] if result else None
	
	    def salvar_relatorio(self, id_agend_ml: str, relatorio_json: str):
	        """ Insere ou atualiza o relat√≥rio de um agendamento. """
	        query = """
	            INSERT INTO relatorio_agend (id_agend_ml, relatorio) 
	            VALUES (%s, %s) 
	            ON DUPLICATE KEY UPDATE relatorio = VALUES(relatorio);
	        """
	        self.access.custom_i_u_query(query, [(id_agend_ml, relatorio_json)])
	    
	    def get_caixas_by_agendamento_ml(self, id_agend_ml: str) -> list:
	        """
	        Busca todas as caixas e seus respectivos itens para um determinado agendamento.
	        Retorna uma lista de dicion√°rios, onde cada dicion√°rio representa uma caixa.
	        """
	        # Primeiro, busca todas as caixas do agendamento
	        query_caixas = "SELECT caixa_num FROM embalagem_caixas WHERE id_agend_ml = %s ORDER BY caixa_num"
	        caixas_result = self.access.custom_select_query(query_caixas, (id_agend_ml,))
	        
	        # Converte a lista de tuplas para uma lista simples de n√∫meros de caixa
	        numeros_caixas = [row[0] for row in caixas_result]
	        
	        resultado_final = []
	        if not numeros_caixas:
	            return resultado_final
	
	        # Para cada caixa, busca seus itens
	        for num in numeros_caixas:
	            query_itens = """
	                SELECT sku, quantidade 
	                FROM embalagem_caixa_itens 
	                WHERE id_agend_ml = %s AND caixa_num = %s
	            """
	            itens_result = self.access.custom_select_query(query_itens, (id_agend_ml, num))
	            
	            itens_da_caixa = [
	                {"sku": item[0], "quantidade": item[1]} for item in itens_result
	            ]
	            
	            resultado_final.append({
	                "caixa_num": num,
	                "itens": itens_da_caixa
	            })
	            
	        return resultado_final
	    
	    def set_expedicao_inicio(self, id_agend_bd: int, ts: datetime) -> None:
	        """
	        Define explicitamente o timestamp de in√≠cio de expedi√ß√£o para um agendamento.
	        Compat√≠vel com MySQL (placeholders %s) e com seu wrapper custom_i_u_query.
	        """
	        self.access.custom_i_u_query(
	            "UPDATE agendamento SET expedicao_inicio = %s WHERE id_agend = %s;",
	            [(ts, id_agend_bd)]
	        )
	
	
	    def set_expedicao_fim(self, id_agend_bd: int, ts: datetime) -> None:
	        """
	        Define explicitamente o timestamp de t√©rmino de expedi√ß√£o para um agendamento.
	        Compat√≠vel com MySQL (placeholders %s) e com seu wrapper custom_i_u_query.
	        """
	        self.access.custom_i_u_query(
	            "UPDATE agendamento SET expedicao_fim = %s WHERE id_agend = %s;",
	            [(ts, id_agend_bd)]
	        )
__init__.py=from .AgendamentoController import AgendamentoController
	from .DatabaseController import DatabaseController

[classes/views]
AgendamentoView.py=from classes.models import Agendamento, Produto, Composicao
	from datetime import datetime
	
	class Agendamento:
	    """ Classe feita para gerenciar os dados de um agendamento """
	    def __init__(self, 
	                id_bd:int = 0, 
	                id_agend_ml:str = '', 
	                id_tipo:int = 0,
	                empresa:int = 0,
	                id_mktp:int = 0,
	                colaborador = '',
	                entrada:datetime = datetime.now()):
	        """
	        Instancia um objeto da classe Agendamento
	
	        Args
	        -----------   
	            id_bd (int): ID da composi√ß√£o no Banco de dados.
	            id_agend_ml (str): ID do agendamento no ML.
	            id_tipo (int): ID do tipo do agendamento.
	            empresa (int): ID da empresa do agendamento.
	            colaborador (str): Nome do colaborador.
	
	        Vars
	        -----------
	            produtos (list[Produto]): Lista com todos os produtos do agendamento.
	        """
	        self.id_bd = id_bd
	        self.id_agend_ml = id_agend_ml
	        self.id_tipo = id_tipo
	        self.empresa = empresa
	        self.id_mktp = id_mktp
	        self.colaborador = colaborador
	        self.entrada = entrada
	
	        self.produtos:list[Produto] = []
	
	    def __repr__(self):
	        """ Formata como o objeto deve ser transformado em uma string """
	        return f"Agendamento\
	                \n\tID BD: {self.id_bd}\
	                \n\tID agendamento: {self.id_agend_ml}\
	                \n\tID tipo: {self.id_tipo}"
	
	    def to_dict(self):
	        """ Transforma o objeto num dicion√°rio """
	        return {
	            "id_bd": self.id_bd,
	            "id_agend_ml": self.id_agend_ml,
	            "id_tipo": self.id_tipo,
	            "empresa": self.empresa,
	            "id_mktp": self.id_mktp,
	            "colaborador": self.colaborador,
	            "entrada_agend": self.entrada,
	            "produtos": []
	        }
	    
	    def to_tuple(self):
	        """ Transforma o objeto num tuple """
	        return (
	            self.id_agend_ml,
	            self.id_tipo,
	            self.empresa,
	            self.id_mktp,
	            self.colaborador,
	            self.entrada
	        )
	
	    def insert_produto(self, produto_obj:Produto = None):
	        """ Insere um produto ao agendamento """
	        self.produtos.append(produto_obj)
	
	    def search_produto(self, att_name:str = '', att_value:str = ''):
	        """ Busca por um produto baseado em um atributo e um valor """
	        return next((i for i in self.produtos if getattr(i, att_name) == att_value), None)
	    
	    def set_id_bd(self, id_bd:int = 0):
	        """ Insere o id do agendamento """
	        self.id_bd = id_bd
	
	    def set_colaborador(self, colaborador:str = ''):
	        """ Insere o colaborador do agendamento """
	        self.colaborador = colaborador
	
	    def set_empresa(self, empresa:int = 0):
	        """ Insere o id da empresa do agendamento """
	        self.empresa = empresa
	        
	    def set_mktp(self, id_mktp:int = 0):
	        """ Insere o id da empresa do agendamento """
	        self.id_mktp = id_mktp
	        
	    def set_id_agend_for_produtos(self):
	        """ Insere o id do agendamento a todos os produtos dentro dele """
	        for produto in self.produtos:
	            produto.set_id_agend(self.id_bd)
	
	    def return_produtos_in_tuple(self):
	        """ Retorna todos os produtos em tuples """
	        return [produto.to_tuple() for produto in self.produtos]
	    
	    def return_all_composicoes_in_tuple(self):
	        """ Retorna todas as composi√ß√µes em tuples """
	        temp_list = []
	        for produto in self.produtos:
	            temp_list += produto.return_composicao_in_tuple()
	        return temp_list
	
	from classes.models import Agendamento, Produto, Composicao
	
	class AgendamentoView:
	    def display_agendamento(self, agendamento:Agendamento = None):
	        print(agendamento)
	
	    def display_produto(self, produto:Produto = None):
	        print(produto)
	
	    def display_all_produtos(self, agendamento:Agendamento = None):
	        for produto in agendamento.produtos:
	            print(produto)
	
	    def display_composicao(self, composicao:Composicao = None):
	        print(composicao)
	
	    def display_all_composicoes(self, produto:Produto = None):
	        for composicao in produto.composicoes:
	            print(composicao)
	
	    def display_all_in_agend(self, agendamento:Agendamento = None):
	        print(agendamento)
	        for produto in agendamento.produtos:
	            print(produto)
	            for composicao in produto.composicoes:
	                print(composicao)
	
	    def show_agendamento_created(self, agendamento:Agendamento = None):
	        print(f"Agendamento criado com sucesso\n ID do agendamento: {agendamento.id_agend_ml}")
	        print(f"Cont√©m {len(agendamento.produtos)} produtos")
	        
	    def show_error(self, message):
	        print(f"Error: {message}")
__init__.py=from .AgendamentoView import AgendamentoView

[base_jp_lab]
README.md=## base_jp_lab ##
	
	Pacote, com as estruturas b√°sicas, para produ√ß√£o de sistemas de automa√ß√£o para e-commerce na JauPesca.
	
	Para instalar o pacote, utilize o c√≥digo abaixo enquando na pasta do reposit√≥rio:\
	``` python -m pip install . ```
	
setup.py=from setuptools import setup, find_packages
	
	description = 'Pacote com objetos que ser√£o utilizados para cria√ß√£o de sistemas automatizados dentro da empresa JauPesca'
	
	setup(
	    name='base_jp_lab',
	    version='0.1.3',
	    description=description,
	    author='Bruno Lallo, Marcelo de Paula',
	    author_email='brunolallo8@gmail.com, marcelodepaula.dev@gmai.com',
	    packages=find_packages(),
	    install_requires=[
	        "requests==2.32.3", "selenium==4.24.0", "gspread==6.1.4", "oauth2client==4.1.3", "pandas==2.2.3", "mysql-connector==2.2.9", "cryptography==43.0.3", "grequests==0.7.0", "psycopg2==2.9.10"
	        ],
	    license='MIT'
	)

[base_jp_lab/base_jp_lab]
__init__.py=from .Objects import Access, AsyncCaller, Caller, ConnectionMySql, Scraper
	from .Objects.GetData import api_data, api_token_n8n, sheet_data, alter_sheet, scraping_base_url, set_api_keys, encrypt_msg, decrypt_msg, api_token_db

[base_jp_lab/base_jp_lab/Configs]
decrypt_keys.json={
	 "keys": {
	  "tiny_key": "",
	  "pedidook_key": "",
	  "mercadolivre_key": "",
	  "magalu_key": "",
	  "amazon_key": "",
	  "shopee_key": ""
	 }
	}

[base_jp_lab/base_jp_lab/Objects]
AccessClass.py=from .ConnectionMySqlClass import ConnectionMySql
	from .ConnectionPGClass import ConnectionPG
	from typing import Union, List, Dict, Any
	import time
	
	class Access():
	    """Enhanced database access class with better error handling"""
	    
	    def __init__(self, user: str, password: str, host: str, port: str, name: str, is_mysql: bool = True):
	        self.is_mysql = is_mysql
	        if is_mysql:
	            self.con = ConnectionMySql(user, password, host, port, name)
	        else:
	            self.con = ConnectionPG(user, password, host, port, name)
	        
	    def get_api_data(self, id_api: int) -> List[Dict[str, Any]]:
	        """Safe query with retry logic"""
	        return self._execute_with_retry(
	            "SELECT * FROM apis WHERE id_api = %s", 
	            (id_api,),
	            is_select=True
	        )
	        
	    def custom_select_query(self, query: str, params: tuple = None) -> Union[List[Dict[str, Any]], List[tuple]]:
	        """Safe select query with retry logic"""
	        return self._execute_with_retry(query, params, is_select=True)
	    
	    def custom_i_u_query(self, query: str, data: Union[List[tuple], tuple]) -> None:
	        """Safe insert/update query with retry logic"""
	        self._execute_with_retry(query, data, is_select=False)
	    
	    def _execute_with_retry(self, query: str, params: Any = None, is_select: bool = True) -> Any:
	        """Core method with retry logic for all queries"""
	        max_retries = 3
	        retry_delay = 1  # seconds
	        
	        last_exception = None
	        
	        for attempt in range(max_retries):
	            try:
	                self.con.start_con()
	                
	                if isinstance(params, list):
	                    self.con.cursor.executemany(query, params)
	                elif params:
	                    self.con.cursor.execute(query, params)
	                else:
	                    self.con.cursor.execute(query)
	                
	                if not is_select:
	                    self.con.db.commit()
	                    print('Dados inseridos/alterados com sucesso')
	                    return None
	                
	                result = self.con.cursor.fetchall()
	                return result
	                
	            except Exception as e:
	                last_exception = e
	                print(f"Database error (attempt {attempt + 1}): {str(e)}")
	                
	                if attempt < max_retries - 1:
	                    print(f"Retrying in {retry_delay} seconds...")
	                    time.sleep(retry_delay)
	                    self.con.close_con()  # Ensure clean state for retry
	                else:
	                    # On final attempt, try to rollback if it was a write operation
	                    if not is_select and hasattr(self.con, 'db') and self.con.db:
	                        try:
	                            self.con.db.rollback()
	                        except:
	                            pass
	                    raise
	            finally:
	                try:
	                    self.con.close_con()
	                except Exception as e:
	                    print(f"Error closing connection: {str(e)}")
	        
	        raise last_exception if last_exception else Exception("Unknown database error")
AsyncCallerClass.py=import httpx
	import asyncio
	from math import ceil
	from typing import Union, List, Optional
	from .AccessClass import Access
	from .GetData import api_data, api_token_db
	from itertools import batched
	
	class AsyncCaller:
	    """Classe para realizar chamadas HTTPS de modo ass√≠ncrono usando httpx"""
	    
	    def __init__(self, access: Access = None, site_name: str = '', owner: str = 'silvio'):
	        """
	        Inicializa uma inst√¢ncia da classe 'AsyncCaller'
	        
	        Args:
	            access (Access): Acesso ao banco de dados
	            site_name (str): Nome do site que ser√° acessado
	            owner (str, opcional): Nome do dono com todas as letras min√∫sculas
	        """
	        api = api_data(access, site_name)
	
	        self.urls = []
	        self.std_url = api[1]
	        self.headers = eval(api[3])['header']
	        self.param = eval(api[5])['params']
	        self.chunked_urls = []
	        
	        if "Authorization" in self.headers and self.headers["Authorization"] == "Bearer {}":
	            self.headers['Authorization'] = f"Bearer {api_token_db(access, site_name, owner=owner)}"
	
	    def set_url(self, url: Union[str, List[str]] = None):
	        """
	        Adiciona urls √† lista de urls que ser√£o acessadas
	        
	        Args:
	            url (str|list): Url que deve ser inserida
	        """
	        if isinstance(url, str):
	            self.urls.append(self.std_url.format(url))
	        elif isinstance(url, list):
	            for i in url:
	                self.urls.append(self.std_url.format(i))
	
	    def separate_chunks(self, chunk_size: Union[int, float] = 0):
	        """
	        Separa o atributo 'urls' em listas menores
	        
	        Args:
	            chunk_size (int|float): Tamanho dos chunks
	        """
	        if isinstance(chunk_size, float):
	            chunk_size = round(chunk_size)
	
	        self.chunked_urls = batched(self.urls, chunk_size)
	
	    async def _fetch_url(self, client: httpx.AsyncClient, url: str, return_full_response: bool):
	        """Helper method to fetch a single URL"""
	        try:
	            response = await client.get(url)
	            response.raise_for_status()
	            return response if return_full_response else response.json()
	        except httpx.HTTPStatusError as e:
	            print(f"HTTP error for {url}: {e}")
	            return None
	        except Exception as e:
	            print(f"Error fetching {url}: {e}")
	            return None
	
	    async def make_calls(self, 
	                        chunk_size: Union[int, float] = 0, 
	                        single_list: bool = True,
	                        return_full_response: bool = False) -> Optional[Union[List, List[List]]]:
	        """
	        Faz as chamadas de modo ass√≠ncrono
	        
	        Args:
	            chunk_size (int|float): Tamanho dos chunks
	            single_list (bool): Retornar como lista √∫nica ou lista de chunks
	            return_full_response (bool): Retornar resposta completa ou apenas JSON
	            
	        Returns:
	            List of responses or None if no URLs
	        """
	        self.chunked_urls = []
	
	        if not self.urls:
	            print("Nenhuma URL adicionada")
	            return None
	
	        async with httpx.AsyncClient(headers=self.headers) as client:
	            if chunk_size == 0:
	                tasks = [self._fetch_url(client, url, return_full_response) for url in self.urls]
	                return await asyncio.gather(*tasks)
	            else:
	                if chunk_size > 0 and not self.chunked_urls:
	                    self.separate_chunks(chunk_size)
	
	                results = []
	                for chunk in self.chunked_urls:
	                    print(f"Request em chunk com tamanho {len(chunk)}")
	                    tasks = [self._fetch_url(client, url, return_full_response) for url in chunk]
	                    chunk_result = await asyncio.gather(*tasks)
	                    
	                    if single_list:
	                        results.extend(chunk_result)
	                    else:
	                        results.append(chunk_result)
	                
	                return results
CallerClass.py=import requests
	import json
	import time
	from requests.exceptions import HTTPError, JSONDecodeError
	from requests.adapters import HTTPAdapter, Retry
	from .AccessClass import Access
	from .GetData import api_token_db, api_data
	
	class Caller():
	    """ Classe criada para realizar chamadas HTTPS e gerenciar os dados necess√°rios para essas chamadas """
	    def __init__(self, access:Access, site_name:str, link_n8n:str = '', owner:str = 'silvio'):
	        """
	        Inicializa uma inst√¢ncia da classe 'Caller'sad
	        
	        Args
	        ----------
	            access (Access): Acesso ao banco de dados.
	            site_name (str): Nome do site que ser√° acessado.
	            link_n8n (str): URL do webhook do N8N
	            owner (str, opcional): Nome do dono com todas as letras min√∫sculas.
	        
	        Vars
	        ----------
	            std_url (str): URL do endpoint da API sem formata√ß√£o. String apenas aponta para a url e deve ser alterada para acessar dados espec√≠ficos.
	            header (dict): Valores padr√µes do header.
	            param (dict): Valores padr√µes dos par√¢metros.
	            token_name (str): Nome do valor em que a chave da API √© retornado.
	            session (requests.Session): Objeto Session usado para manter informa√ß√µes entre diferentes requests.
	            
	        Extra
	        ----------
	            retry_strategy (requests.adapters.Retry): Cria a "estrat√©gia" de quando e quantas vezes refazer um request que falhou.
	            
	        Notas
	        ----------
	            A inser√ß√£o em 'std_url', 'header', 'param' e 'token_name' foram feitos baseados na estrutura do banco de dados `jp_bd.apis`.
	        """
	        
	        self.access = access
	        self.site_name = site_name
	        self.link_n8n = link_n8n
	        self.owner = owner
	        api = api_data(self.access, self.site_name)
	
	        self.std_url = api[1]
	        self.req_url = ''
	        self.header = eval(api[3])['header']
	        self.param = eval(api[5])['params']
	        self.token_name = api[7]
	
	        self.site_name = site_name
	        self.api_url = link_n8n
	        
	        self.session = requests.Session()
	        self.session.headers = self.header
	        self.session.params = self.param
	        
	        if 'Authorization' in self.session.headers and self.session.headers['Authorization'] == 'Bearer {}':
	            print('Pegando chave de API:')
	            self.session.headers.update({'Authorization': f'Bearer {api_token_db(self.access, self.site_name, self.owner, self.link_n8n, self.token_name)}'})
	        elif 'x-amz-access-token' in self.session.headers:
	            print('Pegando chave de API:')
	            self.session.headers.update({'x-amz-access-token': api_token_db(self.access, self.site_name, self.owner, self.link_n8n, self.token_name)})     
	
	        retry_strategy = Retry(
	            total=5, # Quantidade de tentativas m√°ximas
	            backoff_factor=0.2, # Tempo entre ser√° (backoff_factor) * (2 ** (tentativas_falhadas - 1)) -> Com 0.1 = 0.1, 0.2, 0.4, 0.8, 1.6
	            allowed_methods=['GET', 'POST', 'PUT', 'PATCH', 'OPTIONS'],
	            status_forcelist=[429, 500, 502, 503, 504], # Resultados que ser√£o repetidos
	            raise_on_status=True)
	        self.session.mount('https://', HTTPAdapter(max_retries=retry_strategy))
	        self.session.mount('http://', HTTPAdapter(max_retries=retry_strategy))
	    
	    def print_all(self):
	        print(f'URL: {self.std_url}')
	        print(f'Headers: {self.header}')
	        print(f'Par√¢metros: {self.param}')
	
	    def change_api_key(self, new_owner:str|None):
	        """
	        Altera a chave da API que ser√° usada, pode ser usada para resetar uma chave expirada
	        
	        Args
	        ----------
	            new_owner (str): Nome do novo dono.
	        """
	        
	        if new_owner is None:
	            new_owner = self.owner
	
	        if 'Authorization' in self.session.headers:
	            print('Alterando chave de API:')
	            self.session.headers.update({'Authorization': f'Bearer {api_token_db(self.access, self.site_name, new_owner, self.link_n8n, self.token_name)}'})
	            # print('Authorization ->')
	            # print(f'self.access: {self.access}')
	            # print(f'self.site_name: {self.site_name}')
	            # print(f'new_owner: {new_owner}')
	            # print(f'self.link_n8n: {self.link_n8n}')
	            # print(f'self.token_name: {self.token_name}')
	            # print(f'{api_token_db(self.access, self.site_name, new_owner, self.link_n8n, self.token_name)}')
	            # print(f'Nova chave: {self.session.headers["Authorization"]}')
	        elif 'x-amz-access-token' in self.session.headers:
	            print('Alterando chave de API:')
	            self.session.headers.update({'x-amz-access-token': api_token_db(self.access, self.site_name, new_owner, self.link_n8n, self.token_name)})  
	            # print('x-amz-access-token ->')
	            # print(f'self.access: {self.access}')
	            # print(f'self.site_name: {self.site_name}')
	            # print(f'new_owner: {new_owner}')
	            # print(f'self.link_n8n: {self.link_n8n}')
	            # print(f'self.token_name: {self.token_name}')
	            # print(f'{api_token_db(self.access, self.site_name, new_owner, self.link_n8n, self.token_name)}')
	            # print(f'Nova chave: {self.session.headers["Authorization"]}')
	
	    
	    def make_call(self, add_to_url:str = '', method:str = 'get', params_add:dict = {}, data_post:dict = {}, disable_std_params:bool = False, return_full_response:bool = False) -> dict|requests.Response:
	        """
	        Realiza uma chamada com base nos args inseridos
	        
	        Args:
	            add_to_url (str): Valor que deve ser adicionado ao fim da url da api para especificar os dados que ser√£o buscados.
	            method (str): M√©todo utilizado pela chamada ('GET', 'POST', 'PUT', etc).
	            params_add (dict): Par√¢metros adicionais que devem ser adicionados √† chamada.
	            data_post (dict): Dados que ser√£o enviados num POST ou PUT.
	            disable_std_params (bool): Desabilita os par√¢metros padr√µes.
	            return_full_response (bool): Retorna todos os dados da Response.
	        """
	        
	        if disable_std_params: self.session.params = {}
	        if params_add != {}: self.session.params.update(params_add)
	        
	        self.req_url = self.std_url.format(add_to_url) if add_to_url != '' else self.std_url[:-2]
	        for attempt in range(2): # Tenta 2 vezes (a segunda se o token estiver expirado)
	            try:
	                # 1. TENTA FAZER A REQUISI√á√ÉO
	                call = self.session.request(
	                    method = method,
	                    url = self.req_url,
	                    data = None if method.lower() not in ['post', 'put'] else json.dumps(data_post)
	                )
	                call.raise_for_status()
	                
	                # 2. SUCESSO!
	                print(f'Chamada feita. Resposta com c√≥digo {call.status_code}')
	                if return_full_response:
	                    return call
	                else:
	                    try:
	                        return call.json()
	                    except JSONDecodeError:
	                        print('Resposta n√£o √© um JSON v√°lido. Retornando texto bruto')
	                        return call.text
	                    
	            except HTTPError as er1:
	                # 3. FALHA HTTP CAPTURADA
	                # Verifica se o erro √© de autentica√ß√£o (401 ou 403)
	                # Se for e est√° na primeira tentativa, troca a chave da API e tenta novamente
	                code = int(er1.response.status_code)
	                if code in (401, 403) and attempt == 0:
	                    print('Token expirado ou inv√°lido. Tentando trocar a chave da API e refazer a chamada...')
	                    self.change_api_key(new_owner = self.owner)
	                    time.sleep(1) # Pequena pausa para evitar problemas
	                    
	                    # A palavra-chave 'continue' pula para a pr√≥xima itera√ß√£o do loop para tentar novamente.
	                    continue
	                
	                # Se n√£o for um erro de autentica√ß√£o na primeira tentativa, ou se for qualquer erro na segunda, falha.
	                print(f'Erro HTTP final. C√≥digo {er1.response.status_code}')
	                return call
	            
	            except requests.exceptions.RequestException as e:
	                # 4. OUTRAS FALHAS DE REQUISI√á√ÉO (Conex√£o, timeout, etc)
	                print(f'Erro na requisi√ß√£o: {e}')
	                raise e
	            
	        # 5. FALHA AP√ìS RETENTATIVAS
	        # Este ponto s√≥ √© alcan√ßado se o loop terminar sem um 'return'.
	        print("Falha de autentica√ß√£o persistente ap√≥s nova tentativa.")
	        return call
ConnectionMySqlClass.py=import mysql.connector
	import mysql.connector.pooling
	from mysql.connector import Error, InterfaceError
	import time
	from typing import Optional
	
	class ConnectionMySql():
	    """Enhanced MySQL connection class with robust error handling"""
	    
	    _connection_pool = None
	    _pool_initialized = False
	    
	    def __init__(self, user: str, password: str, host: str, port: str, name: str) -> None:
	        self.user = user
	        self.password = password 
	        self.host = host 
	        self.port = port 
	        self.name = name 
	        self.db = None
	        self.cursor = None
	        
	        if not ConnectionMySql._pool_initialized:
	            ConnectionMySql._initialize_pool(user, password, host, port, name)
	    
	    @classmethod
	    def _initialize_pool(cls, user, password, host, port, name):
	        """Initialize the connection pool with retry logic"""
	        try:
	            cls._connection_pool = mysql.connector.pooling.MySQLConnectionPool(
	                pool_name="mysql_pool",
	                pool_size=5,
	                host=host,
	                user=user,
	                password=password,
	                database=name,
	                port=port,
	                autocommit=False,
	                pool_reset_session=True,
	                connect_timeout=30
	            )
	            cls._pool_initialized = True
	        except Error as e:
	            print(f"Error creating connection pool: {e}")
	            cls._pool_initialized = False
	            raise
	    
	    def start_con(self):
	        """Get a connection with retry logic"""
	        max_retries = 3
	        retry_delay = 1  # seconds
	        
	        for attempt in range(max_retries):
	            try:
	                if self.db is None or not hasattr(self.db, 'is_connected') or not self.db.is_connected():
	                    self.db = self._connection_pool.get_connection()
	                    self.cursor = self.db.cursor()
	                    # Test the connection
	                    self.cursor.execute("SELECT 1")
	                    self.cursor.fetchone()
	                return
	            except (Error, InterfaceError, AttributeError) as e:
	                if attempt == max_retries - 1:
	                    raise
	                print(f"Connection attempt {attempt + 1} failed: {str(e)}. Retrying...")
	                time.sleep(retry_delay)
	                self._cleanup_failed_connection()
	    
	    def _cleanup_failed_connection(self):
	        """Clean up any failed connection state"""
	        try:
	            if self.cursor:
	                self.cursor.close()
	            if self.db:
	                try:
	                    self.db.close()
	                except:
	                    pass
	        except:
	            pass
	        finally:
	            self.cursor = None
	            self.db = None
	    
	    def close_con(self):
	        """Safely close connection and return it to the pool"""
	        try:
	            if self.cursor:
	                try:
	                    self.cursor.close()
	                except:
	                    pass
	            
	            if self.db:
	                try:
	                    if hasattr(self.db, 'is_connected') and self.db.is_connected():
	                        self.db.close()  # This returns it to the pool
	                except:
	                    pass
	        except Exception as e:
	            print(f"Error during connection close: {str(e)}")
	        finally:
	            self.cursor = None
	            self.db = None
	    
	    def __del__(self):
	        """Destructor to ensure cleanup"""
	        self.close_con()
ConnectionPGClass.py=import psycopg2
	from psycopg2 import pool
	from typing import Optional
	
	class ConnectionPG:
	    """Classe para controlar a conex√£o com PostgreSQL com connection pooling"""
	    
	    _connection_pool = None
	    
	    def __init__(self, user: str = '', password: str = '', host: str = '', port: str = '', name: str = ''):
	        """
	        Inicializa a classe com configura√ß√µes de conex√£o
	        
	        Args:
	            user (str): Nome do usu√°rio
	            password (str): Senha do banco
	            host (str): Host do banco
	            port (str): Porta do banco
	            name (str): Nome do banco
	        """
	        self.user = user
	        self.password = password
	        self.host = host
	        self.port = port
	        self.database = name
	        self.db = None
	        self.cursor = None
	        
	        # Initialize connection pool if not already done
	        if ConnectionPG._connection_pool is None:
	            ConnectionPG._initialize_pool(user, password, host, port, name)
	    
	    @classmethod
	    def _initialize_pool(cls, user, password, host, port, name):
	        """Initialize the connection pool"""
	        try:
	            cls._connection_pool = psycopg2.pool.SimpleConnectionPool(
	                minconn=1,
	                maxconn=5,
	                user=user,
	                password=password,
	                host=host,
	                port=port,
	                database=name
	            )
	        except Exception as e:
	            print(f"Error creating connection pool: {e}")
	            raise
	    
	    def start_con(self):
	        """Obt√©m uma conex√£o do pool"""
	        try:
	            if self.db is None or self.db.closed:
	                self.db = self._connection_pool.getconn()
	                self.cursor = self.db.cursor()
	        except Exception as e:
	            print(f"Error getting connection from pool: {e}")
	            raise
	    
	    def close_con(self):
	        """Fecha a conex√£o e retorna ao pool"""
	        try:
	            if self.cursor:
	                self.cursor.close()
	            if self.db and not self.db.closed:
	                self._connection_pool.putconn(self.db)
	            # Reset references
	            self.cursor = None
	            self.db = None
	        except Exception as e:
	            print(f"Error closing connection: {e}")
GetData.py=import requests
	from mysql.connector.errors import Error, DatabaseError, ProgrammingError
	from .AccessClass import Access 
	import gspread
	from oauth2client.service_account import ServiceAccountCredentials
	import json
	from cryptography.fernet import Fernet
	
	class APITokenNotFound(Exception):
	    def __init__(self):
	        exit('Chave de API n√£o foi encontrada')
	
	def api_token_db(access: Access, site_name: str, owner:str = 'silvio', link_n8n: str = '', token_name:str = '') -> tuple:
	    print('Buscando chave de API no DB...')
	    data_api = access.custom_select_query(f'SELECT access_token from apis_valores WHERE loja = "{site_name} - {owner}"')
	    if len(data_api[0]) > 0:
	        return data_api[0][0]
	    elif link_n8n != '':
	        return api_token_n8n(link_n8n, site_name, owner, token_name)
	    else:
	        raise APITokenNotFound()
	
	def api_token_n8n(link_n8n:str, site_name:str, owner:str = '', token_name:str = '') -> dict:
	    """
	    Busca a chave de API no flow do N8N
	    
	    Args
	    ----------
	        site_name (str): Nome do site que ser√° acessado.
	        link_n8n (str): URL do webhook do N8N
	        owner (str, opcional): Nome do dono com todas as letras min√∫sculas.
	    """
	    r = requests.get(
	        url=link_n8n,
	        headers={'type':site_name, 'owner':owner}
	    )
	    return r.json()[token_name]
	
	def api_data(access:Access, site_name:str) -> tuple:
	    """
	    Faz o "middle-man" entre a classe 'Caller' e a 'Access'
	    
	    Args
	    ----------
	        access (Access): Acesso ao banco.
	        site_name (str): Nome do site que ser√° acessado.
	    """
	    match site_name:
	        case 'tiny':
	            return access.get_api_data(1)[0]
	        case 'pedidook':
	            return access.get_api_data(2)[0]
	        case 'mercadolivre':
	            return access.get_api_data(3)[0]
	        case 'magalu':
	            return access.get_api_data(4)[0]
	        case 'amazon':
	            return access.get_api_data(5)[0]
	        case 'shopee':
	            return access.get_api_data(6)[0]
	        
	def scraping_base_url(site_name:str) -> str|None:
	    """
	    Busca a url do marketplace que ser√° usado  
	    
	    Args
	    ----------
	        site_name (str): Nome do site que ser√° acessado.
	    """
	    if site_name in ['pedidook', 'tiny', 'mercadolivre', 'amazon', 'shopee']:
	        return None
	    elif site_name == 'magalu':
	        return 'https://magazineluiza.com.br/{}'
	    
	def sheet_data(sheet_name:str, creds_location:str, worksheet_id:int = None):
	    """
	    Busca dados do sheets
	    
	    Args
	    ----------
	        sheet_name (str): Nome da planilha que ser√° acessada.
	        creds_location (str): Caminho at√© o arquivo json que cont√©m as credenciais para fazer a conex√£o ao Sheets.
	        worksheet_id (int): GID de uma p√°gina dentro da planilha. O GID pode ser encontrado no final da URL ao acessar a p√°gina. 
	    """
	    scope = ["https://spreadsheets.google.com/feeds",'https://www.googleapis.com/auth/spreadsheets',"https://www.googleapis.com/auth/drive.file","https://www.googleapis.com/auth/drive"]
	    creds = ServiceAccountCredentials.from_json_keyfile_name(creds_location, scope)
	    client = gspread.authorize(creds)
	    sheet = client.open(sheet_name).sheet1 if worksheet_id is None else client.open(sheet_name).get_worksheet_by_id(worksheet_id) 
	    return sheet.get_all_records()
	
	def alter_sheet(sheet_name:str, creds_location:str, data:list, worksheet_id:int = None):
	    """
	    Altera ou adiciona dados √† uma planilha
	    
	    Args
	    ----------
	        sheet_name (str): Nome da planilha que ser√° acessada.
	        creds_location (str): Caminho at√© o arquivo json que cont√©m as credenciais para fazer a conex√£o ao Sheets.
	        data (list): Dados que devem ser inseridos na planilha.
	        worksheet_id (int): GID de uma p√°gina dentro da planilha. O GID pode ser encontrado no final da URL ao acessar a p√°gina. 
	    """
	    pass
	
	def encrypt_msg(message:str, key:str):
	    """
	    Encripta uma string usando Fernet.
	    
	    Args
	    ----------
	        message (str): String que ser√° criptografada.
	        key (str): Chave de criptografia que ser√° usada. 
	    """
	    fernet = Fernet(key)
	    return fernet.encrypt(message.encode()).decode()
	
	def decrypt_msg(message:str, site_name:str, keys_json_path:str = 'base_jp_lab/Configs/decrypt_keys.json', override_key:str = ''):
	    """
	    Decripta uma string usando Fernet.
	    
	    Args
	    ----------
	        message (str): String que ser√° criptografada.
	        site_name (str): Nome do site de onde o valor criptografado vem. 
	        keys_json_path (str): Caminho at√© o arquivo JSON com as chaves de criptografia.
	        override_key (str): Utiliza uma nova chave e ignora a chave no arquivo JSON.
	    """
	    if override_key == '':
	        with open(keys_json_path, 'r') as f:
	            key = json.load(f)['keys'][f'{site_name}_key']
	    else:
	        key = override_key
	
	    fernet = Fernet(key)
	    return fernet.decrypt(message).decode()
	
	def set_api_keys(keys_json_path:str = 'base_jp_lab/Configs/decrypt_keys.json') -> None:
	    """
	    Configura as chaves de API e as adiciona, criptografadas, ao banco. 
	    
	    Args
	    ----------
	        keys_json_path (str): Caminho para o arquivo JSON com as chaves de criptografia.
	    """
	    key = Fernet.generate_key()
	    loja_id = input('Qual o site que voc√™ deseja cadastrar?\n0 - Tiny\n1 - PedidoOK\n2 - Mercado Livre\n3 - Magalu\n4 - Amazon\n5 - Shopee\n')
	    match loja_id:
	        case '0':
	            nome_loja = 'tiny'
	        case '1':
	            nome_loja = 'pedidook'
	        case '2':
	            nome_loja = 'mercadolivre'
	        case '3':
	            nome_loja = 'magalu'
	        case '4':
	            nome_loja = 'amazon'
	        case '5':
	            nome_loja = 'shopee' 
	        case default:
	            print('N√∫mero digitado n√£o √© v√°lido!')
	    client_id = input('Digite seu client_id:')
	    client_secret = input('Digite seu client_secret:')
	    refresh_token = input('Digite seu refresh_token:')
	
	    enc_client_id = encrypt_msg(client_id, key)
	    enc_client_secret = encrypt_msg(client_secret, key)
	    enc_refresh_token = encrypt_msg(refresh_token, key)
	
	    with open(keys_json_path, 'r') as f:
	        keys = dict(json.load(f))
	
	    keys['keys'][f'{nome_loja}_key'] = key.decode()
	
	    with open(keys_json_path, 'w') as f:
	        json.dump(keys, f, indent=1)
	
	    a = Access('root', '', 'localhost', '3306', 'jp_bd')
	    data = [(enc_client_id, enc_client_secret, enc_refresh_token, int(loja_id) + 1)]
	    a.custom_i_u_query('UPDATE apis SET client_id_api = %s, client_secret_api = %s, refresh_token_api = %s WHERE id_api = %s', data)
ScraperClass.py=from selenium.webdriver import Firefox, FirefoxOptions, Chrome, ChromeOptions
	from selenium.common.exceptions import NoSuchAttributeException, NoSuchElementException
	from selenium.webdriver.common.by import By
	from .GetData import scraping_base_url
	
	class InvalidSiteName(Exception):
	    pass
	
	class Scraper():
	    """ Classe criada para realizar WebScraping """
	    def __init__(self, site_name:str, url_add:str, xpath:str, std_wait_time:float = 0):
	        """
	        Inicializa uma inst√¢ncia da classe 'Scraper'
	        
	        Args
	        ----------
	            site_name (str): Nome do site que ser√° acessado.
	            url_add (str): Parte que deve ser adicionada √† URL para acessar o dado espec√≠fico que √© desejado. Caso haja parte din√¢mica dentro dessa string, utilize '{}' e o m√©todo 'format()'
	        
	        Vars
	        ----------
	            base_url (str): Parte padr√£o da URL. Se for 'None', n√£o cria o objeto.
	            url (str): URL formatada com o resto adicionado em 'url_add'.
	            driver_options (Options): Op√ß√µes extras que podem ser inser√≠das ao driver.
	            driver (Chrome): Objeto que abre o navegador e faz o WebScraping.
	            std_wait_time (float): Tempo de espera para completar o objetivo do drive.
	            xpath (str): X-Path do elemento que deve ser buscado
	        """
	        self.base_url = scraping_base_url(site_name)
	        if self.base_url is not None:
	            self.url = self.base_url.format(url_add)
	            self.driver_options = ChromeOptions()
	            # self.driver_options.add_argument()
	            self.driver = Chrome(self.driver_options)
	            self.std_wait_time = std_wait_time
	            self.scrapped_data = []
	            self.xpath = xpath
	        else:
	            raise InvalidSiteName('Site inv√°lido para WebScraping')
	
	    def start_scraping(self, search_data:list = []) -> None:
	        """
	        Inicia a raspagem dos dados
	        
	        Args
	        ----------
	            search_data (list): Valores din√¢micos que ser√£o buscados 
	        """
	        for item in search_data:
	            self.driver.get(self.url.format(item))
	            self.driver.implicitly_wait(self.std_wait_time)
	            self.scrapped_data += self.seach_element(self.xpath)
	        self.driver.close()
	
	    def seach_element(self, xpath:str):
	        """
	        Busca um elemento baseado em um XPATH
	        
	        Args
	        ----------
	            xpath (str): Caminho XPATH do elemento desejado
	        """
	        found_element = self.driver.find_element(By.XPATH, xpath)
	        print(found_element.text)
	        return found_element.text
__init__.py=from .GetData import api_data, api_token_n8n, scraping_base_url, sheet_data, alter_sheet, set_api_keys, encrypt_msg, decrypt_msg
	from .ConnectionMySqlClass import ConnectionMySql
	from .AccessClass import Access
	from .AsyncCallerClass import AsyncCaller
	from .CallerClass import Caller
	from .ScraperClass import Scraper

[rotas]
__init__.py=from .homepage import *
	from .auth import *
	from .config import *
	from .process_pdf import *
	from .agendamentos import *
	from .alteracoes import *
	from .upload_pdf import *
	from .retiradoEstoque import *
	from .health_check import *
	from .teste import *
	from .alterar_agendamento import *
	from .downloads import *
	from .erro import *
	from .imprimir_composicoes import *
	from .atualizar_pdf import *
	from .upload_excel import *
	from .view_excel import *
	from .reservados import *
	from .embalar import *
	from .expedicao import *
	from .excluir_agendamento import * 
	from .relatorio import *
agendamentos.py=from main import app, render_template, agendamento_controller, ParametroInvalido
	from flask import session
	from datetime import datetime
	
	""" Leva para as p√°ginas 'novoAgendamento' e 'agendamentos' """
	@app.route("/agendamentos/<acao>")
	def agendamentos(acao):
	    if acao == "criar":
	        return render_template("novoAgendamento.html")
	    elif acao == "ver":
	        # 1) Carrega tudo em mem√≥ria
	        agendamento_controller.clear_agendamentos()
	        agendamento_controller.create_agendamento_from_bd_data()
	        todos = agendamento_controller.agendamentos
	
	        # ‚Äî Ordena do mais recente para o mais antigo pela data de entrada
	        todos.sort(key=lambda a: a.entrada or datetime.min, reverse=True)
	        # 2) Filtra pelo role
	        role = session.get("role", "all")
	        if role == "limp_conf":
	            # s√≥ Limpeza (1) e Confer√™ncia (3)
	            dados = [a for a in todos if a.id_tipo in (1, 3)]
	        elif role == "emb_exp":
	            # s√≥ Embalar (4) e Expedi√ß√£o (5)
	            dados = [a for a in todos if a.id_tipo in (4, 5)]
	        else:
	            # 'all' ou qualquer outro role v√™ tudo
	            dados = todos
	
	        # 3) Renderiza s√≥ os permitidos
	        return render_template("agendamentos.html", dados=dados)
	
	    else:
	        raise ParametroInvalido()
	
alteracoes.py=from main import (
	    app, 
	    render_template, 
	    request, 
	    redirect,
	    url_for,
	    jsonify,
	    agendamento_controller, 
	    caller, 
	    ParametroInvalido, 
	    MetodoInvalido, 
	    LimiteRequests)
	import time
	
	""" Leva para as p√°ginas 'alteracoes' e 'compras' """
	@app.route("/alteracoes/<acao>", methods=["GET", "POST"])
	def alteracoes(acao):
	    if acao == "alterar":
	        if request.method == "POST":
	            agendamento_controller.clear_agendamentos()
	
	            agendamento_controller.insert_agendamento(request.json["id_agend"])
	            agendamento_obj = agendamento_controller.get_last_made_agendamento()
	            agendamento_controller.create_agendamento_from_bd_data(agendamento_obj)
	            # agendamento_controller.view.display_all_in_agend(agendamento_obj)
	
	            produto_obj = agendamento_controller.search_produto(
	                agendamento_obj, "id_bd", str(request.json["id_prod"])
	            )
	
	            agendamento_controller.insert_composicao_alteracao_in_bd(
	                produto_obj, request.json["itens"]
	            )
	
	            return "Dados para serem alterados foram inseridos no banco de dados!"
	        elif request.method == "GET":
	            agendamento_controller.clear_agendamentos()
	            agendamento_controller.create_agendamento_for_alteracao()
	            joined_agend = agendamento_controller.create_joined_agendamento()
	
	            return render_template(
	                "alteracoes.html",
	                dados=agendamento_controller.return_joined_composicoes_from_joined_agend(
	                    joined_agend
	                )
	            )
	        else:
	            raise MetodoInvalido()
	    elif acao == "comprar":
	        if request.method == "POST":
	            agendamento_controller.clear_agendamentos()
	
	            agendamento_controller.insert_agendamento(request.json["id_agend"])
	            agendamento_obj = agendamento_controller.get_last_made_agendamento()
	            agendamento_controller.create_agendamento_from_bd_data(agendamento_obj)
	            # agendamento_controller.view.display_all_in_agend(agendamento_obj)
	
	            produto_obj = agendamento_controller.search_produto(
	                agendamento_obj, "id_bd", str(request.json["id_prod"])
	            )
	
	            agendamento_controller.insert_composicao_compras_in_bd(
	                produto_obj, request.json["itens"]
	            )
	
	            return "Dados para serem comprados foram inseridos no banco de dados!"
	        else:
	            agendamento_controller.clear_agendamentos()
	
	            return render_template(
	                "compras.html",
	                dados=agendamento_controller.get_compras_data()
	            )
	    else:
	        raise ParametroInvalido()
	
	
	@app.route("/dados-compra-tiny/<id_tiny>")
	async def teste(id_tiny):
	    
	    try:
	        resp = caller.make_call(f"produtos/{id_tiny}")
	        time.sleep(5)
	    except BaseException:
	        raise LimiteRequests()
	    return resp
	
	@app.route("/dados-estoque/<id_tiny>")
	async def dados_estoque(id_tiny):
	    try:
	        resp = caller.make_call(f"estoque/{id_tiny}")
	        time.sleep(5)
	        if isinstance(resp, dict) and "status" in resp and resp["status"] >= 400:
	            # Se caller.make_call retorna um dicion√°rio com um status de erro
	            return jsonify(resp), resp["status"]
	        return jsonify(resp)
	    except LimiteRequests:
	        raise LimiteRequests()
	    except Exception as e:
	        print(f"Erro inesperado ao chamar a API externa: {e}")
	        return jsonify({"error": "Erro interno ao processar a requisi√ß√£o"}), 500
	
	@app.route('/remover-compra/<id>/<quant>')
	async def remover(id, quant):
	    agendamento_controller.update_quant_compra(id, quant)
	    return render_template(
	                "compras.html",
	                dados=agendamento_controller.get_compras_data()
	            )
alterar_agendamento.py=from main import (
	    app,
	    render_template,
	    request,
	    agendamento_controller,
	    redirect,
	    url_for,
	    MetodoInvalido
	)
	
	@app.route("/alterar-agendamento", methods=["POST", "GET"])
	def alt_agend():
	    if request.method == "GET":
	        # carregar em mem√≥ria o agendamento a partir do BD
	        agendamento_controller.clear_agendamentos()
	        agendamento_controller.insert_agendamento(id_bd=int(request.args["id"]))
	        agend_obj = agendamento_controller.get_last_made_agendamento()
	        agendamento_controller.create_agendamento_from_bd_data(agend_obj)
	
	        # se for chamada via AJAX (modal), devolve s√≥ o partial
	        if request.args.get("modal") == "true":
	            return render_template(
	                "partials/form_editar_agendamento.html",
	                dados=agendamento_controller.get_last_made_agendamento()
	            )
	
	        # caso contr√°rio, p√°gina completa
	        return render_template(
	            "alterar_agendamento.html",
	            dados=agendamento_controller.get_last_made_agendamento()
	        )
	
	    elif request.method == "POST":
	        try:
	            # 1) Pega o ID do agendamento que veio no form
	            id_bd = int(request.form["inp_id"])
	
	            # 2) Busca o registro atual no BD para extrair o colaborador
	            registro = agendamento_controller.db_controller.get_agendamento_by_bd_id(id_bd)
	            colaborador_atual = registro[0][5] if registro and registro[0][5] else ""
	            centro_atual = registro[0][6] if registro and registro[0][6] else ""
	
	            # 3) Recria em mem√≥ria o objeto de agendamento (mantendo colaborador)
	            agendamento_controller.clear_agendamentos()
	            agendamento_controller.insert_agendamento(
	                id_bd,
	                request.form["inp_ml"],
	                int(request.form["inp_tipo"]),
	                int(request.form["inp_emp"]),
	                int(request.form["inp_mktp"]),
	                colaborador_atual,
	                centro_distribuicao=centro_atual
	            )
	
	            # 4) Executa o UPDATE no BD
	            agendamento_controller.update_agendamento(
	                agendamento_controller.get_last_made_agendamento()
	            )
	
	            # resposta para AJAX
	            if request.headers.get("X-Requested-With") == "XMLHttpRequest":
	                return "ok", 200
	
	            # redireciona com flag de sucesso
	            return redirect(url_for("agendamentos", acao="ver", alterado="ok"))
	
	        except Exception as e:
	            print(f"Erro ao alterar agendamento: {e}")
	
	            if request.headers.get("X-Requested-With") == "XMLHttpRequest":
	                return "erro", 500
	
	            return redirect(url_for("agendamentos", acao="ver", erro="alteracao"))
	
	    else:
	        raise MetodoInvalido()
	
atualizar_agend.py=from main import app, redirect, url_for, request, caller
	from collections import Counter
	
	""" Faz o BackEnd atualizar partes de um kit que foram alterados no tiny """
	# N√ÉO FOI REPASSADO PARA A NOVA INFRA
	@app.route('/atualizar')
	def atualizar_agend():
	    bd_data = caller.access.custom_select_query(f'SELECT  p.id_prod_tiny, c.id_comp_tiny FROM comp_agend c JOIN produtos_agend p WHERE id_prod_comp = {request.args['prod_id']} AND c.id_prod_comp = p.id_prod;')
	    id_tiny = bd_data[0][0]
	    ids_comp = [int(i[1]) for i in bd_data]
	    resp = caller.make_call(f'produtos/{id_tiny}/kit')
	    ids_kit = [i['produto']['id'] for i in resp]
	    if Counter(ids_comp) == Counter(ids_kit):
	        print("TUDO IGUAL")
	    else:
	        print(ids_comp)
	        print(ids_kit)
	        remove = [(i, request.args['prod_id']) for i in ids_comp if i not in ids_kit]
	        caller.access.custom_i_u_query('UPDATE comp_agend SET substituido_comp = 1 WHERE id_comp_tiny = %s AND id_prod_comp = %s', remove)
	    return redirect(url_for('retirado_estoque', id=request.args['id'], tipo=request.args['tipo']))
atualizar_pdf.py=import os
	import time
	from flask import request, redirect, url_for, flash
	from werkzeug.utils import secure_filename
	
	# Importe as vari√°veis globais da sua aplica√ß√£o (app, controller, etc.)
	from main import app, agendamento_controller 
	
	@app.route('/atualizar-pdf', methods=['POST'])
	def atualizar_pdf_route():
	    # Valida se os campos necess√°rios foram enviados no formul√°rio
	    if 'path' not in request.files or 'id_bd_atualizar' not in request.form:
	        flash('Requisi√ß√£o inv√°lida. Faltam par√¢metros.', 'danger')
	        # Redireciona para a p√°gina de visualiza√ß√£o de agendamentos
	        return redirect(url_for('agendamentos', acao='ver'))
	
	    file = request.files['path']
	    id_bd = request.form.get('id_bd_atualizar')
	
	    if file.filename == '' or not id_bd:
	        flash('Dados incompletos. Selecione um arquivo e tente novamente.', 'warning')
	        return redirect(url_for('agendamentos', acao='ver'))
	
	    # Verifica se o arquivo √© um PDF
	    if file and file.filename.endswith('.pdf'):
	        try:
	            # Garante um nome de arquivo seguro e √∫nico
	            filename = secure_filename(f"update_{id_bd}_{int(time.time())}.pdf")
	            
	            # Define o caminho para salvar o arquivo (ajuste a pasta se necess√°rio)
	            upload_folder = app.config.get('UPLOAD_FOLDER', 'uploads') 
	            if not os.path.exists(upload_folder):
	                os.makedirs(upload_folder)
	            pdf_path = os.path.join(upload_folder, filename)
	            
	            file.save(pdf_path)
	
	            # Chama o m√©todo do controller para processar a atualiza√ß√£o
	            success, message = agendamento_controller.update_pdf_agendamento(int(id_bd), pdf_path)
	            
	            # Remove o arquivo tempor√°rio ap√≥s o processamento
	            os.remove(pdf_path) 
	
	            if success:
	                # Adiciona o par√¢metro 'atualizado=ok' para o feedback no front-end
	                return redirect(url_for('agendamentos', acao='ver', atualizado='ok'))
	            else:
	                flash(f'Erro na atualiza√ß√£o: {message}', 'danger')
	                return redirect(url_for('agendamentos', acao='ver'))
	
	        except Exception as e:
	            flash(f'Ocorreu um erro inesperado: {str(e)}', 'danger')
	            return redirect(url_for('agendamentos', acao='ver'))
	    
	    # Se o arquivo n√£o for um PDF
	    flash('Formato de arquivo inv√°lido. Por favor, envie um PDF.', 'warning')
	    return redirect(url_for('agendamentos', acao='ver'))
auth.py=# rotas/auth.py
	from flask import (
	    Blueprint,
	    render_template,
	    request,
	    redirect,
	    url_for,
	    session,
	    flash
	)
	from hashlib import sha256
	from base_jp_lab import Access
	
	bp_auth = Blueprint(
	    'auth',
	    __name__,
	    template_folder='../templates'   # ajusta se necess√°rio
	)
	
	# inst√¢ncia de acesso; se preferir, mova para um arquivo de config comum
	access = Access(
	    "Bruno_Lallo",
	    "ji}dx(v{M,z2j+f>[/}%_Vr-0?nI}W*@Dw68NnHJ+tMu&ZkF",
	    "192.168.15.200",
	    "3306",
	    "jp_bd",
	)
	
	def render_error_page(error_title, error_msg, referrer):
	    return render_template(
	        'error_page.html',
	        error_title=error_title,
	        error_msg=error_msg,
	        referrer=referrer
	    )
	
	@bp_auth.route('/login', methods=['GET', 'POST'])
	def login():
	    if request.method == 'GET':
	        return render_template('login.html')
	
	    usuario = request.form.get('usuario', '').strip()
	    senha    = request.form.get('senha', '')
	
	    rows = access.custom_select_query(
	        "SELECT id_usuario, nome_usuario, nome_display_usuario, senha_usuario, role "
	        "FROM usuarios WHERE nome_usuario = %s",
	        (usuario,)
	    )
	
	    # Se n√£o encontrou ou a senha n√£o bate, retorna o mesmo erro gen√©rico
	    if not rows or sha256(senha.encode()).hexdigest() != rows[0][3]:
	        return render_template('login.html', login_error="Usu√°rio ou senha incorretos")
	
	    # Autentica√ß√£o ok
	    user_id, _, display_name, _, role = rows[0]
	    session.clear()
	    session['id_usuario']           = user_id
	    session['nome_display_usuario'] = display_name
	    session['role'] = role
	    return redirect(url_for('homepage'))
	
	
	@bp_auth.route('/logout')
	def logout():
	    session.clear()
	    flash('Voc√™ saiu do sistema.', 'info')
	    return redirect(url_for('auth.login'))
	
config.py=from main import app, render_template
	
	DB_CONFIG = {
	    "host": "192.168.15.200",
	    "port": 3306,
	    "user": "Bruno_Lallo",
	    "password": "ji}dx(v{M,z2j+f>[/}%_Vr-0?nI}W*@Dw68NnHJ+tMu&ZkF",
	    "database": "jp_bd",
	    "autocommit": True,
	}
	
	""" Leva para a p√°gina 'config' """
	@app.route('/config')
	def config():
	    return render_template('config.html')
downloads.py=from main import app, request, pd, send_from_directory, redirect, url_for, ParametroInvalido
	import datetime
	
	@app.route("/compra-planilha/<extensao>", methods=['POST'])
	def compra_para_csv(extensao):
	    if extensao == 'excel' or extensao == 'csv' or extensao == 'pdf':
	        filename = f'compras-{datetime.datetime.today().strftime('%d-%m-%Y')}.{'csv' if extensao == 'csv' else 'xlsx'}'
	        df = pd.DataFrame(eval(request.form['dados']))
	        if extensao == 'csv':
	            df.to_csv(f'temp/{filename}', index=False, encoding='utf-8')
	        elif extensao == 'excel':
	            df.to_excel(f'temp/{filename}', index=False)
	        elif extensao == 'pdf':
	            return 'IMPLEMENTA√á√ÉO AINDA N√ÉO FEITA' # TODO Implementar constru√ß√£o e download de PDF
	        else:
	            raise ParametroInvalido()
	        return redirect(url_for('download_compra', filename=filename))
	    else:
	        return redirect(url_for('erro', error_title='Teste', error_msg='Teste-MSG'))
	    
	@app.route("/download-compra/<filename>")
	def download_compra(filename):
	    file = send_from_directory('temp', filename)
	    return file
	
	# TODO Limpar arquivos criados ap√≥s o envio. FONTE: https://stackoverflow.com/questions/53747258/flask-send-file-not-sending-file
embalar.py=from flask import Blueprint, render_template, request, jsonify, json, current_app
	from base_jp_lab import Caller
	from classes.models.DatabaseModel import Database
	from classes.controllers.DatabaseController import DatabaseController
	from classes.controllers.AgendamentoController import AgendamentoController
	from datetime import datetime
	import mysql.connector
	from mysql.connector import errorcode
	
	bp_embalar = Blueprint("embalar", __name__, template_folder="templates")
	
	# Configura√ß√£o de acesso ao MySQL
	_db_config = {
	    'host': '192.168.15.200',
	    'port': 3306,
	    'user': 'Bruno_Lallo',
	    'password': 'ji}dx(v{M,z2j+f>[/}%_Vr-0?nI}W*@Dw68NnHJ+tMu&ZkF',
	    'database': 'jp_bd',
	    'autocommit': True
	}
	
	@bp_embalar.route("/api/embalar/buscar_anuncios", methods=["GET"])
	def buscar_anuncios():
	    ag_ctrl = current_app.config['AG_CTRL']
	    caller  = current_app.config['CALLER']
	
	    id_agendamento = request.args.get("id_agendamento")
	    if not id_agendamento:
	        return jsonify({"error": "ID do agendamento n√£o fornecido."}), 400
	
	    try:
	        # monta objeto Agendamento usando o controller compartilhado
	        ag = ag_ctrl.create_agendamento_from_bd_data(id_agendamento)
	        if not ag:
	            return jsonify({"error": "Agendamento n√£o encontrado."}), 404
	
	        anuncios = []
	        for produto in ag.produtos:
	            pd = produto.to_dict()
	
	            # imagem do Tiny
	            try:
	                detalhes = caller.make_call(f"produtos/{produto.id_tiny}")
	                anexos = detalhes.get("anexos", [])
	                pd["imagemUrl"] = anexos[0].get("url", "") if anexos else ""
	            except Exception:
	                pd["imagemUrl"] = ""
	
	            # composi√ß√£o do kit
	            try:
	                kits_resp = caller.make_call(f"produtos/{produto.id_tiny}/kits")
	                kits = kits_resp.get("kits", [])
	                pd["composicoes"] = [{
	                    "nome":            kit.get("nome"),
	                    "sku":             kit.get("sku"),
	                    "unidades_totais": kit.get("quantidade", 0),
	                    "estoque_error_flag": "red" if kit.get("quantidade", 0) > kit.get("estoque_tiny", 0) else "green"
	                } for kit in kits]
	            except Exception:
	                pd["composicoes"] = [c.to_dict() for c in produto.composicoes]
	
	            anuncios.append(pd)
	
	        return jsonify({"success": True, "anuncios": anuncios})
	
	    except Exception as e:
	        print(f"Erro ao buscar an√∫ncios: {e}")
	        return jsonify({"error": "Erro interno do servidor ao buscar an√∫ncios."}), 500
	
	@bp_embalar.route("/api/embalar/bipar", methods=["POST"])
	def bipar_embalagem():
	    data = request.get_json() or {}
	    id_agend = data.get("id_agend_ml")
	    id_prod_ml = data.get("id_prod_ml")
	    if not id_agend or not id_prod_ml: # E verificamos a nova vari√°vel
	        return jsonify(error="Par√¢metros 'id_agend_ml' e 'id_prod_ml' s√£o obrigat√≥rios."), 400
	
	    insert_sql = """
	        INSERT INTO embalagem_bipados (id_agend_ml, id_prod_ml, bipados)
	        VALUES (%s, %s, 1)
	        ON DUPLICATE KEY UPDATE bipados = bipados + 1
	    """
	    select_sql = """
	        SELECT bipados FROM embalagem_bipados WHERE id_agend_ml = %s AND id_prod_ml = %s
	    """
	
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur = conn.cursor()
	        cur.execute(insert_sql, (id_agend, id_prod_ml))
	        cur.execute(select_sql, (id_agend, id_prod_ml))
	        row = cur.fetchone()
	        novo_total = row[0] if row else 0
	        cur.close()
	        conn.close()
	        return jsonify(id_prod_ml=id_prod_ml, bipados=novo_total)
	    except Exception as e:
	        print(f"Erro em bipar_embalagem: {e}")
	        return jsonify(error=str(e)), 500
	
	@bp_embalar.route('/api/embalar/bipados/<id_agend_ml>')
	def api_embalar_bipados(id_agend_ml):
	    select_sql = """
	        SELECT id_prod_ml, bipados
	        FROM embalagem_bipados
	        WHERE id_agend_ml = %s
	    """
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur = conn.cursor()
	        cur.execute(select_sql, (id_agend_ml,))
	        rows = cur.fetchall()
	        cur.close()
	        conn.close()
	        return jsonify([{'id_prod_ml': r[0], 'bipados': r[1]} for r in rows])
	    except Exception as e:
	        print(f"Erro em api_embalar_bipados: {e}")
	        return jsonify(error=str(e)), 500
	    
	# cria uma nova caixa
	@bp_embalar.route("/api/embalar/caixa", methods=["POST"])
	def criar_caixa():
	    data = request.get_json() or {}
	    id_agend = str(data.get("id_agend_ml") or "").strip()
	    if not id_agend:
	        return jsonify(error="id_agend_ml obrigat√≥rio"), 400
	
	    conn = mysql.connector.connect(**_db_config)
	    try:
	        conn.start_transaction()
	        cur = conn.cursor()
	
	        cur.execute("""
	            SELECT COALESCE(MAX(caixa_num), 0)
	            FROM embalagem_caixas
	            WHERE id_agend_ml=%s
	            FOR UPDATE
	        """, (id_agend,))
	        prox = (cur.fetchone()[0] or 0) + 1
	
	        codigo = f"{id_agend}-{prox}"
	        cur.execute("""
	            INSERT INTO embalagem_caixas
	                (id_agend_ml, caixa_num, codigo_unico_caixa, inicio_embalagem)
	            VALUES (%s, %s, %s, NOW())
	        """, (id_agend, prox, codigo))
	        conn.commit()
	        return jsonify(caixa_num=prox, codigo_unico_caixa=codigo), 201
	
	    except mysql.connector.Error as e:
	        conn.rollback()
	        if getattr(e, "errno", None) == errorcode.ER_DUP_ENTRY:
	            cur = conn.cursor()
	            cur.execute("""
	                SELECT caixa_num, codigo_unico_caixa
	                FROM embalagem_caixas
	                WHERE id_agend_ml=%s
	                ORDER BY caixa_num DESC LIMIT 1
	            """, (id_agend,))
	            row = cur.fetchone()
	            if row:
	                return jsonify(caixa_num=row[0], codigo_unico_caixa=row[1]), 200
	        raise
	    finally:
	        try: cur.close()
	        except Exception: pass
	        conn.close()
	        
	@bp_embalar.route("/api/embalar/scan", methods=["POST"])
	def scan_atomico():
	    data = request.get_json() or {}
	    id_agend = str(data.get("id_agend_ml") or "").strip()
	    id_prod_ml = str(data.get("id_prod_ml") or "").strip()  # etiqueta
	    sku = str(data.get("sku") or "").strip()                # o que vai gravar na caixa (pode ser a pr√≥pria etiqueta)
	    codigo = (data.get("codigo_unico_caixa") or "").strip()
	    cx_num = data.get("caixa_num")
	
	    if not id_agend or not id_prod_ml or not sku or (not codigo and cx_num is None):
	        return jsonify(ok=False, error="Informe id_agend_ml, id_prod_ml, sku e caixa (codigo_unico_caixa OU caixa_num)."), 400
	
	    conn = mysql.connector.connect(**_db_config)
	    try:
	        conn.start_transaction()
	        cur = conn.cursor()
	
	        if codigo and cx_num is None:
	            cur.execute("""
	                SELECT caixa_num FROM embalagem_caixas
	                WHERE id_agend_ml=%s AND codigo_unico_caixa=%s
	                FOR UPDATE
	            """, (id_agend, codigo))
	            row = cur.fetchone()
	            if not row:
	                conn.rollback()
	                return jsonify(ok=False, error="Caixa n√£o encontrada (codigo_unico_caixa)."), 404
	            cx_num = int(row[0])
	        else:
	            cur.execute("""
	                SELECT 1 FROM embalagem_caixas
	                WHERE id_agend_ml=%s AND caixa_num=%s
	                FOR UPDATE
	            """, (id_agend, cx_num))
	            if not cur.fetchone():
	                conn.rollback()
	                return jsonify(ok=False, error="Caixa n√£o encontrada (caixa_num)."), 404
	
	        cur.execute("""
	            INSERT INTO embalagem_bipados (id_agend_ml, id_prod_ml, bipados)
	            VALUES (%s, %s, 1)
	            ON DUPLICATE KEY UPDATE bipados = bipados + 1
	        """, (id_agend, id_prod_ml))
	
	        cur.execute("""
	            INSERT INTO embalagem_caixa_itens (id_agend_ml, caixa_num, sku, quantidade)
	            VALUES (%s, %s, %s, 1)
	            ON DUPLICATE KEY UPDATE quantidade = quantidade + 1
	        """, (id_agend, cx_num, sku))
	
	        cur.execute("""
	            SELECT bipados FROM embalagem_bipados
	            WHERE id_agend_ml=%s AND id_prod_ml=%s
	        """, (id_agend, id_prod_ml))
	        bipados_atual = int((cur.fetchone() or [0])[0])
	
	        cur.execute("""
	            SELECT quantidade FROM embalagem_caixa_itens
	            WHERE id_agend_ml=%s AND caixa_num=%s AND sku=%s
	        """, (id_agend, cx_num, sku))
	        qtd_na_caixa = int((cur.fetchone() or [0])[0])
	
	        conn.commit()
	        return jsonify(ok=True,
	                       id_agend_ml=id_agend,
	                       id_prod_ml=id_prod_ml,
	                       caixa_num=cx_num,
	                       sku=sku,
	                       bipados=bipados_atual,
	                       quantidade_caixa=qtd_na_caixa)
	    except Exception as e:
	        conn.rollback()
	        return jsonify(ok=False, error=str(e)), 500
	    finally:
	        try: cur.close()
	        except Exception: pass
	        conn.close()
	
	@bp_embalar.route("/api/embalar/caixa/item", methods=["POST"])
	def adicionar_item_caixa():
	    data = request.get_json() or {}
	    id_agend = data.get("id_agend_ml")
	    caixa_num = data.get("caixa_num")
	    sku = data.get("sku")
	    if not all([id_agend, caixa_num, sku]):
	        return jsonify(error="Par√¢metros inv√°lidos"), 400
	
	    conn = mysql.connector.connect(**_db_config)
	    cur  = conn.cursor()
	    # tenta inserir, ou incrementa se j√° existir
	    cur.execute("""
	        INSERT INTO embalagem_caixa_itens (id_agend_ml, caixa_num, sku, quantidade)
	        VALUES (%s,%s,%s,1)
	        ON DUPLICATE KEY UPDATE quantidade = quantidade + 1
	    """, (id_agend, caixa_num, sku))
	    conn.commit()
	    # l√™ quantidade atual
	    cur.execute("""
	    SELECT quantidade FROM embalagem_caixa_itens
	    WHERE id_agend_ml=%s AND caixa_num=%s AND sku=%s
	    """, (id_agend, caixa_num, sku))
	    qtd = cur.fetchone()[0]
	    cur.close()
	    conn.close()
	    return jsonify(caixa_num=caixa_num, sku=sku, quantidade=qtd), 200
	
	@bp_embalar.route("/api/embalar/caixa/<id_agend_ml>", methods=["GET"])
	def buscar_caixas(id_agend_ml):
	    conn = mysql.connector.connect(**_db_config)
	    cur  = conn.cursor(dictionary=True)
	    cur.execute("""
	        SELECT caixa_num, codigo_unico_caixa
	        FROM embalagem_caixas
	        WHERE id_agend_ml=%s
	        ORDER BY caixa_num
	    """, (id_agend_ml,))
	    caixas_rows = cur.fetchall()
	    resultado = []
	    for row in caixas_rows:
	        num = row["caixa_num"]
	        cur.execute("""
	            SELECT sku, quantidade
	            FROM embalagem_caixa_itens
	            WHERE id_agend_ml=%s AND caixa_num=%s
	        """, (id_agend_ml, num))
	        itens = [{"sku": r["sku"], "quantidade": r["quantidade"]} for r in cur.fetchall()]
	        resultado.append({
	            "caixa_num": num,
	            "codigo_unico_caixa": row["codigo_unico_caixa"],
	            "itens": itens
	        })
	    cur.close(); conn.close()
	    return jsonify(resultado)
	
	@bp_embalar.route('/api/embalar/iniciar', methods=['POST'])
	def iniciar_embalagem():
	    """Cria um registro para um produto no in√≠cio da embalagem com 0 bipados."""
	    data = request.get_json() or {}
	    id_agend = data.get("id_agend_ml")
	    id_prod_ml = data.get("id_prod_ml")
	
	    if not id_agend or not id_prod_ml:
	        return jsonify(error="Par√¢metros 'id_agend_ml' e 'id_prod_ml' s√£o obrigat√≥rios."), 400
	
	    # Insere com 0 ou atualiza para 0 se j√° existir por algum motivo
	    sql = """
	        INSERT INTO embalagem_bipados (id_agend_ml, id_prod_ml, bipados)
	        VALUES (%s, %s, 0)
	        ON DUPLICATE KEY UPDATE bipados = 0
	    """
	
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur = conn.cursor()
	        cur.execute(sql, (id_agend, id_prod_ml))
	        conn.commit()
	        cur.close()
	        conn.close()
	        return jsonify(success=True, message="Produto iniciado na embalagem.")
	    except Exception as e:
	        print(f"Erro em iniciar_embalagem: {e}")
	        return jsonify(error=str(e)), 500
	
	@bp_embalar.route('/embalar/finalizar/<int:id_agend_bd>', methods=['POST'])
	def finalizar_embalagem(id_agend_bd):
	    """
	    Finaliza a fase de embalagem, gera um relat√≥rio e move o agendamento para a expedi√ß√£o.
	    """
	    try:
	        cfg = current_app.config
	        agendamento_controller = cfg['AG_CTRL']
	        access = cfg['ACCESS']
	        
	        # 1. Carrega o agendamento completo a partir do banco de dados
	        agendamento_controller.clear_agendamentos()
	        agendamento_controller.insert_agendamento(id_bd=id_agend_bd)
	        agend = agendamento_controller.get_last_made_agendamento()
	        agendamento_controller.create_agendamento_from_bd_data(agend)
	
	        if not agend:
	            return jsonify({"success": False, "message": "Agendamento n√£o encontrado."}), 404
	
	        # 2. Busca dados das caixas e itens embalados para o relat√≥rio
	        caixas_result = access.custom_select_query(
	            "SELECT caixa_num FROM embalagem_caixas WHERE id_agend_ml = %s ORDER BY caixa_num",
	            (agend.id_agend_ml,)
	        )
	        
	        caixas_relatorio = []
	        if caixas_result:
	            for caixa_row in caixas_result:
	                caixa_num = caixa_row[0]
	                # Busca os itens na caixa, incluindo o nome do produto
	                itens_result = access.custom_select_query(
	                    """SELECT i.sku, i.quantidade, p.nome_prod
	                    FROM embalagem_caixa_itens i
	                    LEFT JOIN produtos_agend p ON i.sku = p.sku_prod AND p.id_agend_prod = %s
	                    WHERE i.id_agend_ml = %s AND i.caixa_num = %s
	                    """,
	                    (agend.id_bd, agend.id_agend_ml, caixa_num)
	                )
	                itens_caixa = [{"sku": item[0], "quantidade": item[1], "nome": item[2]} for item in itens_result] if itens_result else []
	                caixas_relatorio.append({"caixa_numero": caixa_num, "itens": itens_caixa})
	
	        # 3. Monta o payload do relat√≥rio de embalagem
	        relatorio_payload = {
	            "tipo_relatorio": "embalagem",
	            "termino_embalagem": datetime.now().strftime("%d/%m/%Y %H:%M:%S"),
	            "detalhes_embalagem": {
	                "total_caixas": len(caixas_relatorio),
	                "caixas": caixas_relatorio
	            }
	        }
	
	        # 4. Busca o relat√≥rio de confer√™ncia existente para adicionar as novas informa√ß√µes
	        relatorio_final = {}
	        relatorio_existente_raw = access.custom_select_query(
	            "SELECT relatorio FROM relatorio_agend WHERE id_agend_ml = %s", (agend.id_agend_ml,)
	        )
	        if relatorio_existente_raw and relatorio_existente_raw[0][0]:
	            relatorio_final = json.loads(relatorio_existente_raw[0][0])
	
	        # Adiciona os dados de embalagem ao relat√≥rio geral
	        relatorio_final['RelatorioEmbalagem'] = relatorio_payload
	
	        # 5. Salva o relat√≥rio atualizado no banco
	        access.custom_i_u_query(
	            """INSERT INTO relatorio_agend (id_agend_ml, relatorio) VALUES (%s, %s)
	            ON DUPLICATE KEY UPDATE relatorio = VALUES(relatorio)""",
	            [(agend.id_agend_ml, json.dumps(relatorio_final, ensure_ascii=False))]
	        )
	
	        # 6. Altera o tipo do agendamento para Expedi√ß√£o (ID 5)
	        agend.set_tipo(5)
	        agendamento_controller.update_agendamento(agend)
	
	        return jsonify({"success": True, "message": "Embalagem finalizada. Agendamento movido para expedi√ß√£o."})
	
	    except Exception as e:
	        print(f"Erro ao finalizar embalagem: {e}")
	        return jsonify({"success": False, "message": str(e)}), 500
erro.py=from main import app, render_template, ParametroInvalido, MetodoInvalido, LimiteRequests, ArquivoInvalido
	
	def error_handler(err):
	    err_txt = err.description.split('///')
	    return render_template("erro.html", erro_title=err_txt[0], erro_msg_primary=err_txt[1], erro_msg_secondary=err_txt[2], erro_code=err.code)
	
	app.register_error_handler(ParametroInvalido, error_handler)
	app.register_error_handler(MetodoInvalido, error_handler)
	app.register_error_handler(LimiteRequests, error_handler)
	app.register_error_handler(ArquivoInvalido, error_handler)
excluir_agendamento.py=from main import app, jsonify, agendamento_controller
	
	@app.route('/agendamento/excluir/<int:id_agendamento>', methods=['DELETE'])
	def excluir_agendamento_route(id_agendamento):
	    """
	    Rota para lidar com requisi√ß√µes de exclus√£o de agendamentos.
	    """
	    if not id_agendamento:
	        return jsonify({"success": False, "message": "ID do agendamento n√£o fornecido."}), 400
	
	    sucesso = agendamento_controller.excluir_agendamento_completo(id_agendamento)
	
	    if sucesso:
	        return jsonify({"success": True, "message": "Agendamento exclu√≠do com sucesso."})
	    else:
	        return jsonify({"success": False, "message": "Erro ao excluir o agendamento."}), 500
expedicao.py=from flask import Blueprint, jsonify, request, render_template, current_app
	import json  # (builtin)
	
	bp_expedicao = Blueprint('expedicao', __name__, template_folder='templates')
	
	print("-> Definindo rotas para a Expedi√ß√£o...")
	
	@bp_expedicao.route('/expedicao/<int:id_agend_bd>')
	def expedicao(id_agend_bd: int):
	    """
	    Renderiza a p√°gina principal da expedi√ß√£o.
	    Carrega o agendamento do BD, monta as caixas com:
	      - codigo_unico = "<id_agend_ml>/<caixa_num>"
	      - total_unidades somando os itens da caixa
	    """
	    if not id_agend_bd:
	        # Mant√©m a mesma exce√ß√£o usada no projeto (vem do main/exceptions)
	        raise current_app.view_functions['health_check'].__globals__['ParametroInvalido']() \
	            if 'ParametroInvalido' in current_app.view_functions['health_check'].__globals__ else Exception("Par√¢metro inv√°lido")
	
	    cfg = current_app.config
	    agendamento_controller = cfg['AG_CTRL']
	    db_controller = cfg['DB_CTRL']
	
	    # Carrega agendamento completo
	    agendamento_controller.clear_agendamentos()
	    agendamento_controller.insert_agendamento(id_bd=id_agend_bd)
	    agendamento_obj = agendamento_controller.get_last_made_agendamento()
	    agendamento_controller.create_agendamento_from_bd_data(agendamento_obj)
	
	    if not agendamento_obj or not getattr(agendamento_obj, 'id_agend_ml', None):
	        return "Erro: Agendamento n√£o encontrado no banco de dados.", 404
	
	    # Caixas e produtos
	    caixas_data = db_controller.get_caixas_by_agendamento_ml(agendamento_obj.id_agend_ml)
	    produtos_para_json = [p.to_dict() for p in agendamento_obj.produtos]
	
	    # Campos derivados √∫teis no front
	    for caixa in caixas_data:
	        caixa['codigo_unico'] = f"{agendamento_obj.id_agend_ml}/{caixa['caixa_num']}"
	        caixa['total_unidades'] = sum(int(item.get('quantidade', 0)) for item in caixa.get('itens', []))
	
	    return render_template(
	        "expedicao.html",
	        dados_agend=agendamento_obj,
	        caixas=caixas_data,
	        todos_os_produtos_json=json.dumps(produtos_para_json, ensure_ascii=False)
	    )
	
	@bp_expedicao.route('/api/expedicao/bipar', methods=['POST'])
	def api_expedicao_bipar():
	    """
	    Registra uma caixa bipada (√∫nica) na expedi√ß√£o.
	    Usa INSERT IGNORE para n√£o duplicar.
	    """
	    data = request.get_json() or {}
	    id_agend_ml = data.get('id_agend_ml')
	    codigo_unico_caixa = data.get('codigo_unico_caixa')
	
	    if not id_agend_ml or not codigo_unico_caixa:
	        return jsonify({"success": False, "message": "Dados incompletos."}), 400
	
	    access = current_app.config['ACCESS']
	    try:
	        access.custom_i_u_query(
	            "INSERT IGNORE INTO expedicao_caixas_bipadas (id_agend_ml, codigo_unico_caixa) VALUES (%s, %s)",
	            [(id_agend_ml, codigo_unico_caixa)]
	        )
	        return jsonify({"success": True}), 201
	    except Exception as e:
	        print(f"!!! Erro ao salvar bipagem da expedi√ß√£o: {e}")
	        return jsonify({"success": False, "message": "Erro interno do servidor."}), 500
	
	@bp_expedicao.route('/api/expedicao/bipados/<id_agend_ml>')
	def api_expedicao_bipados(id_agend_ml):
	    """
	    Retorna a lista de c√≥digos √∫nicos de caixas j√° bipadas para um agendamento.
	    """
	    access = current_app.config['ACCESS']
	    try:
	        rows = access.custom_select_query(
	            "SELECT codigo_unico_caixa FROM expedicao_caixas_bipadas WHERE id_agend_ml = %s",
	            (id_agend_ml,)
	        ) or []
	        bipados = [r[0] for r in rows]
	        return jsonify({"success": True, "bipados": bipados})
	    except Exception as e:
	        print(f"!!! Erro ao buscar bipados da expedi√ß√£o: {e}")
	        return jsonify({"success": False, "message": "Erro interno do servidor."}), 500
	
	@bp_expedicao.route('/api/expedicao/iniciar', methods=['POST'])
	def iniciar_expedicao():
	    """
	    Marca o in√≠cio da expedi√ß√£o no BD e retorna o timestamp em ISO8601.
	    Mant√©m a l√≥gica ‚Äúantiga‚Äù (mais est√°vel) usando o db_controller.
	    """
	    data = request.get_json() or {}
	    id_agend_bd = data.get('id_agend_bd')
	    if not id_agend_bd:
	        return jsonify({"success": False, "message": "ID do agendamento n√£o fornecido."}), 400
	
	    cfg = current_app.config
	    db_controller = cfg['DB_CTRL']
	
	    try:
	        db_controller.update_expedicao_inicio(id_agend_bd)
	        agendamento = db_controller.get_agendamento_by_bd_id(id_agend_bd)[0]
	        # No antigo, o in√≠cio ficava no √≠ndice 8 ‚Äî mant√©m compatibilidade
	        start_time_iso = agendamento[8].isoformat() if agendamento[8] else None
	        return jsonify({"success": True, "startTime": start_time_iso})
	    except Exception as e:
	        print(f"!!! Erro ao iniciar a expedi√ß√£o: {e}")
	        return jsonify({"success": False, "message": str(e)}), 500
	
	@bp_expedicao.route('/api/expedicao/finalizar', methods=['POST'])
	def finalizar_expedicao():
	    """
	    Atualiza o status do agendamento para Finalizado e gera o relat√≥rio final.
	    Fluxo ‚Äúantigo‚Äù + melhoria: carrega o objeto antes de finalizar, finaliza, gera/salva relat√≥rio.
	    """
	    data = request.get_json() or {}
	    id_agend_bd = data.get('id_agend_bd')
	    if not id_agend_bd:
	        return jsonify({"success": False, "message": "ID do agendamento n√£o fornecido."}), 400
	
	    cfg = current_app.config
	    agendamento_controller = cfg['AG_CTRL']
	
	    try:
	        # 1) carrega o objeto do agendamento
	        agendamento_controller.clear_agendamentos()
	        agendamento_controller.insert_agendamento(id_bd=id_agend_bd)
	        agendamento_obj = agendamento_controller.get_last_made_agendamento()
	        agendamento_controller.create_agendamento_from_bd_data(agendamento_obj)
	
	        # 2) finaliza expedi√ß√£o (atualiza tempos/status no BD)
	        agendamento_controller.finalizar_expedicao(id_agend_bd)
	
	        # 3) gera e salva relat√≥rio final de expedi√ß√£o
	        agendamento_controller.gerar_e_salvar_relatorio_expedicao(agendamento_obj)
	
	        return jsonify({"success": True, "message": "Agendamento movido para 'Finalizado'."})
	    except Exception as e:
	        print(f"!!! Erro ao finalizar a expedi√ß√£o: {e}")
	        return jsonify({"success": False, "message": str(e)}), 500
	
health_check.py=from main import app, agendamento_controller, jsonify
	
	@app.route("/health")
	def health_check():
	    try:
	        # Test database connection
	        agendamento_controller.test_connection()
	        return jsonify({"status": "healthy", "database": "connected"}), 200
	    except Exception as e:
	        return jsonify({"status": "unhealthy", "error": str(e)}), 500
	
homepage.py=from main import app, render_template, session
	
	""" Leva para a p√°gina 'index' e cria var√≠aveis na sess√£o """
	@app.route('/')
	def homepage():
	    session['id_agendamento'] = ''
	    session['agend_process_done'] = False
	    session['estoque_tiny_done'] = False
	    return render_template('index.html')
imprimir_composicoes.py=from main import app, render_template, agendamento_controller, jsonify
	
	@app.get("/imprimir-comp/<id_agend>")
	def imprimir_composicao(id_agend:int):
	    agendamento_controller.clear_agendamentos()
	    agendamento_controller.insert_agendamento(id_bd=id_agend)
	    
	    agendamento_obj = agendamento_controller.get_last_made_agendamento()
	    
	    agendamento_controller.create_agendamento_from_bd_data(agendamento_obj)
	    
	    return_val = agendamento_controller.return_comp_grouped(agendamento_obj)
	    
	    print(return_val[0].comp_origem[0].localizacao)
	
	    return render_template("imprimir_composicoes.html", comps=sorted(return_val, key=lambda obj: obj.comp_origem[0].localizacao), agendamento=agendamento_obj)
process_pdf.py=from main import app, redirect, url_for, agendamento_controller
	from classes.models import Agendamento
	
	""" Faz o BackEnd processar o arquivo PDF baixado e envia os dados ao banco de dados """
	@app.route('/process-pdf/<path>/<type>')
	def process_pdf(path, type):
	    pdf_path = f"{app.config['UPLOAD_FOLDER']}/{path}"
	    agendamento_controller.create_agendamento_from_pdf(
	        pdf_path=pdf_path,
	        id_agend_ml=path.split('-')[1],
	        id_tipo=type,
	        empresa=0,
	        id_mktp=1,
	        colaborador=''
	    )
	    agendamento:Agendamento = agendamento_controller.agendamentos[-1]
	    agendamento_controller.get_prod_data_tiny(agendamento)
	    agendamento_controller.get_comp_tiny(agendamento)
	    agendamento_controller.get_comp_data_tiny(agendamento)
	
	    agendamento_controller.insert_agendamento_in_bd(agendamento)
	    # Como √© feito ap√≥s uma inser√ß√£o, nunca acontecer√° de n√£o haver resposta
	    id_agend_bd = agendamento_controller.get_last_made_agendamento_in_bd()[0]
	
	    agendamento_controller.set_id_bd_for_all(agendamento, id_agend_bd)
	
	    agendamento_controller.insert_produto_in_bd(agendamento)
	
	    for i in agendamento_controller.return_all_produtos_from_agendamento(agendamento):
	        produto = agendamento_controller.search_produto(agendamento, 'etiqueta', i[2])
	        produto.set_id_bd(i[0])
	        produto.set_id_bd_for_composicoes()
	
	    agendamento_controller.set_error_flags_composicoes(agendamento)
	
	    agendamento_controller.insert_composicao_in_bd(agendamento)
	
	    return redirect(url_for('agendamentos', acao='ver'))
	
relatorio.py=# agendamentos_web/rotas/relatorio.py
	
	from flask import Blueprint, render_template, jsonify
	from main import db_controller  # Importe o db_controller do seu main.py
	import json
	
	bp_relatorio = Blueprint('relatorio', __name__)
	
	@bp_relatorio.route('/relatorio/<id_agend_ml>')
	def ver_relatorio(id_agend_ml):
	    """
	    Busca os dados do relat√≥rio em JSON no banco de dados,
	    converte para um dicion√°rio Python e renderiza um template parcial.
	    """
	    try:
	        # Usa o m√©todo que j√° existe no seu DatabaseController
	        relatorio_str = db_controller.get_relatorio_by_agendamento_ml(id_agend_ml)
	
	        if not relatorio_str:
	            # Retorna um erro amig√°vel se o relat√≥rio n√£o for encontrado
	            return '<div class="alert alert-warning">Relat√≥rio n√£o encontrado para este agendamento.</div>'
	
	        # Converte a string JSON para um dicion√°rio Python
	        dados_relatorio = json.loads(relatorio_str)
	
	        # Renderiza um template HTML apenas com o conte√∫do do modal
	        return render_template('partials/modal_relatorio_conteudo.html', relatorio=dados_relatorio)
	
	    except Exception as e:
	        print(f"Erro ao buscar relat√≥rio: {e}")
	        return '<div class="alert alert-danger">Ocorreu um erro ao carregar o relat√≥rio.</div>'
reservados.py=from main import app, render_template
	
	@app.route('/reservados')
	def reservados():
	    # aqui voc√™ pode buscar os "reservados" no banco e passar ao template
	    dados_reservados = []  # substitua pela sua l√≥gica
	    return render_template('reservados.html', dados=dados_reservados)
	
retiradoEstoque.py=import json
	import mysql.connector
	from flask import session, render_template, Blueprint, request, jsonify, current_app as app, redirect, url_for, make_response
	from datetime import datetime
	from classes.models import Agendamento
	import requests
	from datetime import datetime, date
	import re
	import threading
	import queue
	import uuid
	from typing import Literal, Optional
	from datetime import datetime
	import pytz
	
	tz = pytz.timezone("America/Sao_Paulo")
	data_str = datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
	
	bp_retirado = Blueprint('retirado', __name__)
	
	_TINY_BASE = "https://api.tiny.com.br/public-api/v3"  # segue seu padr√£o
	
	# Fila e status de tarefas em mem√≥ria (simples; rein√≠cio do app limpa o estado)
	_mov_queue: "queue.Queue[dict]" = queue.Queue()
	_mov_status: dict[str, dict] = {}
	_mov_worker_started = False
	
	# Configura√ß√£o de acesso ao MySQL
	_db_config = {
	    'host': '192.168.15.200',
	    'port': 3306,
	    'user': 'Bruno_Lallo',
	    'password': 'ji}dx(v{M,z2j+f>[/}%_Vr-0?nI}W*@Dw68NnHJ+tMu&ZkF',
	    'database': 'jp_bd',
	    'autocommit': True
	}
	
	# ===================== WORKER (com retries) =====================
	
	def _start_estoque_worker_once():
	    """Inicia uma √∫nica thread daemon que consome _mov_queue e lan√ßa no Tiny (com logs detalhados)."""
	    global _mov_worker_started
	    if _mov_worker_started:
	        print("[estoque-worker] j√° iniciado.")
	        return
	
	    def _estoque_worker():
	        import time
	
	        print("[estoque-worker] thread iniciada.")
	        while True:
	            task = _mov_queue.get()  # bloqueia at√© ter tarefa
	            task_id = task["task_id"]
	            print("\n[estoque-worker] >>> Nova task recebida:", task_id)
	            print("[estoque-worker] Task bruta:", task)
	
	            try:
	                _mov_status[task_id]["status"] = "processando"
	
	                id_produto: int = task["id_produto"]
	                id_deposito: int = task["id_deposito"]
	                quantidade: float = task["quantidade"]
	                tipo_api: Literal["S", "E", "B"] = task["tipo_api"]
	                token: str = task["token"]
	                observacoes: Optional[str] = task.get("observacoes")
	                preco_unitario: Optional[float] = task.get("preco_unitario")
	
	                try:
	                    tz = pytz.timezone("America/Sao_Paulo")
	                    data_str = datetime.now(tz).strftime("%Y-%m-%d %H:%M:%S")
	                except Exception:
	                    data_str = datetime.now().strftime("%Y-%m-%d %H:%M:%S")
	
	                quantidade_abs = abs(float(quantidade))
	                url = f"{_TINY_BASE}/estoque/{id_produto}"
	
	                current_token = token
	                attempt_429 = 0
	                did_swap_token = False
	
	                print(f"[estoque-worker:{task_id}] url={url}")
	                print(f"[estoque-worker:{task_id}] deposito={id_deposito} produto={id_produto} qtd={quantidade_abs} tipo={tipo_api}")
	                print(f"[estoque-worker:{task_id}] token(recebido)={current_token[:5]}...{current_token[-5:] if len(current_token)>5 else current_token} (len={len(current_token)})")
	
	                while True:
	                    auth_header = _normalize_bearer(current_token)
	                    print(f"[estoque-worker:{task_id}] Authorization header=Bearer <{len(current_token)} chars> (prefix ok={auth_header.lower().startswith('bearer ')})")
	
	                    headers = {
	                        "Authorization": auth_header,
	                        "User-Agent": "AgendamentosWeb/1.0",
	                        "Content-Type": "application/json",
	                        "Accept": "application/json",
	                    }
	                    body = {
	                        "deposito": {"id": id_deposito},
	                        "tipo": tipo_api,
	                        "data": data_str,
	                        "quantidade": quantidade_abs,
	                        "precoUnitario": float(preco_unitario) if preco_unitario is not None else 0,
	                        "observacoes": (observacoes or "")
	                    }
	
	                    print(f"[estoque-worker:{task_id}] POST -> Tiny (tentativa 429={attempt_429}, token_trocado={did_swap_token})")
	                    try:
	                        r = requests.post(url, headers=headers, json=body, timeout=30)
	                    except requests.RequestException as req_err:
	                        print(f"[estoque-worker:{task_id}] EXCEPTION requests: {req_err}")
	                        _mov_status[task_id]["status"] = "falhou"
	                        _mov_status[task_id]["error"] = {"exception": str(req_err)}
	                        break
	
	                    # Guarda payload essencial e status
	                    _mov_status[task_id]["request"] = {
	                        "url": url,
	                        "body": {**body, "observacoes": "[omitted]" if body.get("observacoes") else ""},
	                        "status_code": r.status_code
	                    }
	
	                    # Log de resposta
	                    resp_text = (r.text or "")
	                    short = (resp_text[:300] + ("..." if len(resp_text) > 300 else ""))
	                    print(f"[estoque-worker:{task_id}] Tiny respondeu HTTP {r.status_code}")
	                    print(f"[estoque-worker:{task_id}] Resumo resposta: {short}")
	
	                    try:
	                        resp_json = r.json()
	                    except Exception:
	                        resp_json = {"raw": resp_text}
	
	                    if 200 <= r.status_code < 300:
	                        print(f"[estoque-worker:{task_id}] ‚úÖ CONCLU√çDO. JSON:", resp_json)
	                        _mov_status[task_id]["status"] = "concluido"
	                        _mov_status[task_id]["result"] = resp_json
	                        break
	
	                    # 401/403 -> tenta trocar token UMA vez
	                    if r.status_code in (401, 403):
	                        print(f"[estoque-worker:{task_id}] ‚ö†Ô∏è Auth falhou ({r.status_code}). Tentando buscar token no DB...")
	                        if not did_swap_token:
	                            new_tok = _get_fallback_token_from_db()
	                            if new_tok and new_tok != current_token:
	                                print(f"[estoque-worker:{task_id}] Token trocado: {current_token[:3]}... -> {new_tok[:3]}... (len {len(new_tok)})")
	                                did_swap_token = True
	                                current_token  = new_tok
	                                continue  # reexecuta j√° com o novo token
	                            else:
	                                print(f"[estoque-worker:{task_id}] Nenhum token v√°lido retornado do DB (new_tok={bool(new_tok)}).")
	                        _mov_status[task_id]["status"] = "falhou"
	                        _mov_status[task_id]["error"] = {
	                            "status_code": r.status_code,
	                            "response": resp_json,
	                            "detail": "Falha de autentica√ß√£o; troca de token indispon√≠vel/ineficaz."
	                        }
	                        break
	
	                    # 429 -> backoff
	                    if r.status_code == 429:
	                        wait_s = _wait_backoff_429(attempt_429)
	                        print(f"[estoque-worker:{task_id}] 429 recebido. Pr√≥xima espera: {wait_s}s")
	                        attempt_429 += 1
	                        if wait_s < 0:
	                            print(f"[estoque-worker:{task_id}] ‚ùå Backoff m√°ximo atingido; encerrando.")
	                            _mov_status[task_id]["status"] = "falhou"
	                            _mov_status[task_id]["error"] = {
	                                "status_code": r.status_code,
	                                "response": resp_json,
	                                "detail": "Rate limit persistente; backoff m√°ximo atingido."
	                            }
	                            break
	                        time.sleep(wait_s)
	                        continue
	
	                    # Outros erros -> falha direta
	                    print(f"[estoque-worker:{task_id}] ‚ùå Erro n√£o tratado para retry (status={r.status_code}).")
	                    _mov_status[task_id]["status"] = "falhou"
	                    _mov_status[task_id]["error"] = {
	                        "status_code": r.status_code,
	                        "response": resp_json
	                    }
	                    break
	
	            except Exception as e:
	                print(f"[estoque-worker:{task_id}] EXCEPTION geral:", e)
	                _mov_status[task_id]["status"] = "falhou"
	                _mov_status[task_id]["error"] = {"exception": str(e)}
	                try:
	                    app.logger.exception("Falha no worker de estoque")
	                except Exception:
	                    pass
	            finally:
	                print(f"[estoque-worker] <<< Task finalizada: {task_id} (status={_mov_status[task_id]['status']})\n")
	                _mov_queue.task_done()
	
	    t = threading.Thread(target=_estoque_worker, daemon=True, name="estoque-worker")
	    t.start()
	    _mov_worker_started = True
	    print("[estoque-worker] thread disparada.")
	    
	@bp_retirado.route('/api/bipagem/detalhe', methods=['GET'])
	def api_bipagem_detalhe():
	    """
	    GET /api/bipagem/detalhe?id_agend_ml=123&sku=API1
	
	    Retorna:
	      - bipagem (1 linha de agendamento_produto_bipagem)
	      - equivalentes (N linhas de agendamento_produto_bipagem_equivalentes)
	      - totais (diretos, equivalentes_total, total)
	    """
	    try:
	        id_agend_ml_raw = request.args.get('id_agend_ml')
	        sku = (request.args.get('sku') or '').strip()
	
	        # valida√ß√µes
	        try:
	            id_agend_ml = int(id_agend_ml_raw)
	        except (TypeError, ValueError):
	            return _cors_error("Query 'id_agend_ml' deve ser inteiro", 400)
	        if not sku:
	            return _cors_error("Query 'sku' √© obrigat√≥ria", 400)
	        if len(sku) > 30:
	            return _cors_error("Query 'sku' excede 30 caracteres", 400)
	
	        # SQL
	        sql_bipagem = """
	            SELECT id_agend_ml, sku, bipados
	            FROM agendamento_produto_bipagem
	            WHERE id_agend_ml = %s AND sku = %s
	            LIMIT 1
	        """
	        sql_equivs = """
	            SELECT
	                id,
	                id_agend_ml,
	                sku_original,
	                gtin_original,
	                id_tiny_original,
	                nome_equivalente,
	                sku_bipado,
	                gtin_bipado,
	                id_tiny_equivalente,
	                bipados,
	                criado_por,
	                criado_em,
	                atualizado_em,
	                observacao
	            FROM agendamento_produto_bipagem_equivalentes
	            WHERE id_agend_ml = %s AND sku_original = %s
	            ORDER BY sku_bipado
	        """
	
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor(dictionary=True)
	
	        # 1) Direto
	        cur.execute(sql_bipagem, (id_agend_ml, sku))
	        bipagem = cur.fetchone()  # dict | None
	
	        # 2) Equivalentes
	        cur.execute(sql_equivs, (id_agend_ml, sku))
	        equivalentes = cur.fetchall()  # list[dict]
	
	        cur.close(); conn.close()
	
	        # helpers
	        def serialize(v):
	            if isinstance(v, (datetime, date)):
	                return v.strftime("%Y-%m-%d %H:%M:%S")
	            return v
	
	        def to_int_safe(v, default=0):
	            try:
	                return int(v)
	            except (TypeError, ValueError):
	                return default
	
	        # normaliza datas
	        for row in (equivalentes or []):
	            for k, v in list(row.items()):
	                row[k] = serialize(v)
	
	        # totais robustos
	        bipados_diretos = to_int_safe(bipagem.get("bipados")) if bipagem else 0
	        bipados_equivalentes_total = sum(to_int_safe(e.get("bipados")) for e in (equivalentes or []))
	        bipados_total = bipados_diretos + bipados_equivalentes_total
	
	        resp = make_response(jsonify({
	            "ok": True,
	            "id_agend_ml": id_agend_ml,
	            "sku": sku,
	            "bipagem": bipagem,                 # dict ou null
	            "equivalentes": equivalentes,       # lista (0..N)
	            "totais": {
	                "bipados_diretos": bipados_diretos,
	                "bipados_equivalentes_total": bipados_equivalentes_total,
	                "bipados_total": bipados_total
	            }
	        }), 200)
	        _set_cors_headers(resp)  # inofensivo se mesma origem
	        return resp
	
	    except Exception as e:
	        app.logger.exception("Erro em /api/bipagem/detalhe [GET]")
	        resp = make_response(jsonify(ok=False, error=str(e)), 500)
	        _set_cors_headers(resp)
	        return resp
	
	@bp_retirado.route('/api/bipar', methods=['POST'])
	def api_bipar():
	    """
	    Faz upsert em agendamento_produto_bipagem (bipe direto) e
	    retorna o TOTAL = diretos + equivalentes para o sku original.
	    """
	    data     = request.get_json() or {}
	    id_agend = data.get('id_agend')
	    sku      = (data.get('sku') or '').strip()
	    quant    = int(data.get('quant', 1))
	
	    if not id_agend or not sku:
	        return jsonify(error="Par√¢metros 'id_agend' e 'sku' s√£o obrigat√≥rios"), 400
	
	    insert_sql = """
	        INSERT INTO agendamento_produto_bipagem (id_agend_ml, sku, bipados)
	        VALUES (%s, %s, %s)
	        ON DUPLICATE KEY UPDATE bipados = bipados + %s
	    """
	    select_diretos_sql = """
	        SELECT bipados
	        FROM agendamento_produto_bipagem
	        WHERE id_agend_ml = %s AND sku = %s
	    """
	    select_equiv_sql = """
	        SELECT COALESCE(SUM(bipados), 0)
	        FROM agendamento_produto_bipagem_equivalentes
	        WHERE id_agend_ml = %s AND sku_original = %s
	    """
	
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	
	        # Upsert do bip "direto"
	        cur.execute(insert_sql, (id_agend, sku, quant, quant))
	
	        # L√™ diretos atualizados
	        cur.execute(select_diretos_sql, (id_agend, sku))
	        row = cur.fetchone()
	        diretos = int(row[0]) if row else 0
	
	        # Soma equivalentes para este sku_original no mesmo agendamento
	        cur.execute(select_equiv_sql, (id_agend, sku))
	        equiv = int(cur.fetchone()[0] or 0)
	
	        total = diretos + equiv
	
	        cur.close()
	        conn.close()
	
	        # Mantive 'bipados' como TOTAL p/ n√£o quebrar sua UI atual
	        return jsonify(
	            ok=True,
	            sku=sku,
	            bipados=total,                    # TOTAL (diretos + equivalentes)
	            bipados_diretos=diretos,          # s√≥ diretos
	            bipados_equivalentes=equiv        # s√≥ equivalentes
	        )
	    except Exception as e:
	        app.logger.exception("Erro em api_bipar")
	        return jsonify(error=str(e)), 500
	
	
	def normalize_gtin(value):
	    if value is None:
	        return None
	    s = str(value).strip()
	    # Tratamentos comuns de "n√£o encontrado"
	    if s.lower() in {
	        "gtin/ean n√£o encontrado", "gtin nao encontrado", "gtin n√£o encontrado",
	        "ean n√£o encontrado", "nao encontrado", "n√£o encontrado", "not found", ""
	    }:
	        return None
	    # Se vier um n√∫mero, mantemos s√≥ d√≠gitos; sen√£o devolvemos original
	    digits = re.sub(r'\D+', '', s)
	    return digits if digits else s  # pode ser texto curto; coluna √© VARCHAR(14)
	
	def to_int_or_none(v):
	    try:
	        return int(v)
	    except (TypeError, ValueError):
	        return None
	
	@bp_retirado.route('/api/equiv/bipar', methods=['POST'])
	def api_equiv_bipar():
	    data = request.get_json() or {}
	
	    # obrigat√≥rios
	    id_agend     = data.get('id_agend')
	    sku_original = (data.get('sku_original') or '').strip()
	    sku_bipado   = (data.get('sku_bipado') or '').strip()
	
	    # opcionais
	    gtin_original       = normalize_gtin(data.get('gtin_original'))
	    gtin_bipado         = normalize_gtin(data.get('gtin_bipado'))
	    id_tiny_original    = to_int_or_none(data.get('id_tiny_original'))
	    id_tiny_equivalente = to_int_or_none(data.get('id_tiny_equivalente'))
	    nome_equivalente    = (data.get('nome_equivalente') or '').strip() or None   # <<< ADICIONADO
	    usuario             = (data.get('usuario') or '').strip() or 'Desconhecido'
	    observacao          = (data.get('observacao') or '').strip() or None
	
	    # valida m√≠nimos
	    try:
	        id_agend = int(id_agend)
	    except (TypeError, ValueError):
	        return jsonify(error="'id_agend' deve ser inteiro"), 400
	    if not sku_original or not sku_bipado:
	        return jsonify(error="Campos 'sku_original' e 'sku_bipado' s√£o obrigat√≥rios"), 400
	    if len(sku_original) > 30 or len(sku_bipado) > 30:
	        return jsonify(error="SKU excede 30 caracteres"), 400
	    if gtin_original and len(str(gtin_original)) > 14:
	        return jsonify(error="gtin_original excede 14 caracteres ap√≥s normaliza√ß√£o"), 400
	    if gtin_bipado and len(str(gtin_bipado)) > 14:
	        return jsonify(error="gtin_bipado excede 14 caracteres ap√≥s normaliza√ß√£o"), 400
	    if observacao and len(observacao) > 255:
	        return jsonify(error="observacao excede 255 caracteres"), 400
	    if usuario and len(usuario) > 100:
	        return jsonify(error="usuario excede 100 caracteres"), 400
	    if nome_equivalente and len(nome_equivalente) > 255:                           # <<< ADICIONADO
	        return jsonify(error="nome_equivalente excede 255 caracteres"), 400
	
	    insert_sql = """
	        INSERT INTO agendamento_produto_bipagem_equivalentes
	          (id_agend_ml, sku_original, gtin_original, id_tiny_original,
	           nome_equivalente,                                                   
	           sku_bipado,  gtin_bipado,  id_tiny_equivalente,
	           bipados, criado_por, observacao)
	        VALUES (%s, %s, %s, %s,
	                %s,
	                %s, %s, %s,
	                0, %s, %s)
	    """
	
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	        cur.execute(
	            insert_sql,
	            (id_agend, sku_original, gtin_original, id_tiny_original,
	             nome_equivalente,                                                     # <<< ADICIONADO
	             sku_bipado, gtin_bipado, id_tiny_equivalente,
	             usuario, observacao)
	        )
	        conn.commit()
	        cur.close(); conn.close()
	
	        return jsonify(
	            ok=True, created=True,
	            id_agend=id_agend,
	            sku_original=sku_original, gtin_original=gtin_original, id_tiny_original=id_tiny_original,
	            nome_equivalente=nome_equivalente,                                     # <<< ADICIONADO (n√£o quebra nada)
	            sku_bipado=sku_bipado,   gtin_bipado=gtin_bipado,   id_tiny_equivalente=id_tiny_equivalente,
	            bipados=0, criado_por=usuario, observacao=observacao
	        ), 201
	
	    except mysql.connector.Error as e:
	        from mysql.connector import errorcode
	        if getattr(e, "errno", None) == errorcode.ER_DUP_ENTRY:
	            return jsonify(ok=False, error="Equivalente j√° existe (id_agend_ml, sku_original, sku_bipado).", code="DUPLICATE"), 409
	        if getattr(e, "errno", None) == errorcode.ER_NO_REFERENCED_ROW_2:
	            return jsonify(ok=False, error="FK violada: (id_agend_ml, sku) n√£o existe na tabela pai.", code="FK_FAIL"), 422
	        app.logger.exception("Erro em /api/equiv/bipar")
	        return jsonify(error=str(e)), 500
	    
	@bp_retirado.route('/api/equiv/add-unidades', methods=['POST'])
	def api_equiv_add_unidades():
	    data         = request.get_json() or {}
	    id_agend     = data.get('id_agend')
	    sku_original = (data.get('sku_original') or '').strip()
	    sku_bipado   = (data.get('sku_bipado') or '').strip()
	    quant        = int(data.get('quant', 1))
	
	    if not id_agend or not sku_original or not sku_bipado:
	        return jsonify(error="Campos 'id_agend', 'sku_original', 'sku_bipado' s√£o obrigat√≥rios"), 400
	    if quant == 0:
	        return jsonify(error="'quant' deve ser diferente de zero"), 400
	
	    upd_sql = """
	        UPDATE agendamento_produto_bipagem_equivalentes
	           SET bipados = bipados + %s, atualizado_em = CURRENT_TIMESTAMP
	         WHERE id_agend_ml=%s AND sku_original=%s AND sku_bipado=%s
	    """
	    sel_par_sql = """
	        SELECT bipados
	          FROM agendamento_produto_bipagem_equivalentes
	         WHERE id_agend_ml=%s AND sku_original=%s AND sku_bipado=%s
	    """
	    sel_diretos_sql = """
	        SELECT COALESCE(bipados,0)
	          FROM agendamento_produto_bipagem
	         WHERE id_agend_ml=%s AND sku=%s
	    """
	    sel_equiv_total_sql = """
	        SELECT COALESCE(SUM(bipados),0)
	          FROM agendamento_produto_bipagem_equivalentes
	         WHERE id_agend_ml=%s AND sku_original=%s
	    """
	
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	
	        # 1) soma no par equivalente (erro 404 se n√£o existir)
	        cur.execute(upd_sql, (quant, id_agend, sku_original, sku_bipado))
	        if cur.rowcount == 0:
	            cur.close(); conn.close()
	            return jsonify(ok=False, error="Equivalente n√£o encontrado para este agendamento/sku"), 404
	
	        # (opcional) commit imediato da altera√ß√£o
	        conn.commit()
	
	        # 2) valor do par (equivalente) ap√≥s a soma
	        cur.execute(sel_par_sql, (id_agend, sku_original, sku_bipado))
	        row = cur.fetchone()
	        bipados_par = int(row[0]) if row else 0
	
	        # 3) diretos do sku_original
	        cur.execute(sel_diretos_sql, (id_agend, sku_original))
	        row = cur.fetchone()
	        bipados_diretos = int(row[0]) if row else 0
	
	        # 4) soma de TODOS os equivalentes para o sku_original
	        cur.execute(sel_equiv_total_sql, (id_agend, sku_original))
	        row = cur.fetchone()
	        bipados_equivalentes_total = int(row[0]) if row and row[0] is not None else 0
	
	        # 5) total final = diretos + equivalentes_total
	        bipados_total = bipados_diretos + bipados_equivalentes_total
	
	        cur.close(); conn.close()
	
	        return jsonify(
	            ok=True,
	            id_agend=id_agend,
	            sku_original=sku_original,
	            sku_bipado=sku_bipado,
	            incrementado=quant,
	            bipados=bipados_par,                      # valor do PAR equivalente (como antes)
	            bipados_diretos=bipados_diretos,          # s√≥ diretos
	            bipados_equivalentes_total=bipados_equivalentes_total,  # soma de todos equivalentes
	            bipados_total=bipados_total               # diretos + equivalentes_total
	        )
	    except Exception as e:
	        app.logger.exception("Erro em /api/equiv/add-unidades")
	        return jsonify(error=str(e)), 500
	
	@bp_retirado.route('/api/bipados/<id_agend>')
	def api_bipados_agend(id_agend):
	    select_sql = """
	        SELECT sku, bipados
	        FROM agendamento_produto_bipagem
	        WHERE id_agend_ml = %s
	    """
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	        cur.execute(select_sql, (id_agend,))
	        rows = cur.fetchall()
	        cur.close()
	        conn.close()
	        return jsonify([{'sku': r[0], 'bipados': r[1]} for r in rows])
	    except Exception as e:
	        app.logger.exception("Erro em api_bipados_agend")
	        return jsonify(error=str(e)), 500
	
	@bp_retirado.route('/api/bipados-total/<int:id_agend>')
	def api_bipados_total(id_agend):
	    sql = """
	        SELECT
	          x.sku_original,
	          SUM(x.bipados) AS bipados_total
	        FROM (
	          SELECT
	            apb.sku AS sku_original,
	            COALESCE(apb.bipados, 0) AS bipados
	          FROM agendamento_produto_bipagem apb
	          WHERE apb.id_agend_ml = %s
	
	          UNION ALL
	
	          SELECT
	            ape.sku_original AS sku_original,
	            COALESCE(ape.bipados, 0) AS bipados
	          FROM agendamento_produto_bipagem_equivalentes ape
	          WHERE ape.id_agend_ml = %s
	        ) x
	        GROUP BY x.sku_original
	        ORDER BY x.sku_original
	    """
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	        cur.execute(sql, (id_agend, id_agend))
	        rows = cur.fetchall()
	        cur.close()
	        conn.close()
	        return jsonify([{"sku_original": r[0], "bipados_total": int(r[1])} for r in rows])
	    except Exception as e:
	        app.logger.exception("Erro em api_bipados_total")
	        return jsonify(error=str(e)), 500
	
	@bp_retirado.route('/api/equiv/<int:id_agend>', methods=['GET'])
	def api_equiv_listar(id_agend):
	    sql = """
	        SELECT
	            id,
	            id_agend_ml,
	            sku_original,
	            gtin_original,
	            id_tiny_original,
	            nome_equivalente,                 -- <<< ADICIONADO
	            sku_bipado,
	            gtin_bipado,
	            id_tiny_equivalente,
	            bipados,
	            criado_por,
	            criado_em,
	            atualizado_em,
	            observacao
	        FROM agendamento_produto_bipagem_equivalentes
	        WHERE id_agend_ml = %s
	        ORDER BY sku_original, sku_bipado
	    """
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor(dictionary=True)
	        cur.execute(sql, (id_agend,))
	        rows = cur.fetchall()
	        cur.close(); conn.close()
	
	        def serialize(v):
	            if isinstance(v, (datetime, date)):
	                return v.strftime("%Y-%m-%d %H:%M:%S")
	            return v
	
	        return jsonify([
	            {k: serialize(v) for k, v in row.items()}
	            for row in rows
	        ])
	    except Exception as e:
	        app.logger.exception("Erro em /api/equiv/<id>")
	        return jsonify(error=str(e)), 500
	
	
	@bp_retirado.route('/api/equiv/delete', methods=['DELETE'])
	def api_equiv_delete():
	    """
	    DELETE /api/equiv/delete
	    Body JSON:
	    {
	        "id_agend": 123,
	        "sku_original": "SKU-ORIG",
	        "sku_bipado": "SKU-BIPADO"
	    }
	
	    Exclui um registro espec√≠fico da tabela
	    agendamento_produto_bipagem_equivalentes.
	    """
	    data = request.get_json() or {}
	
	    # ----------------------------
	    # 1) Captura e valida entradas
	    # ----------------------------
	    id_agend     = data.get('id_agend')
	    sku_original = (data.get('sku_original') or '').strip()
	    sku_bipado   = (data.get('sku_bipado') or '').strip()
	
	    try:
	        id_agend = int(id_agend)
	    except (TypeError, ValueError):
	        return jsonify(ok=False, error="'id_agend' deve ser inteiro"), 400
	
	    if not sku_original or not sku_bipado:
	        return jsonify(ok=False, error="Campos 'sku_original' e 'sku_bipado' s√£o obrigat√≥rios"), 400
	    if len(sku_original) > 30 or len(sku_bipado) > 30:
	        return jsonify(ok=False, error="SKU excede 30 caracteres"), 400
	
	    # ----------------------------
	    # 2) SQL principal
	    # ----------------------------
	    delete_sql = """
	        DELETE FROM agendamento_produto_bipagem_equivalentes
	         WHERE id_agend_ml = %s
	           AND sku_original = %s
	           AND sku_bipado = %s
	    """
	
	    # Ap√≥s excluir, recalculamos o total de bipados
	    select_diretos_sql = """
	        SELECT COALESCE(bipados,0)
	        FROM agendamento_produto_bipagem
	        WHERE id_agend_ml = %s AND sku = %s
	    """
	    select_equiv_total_sql = """
	        SELECT COALESCE(SUM(bipados),0)
	        FROM agendamento_produto_bipagem_equivalentes
	        WHERE id_agend_ml = %s AND sku_original = %s
	    """
	
	    try:
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	
	        # ----------------------------
	        # 3) Executa exclus√£o
	        # ----------------------------
	        cur.execute(delete_sql, (id_agend, sku_original, sku_bipado))
	        rows_affected = cur.rowcount
	
	        if rows_affected == 0:
	            cur.close(); conn.close()
	            return jsonify(ok=False, error="Equivalente n√£o encontrado para exclus√£o"), 404
	
	        conn.commit()
	
	        # ----------------------------
	        # 4) Recalcula totais
	        # ----------------------------
	        cur.execute(select_diretos_sql, (id_agend, sku_original))
	        row = cur.fetchone()
	        bipados_diretos = int(row[0]) if row else 0
	
	        cur.execute(select_equiv_total_sql, (id_agend, sku_original))
	        row = cur.fetchone()
	        bipados_equivalentes_total = int(row[0]) if row and row[0] is not None else 0
	
	        bipados_total = bipados_diretos + bipados_equivalentes_total
	
	        cur.close(); conn.close()
	
	        return jsonify(
	            ok=True,
	            deleted=True,
	            id_agend=id_agend,
	            sku_original=sku_original,
	            sku_bipado=sku_bipado,
	            bipados_diretos=bipados_diretos,
	            bipados_equivalentes_total=bipados_equivalentes_total,
	            bipados_total=bipados_total
	        ), 200
	
	    except Exception as e:
	        app.logger.exception("Erro em /api/equiv/delete")
	        return jsonify(ok=False, error=str(e)), 500
	
	@bp_retirado.route('/retirado', methods=['GET', 'POST'])
	def retirado_estoque():
	    ag_ctrl = app.config['AG_CTRL']
	    if request.method == "GET":        
	        ag_ctrl.clear_agendamentos()
	        # Corrigido para lidar com IDs que podem n√£o ser inteiros inicialmente
	        id_agendamento = request.args['id']
	        ag_ctrl.insert_agendamento(id_bd=int(id_agendamento))
	        agend: Agendamento = ag_ctrl.get_last_made_agendamento()
	        ag_ctrl.create_agendamento_from_bd_data(agend)
	        ag_ctrl.set_error_flags_composicoes(agend)
	
	        tipo = int(request.args.get('tipo', 0))
	
	        if tipo == 1:
	            return render_template(
	            'limpeza.html',
	            dados=ag_ctrl.search_agendamento('id_bd', str(agend.id_bd)),
	            comps=ag_ctrl.return_all_in_dict(agend)
	            )
	
	        elif tipo == 4: # Fase "Embalar"
	            comps = []
	            for p in agend.produtos:
	                pd = p.to_dict() 
	                pd['imagemUrl'] = pd.pop('imagem_url', '') 
	                pd['composicoes'] = []
	                for c in p.composicoes:
	                    comp_dict = c.to_dict()
	                    comp_dict['imagem_url'] = comp_dict.get('imagem_url', '')
	                    pd['composicoes'].append(comp_dict)
	                comps.append(pd)
	            return render_template(
	                'embalar.html',
	                dados=agend,
	                comps=comps, 
	                dados_agend=agend
	            )
	
	        elif tipo == 5:
	            return redirect(url_for('expedicao.expedicao', id_agend_bd=agend.id_bd))
	
	        else:
	            comps = []
	            pode_mudar = request.args.get('mudar', 'False').lower() == 'true'
	            for p in agend.produtos:
	                pd = p.to_dict() 
	                pd['imagemUrl'] = pd.pop('imagem_url', '') 
	                pd['composicoes'] = []
	                for c in p.composicoes:
	                    comp_dict = c.to_dict()
	                    comp_dict['imagem_url'] = comp_dict.get('imagem_url', '')
	                    pd['composicoes'].append(comp_dict)
	                comps.append(pd)
	            
	            # mapeamento marketplace no mesmo padr√£o do dicion√°rio de empresa
	            marketplace_map = {
	                1: "Mercado Livre",
	                2: "Magalu",
	                3: "Shopee",
	                4: "Amazon"
	            }
	            marketplace_nome = marketplace_map.get(getattr(agend, "id_mktp", 0), "Nenhuma")
	
	            return render_template(
	                'retiradoEstoque.html',
	                dados=ag_ctrl.return_comp_grouped(agend),
	                comps=comps,
	                pode_mudar=pode_mudar,
	                dados_agend=ag_ctrl.get_last_made_agendamento(),
	                marketplace_nome=marketplace_nome
	            )
	
	    # ‚îÄ‚îÄ‚îÄ se for POST (finaliza e redireciona para embalar) ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	    ag_ctrl.clear_agendamentos()
	    ag_ctrl.insert_agendamento(request.form['inp_id_pedido'])
	    agend: Agendamento = ag_ctrl.get_last_made_agendamento()
	    ag_ctrl.create_agendamento_from_bd_data(agend)
	    ag_ctrl.set_error_flags_composicoes(agend)
	    ag_ctrl.set_empresa_colaborador_agend(
	        agend,
	        request.form.get('inp_nome_emp', ''),
	        request.form.get('inp_nome_col', '')
	    )
	    ag_ctrl.update_empresa_colaborador_bd(agend)
	
	    # Marca como embalar
	    agend.set_tipo(4)
	    ag_ctrl.update_agendamento(agend)
	
	    # ‚îÄ‚îÄ‚îÄ Recria o comps serializ√°vel para o POST tamb√©m ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	    comps = []
	    for p in agend.produtos:
	        pd = p.to_dict()
	        # Busca e adiciona a URL da imagem
	        pd['imagemUrl'] = ag_ctrl.get_product_image_url(p.sku)
	        pd['composicoes'] = [c.to_dict() for c in p.composicoes]
	        comps.append(pd)
	    # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	
	    return render_template(
	        'embalar.html',
	        dados=ag_ctrl.search_agendamento('id_bd', agend.id_bd),
	        comps=comps,
	        dados_agend=agend
	    )
	
	@bp_retirado.route('/relatorio/finalizar/<int:id_agend>', methods=['POST'])
	def finalizar_conferencia(id_agend):
	    """
	    Finaliza a fase de confer√™ncia, gera um relat√≥rio e move o agendamento para Embalar.
	    """
	    try:
	        ag_ctrl = app.config['AG_CTRL']
	        # Carrega o agendamento em mem√≥ria
	        ag_ctrl.clear_agendamentos()
	        ag_ctrl.insert_agendamento(id_bd=id_agend)
	        ag = ag_ctrl.get_last_made_agendamento()
	        ag_ctrl.create_agendamento_from_bd_data(ag)
	
	        # ----- O bloco de gera√ß√£o de relat√≥rio permanece o mesmo -----
	        inicio = ag.entrada
	        termino = datetime.now()
	        duracao = termino - inicio
	        informacoes = {
	            "Agendamento": ag.id_agend_ml,
	            "Empresa": {1:"Ja√∫ Pesca",2:"Ja√∫ Fishing",3:"L.T. Sports"}.get(ag.empresa, ""),
	            "DataInicio": inicio.strftime("%d/%m/%Y %Hh %Mm %Ss"),
	            "DataTerminoConferencia": termino.strftime("%d/%m/%Y %Hh %Mm %Ss"),
	            "Permanencia": f"{duracao.seconds//3600:02d}h {(duracao.seconds%3600)//60:02d}m {duracao.seconds%60:02d}s"
	        }
	        colaboradores = [{"Colaborador": ag.colaborador}]
	        rel = []
	        for p in ag.produtos:
	            total = sum(c.unidades_totais for c in p.composicoes) or p.unidades
	            kits = [{"codigo_tiny_kit": c.id_tiny, "sku_kit": c.prod_sku} for c in p.composicoes]
	            historico = []
	            rel.append({
	                "sku": p.sku, "codigo_de_barras":p.gtin, "codigo_tiny": p.id_tiny or None,
	                "nome": p.nome, "unidades_totais": str(total), "faz_parte_de": kits, "historico": historico
	            })
	        payload = {
	            "Informacoes": informacoes, "Colaboradores": colaboradores, "RelatorioConferencia": rel
	        }
	        # ----------------------------------------------------------------
	
	        # Salva no banco
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	        cur.execute(
	            "INSERT INTO relatorio_agend (id_agend_ml, relatorio) VALUES (%s, %s) ON DUPLICATE KEY UPDATE relatorio = VALUES(relatorio)",
	            (ag.id_agend_ml, json.dumps(payload, ensure_ascii=False))
	        )
	        conn.commit()
	        cur.close()
	        conn.close()
	
	        # Marca como Embalar (ID 4)
	        ag.set_tipo(4)
	        ag_ctrl.update_agendamento(ag)
	
	        # Retorna uma resposta de sucesso padronizada
	        return jsonify({"success": True, "message": "Confer√™ncia finalizada! O agendamento foi movido para a Embalagem."})
	
	    except Exception as e:
	        app.logger.exception("Falha ao finalizar confer√™ncia e salvar relat√≥rio")
	        return jsonify({"success": False, "message": f"Erro ao finalizar: {e}"}), 500
	
	
	# ---------------------------------------------------------------
	# 1) Proxy gen√©rico para Tiny (GET + OPTIONS com CORS)
	#    Front envia:
	#      - Header "Path": ex. /public-api/v3/produtos
	#      - Header "Authorization": ex. "Bearer xyz..."
	#    Query string do request √© repassada (ex.: ?codigo=JP123)
	# ---------------------------------------------------------------
	@bp_retirado.route('/api/tiny-proxy', methods=['GET', 'OPTIONS'])
	def tiny_proxy():
	    # Preflight CORS
	    if request.method == 'OPTIONS':
	        resp = make_response('', 204)
	        _set_cors_headers(resp)
	        return resp
	
	    path = (request.headers.get('Path') or '').strip()
	    auth = (request.headers.get('Authorization') or '').strip()
	
	    if not path or not auth:
	        return _cors_error('Headers "Path" e "Authorization" s√£o obrigat√≥rios', 400)
	
	    # Normaliza e valida o Path para evitar SSRF
	    if not path.startswith('/'):
	        path = '/' + path
	
	    # Permita s√≥ o prefixo da API p√∫blica do Tiny v3
	    allowed_prefixes = ['/public-api/v3/']
	    if not any(path.startswith(p) for p in allowed_prefixes):
	        return _cors_error('Path inv√°lido para proxy', 400)
	
	    base_url = 'https://api.tiny.com.br'
	    url = f'{base_url}{path}'
	
	    # Copiamos a query string do request atual
	    params = request.args.to_dict(flat=True)
	
	    # Repassar somente o Authorization, definindo um UA simples
	    headers = {
	        'Authorization': auth,
	        'User-Agent': 'AgendamentosWeb/1.0'
	    }
	
	    try:
	        r = requests.get(url, headers=headers, params=params, timeout=20)
	    except requests.RequestException as e:
	        app.logger.exception('Falha ao chamar Tiny')
	        return _cors_error(f'Erro ao contatar Tiny: {e}', 502)
	
	    # Monta a resposta preservando status e content-type do Tiny
	    resp = make_response(r.content, r.status_code)
	    resp.headers['Content-Type'] = r.headers.get('Content-Type', 'application/json')
	    _set_cors_headers(resp)
	    return resp
	
	
	# ---------------------------------------------------------------
	# 2) Atalho: produto por SKU (POST JSON)
	#    Body: { "sku": "JP123", "token": "Bearer xyz..." }  (ou mande o token no header Authorization)
	# ---------------------------------------------------------------
	@bp_retirado.route('/api/tiny/produto-por-sku', methods=['POST', 'OPTIONS'])
	def tiny_produto_por_sku():
	    if request.method == 'OPTIONS':
	        resp = make_response('', 204)
	        _set_cors_headers(resp)
	        return resp
	
	    data = request.get_json() or {}
	    sku = (data.get('sku') or '').strip()
	    token = (data.get('token') or request.headers.get('Authorization') or '').strip()
	
	    if not sku or not token:
	        return _cors_error('Par√¢metros "sku" e "token" s√£o obrigat√≥rios', 400)
	
	    # Garante prefixo Bearer (se j√° vier, mantemos)
	    if not token.lower().startswith('bearer '):
	        token = f'Bearer {token}'
	
	    url = 'https://api.tiny.com.br/public-api/v3/produtos'
	    headers = {'Authorization': token, 'User-Agent': 'AgendamentosWeb/1.0'}
	    params = {'codigo': sku}
	
	    try:
	        r = requests.get(url, headers=headers, params=params, timeout=20)
	    except requests.RequestException as e:
	        app.logger.exception('Falha ao chamar Tiny (produto-por-sku)')
	        return _cors_error(f'Erro ao contatar Tiny: {e}', 502)
	
	    resp = make_response(r.content, r.status_code)
	    resp.headers['Content-Type'] = r.headers.get('Content-Type', 'application/json')
	    _set_cors_headers(resp)
	    return resp
	
	
	# ---------------------------------------------------------------
	# Helpers CORS
	# ---------------------------------------------------------------
	def _set_cors_headers(resp):
	    # Libere *apenas* o(s) origin(s) que voc√™ usa no front
	    origin = request.headers.get('Origin') or '*'
	    resp.headers['Access-Control-Allow-Origin'] = origin
	    resp.headers['Vary'] = 'Origin'
	    resp.headers['Access-Control-Allow-Methods'] = 'GET, POST, OPTIONS'
	    resp.headers['Access-Control-Allow-Headers'] = 'Authorization, Path, Content-Type'
	    resp.headers['Access-Control-Max-Age'] = '600'
	    return resp
	
	def _cors_error(msg, code):
	    resp = make_response(jsonify(error=msg), code)
	    _set_cors_headers(resp)
	    return resp
	
	def _to_str_first(v) -> str:
	    """Converte para string. Se vier lista/tupla, usa o primeiro item.
	    Se vier None -> '' . Se vier dict -> levanta ValueError (tipo inv√°lido)."""
	    if v is None:
	        return ''
	    if isinstance(v, (list, tuple)):
	        v = v[0] if v else ''
	    if isinstance(v, dict):
	        raise ValueError("Tipo inv√°lido (dict) para campo string")
	    return str(v)
	
	def _to_opt_str_first(v):
	    """Como _to_str_first, mas retorna None se vazio ap√≥s strip()."""
	    s = _to_str_first(v).strip()
	    return s if s else None
	
	
	@bp_retirado.route('/transf-estoque', methods=['POST', 'OPTIONS'])
	def transf_estoque():
	    """
	    Enfileira um lan√ßamento de estoque no Tiny (S/E/B) para processamento em background.
	    Body JSON:
	      - id_deposito   (int|list[int])   -> obrigat√≥rio
	      - id_produto    (int|list[int])   -> obrigat√≥rio
	      - unidades      (number|list)     -> obrigat√≥rio (> 0)
	      - tipo          (str|list[str])   -> "Sa√≠da" | "Entrada" | "Balan√ßo" | "S" | "E" | "B"
	      - auth_token    (str|list[str])   -> obrigat√≥rio (Bearer xyz... ou apenas xyz)
	      - observacoes   (str|list[str])   -> opcional
	      - preco_unitario(number|list)     -> opcional (default = 0)
	    """
	    if request.method == 'OPTIONS':
	        resp = make_response('', 204)
	        _set_cors_headers(resp)
	        return resp
	
	    try:
	        _start_estoque_worker_once()
	        data = request.get_json() or {}
	        print("\n[/transf-estoque] payload recebido:", {k: (v if k!='auth_token' else '(omitido)') for k,v in data.items()})
	
	        # --- Normaliza√ß√£o defensiva ---
	        try:
	            _id_dep_raw = data.get('id_deposito')
	            if isinstance(_id_dep_raw, (list, tuple)):
	                _id_dep_raw = _id_dep_raw[0] if _id_dep_raw else None
	            id_deposito = int(_id_dep_raw)
	
	            _id_prod_raw = data.get('id_produto')
	            if isinstance(_id_prod_raw, (list, tuple)):
	                _id_prod_raw = _id_prod_raw[0] if _id_prod_raw else None
	            id_produto = int(_id_prod_raw)
	
	            _un_raw = data.get('unidades')
	            if isinstance(_un_raw, (list, tuple)):
	                _un_raw = _un_raw[0] if _un_raw else None
	            quantidade = float(_un_raw)
	        except (TypeError, ValueError):
	            print("[/transf-estoque] erro de tipos nos campos id_deposito/id_produto/unidades")
	            return _cors_error("Campos 'id_deposito', 'id_produto' devem ser inteiros e 'unidades' num√©rico", 400)
	
	        if quantidade <= 0:
	            print("[/transf-estoque] unidades <= 0")
	            return _cors_error("Campo 'unidades' deve ser maior que zero", 400)
	
	        try:
	            tipo = _to_str_first(data.get('tipo')).strip()
	            token = _to_str_first(data.get('auth_token')).strip()
	            observacoes = _to_opt_str_first(data.get('observacoes'))
	            _preco_raw = data.get('preco_unitario')
	            if isinstance(_preco_raw, (list, tuple)):
	                _preco_raw = _preco_raw[0] if _preco_raw else None
	            preco_unit = float(_preco_raw) if _preco_raw is not None else None
	        except ValueError as ve:
	            print(f"[/transf-estoque] tipos inv√°lidos no payload: {ve}")
	            return _cors_error(f"Tipos inv√°lidos no payload: {ve}", 400)
	
	        if not token:
	            print("[/transf-estoque] auth_token ausente")
	            return _cors_error("Campo 'auth_token' √© obrigat√≥rio", 400)
	
	        # Mapeia tipo amig√°vel -> API Tiny
	        t = tipo.lower()
	        if t in ('saida', 'sa√≠da', 's'):
	            tipo_api = 'S'
	        elif t in ('entrada', 'e'):
	            tipo_api = 'E'
	        elif t in ('balanco', 'balan√ßo', 'b', 'ajuste'):
	            tipo_api = 'B'
	        else:
	            print(f"[/transf-estoque] tipo inv√°lido: {tipo}")
	            return _cors_error("Campo 'tipo' deve ser 'Sa√≠da', 'Entrada' ou 'Balan√ßo' (ou S/E/B)", 400)
	
	        task_id = uuid.uuid4().hex
	        print(f"[/transf-estoque] enfileirando task_id={task_id} deposito={id_deposito} produto={id_produto} qtd={quantidade} tipo={tipo_api}")
	
	        _mov_status[task_id] = {
	            "status": "enfileirado",
	            "criado_em": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
	            "params": {
	                "id_produto": id_produto,
	                "id_deposito": id_deposito,
	                "unidades": quantidade,
	                "tipo": tipo_api
	            }
	        }
	        _mov_queue.put({
	            "task_id": task_id,
	            "id_produto": id_produto,
	            "id_deposito": id_deposito,
	            "quantidade": quantidade,
	            "tipo_api": tipo_api,
	            "token": token,
	            "observacoes": observacoes,
	            "preco_unitario": preco_unit,
	        })
	
	        resp = make_response(jsonify(ok=True, task_id=task_id, status="enfileirado"), 202)
	        _set_cors_headers(resp)
	        return resp
	
	    except Exception as e:
	        print(f"[/transf-estoque] EXCEPTION: {e}")
	        try:
	            app.logger.exception("Falha no POST /transf-estoque")
	        except Exception:
	            pass
	        resp = make_response(jsonify(ok=False, error="Falha interna ao enfileirar lan√ßamento", detalhe=str(e)), 500)
	        _set_cors_headers(resp)
	        return resp
	
	@bp_retirado.route('/transf-estoque/status/<task_id>', methods=['GET', 'OPTIONS'])
	def transf_estoque_status(task_id):
	    if request.method == 'OPTIONS':
	        resp = make_response('', 204)
	        _set_cors_headers(resp)
	        return resp
	
	    print(f"[/transf-estoque/status] consulta status task_id={task_id}")
	    st = _mov_status.get(task_id)
	    if not st:
	        print(f"[/transf-estoque/status] task n√£o encontrada: {task_id}")
	        return _cors_error("Task n√£o encontrada", 404)
	
	    resp = make_response(jsonify(st), 200)
	    _set_cors_headers(resp)
	    return resp
	
	@bp_retirado.route('/estoque/mover', methods=['POST', 'OPTIONS'])
	def estoque_mover():
	    """
	    POST /estoque/mover
	    Requer sess√£o v√°lida. N√ÉO precisa mandar token.
	
	    Body JSON:
	    {
	      "empresa": "jaupesca",                # opcional (reserve para sele√ß√£o de token no futuro)
	      "observacoes": "texto...",            # opcional
	      "preco_unitario": 0,                  # opcional (default 0)
	      "movimentos": [
	        {
	          "sku": "JP123",                   # opcional (s√≥ para log)
	          "id_produto": 123456,             # obrigat√≥rio
	          "de": 785301556,                  # dep√≥sito origem (Sa√≠da)
	          "para": 822208355,                # dep√≥sito destino (Entrada)
	          "unidades": 5,                    # > 0
	          "preco_unitario": 0               # opcional (sobrep√µe o geral)
	        },
	        ...
	      ]
	    }
	
	    Resposta: 202 Accepted
	    {
	      "ok": true,
	      "tasks": [
	        {
	          "sku": "JP123",
	          "id_produto": 123456,
	          "de": 785301556,
	          "para": 822208355,
	          "unidades": 5,
	          "task_saida": "<id>",
	          "task_entrada": "<id>"
	        },
	        ...
	      ]
	    }
	    """
	    if request.method == 'OPTIONS':
	        resp = make_response('', 204)
	        _set_cors_headers(resp)
	        return resp
	
	    ok, resp = _require_session_user()
	    if not ok:
	        return resp  # 401
	
	    try:
	        _start_estoque_worker_once()
	
	        data = request.get_json() or {}
	        empresa = _to_opt_str_first(data.get('empresa'))
	        observacoes_base = _to_opt_str_first(data.get('observacoes')) or ''
	        preco_unitario_default = float(data.get('preco_unitario') or 0)
	
	        movs = data.get('movimentos')
	        if isinstance(movs, dict):
	            movs = [movs]
	        if not isinstance(movs, list) or not movs:
	            return _cors_error("Campo 'movimentos' deve ser lista n√£o vazia", 400)
	
	        token = _get_tiny_token_for_user(empresa)
	        if not token:
	            return _cors_error("N√£o foi poss√≠vel obter token do Tiny para o usu√°rio atual", 503)
	
	        out = []
	        for mv in movs:
	            try:
	                sku = _to_opt_str_first(mv.get('sku'))
	                id_produto = int(mv.get('id_produto'))
	                dep_de = int(mv.get('de'))
	                dep_para = int(mv.get('para'))
	                unidades = float(mv.get('unidades'))
	
	                # üîí Guard: bloqueia origem == destino (ex.: 141 -> 141)
	                if dep_de == dep_para:
	                    return _cors_error(
	                        f"Dep√≥sitos de origem e destino s√£o iguais (#{dep_de}). Opera√ß√£o inv√°lida.",
	                        400
	                    )
	
	                if unidades <= 0:
	                    return _cors_error("Cada movimento deve ter 'unidades' > 0", 400)
	                preco_unit = float(mv.get('preco_unitario') if mv.get('preco_unitario') is not None else preco_unitario_default)
	            except (TypeError, ValueError):
	                return _cors_error("Campos do movimento inv√°lidos (id_produto/de/para inteiros; unidades num√©rico)", 400)
	
	            # 1) SA√çDA (de)
	            task_id_s = uuid.uuid4().hex
	            _mov_status[task_id_s] = {
	                "status": "enfileirado",
	                "criado_em": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
	                "params": {"id_produto": id_produto, "id_deposito": dep_de, "unidades": unidades, "tipo": "S"}
	            }
	            _mov_queue.put({
	                "task_id": task_id_s,
	                "id_produto": id_produto,
	                "id_deposito": dep_de,
	                "quantidade": unidades,
	                "tipo_api": 'S',
	                "token": token,
	                "observacoes": observacoes_base,
	                "preco_unitario": preco_unit,
	            })
	
	            # 2) ENTRADA (para)
	            task_id_e = uuid.uuid4().hex
	            _mov_status[task_id_e] = {
	                "status": "enfileirado",
	                "criado_em": datetime.now().strftime("%Y-%m-%d %H:%M:%S"),
	                "params": {"id_produto": id_produto, "id_deposito": dep_para, "unidades": unidades, "tipo": "E"}
	            }
	            _mov_queue.put({
	                "task_id": task_id_e,
	                "id_produto": id_produto,
	                "id_deposito": dep_para,
	                "quantidade": unidades,
	                "tipo_api": 'E',
	                "token": token,
	                "observacoes": observacoes_base,
	                "preco_unitario": preco_unit,
	            })
	
	            out.append({
	                "sku": sku, "id_produto": id_produto, "de": dep_de, "para": dep_para,
	                "unidades": unidades, "task_saida": task_id_s, "task_entrada": task_id_e
	            })
	
	        resp = make_response(jsonify(ok=True, tasks=out), 202)
	        _set_cors_headers(resp)
	        return resp
	
	    except Exception as e:
	        try:
	            app.logger.exception("Falha em /estoque/mover")
	        except Exception:
	            pass
	        resp = make_response(jsonify(ok=False, error=str(e)), 500)
	        _set_cors_headers(resp)
	        return resp
	    
	# ===================== HELPERS NOVOS =====================
	
	def _require_session_user():
	    """Garante usu√°rio logado via session. Retorna (ok:bool, resp:Response|None)."""
	    if 'id_usuario' not in session:
	        resp = make_response(jsonify(ok=False, error='N√£o autenticado'), 401)
	        _set_cors_headers(resp)
	        return False, resp
	    return True, None
	
	def _get_tiny_token_for_user(empresa: Optional[str] = None) -> Optional[str]:
	    """
	    Obt√©m o access_token do Tiny **no servidor**:
	    - Usa sua fonte padr√£o (_get_fallback_token_from_db) para n√£o quebrar nada.
	    - Se amanh√£ voc√™ passar a guardar por empresa/usu√°rio, adapte aqui sem tocar no front.
	    """
	    # TODO: se voc√™ tiver tokens por empresa/usu√°rio, selecione com base na sess√£o/empresa
	    tok = _get_fallback_token_from_db()
	    return tok
	
	def _wait_backoff_429(attempt_idx: int) -> int:
	    """Backoff para 429 em segundos: 5, 10, 20, 40, 60, 120, 240, 480, 600. Ao estourar, retorna -1."""
	    ladder = [5, 10, 20, 40, 60, 120, 240, 480, 600]
	    return ladder[attempt_idx] if attempt_idx < len(ladder) else -1
	
	def _get_fallback_token_from_db() -> Optional[str]:
	    """
	    Busca um access_token no MySQL:
	      - Tenta pegar o MAIS RECENTE (quando houver carimbo de tempo/auto-inc).
	      - Limpa aspas e espa√ßos.
	    Retorna a string do token (sem 'Bearer ') ou None.
	    """
	    try:
	        print("[token-db] consultando DB por access_token (id_api_valor=13)")
	        conn = mysql.connector.connect(**_db_config)
	        cur  = conn.cursor()
	
	        # Se houver coluna de timestamp/auto-inc, isso pega o mais recente.
	        # Caso n√£o exista, ORDER BY id_api_valor DESC mant√©m compat√≠vel.
	        cur.execute("""
	            SELECT access_token
	              FROM apis_valores
	             WHERE id_api_valor = 13
	             ORDER BY id_api_valor DESC
	             LIMIT 1
	        """)
	        row = cur.fetchone()
	        cur.close(); conn.close()
	
	        if not row:
	            print("[token-db] nenhuma linha encontrada.")
	            return None
	
	        raw = row[0]
	        if raw is None:
	            print("[token-db] access_token NULL no DB.")
	            return None
	
	        tok = str(raw).strip().strip('"').strip("'")
	        # Token ‚Äúlimpo‚Äù:
	        tok = tok.replace("\r", "").replace("\n", "").strip()
	
	        if not tok:
	            print("[token-db] access_token vazio ap√≥s limpeza.")
	            return None
	
	        print(f"[token-db] token encontrado: {tok[:5]}...{tok[-5:] if len(tok)>5 else tok} (len={len(tok)})")
	        return tok
	    except Exception as e:
	        print("[token-db] EXCEPTION ao buscar token no DB:", e)
	        try:
	            app.logger.exception("Falha ao buscar fallback token no DB")
	        except Exception:
	            pass
	        return None
	
	def _normalize_bearer(token: str) -> str:
	    return token if token.lower().startswith("bearer ") else f"Bearer {token}"
	
	@bp_retirado.route('/api/tiny/produto-por-sku-interno', methods=['GET'])
	def tiny_produto_por_sku_interno():    
	    """
	    Busca produto no Tiny por SKU, usando o Caller do servidor.
	    Requer usu√°rio logado (session['id_usuario']).
	    Ex.: GET /api/tiny/produto-por-sku-interno?sku=JP123
	    """
	    # Seguran√ßa extra (o before_request j√° bloqueia, mas deixo expl√≠cito):
	    if 'id_usuario' not in session:
	        return jsonify(ok=False, error='N√£o autenticado'), 401
	
	    sku = (request.args.get('sku') or '').strip()
	    if not sku:
	        return jsonify(ok=False, error='Par√¢metro "sku" √© obrigat√≥rio'), 400
	
	    try:
	        ag_ctrl = app.config['AG_CTRL']
	        # Reaproveita o Caller (Tiny v3) j√° configurado no main.py
	        # Dica: situacao='A' filtra produto ativo quando houver m√∫ltiplos
	        resp = ag_ctrl.caller.make_call(
	            'produtos',
	            params_add={'codigo': sku, 'situacao': 'A'}
	        )
	
	        # Padroniza retorno
	        if not isinstance(resp, dict):
	            return jsonify(ok=False, error='Resposta inesperada do Tiny', raw=resp), 502
	
	        itens = resp.get('itens', []) or []
	        # Se vier mais de um, preferimos o ativo (situacao == 'A')
	        ativo = next((i for i in itens if i.get('situacao') == 'A'), itens[0] if itens else None)
	
	        return jsonify(ok=True, itens=itens, ativo=ativo), 200
	
	    except Exception as e:
	        app.logger.exception("Falha ao consultar Tiny por SKU")
	        return jsonify(ok=False, error=str(e)), 500
	
	
	@bp_retirado.route('/api/tiny/produto/<int:id_tiny>', methods=['GET'])
	def tiny_produto_por_id_interno(id_tiny: int):
	    """
	    Detalhes do produto por ID do Tiny, com sess√£o obrigat√≥ria.
	    Ex.: GET /api/tiny/produto/123456
	    """
	    if 'id_usuario' not in session:
	        return jsonify(ok=False, error='N√£o autenticado'), 401
	
	    try:
	        ag_ctrl = app.config['AG_CTRL']
	        resp = ag_ctrl.caller.make_call(f'produtos/{id_tiny}')
	        if not isinstance(resp, dict):
	            return jsonify(ok=False, error='Resposta inesperada do Tiny', raw=resp), 502
	        return jsonify(ok=True, produto=resp), 200
	    except Exception as e:
	        app.logger.exception("Falha ao consultar Tiny por ID")
	        return jsonify(ok=False, error=str(e)), 500
	
	
	@bp_retirado.route('/api/tiny/produto/<int:id_tiny>/kit', methods=['GET'])
	def tiny_produto_kit_interno(id_tiny: int):
	    """
	    Composi√ß√£o (kit) do produto por ID do Tiny, com sess√£o obrigat√≥ria.
	    Ex.: GET /api/tiny/produto/123456/kit
	    """
	    if 'id_usuario' not in session:
	        return jsonify(ok=False, error='N√£o autenticado'), 401
	
	    try:
	        ag_ctrl = app.config['AG_CTRL']
	        resp = ag_ctrl.caller.make_call(f'produtos/{id_tiny}/kit')
	        # O Tiny costuma devolver uma lista/n√≥ simples; padronize para JSON
	        return jsonify(ok=True, kit=resp), 200
	    except Exception as e:
	        app.logger.exception("Falha ao consultar kit do Tiny")
	        return jsonify(ok=False, error=str(e)), 500
	    
	@bp_retirado.route('/api/tiny/composicao-por-sku', methods=['GET'])
	def tiny_composicao_por_sku_interno():
	    """
	    GET /api/tiny/composicao-por-sku?sku=JP123
	    - Requer sess√£o v√°lida (usu√°rio logado).
	    - Busca produto por SKU no Tiny -> pega ID.
	    - Busca composi√ß√£o (kit) por ID.
	    - Retorna {"ok": true, "sku": "...", "id_tiny": 123, "kit": [...]}.
	      Se n√£o for kit, "kit" ser√° [].
	    """
	    # seguran√ßa: exige usu√°rio logado (al√©m do before_request do app)
	    if 'id_usuario' not in session:
	        return jsonify(ok=False, error='N√£o autenticado'), 401
	
	    sku = (request.args.get('sku') or '').strip()
	    if not sku:
	        return jsonify(ok=False, error='Par√¢metro "sku" √© obrigat√≥rio'), 400
	
	    try:
	        ag_ctrl = app.config['AG_CTRL']
	        # 1) Produto por SKU (preferindo ativo)
	        resp_prod = ag_ctrl.caller.make_call(
	            'produtos',
	            params_add={'codigo': sku, 'situacao': 'A'}
	        )
	        if not isinstance(resp_prod, dict):
	            return jsonify(ok=False, error='Resposta inesperada ao buscar produto', raw=resp_prod), 502
	
	        itens = resp_prod.get('itens') or []
	        if not itens:
	            # tenta sem filtro 'situacao' como fallback
	            resp_prod2 = ag_ctrl.caller.make_call(
	                'produtos',
	                params_add={'codigo': sku}
	            )
	            if isinstance(resp_prod2, dict):
	                itens = resp_prod2.get('itens') or []
	
	        if not itens:
	            return jsonify(ok=False, error='Produto n√£o encontrado pelo SKU', sku=sku), 404
	
	        # escolhe item ativo; se n√£o houver, pega o primeiro
	        ativo = next((i for i in itens if (i or {}).get('situacao') == 'A'), itens[0])
	        id_tiny = (ativo or {}).get('id')
	        if not id_tiny:
	            return jsonify(ok=False, error='Produto encontrado mas sem id Tiny'), 502
	
	        # 2) Composi√ß√£o (kit) por ID
	        # No seu projeto voc√™ usa '/produtos/{id}/kit' (mantemos a consist√™ncia)
	        resp_kit = ag_ctrl.caller.make_call(f'produtos/{id_tiny}/kit')
	
	        # Normaliza sa√≠da: se o Tiny n√£o retornar lista, tenta extrair
	        if isinstance(resp_kit, list):
	            kit = resp_kit
	        elif isinstance(resp_kit, dict) and 'itens' in resp_kit:
	            kit = resp_kit.get('itens') or []
	        elif resp_kit in (None, ''):
	            kit = []
	        else:
	            # formato inesperado, mas n√£o vamos quebrar o front
	            kit = []
	
	        return jsonify(ok=True, sku=sku, id_tiny=id_tiny, kit=kit), 200
	
	    except Exception as e:
	        app.logger.exception("Falha em /api/tiny/composicao-por-sku")
	        return jsonify(ok=False, error=str(e)), 500
	
	@bp_retirado.route('/api/tiny/composicao-auto', methods=['GET'])
	def tiny_composicao_auto():
	    """
	    GET /api/tiny/composicao-auto?valor=<barcode-ou-sku>
	    - Requer sess√£o v√°lida (usu√°rio logado).
	    - Tenta primeiro por GTIN/EAN (apenas d√≠gitos com 8/12/13/14+ chars).
	    - Se n√£o encontrar por GTIN/EAN, tenta por SKU (codigo).
	    - Retorna: { ok: true, origem: "gtin"|"sku", id_tiny, kit: [...] }
	      Onde kit = [] se for produto simples (n√£o √© kit).
	    """
	    if 'id_usuario' not in session:
	        return jsonify(ok=False, error='N√£o autenticado'), 401
	
	    valor = (request.args.get('valor') or '').strip()
	    if not valor:
	        return jsonify(ok=False, error='Par√¢metro "valor" √© obrigat√≥rio'), 400
	
	    try:
	        ag_ctrl = app.config['AG_CTRL']
	        # Normaliza EAN/GTIN (mantendo s√≥ d√≠gitos)
	        ean_digits = re.sub(r'\D+', '', valor)
	        candidato = None
	        origem = None
	
	        # Helper local para chamar Tiny e extrair itens
	        def _buscar_produtos(params: dict):
	            resp = ag_ctrl.caller.make_call('produtos', params_add=params)
	            if isinstance(resp, dict):
	                return resp.get('itens') or []
	            return []
	
	        # 1) TENTA POR GTIN/EAN (se o input "parece" um EAN/GTIN)
	        if len(ean_digits) >= 8:
	            # a) tenta por gtin (quando suportado pela API)
	            itens = _buscar_produtos({'gtin': ean_digits, 'situacao': 'A'})
	            candidato = next((i for i in itens if re.sub(r'\D+', '', str(i.get('gtin', ''))) == ean_digits), None)
	
	            # b) fallback: pesquisa gen√©rica (quando gtin n√£o filtra)
	            if not candidato:
	                itens = _buscar_produtos({'pesquisa': ean_digits})
	                candidato = next((i for i in itens if re.sub(r'\D+', '', str(i.get('gtin', ''))) == ean_digits), None)
	
	            # c) ainda n√£o achou? √∫ltima tentativa: procurar exato no campo de c√≥digo
	            if not candidato:
	                itens = _buscar_produtos({'codigo': valor, 'situacao': 'A'})
	                # aqui n√£o d√° pra cravar o match por EAN; se vier 1 item ativo, usamos
	                candidato = itens[0] if itens else None
	
	            if candidato:
	                origem = 'gtin'
	
	        # 2) SE N√ÉO ENCONTROU POR GTIN/EAN, TENTA POR SKU (codigo)
	        if not candidato:
	            itens = _buscar_produtos({'codigo': valor, 'situacao': 'A'})
	            candidato = itens[0] if itens else None
	            if candidato:
	                origem = 'sku'
	
	        if not candidato:
	            return jsonify(ok=False, error='Produto n√£o encontrado por GTIN/EAN nem por SKU'), 404
	
	        id_tiny = candidato.get('id')
	        if not id_tiny:
	            return jsonify(ok=False, error='Produto encontrado, mas sem id Tiny'), 502
	
	        # 3) Busca composi√ß√£o (kit) pelo ID
	        # Mantemos o mesmo padr√£o j√° usado no projeto:
	        resp_kit = ag_ctrl.caller.make_call(f'produtos/{id_tiny}/kit')
	
	        # Normaliza: kit pode vir como lista ou dentro de "itens"
	        if isinstance(resp_kit, list):
	            kit = resp_kit
	        elif isinstance(resp_kit, dict) and 'itens' in resp_kit:
	            kit = resp_kit.get('itens') or []
	        else:
	            kit = []
	
	        return jsonify(ok=True, origem=origem, id_tiny=id_tiny, kit=kit), 200
	
	    except Exception as e:
	        app.logger.exception("Falha em /api/tiny/composicao-auto")
	        return jsonify(ok=False, error=str(e)), 500
	
teste.py=from main import app, render_template, agendamento_controller
	
	@app.route('/teste-2')
	def teste_2():
	    agendamento_controller.clear_agendamentos()
	    agendamento_controller.create_agendamento_for_compras()
	    for i in agendamento_controller.agendamentos:
	        print(len(i.produtos))
	    dados = agendamento_controller.create_joined_agendamento()
	    #print(dados)
	    return render_template('teste.html', dados=agendamento_controller.return_joined_agend_in_dict(dados))
	    #agendamento_controller.clear_agendamentos()
	    #agendamento_controller.insert_agendamento(1)
	    #agendamento_controller.create_agendamento_from_bd_data(agendamento_controller.get_last_made_agendamento())
	    #return render_template('teste.html', dados=agendamento_controller.return_all_in_dict(agendamento_controller.get_last_made_agendamento()))
upload_excel.py=from werkzeug.utils import secure_filename
	from main import (
	    app,
	    request,
	    redirect,
	    url_for,
	    flash,
	    render_template,
	    session,
	    ALLOWED_EXTENSIONS,
	    MetodoInvalido,
	    ArquivoInvalido,
	    agendamento_controller,
	    db_controller  
	)
	import os
	import uuid
	import random
	import string
	import pandas as pd
	
	def mime_permitido(filename):
	    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS
	
	@app.route('/upload-excel', methods=['POST'])
	def upload_excel():
	    save_path = None
	    try:
	        file = request.files.get('file')
	        if not file or not mime_permitido(file.filename):
	            flash("Arquivo inv√°lido ou n√£o selecionado. Apenas .xlsx, .xls e .csv s√£o permitidos.", 'danger')
	            raise ArquivoInvalido()
	
	        # salva o arquivo no disco
	        original = secure_filename(file.filename)
	        unique   = f"{uuid.uuid4().hex}_{original}"
	        os.makedirs(app.config['UPLOAD_FOLDER'], exist_ok=True)   # <- garante a pasta
	        save_path = os.path.join(app.config['UPLOAD_FOLDER'], unique)
	        file.save(save_path)
	
	        # 1) registro do upload
	        upload_uuid = str(uuid.uuid4())
	        db_controller.insert_excel_upload((upload_uuid, original))  # <- corrige 'filename'
	
	        # 2) cria o Agendamento em mem√≥ria a partir do Excel
	        ag = agendamento_controller.create_agendamento_from_excel(
	            excel_path=save_path,
	            id_tipo=int(request.form.get('tipo', 0)),
	            empresa=int(request.form.get('empresa', 0)),
	            id_mktp=int(request.form.get('marketplace', 0)),
	            colaborador=request.form.get('colaborador', ''),
	            upload_uuid=upload_uuid
	        )
	
	        agendamento_controller.get_prod_data_tiny(ag)
	        agendamento_controller.get_comp_tiny(ag)
	        agendamento_controller.get_comp_data_tiny(ag)
	
	        # ‚îÄ‚îÄ‚îÄ NOVO ‚îÄ‚îÄ‚îÄ
	        # 2.5) gera um pedido fake de 8 d√≠gitos e sobrescreve o id_agend_ml
	        fake_pedido = ''.join(random.choices(string.digits, k=8))
	        ag.id_agend_ml = fake_pedido
	        # ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	
	        # 3) insere o Agendamento no BD e pega seu id interno (id_bd)
	        agendamento_controller.insert_agendamento_in_bd(ag)
	        last_id = agendamento_controller.get_last_made_agendamento_in_bd()[0]
	        agendamento_controller.set_id_bd_for_all(ag, last_id)
	
	        # 4) insere os produtos
	        agendamento_controller.insert_produto_in_bd(ag)
	
	        # ATUALIZA√á√ÉO E CORRE√á√ÉO: Mapeia os IDs gerados de volta para os objetos em mem√≥ria #
	        produtos_do_bd = agendamento_controller.return_all_produtos_from_agendamento(ag)
	        
	        # Cria um mapa que agrupa produtos por SKU. Cada SKU aponta para uma lista de objetos.
	        mapa_produtos_memoria = {}
	        for p in ag.produtos:
	            mapa_produtos_memoria.setdefault(p.sku, []).append(p)
	
	        for rec in produtos_do_bd:
	            inserted_prod_id, sku_prod = rec[0], rec[4]
	            
	            # Verifica se h√° uma lista de produtos para este SKU
	            if sku_prod in mapa_produtos_memoria and mapa_produtos_memoria[sku_prod]:
	                # Pega o primeiro produto da lista que ainda n√£o tem ID e o remove.
	                produto_obj = mapa_produtos_memoria[sku_prod].pop(0)
	                produto_obj.set_id_bd(inserted_prod_id)
	                produto_obj.set_id_bd_for_composicoes()
	            else:
	                # Este aviso agora indica um problema mais s√©rio (descompasso real)
	                app.logger.warning(f"SKU {sku_prod} do BD n√£o correspondeu a nenhum produto pendente em mem√≥ria.")
	
	        ##########################################################################################
	
	        # 6) insere as composi√ß√µes (foreign-key j√° ajustado pelo passo 5)
	        agendamento_controller.insert_composicao_in_bd(ag)
	
	        # 7) Define as flags de erro de estoque ap√≥s tudo estar inserido (NOVO)
	        agendamento_controller.set_error_flags_composicoes(ag)
	        
	        # 8) redireciona para a view do Excel (ou cleaning) passando o uuid
	        return redirect(url_for('agendamentos', acao='ver') + "?upload=ok_excel")
	
	    except ArquivoInvalido:
	        # trata especificamente o caso de arquivo inv√°lido, sem repetir o flash
	        return redirect(url_for('agendamentos', acao='ver') + "?upload=fail&erro=arquivo_invalido")
	
	    except Exception as e:
	        app.logger.error(f"Erro ao processar EXCEL: {e}", exc_info=True)
	        print(f"Erro ao processar EXCEL: {e}")
	        erro_msg = "erro_desconhecido"
	        err_str = str(e).lower()
	        if "gtin" in err_str:
	            erro_msg = "gtin_vazio"
	        elif "arquivo inv√°lido" in err_str:
	            erro_msg = "arquivo_invalido"
	        elif "excel" in err_str:
	            erro_msg = "erro_excel"
	        elif "database" in err_str:
	            erro_msg = "erro_banco"
	
	        flash("Ocorreu um erro inesperado ao processar a planilha.", "danger")
	        return redirect(
	            url_for('agendamentos', acao='ver')
	            + f"?upload=fail&erro={erro_msg}"
	        )
	        
	    finally:
	        # Garante que o arquivo tempor√°rio seja sempre removido
	        if save_path and os.path.exists(save_path):
	            os.remove(save_path)
	
upload_pdf.py=import re
	from mysql.connector import IntegrityError
	from werkzeug.utils import secure_filename
	from main import (
	    app,
	    request,
	    redirect,
	    url_for,
	    flash,
	    session,
	    ALLOWED_EXTENSIONS,
	    MetodoInvalido,
	    ArquivoInvalido,
	    agendamento_controller
	)
	import os
	
	
	def mime_permitido(filename):
	    return '.' in filename and filename.rsplit('.', 1)[1].lower() in ALLOWED_EXTENSIONS
	
	
	@app.route('/upload-pdf', methods=['POST'])
	def upload():
	    print(request.form)
	    try:
	        # 1) valida upload
	        if 'path' not in request.files:
	            flash("PDF n√£o foi enviado")
	            raise ArquivoInvalido()
	
	        file = request.files['path']
	        if file.filename == '' or not mime_permitido(file.filename):
	            flash('Arquivo inv√°lido ou n√£o selecionado')
	            raise ArquivoInvalido()
	
	        # 2) salva o PDF
	        filename = secure_filename(file.filename)
	        path_pdf = os.path.join(app.config['UPLOAD_FOLDER'], filename)
	        file.save(path_pdf)
	
	        # 3) extrai id do ML do nome do arquivo
	        try:
	            novo_id_ml = filename.split('-')[1]
	        except IndexError:
	            return redirect('/error/0')
	
	        # 4) Dados do formul√°rio
	        id_bd_str = request.form.get('id_bd', '').strip() or '0'
	        try:
	            id_bd = int(id_bd_str)
	        except ValueError:
	            id_bd = 0
	
	        colab   = session.get('nome_display_usuario', '')
	        empresa = int(request.form.get('empresa', '0'))
	        mktp    = int(request.form.get('marketplace', '0'))
	        tipo    = int(request.form.get('tipo', '0'))
	        centro  = request.form.get('centro_distribuicao', None) 
	        
	        id_agendamento = novo_id_ml
	
	        # === ATUALIZA√á√ÉO ===
	        if id_bd:
	            sucesso, msg = agendamento_controller.update_pdf_agendamento(
	                id_bd=id_bd,
	                colaborador=colab,
	                empresa=empresa,
	                id_mktp=mktp,
	                id_tipo=tipo,
	                pdf_path=path_pdf,
	                new_id_agend_ml=novo_id_ml,
	                centro_distribuicao=centro
	            )
	            if not sucesso:
	                raise Exception(msg)
	            # CORRE√á√ÉO: Mudei o par√¢metro para 'atualizado=ok' para dar um feedback melhor ao usu√°rio
	            return redirect(url_for('agendamentos', acao='ver', atualizado='ok'))
	
	        # === NOVO AGENDAMENTO ===
	
	        # --- VERIFICA√á√ÉO DE DUPLICIDADE MOVIDA PARA C√Å ---
	        # Agora, a checagem s√≥ acontece se N√ÉO for uma atualiza√ß√£o (id_bd √© 0 ou nulo)
	        if agendamento_controller.db_controller.exists_agendamento_ml(id_agendamento):
	            print(f"Tentativa de criar agendamento duplicado: {id_agendamento}")
	            os.remove(path_pdf) 
	            return redirect(url_for('agendamentos', acao='ver', upload='fail', erro='duplicado', pedido=id_agendamento))
	        
	        agendamento_controller.create_agendamento_from_pdf(
	            pdf_path=path_pdf,
	            id_agend_ml=id_agendamento,
	            id_tipo=tipo,
	            empresa=empresa,
	            id_mktp=mktp,
	            colaborador=colab,
	            centro_distribuicao=centro
	        )
	        agendamento = agendamento_controller.agendamentos[-1]
	        agendamento_controller.get_prod_data_tiny(agendamento)
	        agendamento_controller.get_comp_tiny(agendamento)
	        agendamento_controller.get_comp_data_tiny(agendamento)
	        
	        # O try/except aqui ainda √© √∫til para outros erros de banco de dados
	        try:
	            agendamento_controller.insert_agendamento_in_bd(agendamento)
	        except IntegrityError as e:
	            if e.errno == 1062:
	                pedido = agendamento.id_agend_ml
	                return redirect(
	                    url_for('agendamentos', acao='ver', upload='fail', erro='duplicado', pedido=pedido)
	                )
	
	        id_agend_bd = agendamento_controller.get_last_made_agendamento_in_bd()[0]
	        agendamento_controller.set_id_bd_for_all(agendamento, id_agend_bd)
	        agendamento_controller.insert_produto_in_bd(agendamento)
	
	        for tpl in agendamento_controller.return_all_produtos_from_agendamento(agendamento):
	            produto = agendamento_controller.search_produto(agendamento, 'id_ml', tpl[2])
	            if not produto:
	                app.logger.warning(f"Produto n√£o encontrado para o id_ml {tpl[2]}")
	                continue
	            
	            produto.set_id_bd(tpl[0])
	            produto.set_id_bd_for_composicoes()
	
	        agendamento_controller.set_error_flags_composicoes(agendamento)
	        agendamento_controller.insert_composicao_in_bd(agendamento)
	
	        return redirect(url_for('agendamentos', acao='ver') + "?upload=ok_pdf")
	
	    except Exception as e:
	        print(f"Erro ao processar PDF: {e}")
	        msg = str(e).lower()
	
	        # primeiro, testamos duplicado
	        if "j√° existe" in msg or "duplicado" in msg:
	            # tenta extrair o n√∫mero do pedido de dentro da mensagem
	            m = re.search(r'(\d+)', str(e))
	            pedido = m.group(1) if m else ''
	            return redirect(
	                url_for('agendamentos', acao='ver')
	                + f'?upload=fail&erro=duplicado&pedido={pedido}'
	            )
	
	        # sen√£o, mapeamos os outros erros como antes
	        erro_msg = "erro_desconhecido"
	        if "gtin" in msg:
	            erro_msg = "gtin_vazio"
	        elif "arquivo inv√°lido" in msg:
	            erro_msg = "arquivo_invalido"
	        elif "pdf" in msg:
	            erro_msg = "erro_pdf"
	        elif "database" in msg:
	            erro_msg = "erro_banco"
	
	        return redirect(
	            url_for('agendamentos', acao='ver')
	            + f'?upload=fail&erro={erro_msg}'
	        )
view_excel.py=from main import app, db_controller, render_template
	import pandas as pd, os
	
	@app.route('/view-excel/<uuid>')
	def show_excel(uuid):
	    rec = db_controller.get_excel_upload(uuid)
	    _, _, filename, _ = rec
	    path = os.path.join(app.config['UPLOAD_FOLDER'], filename)
	    df = pd.read_excel(path, engine='openpyxl')
	    html = df.to_html(classes='table table-striped table-hover', index=False)
	    return render_template('view_excel.html', filename=filename, data_table=html)
	
	

[static]
global.css=@import url('https://fonts.googleapis.com/css2?family=Montserrat:ital,wght@0,100..900;1,100..900&display=swap');
	
	html {
	    color-scheme: light;
	}
	
	body {
	    font-family: 'Montserrat', sans-serif;
	    background-color: #e9f1fb;
	    -webkit-user-select: none;
	    -moz-user-select: none;
	    -ms-user-select: none;
	    user-select: none;
	    -webkit-user-drag: none;
	}
	
	.nav-item.dropdown:hover .dropdown-menu {
	    display: block;
	    margin-top: 0;
	}
	
	img {
	    pointer-events: none;
	    -webkit-user-drag: none;
	    user-select: none;
	}
	
	/* Modal de sele√ß√£o de impressoras (BrowserPrint) */
	#printerList .list-group-item {
	    cursor: pointer;
	    border-radius: .5rem !important;
	    outline: none;
	}
	
	#printerList .list-group-item:focus-visible {
	    box-shadow: 0 0 0 .25rem rgba(13, 110, 253, .25);
	}
	
	#printerList .list-group-item.active {
	    border-color: rgba(13, 110, 253, .25);
	}
	
	#printerLoading {
	    min-height: 40px;
	}
global.js=document.querySelectorAll('img').forEach(img => {
	    img.setAttribute('draggable', 'false');
	    img.addEventListener('dragstart', event => event.preventDefault());
	});
	
	document.addEventListener('dragstart', (event) => event.preventDefault());
	document.addEventListener('selectstart', (event) => event.preventDefault());
	document.addEventListener('copy', (event) => event.preventDefault());
	
	
	

[static/imprimir_composicoes]
imprimir_composicoes.css=body {
	    font-weight: 500;
	}
	
	/* --- Card Wrapper --- */
	.card {
	    border: none;
	    border-radius: 0.5rem;
	}
	
	.card-body {
	    padding: 0;
	}
	
	/* --- Estilos gerais de tabela --- */
	.table {
	    font-size: 0.95rem;
	    margin-bottom: 0;
	}
	
	.table-hover tbody tr:hover {
	    background-color: #f1f5f9;
	}
	
	/* --- Wrapper responsivo com cantos arredondados --- */
	.table-responsive {
	    overflow: hidden;
	    border-radius: 0.5rem;
	}
	
	.table-responsive table {
	    width: 100%;
	    border-collapse: separate;
	    border-spacing: 0;
	}
	
	/* --- Cabe√ßalho azul + branco --- */
	.table thead {
	    background-color: #007bff;
	}
	
	.table thead th {
	    color: #fff;
	    border: none;
	    font-weight: 600;
	    padding: 0.75rem 1rem;
	}
	
	/* --- Arredonda s√≥ o topo do thead --- */
	.table thead th:first-child {
	    border-top-left-radius: 0.5rem;
	}
	
	.table thead th:last-child {
	    border-top-right-radius: 0.5rem;
	}
	
	/* --- Listras ‚Äúzebra‚Äù e c√©lulas --- */
	.table tbody tr:nth-child(even) {
	    background-color: #fbfcfd;
	}
	
	.table td,
	.table th {
	    padding: 0.75rem 1rem;
	    vertical-align: middle;
	}
	
	/* Melhorias visuais do dropdown */
	.dropdown-menu {
	    min-width: 200px;
	    font-size: 0.95rem;
	}
	
	.dropdown-menu .dropdown-item {
	    padding: 0.6rem 1rem;
	    transition: background 0.2s ease;
	}
	
	.dropdown-menu .dropdown-item:hover {
	    background-color: #f1f5f9;
	}
	
	input[type="number"] {
	    width: 70px;
	    padding: 4px 8px;
	    margin-top: 5px;
	    border: 1px solid #ccc;
	    border-radius: 6px;
	    text-align: center;
	    font-weight: bold;
	    color: #333;
	    background-color: #f9f9f9;
	    transition: border-color 0.3s, box-shadow 0.3s;
	}
	
	input[type="number"]:focus {
	    border-color: #007bff;
	    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
	    outline: none;
	    background-color: #fff;
	}
	
	
	/* --- Responsividade para telas pequenas --- */
	@media screen and (max-width: 1024px) {
	    .table thead {
	        display: none;
	    }
	
	    .table tbody,
	    .table tr,
	    .table td {
	        display: block;
	        width: 100%;
	    }
	
	    .table tr {
	        margin-bottom: 1rem;
	        background: #fff;
	        border-radius: 0.5rem;
	        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
	        padding: 0.75rem;
	    }
	
	    .table td {
	        padding: 1.5rem 1rem 0.5rem 1rem;
	        border: none;
	        text-align: left;
	        position: relative;
	    }
	
	    .table td::before {
	        content: attr(data-label);
	        position: absolute;
	        left: 1rem;
	        top: 0.5rem;
	        font-weight: bold;
	        color: #6c757d;
	        font-size: 0.85rem;
	        display: block;
	        width: 100%;
	        margin-bottom: 0.25rem;
	        color: #0D6EFD;
	    }
	}
	
	.input-wrapper {
	    display: inline-block;
	    position: relative;
	    max-width: 100%;
	}
	
	.input-wrapper input[type="number"] {
	    width: auto;
	    min-width: 60px;
	    max-width: 100px;
	    box-sizing: content-box;
	}
	
	.input-wrapper .input-mirror {
	    position: absolute;
	    top: 0;
	    left: 0;
	    visibility: hidden;
	    white-space: pre;
	    font-weight: bold;
	    font-family: inherit;
	    font-size: inherit;
	    padding: 4px 8px;
	}
	
	.table thead th {
	    position: sticky;
	    top: 0;
	    z-index: 2;
	    background-color: #007bff;
	    /* Mesma cor do seu cabe√ßalho */
	}
	
	@media print {
	    body * {
	        visibility: hidden;
	    }
	
	    #container-table,
	    #container-table * {
	        visibility: visible;
	    }
	
	    #container-table {
	        position: absolute;
	        top: 0;
	        left: 0;
	        width: 100%;
	        overflow: visible !important;
	        max-height: none !important;
	    }
	
	    .table-responsive {
	        overflow: visible !important;
	        max-height: none !important;
	    }
	
	    input[type="number"] {
	        border: none !important;
	        background: transparent !important;
	        font-weight: normal;
	        width: auto !important;
	    }
	
	    .input-wrapper .input-mirror {
	        display: none !important;
	    }
	}
	
	/* Esconde o cabe√ßalho de impress√£o na tela normal */
	.print-header {
	    display: none;
	}
	
	.print-position {
	    text-align: center;
	}
	
	/* Estiliza o cabe√ßalho apenas na impress√£o */
	@media print {
	    .print-header {
	        display: block;
	        text-align: center;
	        margin-bottom: 2rem;
	    }
	
	    .print-logo {
	        max-width: 150px;
	        margin-bottom: 1rem;
	    }
	
	    .print-title {
	        font-size: 1.5rem;
	        font-weight: bold;
	    }
	
	    .print-meta {
	        font-size: 0.9rem;
	        margin-top: -1rem;
	        margin-bottom: 2rem;
	        color: #444;
	    }
	
	    .print-meta span {
	        font-weight: bold;
	    }
	
	    .print-font {
	        font-size: 12px;
	    }
	}
imprimir_composicoes.js=async function getTinyData(ele) {
	    const idTiny = ele[1]?.getAttribute("id_tiny");
	    if (!idTiny) {
	        console.error("id_tiny n√£o encontrado");
	        return;
	    }
	
	    const { protocol, hostname, port } = window.location;
	    const baseUrl = `${protocol}//${hostname}${port ? `:${port}` : ""}`;
	
	    try {
	        const response = await retryFetch(
	            `${baseUrl}/dados-estoque/${idTiny}`,
	            { mode: "cors" },
	            2,
	            4000
	        );
	        const data = await response.json();
	        console.log(data);
	        replaceTableData(ele, data);
	    } catch (error) {
	        console.error("Falha ao buscar dados Tiny:", error);
	    }
	}
	
	async function retryFetch(
	    url,
	    options = {},
	    retries = 5,
	    delay = 5000
	) {
	    try {
	        const response = await fetch(url, options);
	        if (!response.ok) {
	            if (retries > 0) {
	                await new Promise((res) => setTimeout(res, delay));
	                return retryFetch(url, options, retries - 1, delay);
	            }
	            throw new Error(`Status ${response.status}`);
	        }
	        return response;
	    } catch (error) {
	        if (retries > 0) {
	            await new Promise((res) => setTimeout(res, delay));
	            return retryFetch(url, options, retries - 1, delay);
	        }
	        throw error;
	    }
	}
	
	function replaceTableData(ele, json) {
	    const depositos = json.depositos;
	    depositos.forEach((x) => {
	        if (x.id === 785301556) ele[4].innerText = x.disponivel;
	        else if (x.id === 894837591) ele[5].innerText = x.disponivel;
	        else if (x.id === 894837619) ele[6].innerText = x.disponivel;
	    });
	}
	
	// dispara para cada linha (pulando o cabe√ßalho)
	Array.from($('tr')).slice(1).forEach((tr) => {
	    getTinyData($(tr).children());
	});
	
	function autoResizeInput(input) {
	    const mirror = input.nextElementSibling;
	    mirror.textContent = input.value || "0";
	    input.style.width = mirror.offsetWidth + "px";
	}
	
	window.addEventListener("load", () => {
	    document
	        .querySelectorAll(".input-wrapper input[type='number']")
	        .forEach(autoResizeInput);
	
	    const hoje = new Date();
	    const dataFormatada =
	        hoje.toLocaleDateString("pt-BR") +
	        " " +
	        hoje.toLocaleTimeString("pt-BR");
	    const spanData = document.getElementById("data-hoje");
	    if (spanData) spanData.innerText = dataFormatada;
	});
	
	// mapeamento original ‚Üí curto
	const HEADER_MAP = {
	    'Localiza√ß√£o': 'Loc',
	    'Inferior': 'Inf',
	    'Mezanino': 'Mez',
	    'Caixa': 'Cx'
	};
	
	let originalHeaders = [];
	
	// pega todos os TH do cabe√ßalho
	const ths = Array.from(document.querySelectorAll('thead th'));
	
	// dispara antes do di√°logo de print
	window.addEventListener('beforeprint', () => {
	    originalHeaders = ths.map(th => th.textContent);
	    ths.forEach(th => {
	        const novo = HEADER_MAP[th.textContent];
	        if (novo) th.textContent = novo;
	    });
	});
	
	// dispara depois que o print √© cancelado ou conclu√≠do
	window.addEventListener('afterprint', () => {
	    ths.forEach((th, i) => {
	        th.textContent = originalHeaders[i];
	    });
	});
	
	
	
	// async function getTinyData(ele) {
	//     let id_tiny_element = ele[1].getAttribute("id_tiny")
	//     let protocol = window.location.href.split(':')[0]
	//     let url = `${protocol}://${window.location.hostname}:${window.location.port}`
	//     console.log(await retryFetch(`${url}/dados-estoque/${id_tiny_element}`, { mode: 'cors' }, 5))
	// }
	
	// async function retryFetch(url, options = {}, retries) {
	//     setTimeout(() =>
	//         fetch(url, options)
	//             .then((res) => {
	//                 return res
	//                 if (res.ok) {
	//                     return res
	//                 }
	//                 if (retries > 0) {
	//                     return retryFetch(url, options, retries - 1)
	//                 }
	//                 throw new Error(res.status)
	//             })
	//             .catch((error) => console.error(error.message)),
	//         500)
	// }
	
	// function replaceTableData(ele, json) {
	//     let depositos = json["depositos"]
	//     let ids_depositos = [785301556, 894837591, 894837619]
	
	//     let reservado = depositos[0]["reservado"]
	
	//     let dep_obj = {
	//         "151i": 0,
	//         "151m": 0,
	//         "177": 0
	//     }
	
	//     depositos.forEach((x) => {
	//         if (x["id"] == 785301556) { // Dep√≥sito 151 Inferior
	//             //dep_obj["151i"] = x["disponivel"]
	//             ele[4].innerText = x["disponivel"]
	//         } else if (x["id"] == 894837591) { // Dep√≥sito 151 Mesanino
	//             //dep_obj["151m"] = x["disponivel"]
	//             ele[5].innerText = x["disponivel"]
	//         } else if (x["id"] == 894837619) { // Dep√≥sito 177 Cx Fechado
	//             //dep_obj["177"] = x["disponivel"]
	//             ele[6].innerText = x["disponivel"]
	//         }
	//     })
	// }
	
	// Array.from($('tr')).forEach((x, index) => {
	//     if (index > 0) {
	//         getTinyData($(x).children())
	//     }
	// })
	
	// function autoResizeInput(input) {
	//     const mirror = input.nextElementSibling;
	//     mirror.textContent = input.value || "0";
	//     input.style.width = mirror.offsetWidth + "px";
	// }
	
	// // Aplica ao carregar a tabela
	// window.addEventListener("load", () => {
	//     document.querySelectorAll(".input-wrapper input[type='number']").forEach(input => autoResizeInput(input));
	// });
	
	// window.addEventListener("load", () => {
	//     const hoje = new Date();
	//     const dataFormatada = hoje.toLocaleDateString('pt-BR') + ' ' + hoje.toLocaleTimeString('pt-BR');
	//     const spanData = document.getElementById("data-hoje");
	//     if (spanData) {
	//         spanData.innerText = dataFormatada;
	//     }
	// });
	

[static/expedicao]
expedicao.css=/* static/expedicao/expedicao.css */
	
	body {
	    background-color: #e9f1fb;
	}
	
	/* ===== ESTILOS PARA O PAINEL DE CONTROLE ===== */
	.panel-control {
	    background-color: #0d6efd;
	    color: #fff;
	    padding: 1rem;
	    border-radius: 0.375rem;
	    box-shadow: 0 .125rem .25rem rgba(0, 0, 0, .075);
	}
	
	.panel-title {
	    padding-bottom: 0.75rem;
	    margin-bottom: 1rem;
	    border-bottom: 1px solid rgba(255, 255, 255, 0.2);
	}
	
	.panel-control .form-label {
	    color: #fff;
	}
	
	.panel-control,
	.panel-control div {
	    color: #fff;
	}
	
	@media (min-width: 992px) {
	    .border-end-lg {
	        border-right: 1px solid rgba(255, 255, 255, 0.2) !important;
	    }
	}
	
	/* ===== ESTILOS PARA OS CARDS DAS CAIXAS ===== */
	.caixa-card {
	    transition: transform 0.2s ease-in-out;
	}
	
	.caixa-card:hover {
	    transform: translateY(-5px);
	}
	
	/* --- ESTILO DO OVERLAY DE CONCLUS√ÉO --- */
	.check-overlay {
	    position: absolute;
	    top: 0;
	    left: 0;
	    width: 100%;
	    height: 100%;
	    background-color: rgba(25, 135, 84, 0.85);
	    display: flex;
	    justify-content: center;
	    align-items: center;
	    opacity: 0;
	    visibility: hidden;
	    pointer-events: none;
	    border-radius: var(--bs-card-border-radius);
	    transition: opacity 0.3s ease-in-out, visibility 0.3s ease-in-out;
	    z-index: 10;
	}
	
	.check-overlay .bi-check-circle-fill {
	    font-size: 4rem;
	    color: white;
	    transform: scale(0.8);
	    transition: transform 0.3s ease-in-out;
	}
	
	/* --- CONTROLE DE VISIBILIDADE --- */
	.caixa-card.status-concluido .check-overlay {
	    opacity: 1;
	    visibility: visible;
	}
	
	.caixa-card.status-concluido .check-overlay .bi-check-circle-fill {
	    transform: scale(1);
	}
	
	.caixa-card.status-concluido .card-icon {
	    display: none;
	    /* Opcional: esconde o √≠cone laranja original */
	}
	
	/* ===== FEEDBACK DE ERRO NO INPUT ===== */
	.input-erro {
	    animation: shake 0.5s;
	    border-color: #dc3545 !important;
	}
	
	@keyframes shake {
	
	    0%,
	    100% {
	        transform: translateX(0);
	    }
	
	    25% {
	        transform: translateX(-5px);
	    }
	
	    75% {
	        transform: translateX(5px);
	    }
	}
expedicao.js=document.addEventListener("DOMContentLoaded", function () {
	    // --- 1. SELE√á√ÉO DE ELEMENTOS E DADOS ---
	    const panelControl = document.querySelector('.panel-control');
	    const inputBipCaixa = document.getElementById('input-bip-caixa');
	    const contadorCaixasEl = document.getElementById('contador-caixas');
	    const cronometroEl = document.getElementById('cronometro-expedicao');
	
	    // Containers de estado da UI
	    const containerInicio = document.getElementById('container-inicio');
	    const containerBipagem = document.getElementById('container-bipagem');
	    const containerFinalizacao = document.getElementById('container-finalizacao');
	
	    // Bot√µes de a√ß√£o
	    const btnIniciarExpedicao = document.getElementById('btn-iniciar-expedicao');
	    const btnFinalizarExpedicao = document.getElementById('btn-finalizar-expedicao');
	    const btnCancelarInicio = document.getElementById('btn-cancelar-inicio');
	    const btnResetarExpedicao = document.getElementById('btn-resetar-expedicao');
	
	    // Dados do agendamento (lidos dos atributos data-*)
	    const agendamentoIdML = panelControl?.dataset.idMl;
	    const agendamentoIdBD = panelControl?.dataset.idBd;
	    const totalCaixas = document.querySelectorAll('.caixa-card-container').length;
	
	    // Vari√°veis de estado
	    let cronometroInterval;
	    let pollingInterval;
	
	    // ====== MAPAS DE DEP√ìSITOS ======
	    // Aten√ß√£o: mapeado conforme seu template: 1=Ja√∫ Pesca, 2=Ja√∫ Fishing, 3=L.T. Sports
	    const DEPOSITOS_DESTINO = {
	        1: { // ? Empresa Ja√∫ Pesca [ SILVIO ]
	            1: 787964633, // TODO Mercado Livre
	            2: 789951567, // TODO Magazine Luiza
	            3: null, // * Shopee (SILVIO N√ÉO TEM SHOPEE)
	            4: 888484781 //  TODO Amazon
	        },
	        2: { // ? Empresa Ja√∫ Fishing [ LEANDRO ]
	            1: 888526350, // TODO Mercado Livre
	            2: 901950985, // TODO Magazine Luiza
	            3: null, // * Shopee (LEANDRO N√ÉO TEM SHOPEE)
	            4: 901951075 //  TODO Amazon
	        },
	        3: { // ? Empresa LT Sports [ LUCAS ]
	            1: 888526346, // TODO Mercado Livre
	            2: 901950975, // TODO Magazine Luiza
	            3: 895899584, // TODO Shopee
	            4: 901951052 //  TODO Amazon 
	        }
	    }
	
	    // Origem fixa (Produ√ß√£o) e fallback gen√©rico (se faltar mapeamento)
	    const DEPOSITO_PRODUCAO = 822208355; // Dep√≥sito 141
	
	    const NOMES_EMPRESA = { 1: "Ja√∫ Pesca", 2: "Ja√∫ Fishing", 3: "L.T. Sports" };
	    const NOMES_MKTP = { 1: "Mercado Livre", 2: "Magalu", 3: "Shopee", 4: "Amazon", 5: "Outros" };
	
	    // ====== HELPERS ======
	    function onlyDigits(v) { return String(v || '').replace(/\D+/g, ''); }
	
	    function getTodosOsProdutos() {
	        const container = document.getElementById('js-data-produtos');
	        if (!container || !container.dataset.produtos) return [];
	        try { return JSON.parse(container.dataset.produtos); } catch { return []; }
	    }
	
	    // Sanitize simples para mensagens em HTML dos modais
	    function esc(s) {
	        const d = document.createElement('div');
	        d.textContent = String(s ?? '');
	        return d.innerHTML;
	    }
	
	    // Resolve id_tiny a partir do item da caixa (item.sku pode ser id_ml ou sku)
	    function resolverIdTiny(itemSku, todos) {
	        const d = String(itemSku || '');
	        const byIdML = todos.find(p => String(p.id_ml) === d);
	        if (byIdML && (byIdML.id_tiny || byIdML.id)) return byIdML.id_tiny || byIdML.id;
	
	        const bySku = todos.find(p => String(p.sku) === d);
	        if (bySku && (bySku.id_tiny || bySku.id)) return bySku.id_tiny || bySku.id;
	
	        const digit = onlyDigits(d);
	        if (digit) {
	            const byGtin = todos.find(p => onlyDigits(p.gtin) === digit);
	            if (byGtin && (byGtin.id_tiny || byGtin.id)) return byGtin.id_tiny || byGtin.id;
	        }
	        return null;
	    }
	
	    function montarMovimentosValidos(movimentosAgregados, { depProducao, depDestino, precoUnitario = 0 }) {
	        const validos = [];
	        const invalidos = [];
	
	        const dOrig = Number(depProducao);
	        const dDest = Number(depDestino);
	        const pUnit = Number(precoUnitario) || 0;
	
	        movimentosAgregados.forEach(m => {
	            const id = Number(m.id_produto);
	            const un = Number(m.unidades);
	
	            if (!Number.isFinite(id) || id <= 0) {
	                invalidos.push({ ...m, motivo: 'id_produto inv√°lido' });
	                return;
	            }
	            if (!Number.isFinite(un) || un <= 0) {
	                invalidos.push({ ...m, motivo: 'unidades inv√°lidas' });
	                return;
	            }
	            if (!Number.isFinite(dOrig) || dOrig <= 0) {
	                invalidos.push({ ...m, motivo: 'dep√≥sito de origem inv√°lido' });
	                return;
	            }
	            if (!Number.isFinite(dDest) || dDest <= 0) {
	                invalidos.push({ ...m, motivo: 'dep√≥sito de destino inv√°lido' });
	                return;
	            }
	            if (dOrig === dDest) {
	                invalidos.push({ ...m, motivo: 'origem e destino iguais' });
	                return;
	            }
	
	            validos.push({
	                id_produto: id,
	                de: dOrig,
	                para: dDest,
	                unidades: un,
	                preco_unitario: pUnit
	            });
	        });
	
	        return { validos, invalidos };
	    }
	
	    // Soma unidades por id_tiny varrendo TODAS as caixas do DOM
	    function agregarMovimentosPorProduto() {
	        const todos = getTodosOsProdutos();
	        const botoes = document.querySelectorAll('.js-visualizar-itens');
	        const somaPorId = new Map();
	        const faltantes = [];
	
	        botoes.forEach(btn => {
	            const raw = btn.getAttribute('data-caixa');
	            if (!raw) return;
	            let caixa;
	            try { caixa = JSON.parse(raw); } catch { return; }
	            (caixa.itens || []).forEach(item => {
	                const idTiny = resolverIdTiny(item.sku, todos);
	                const qtd = Number(item.quantidade || 0);
	                if (!idTiny) {
	                    faltantes.push({ sku: item.sku, quantidade: qtd });
	                    return;
	                }
	                somaPorId.set(idTiny, (somaPorId.get(idTiny) || 0) + qtd);
	            });
	        });
	
	        const movimentos = Array.from(somaPorId.entries()).map(([id_produto, unidades]) => ({ id_produto, unidades }));
	        return { movimentos, faltantes };
	    }
	
	    // ==== HELPER: entrada manual de ID de dep√≥sito (Admin) ====
	    function inserirIdDepositoAdmin(depProducao) {
	        return Swal.fire({
	            title: 'Inserir ID do dep√≥sito (Admin)',
	            html: 'Pe√ßa para que um administrador insira o ID do dep√≥sito!',
	            input: 'number',
	            inputLabel: 'ID do dep√≥sito de destino',
	            inputAttributes: { min: 1, step: 1 },
	            inputValidator: (value) => {
	                if (!value) return 'Informe um ID.';
	                const v = Number(value);
	                if (!Number.isInteger(v) || v <= 0) return 'O ID precisa ser um inteiro > 0.';
	                if (v === depProducao) return `O destino n√£o pode ser igual √† origem (#${depProducao}).`;
	                return null;
	            },
	            showCancelButton: true,
	            confirmButtonText: 'Usar este ID',
	            cancelButtonText: 'Cancelar'
	        }).then(res => {
	            if (res.isConfirmed) return Number(res.value);
	            throw new Error('cancelled');
	        });
	    }
	
	    // --- FUN√á√ÉO AUXILIAR ROBUSTA PARA PARSE DE DATA (A CORRE√á√ÉO PRINCIPAL) ---
	    function parseISOLocal(isoString) {
	        if (!isoString) return null;
	        // Divide a string em partes: "YYYY-MM-DDTHH:MM:SS" -> ["YYYY", "MM", "DD", "HH", "MM", "SS"]
	        const parts = isoString.split(/[-T:.]/); // Inclui '.' para remover poss√≠veis milissegundos
	        if (parts.length < 6) return null; // Garante que a data √© v√°lida
	        // Os meses em JavaScript s√£o 0-indexados (Janeiro=0, Dezembro=11), por isso subtra√≠mos 1.
	        return new Date(parts[0], parts[1] - 1, parts[2], parts[3], parts[4], parts[5]);
	    }
	
	    let inicioTimestamp = parseISOLocal(panelControl?.dataset.inicioExp);
	    let fimTimestamp = parseISOLocal(panelControl?.dataset.fimExp);
	
	    // --- 2. FUN√á√ïES DO CRON√îMETRO ---
	    function formatarTempo(milissegundos) {
	        if (isNaN(milissegundos) || milissegundos < 0) {
	            milissegundos = 0;
	        }
	        const totalSegundos = Math.floor(milissegundos / 1000);
	        const horas = Math.floor(totalSegundos / 3600).toString().padStart(2, '0');
	        const minutos = Math.floor((totalSegundos % 3600) / 60).toString().padStart(2, '0');
	        const segundos = (totalSegundos % 60).toString().padStart(2, '0');
	        return `${horas}:${minutos}:${segundos}`;
	    }
	
	    function iniciarCronometro() {
	        if (cronometroInterval) clearInterval(cronometroInterval);
	        if (!inicioTimestamp) return;
	
	        cronometroInterval = setInterval(() => {
	            const agora = new Date();
	            const decorrido = agora - inicioTimestamp;
	            cronometroEl.textContent = formatarTempo(decorrido);
	        }, 1000);
	    }
	
	    function pararCronometro() {
	        clearInterval(cronometroInterval);
	        if (inicioTimestamp && fimTimestamp) {
	            const decorrido = fimTimestamp - inicioTimestamp;
	            cronometroEl.textContent = formatarTempo(decorrido);
	        }
	    }
	
	    // --- 3. GERENCIAMENTO DE ESTADO DA UI ---
	    function gerenciarEstadoInicial() {
	        if (totalCaixas === 0) {
	            if (cronometroEl) cronometroEl.textContent = "00:00:00";
	            return;
	        }
	
	        verificarStatusCaixas();
	
	        if (fimTimestamp) { // Se o processo J√Å TERMINOU
	            containerInicio.style.display = 'none';
	            containerBipagem.style.display = 'none';
	            containerFinalizacao.style.display = 'block';
	            btnFinalizarExpedicao.disabled = true;
	            btnFinalizarExpedicao.innerHTML = '<i class="bi bi-check-all me-2"></i> Expedi√ß√£o Conclu√≠da';
	            pararCronometro();
	        } else if (inicioTimestamp) { // Se o processo EST√Å EM ANDAMENTO
	            containerInicio.style.display = 'none';
	            containerFinalizacao.style.display = 'none';
	            containerBipagem.style.display = 'block';
	            inputBipCaixa.focus();
	            iniciarCronometro();
	            iniciarPolling();
	        } else { // Se o processo N√ÉO COME√áOU
	            containerBipagem.style.display = 'none';
	            containerFinalizacao.style.display = 'none';
	            containerInicio.style.display = 'block';
	        }
	    }
	
	    // --- 4. EVENT LISTENERS E L√ìGICA DE A√á√ïES ---
	    btnIniciarExpedicao?.addEventListener('click', function () {
	        this.disabled = true;
	        fetch('/api/expedicao/iniciar', {
	            method: 'POST',
	            headers: { 'Content-Type': 'application/json' },
	            body: JSON.stringify({ id_agend_bd: agendamentoIdBD })
	        })
	            .then(res => res.json())
	            .then(data => {
	                if (data.success) {
	                    // Usa a nova fun√ß√£o de parse robusta
	                    inicioTimestamp = parseISOLocal(data.startTime);
	                    gerenciarEstadoInicial();
	                } else {
	                    Swal.fire('Erro', 'N√£o foi poss√≠vel iniciar a expedi√ß√£o.', 'error');
	                    this.disabled = false;
	                }
	            });
	    });
	
	    // Pergunta um dep√≥sito de destino ao usu√°rio (modo admin)
	    async function solicitarDepositoDestino({ empresaId, mktpId, depProducao, motivo = '' }) {
	        const { value: dep } = await Swal.fire({
	            title: 'Dep√≥sito de destino',
	            html: `
	      ${motivo ? `<div class="mb-2 text-danger fw-bold">${motivo}</div>` : ''}
	      <div class="mb-2">
	        Empresa: <b>${NOMES_EMPRESA[empresaId] || '(?)'}</b><br>
	        Marketplace: <b>${NOMES_MKTP[mktpId] || '(?)'}</b>
	      </div>
	      <div class="small text-muted">
	        Somente um administrador deve informar este ID.
	      </div>
	    `,
	            input: 'number',
	            inputAttributes: { min: 1 },
	            inputLabel: 'ID do dep√≥sito destino',
	            inputPlaceholder: 'Ex.: 888526350',
	            confirmButtonText: 'Usar este ID',
	            showCancelButton: true,
	            cancelButtonText: 'Cancelar',
	            preConfirm: (v) => {
	                const n = Number(v);
	                if (!n) {
	                    Swal.showValidationMessage('Informe um n√∫mero v√°lido.');
	                    return false;
	                }
	                if (n === Number(depProducao)) {
	                    Swal.showValidationMessage('Origem e destino n√£o podem ser o mesmo dep√≥sito.');
	                    return false;
	                }
	                return n;
	            }
	        });
	        return dep ? Number(dep) : null;
	    }
	
	    // Mostra erro da transfer√™ncia com op√ß√µes de Retry / ‚ÄúInformar ID‚Äù
	    async function tratarFalhaTransferencia({ msg, podeInformarId, empresaId, mktpId, depProducao, onRetry, onRetryComId }) {
	        const buttons = {
	            confirmButtonText: 'Tentar novamente',
	            showCancelButton: true,
	            cancelButtonText: 'Fechar',
	            showDenyButton: podeInformarId,
	            denyButtonText: 'Informar ID e tentar'
	        };
	        const { isConfirmed, isDenied } = await Swal.fire({
	            icon: 'error',
	            title: 'N√£o foi poss√≠vel transferir',
	            html: esc(msg || 'Falha ao enfileirar as movimenta√ß√µes.'),
	            ...buttons
	        });
	
	        if (isDenied && onRetryComId) {
	            const novoId = await solicitarDepositoDestino({ empresaId, mktpId, depProducao, motivo: 'Dep√≥sito n√£o mapeado ou inv√°lido.' });
	            if (novoId) onRetryComId(novoId);
	            return;
	        }
	        if (isConfirmed && onRetry) onRetry();
	    }
	
	    btnFinalizarExpedicao?.addEventListener('click', async function () {
	        // evita duplo clique
	        if (this.disabled) return;
	
	        const empresaId = Number(panelControl?.dataset.empresa || 0);
	        const mktpId = Number(panelControl?.dataset.mktp || 0);
	        const depProducao = Number(panelControl?.dataset.depProducao || DEPOSITO_PRODUCAO);
	
	        let depDestino = (DEPOSITOS_DESTINO[empresaId] || {})[mktpId] || null;
	
	        // 1) Agrega itens das caixas -> movimentos por id_tiny
	        const { movimentos, faltantes } = agregarMovimentosPorProduto();
	        if (!movimentos.length) {
	            return Swal.fire('Nada para mover', 'N√£o foi poss√≠vel agregar itens das caixas para transfer√™ncia.', 'info');
	        }
	
	        // 2) Fluxo principal encapsulado (continua mesmo com faltantes)
	        const continuarDepoisDosFaltantes = async () => {
	            // 2.1) Dep√≥sito destino (mapeado ou solicitado)
	            if (!depDestino) {
	                const novo = await solicitarDepositoDestino({ empresaId, mktpId, depProducao, motivo: 'N√£o h√° dep√≥sito de destino configurado.' });
	                if (!novo) return; // cancelado
	                depDestino = novo;
	            }
	
	            // 2.2) Bloqueia origem==destino
	            if (Number(depDestino) === Number(depProducao)) {
	                await Swal.fire('Aten√ß√£o', `Origem (#${depProducao}) e destino (#${depDestino}) n√£o podem ser iguais.`, 'warning');
	                return;
	            }
	
	            // 3) Confirma√ß√£o final
	            const { isConfirmed } = await Swal.fire({
	                title: "Confirmar",
	                html: `Finalizar expedi√ß√£o e transferir do <b>Produ√ß√£o (#${depProducao})</b><br>
	             para <b>${NOMES_MKTP[mktpId] || '(?)'} (dep #${depDestino})</b> ‚Äî ${NOMES_EMPRESA[empresaId] || '(?)'}?`,
	                icon: "question",
	                showCancelButton: true,
	                confirmButtonColor: "#28a745",
	                cancelButtonColor: "#6c757d",
	                confirmButtonText: "Sim, mover e finalizar",
	                cancelButtonText: "Cancelar"
	            });
	            if (!isConfirmed) return;
	
	            // 4) Monta payload (filtra inv√°lidos) ‚Äî antes de chamar o mover
	            const observacoes = `Expedi√ß√£o ${panelControl?.dataset.idMl} ‚Äì ${NOMES_EMPRESA[empresaId] || ''} ‚Üí ${NOMES_MKTP[mktpId] || ''}`;
	
	            const tentarMover = async (dest) => {
	                const { validos, invalidos } = montarMovimentosValidos(movimentos, {
	                    depProducao,
	                    depDestino: dest,
	                    precoUnitario: 0
	                });
	
	                if (!validos.length) {
	                    await Swal.fire('Aten√ß√£o', 'N√£o h√° movimentos v√°lidos para enviar com esse dep√≥sito destino.', 'warning');
	                    return;
	                }
	
	                // 5) Enfileira no servidor (MOVE PRIMEIRO)
	                this.disabled = true;
	                Swal.fire({
	                    title: 'Transferindo para o marketplace‚Ä¶',
	                    html: 'Gerando movimenta√ß√µes de estoque (Sa√≠da/Entrada).',
	                    allowOutsideClick: false,
	                    didOpen: () => Swal.showLoading()
	                });
	
	                try {
	                    const r = await fetch('/estoque/mover', {
	                        method: 'POST',
	                        headers: { 'Content-Type': 'application/json' },
	                        body: JSON.stringify({
	                            observacoes,
	                            preco_unitario: 0,
	                            movimentos: validos
	                        })
	                    });
	                    const payload = await r.json().catch(() => ({}));
	
	                    if (r.ok && payload.ok) {
	                        const qtd = Array.isArray(payload.tasks) ? payload.tasks.length : 0;
	
	                        let html = `Foram enfileiradas <b>${qtd}</b> tarefas (Sa√≠das e Entradas).`;
	                        if (invalidos.length) {
	                            const desc = invalidos.slice(0, 5)
	                                .map(x => `‚Ä¢ id_produto=${x.id_produto ?? '-'} | unidades=${x.unidades ?? '-'} (${x.motivo})`)
	                                .join('<br>');
	                            html += `<br><br><span class="text-muted">Alguns itens foram ignorados:<br>${esc(desc)}</span>`;
	                        }
	
	                        // 6) S√≥ agora FINALIZA a expedi√ß√£o
	                        const respFin = await fetch('/api/expedicao/finalizar', {
	                            method: 'POST',
	                            headers: { 'Content-Type': 'application/json' },
	                            body: JSON.stringify({ id_agend_bd: panelControl?.dataset.idBd })
	                        }).then(r => r.json()).catch(() => ({ success: false }));
	
	                        if (!respFin?.success) {
	                            this.disabled = false;
	                            await Swal.fire('Movido, mas n√£o finalizado', 'As movimenta√ß√µes foram enfileiradas, por√©m houve erro ao finalizar a expedi√ß√£o. Tente finalizar novamente.', 'warning');
	                            return;
	                        }
	
	                        await Swal.fire({ icon: 'success', title: 'Movimenta√ß√µes enfileiradas!', html, timer: 1800, showConfirmButton: false });
	                        window.location.href = '/agendamentos/ver?finalizado=ok';
	                    } else {
	                        // Erro no mover ‚Üí oferece retry / informar ID ‚Äî N√ÉO finaliza
	                        await tratarFalhaTransferencia({
	                            msg: payload?.error || payload?.detalhe || r.statusText,
	                            podeInformarId: true,
	                            empresaId, mktpId, depProducao,
	                            onRetry: () => tentarMover(dest),
	                            onRetryComId: (novoId) => tentarMover(Number(novoId))
	                        });
	                        this.disabled = false;
	                    }
	                } catch (err) {
	                    console.error('Erro na transfer√™ncia:', err);
	                    await tratarFalhaTransferencia({
	                        msg: 'N√£o foi poss√≠vel comunicar com o servidor.',
	                        podeInformarId: true,
	                        empresaId, mktpId, depProducao,
	                        onRetry: () => tentarMover(dest),
	                        onRetryComId: (novoId) => tentarMover(Number(novoId))
	                    });
	                    this.disabled = false;
	                }
	            };
	
	            return tentarMover(depDestino);
	        };
	
	        // 7) Se houver itens sem id_tiny, confirma se continua apenas com os resolvidos
	        if (faltantes.length) {
	            const lista = faltantes.map(f => `‚Ä¢ ${f.sku} (qtd: ${f.quantidade})`).join('<br>');
	            Swal.fire({
	                icon: 'warning',
	                title: 'Produtos sem id_tiny',
	                html: `N√£o consegui resolver <b>id_tiny</b> para:<br>${lista}<br><br>Continuar movendo apenas os resolvidos?`,
	                showCancelButton: true,
	                confirmButtonText: 'Sim, continuar',
	                cancelButtonText: 'Cancelar'
	            }).then(res => { if (res.isConfirmed) continuarDepoisDosFaltantes(); });
	        } else {
	            continuarDepoisDosFaltantes();
	        }
	    });
	
	    btnCancelarInicio?.addEventListener('click', function () {
	        Swal.fire({
	            title: "Voltar?",
	            text: "Tem certeza que deseja cancelar o in√≠cio desta expedi√ß√£o? O cron√¥metro ser√° zerado.",
	            icon: "warning",
	            showCancelButton: true,
	            confirmButtonColor: "#d33",
	            cancelButtonColor: "#3085d6",
	            confirmButtonText: "Sim, cancelar!",
	            cancelButtonText: "N√£o"
	        }).then((result) => {
	            if (result.isConfirmed) {
	                fetch('/api/expedicao/cancelar-inicio', {
	                    method: 'POST',
	                    headers: { 'Content-Type': 'application/json' },
	                    body: JSON.stringify({ id_agend_bd: agendamentoIdBD })
	                })
	                    .then(res => res.json())
	                    .then(data => {
	                        if (data.success) {
	                            window.location.reload();
	                        } else {
	                            Swal.fire('Erro!', 'N√£o foi poss√≠vel cancelar o in√≠cio.', 'error');
	                        }
	                    });
	            }
	        });
	    });
	
	    btnResetarExpedicao?.addEventListener('click', function () {
	        Swal.fire({
	            title: "Resetar Expedi√ß√£o?",
	            html: "Isso ir√° apagar os hor√°rios de in√≠cio e fim desta expedi√ß√£o, retornando-a ao estado inicial.<br><strong>Esta a√ß√£o n√£o pode ser desfeita.</strong>",
	            icon: "warning",
	            showCancelButton: true,
	            confirmButtonColor: "#d33",
	            cancelButtonColor: "#3085d6",
	            confirmButtonText: "Sim, resetar!",
	            cancelButtonText: "Cancelar"
	        }).then((result) => {
	            if (result.isConfirmed) {
	                fetch('/api/expedicao/resetar', {
	                    method: 'POST',
	                    headers: { 'Content-Type': 'application/json' },
	                    body: JSON.stringify({ id_agend_bd: agendamentoIdBD })
	                })
	                    .then(res => res.json())
	                    .then(data => {
	                        if (data.success) {
	                            Swal.fire('Resetado!', 'A expedi√ß√£o foi reiniciada.', 'success')
	                                .then(() => window.location.reload());
	                        } else {
	                            Swal.fire('Erro!', 'N√£o foi poss√≠vel resetar o estado da expedi√ß√£o.', 'error');
	                        }
	                    });
	            }
	        });
	    });
	
	    inputBipCaixa?.addEventListener('keydown', function (event) {
	        if (event.key === 'Enter') {
	            event.preventDefault();
	            const valorLido = this.value.trim();
	            if (!valorLido) return;
	            let idExtraido = '';
	            try {
	                const dadosQr = JSON.parse(valorLido);
	                idExtraido = dadosQr.id;
	            } catch (e) { idExtraido = valorLido; }
	            this.value = '';
	            const caixaContainer = document.querySelector(`.caixa-card-container[data-codigo-unico="${idExtraido}"]`);
	            if (caixaContainer) {
	                const card = caixaContainer.querySelector('.caixa-card');
	                if (card.classList.contains('status-pendente')) {
	                    fetch('/api/expedicao/bipar', {
	                        method: 'POST',
	                        headers: { 'Content-Type': 'application/json' },
	                        body: JSON.stringify({
	                            id_agend_ml: agendamentoIdML,
	                            codigo_unico_caixa: idExtraido
	                        })
	                    })
	                        .then(response => response.json())
	                        .then(data => {
	                            if (data.success) {
	                                marcarCaixaComoConcluidaNaTela(idExtraido);
	                                atualizarContador();
	                            } else {
	                                Swal.fire('Erro!', 'N√£o foi poss√≠vel salvar a bipagem no servidor.', 'error');
	                            }
	                        })
	                        .catch((error) => {
	                            console.error('ERRO na requisi√ß√£o POST:', error);
	                            Swal.fire('Erro de Rede!', 'Falha de comunica√ß√£o com o servidor.', 'error');
	                        });
	                } else {
	                    Swal.fire({
	                        icon: 'warning', title: 'Caixa j√° bipada!',
	                        text: 'Esta caixa j√° foi registrada na expedi√ß√£o.',
	                        timer: 2000, showConfirmButton: false
	                    });
	                }
	            } else {
	                marcarErro();
	                Swal.fire({
	                    icon: 'error', title: 'Caixa n√£o encontrada!',
	                    text: 'O QR Code lido n√£o corresponde a nenhuma caixa deste agendamento.',
	                    timer: 2500, showConfirmButton: false
	                });
	            }
	        }
	    });
	
	    // --- 5. FUN√á√ïES DE APOIO E ATUALIZA√á√ÉO DA UI ---
	    function atualizarContador() {
	        if (!contadorCaixasEl) return;
	        const concluidas = document.querySelectorAll('.status-concluido').length;
	        contadorCaixasEl.textContent = `${concluidas} / ${totalCaixas}`;
	        if (concluidas === totalCaixas && totalCaixas > 0 && !fimTimestamp) {
	            contadorCaixasEl.classList.remove('text-secondary');
	            contadorCaixasEl.classList.add('text-success');
	            fimTimestamp = new Date();
	            pararCronometro();
	            if (pollingInterval) clearInterval(pollingInterval);
	            Swal.fire({
	                icon: 'success', title: 'Todas as caixas bipadas!',
	                text: 'Agora voc√™ pode finalizar a expedi√ß√£o.', confirmButtonText: 'Ok'
	            }).then(() => {
	                containerBipagem.style.display = 'none';
	                containerFinalizacao.style.display = 'block';
	            });
	        }
	    }
	
	    function verificarStatusCaixas() {
	        if (!agendamentoIdML) return;
	        fetch(`/api/expedicao/bipados/${agendamentoIdML}`)
	            .then(response => response.json())
	            .then(data => {
	                if (data.success && data.bipados) {
	                    data.bipados.forEach(codigoUnico => {
	                        marcarCaixaComoConcluidaNaTela(codigoUnico);
	                    });
	                }
	            })
	            .catch(error => console.error("Erro no polling:", error))
	            .finally(() => {
	                atualizarContador();
	            });
	    }
	
	    function iniciarPolling() {
	        if (pollingInterval) clearInterval(pollingInterval);
	        pollingInterval = setInterval(verificarStatusCaixas, 5000);
	    }
	
	    function marcarCaixaComoConcluidaNaTela(codigoUnico) {
	        const caixaContainer = document.querySelector(`.caixa-card-container[data-codigo-unico="${codigoUnico}"]`);
	        if (caixaContainer) {
	            const card = caixaContainer.querySelector('.caixa-card');
	            if (card.classList.contains('status-pendente')) {
	                card.classList.remove('status-pendente');
	                card.classList.add('status-concluido');
	            }
	        }
	    }
	
	    function marcarErro() {
	        if (!inputBipCaixa) return;
	        inputBipCaixa.classList.add('input-erro');
	        setTimeout(() => {
	            inputBipCaixa.classList.remove('input-erro');
	        }, 600);
	    }
	
	    // --- 6. L√ìGICA DO MODAL DE VISUALIZA√á√ÉO ---
	    document.querySelectorAll('.js-visualizar-itens').forEach(botao => {
	        botao.addEventListener('click', function () {
	            const dadosDaCaixa = JSON.parse(this.getAttribute('data-caixa'));
	            abrirModalDetalhes(dadosDaCaixa);
	        });
	    });
	
	    function abrirModalDetalhes(caixa) {
	        const modalEl = document.getElementById('modalDetalhesCaixa');
	        if (!modalEl) { return; }
	
	        const modal = new bootstrap.Modal(modalEl);
	        const dataContainer = document.getElementById('js-data-produtos');
	        const placeholderContainer = document.getElementById('js-data-placeholder');
	        if (!dataContainer || !dataContainer.dataset.produtos) { return; }
	
	        const todosOsProdutos = JSON.parse(dataContainer.dataset.produtos);
	        const placeholderUrl = placeholderContainer?.dataset?.url || '/static/resources/placeholder.png';
	
	        const modalTitle = modalEl.querySelector('.modal-title');
	        const modalBody = modalEl.querySelector('.modal-body');
	
	        modalTitle.textContent = `Itens da Caixa #${caixa.caixa_num}`;
	
	        let bodyHtml = '<p class="text-muted text-center">Nenhum item encontrado nesta caixa.</p>';
	
	        if (caixa.itens && caixa.itens.length > 0) {
	            bodyHtml = '<ul class="list-group list-group-flush">';
	            caixa.itens.forEach(item => {
	                const matchProduto = todosOsProdutos.find(p =>
	                    String(p.id_ml) === String(item.sku) ||
	                    String(p.sku) === String(item.sku) ||
	                    (p.gtin && (String(p.gtin).replace(/\D+/g, '') === String(item.sku).replace(/\D+/g, '')))
	                ) || null;
	
	                const nomeProduto = matchProduto ? matchProduto.nome : 'Produto n√£o encontrado';
	                const skuProduto = matchProduto ? matchProduto.sku : 'SKU n√£o encontrado';
	                const imagemUrl = (matchProduto && (matchProduto.imagem_url || matchProduto.imagemUrl)) ? (matchProduto.imagem_url || matchProduto.imagemUrl) : placeholderUrl;
	
	                bodyHtml += `
	        <li class="list-group-item d-flex justify-content-between align-items-center px-1">
	          <img src="${imagemUrl}" alt="Imagem" class="img-thumbnail me-3" style="width:65px;height:65px;object-fit:contain;">
	          <div class="flex-grow-1">
	            <div class="fw-bold">${esc(nomeProduto)}</div>
	            <small class="text-muted d-block">SKU: ${esc(skuProduto)}</small>
	          </div>
	          <span class="badge bg-primary rounded-pill fs-5 ms-3">${Number(item.quantidade || 0)}</span>
	        </li>`;
	            });
	            bodyHtml += '</ul>';
	        }
	
	        modalBody.innerHTML = bodyHtml;
	        modal.show();
	    }
	
	    // --- 7. INICIALIZA√á√ÉO DA P√ÅGINA ---
	    gerenciarEstadoInicial();
	});

[static/login]
login.css=/* esconde a navbar herdada do base_template */
	nav {
	    display: none !important;
	}
	
	/* garante altura total da viewport, fundo claro */
	body {
	    min-height: 100vh;
	    background-color: #f2f7fb;
	}
	
	/* cart√£o centralizado */
	.login-card {
	    border: none;
	    border-radius: 0.5rem;
	}
	
	/* avatar circular */
	.avatar {
	    width: 80px;
	    height: 80px;
	    object-fit: cover;
	    border-radius: 50%;
	    border: 3px solid #2c3e50;
	    background-color: #fff;
	    padding: 5px;
	}
	
	/* .input-group .btn {
	    border-top-left-radius: 0;
	    border-bottom-left-radius: 0;
	} */
login.js=const toggle = document.getElementById('togglePassword');
	const senha = document.getElementById('senha');
	
	toggle.addEventListener('click', () => {
	    // Alterna o type
	    const oculto = senha.type === 'password';
	    senha.type = oculto ? 'text' : 'password';
	
	    // Alterna o √≠cone
	    const icon = toggle.querySelector('i');
	    icon.classList.toggle('bi-eye');
	    icon.classList.toggle('bi-eye-slash');
	});

[static/embalar]
BrowserPrint-3.1.250.min.js=var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.checkStringArgs = function (e, g, k) { if (null == e) throw new TypeError("The 'this' value for String.prototype." + k + " must not be null or undefined"); if (g instanceof RegExp) throw new TypeError("First argument to String.prototype." + k + " must not be a regular expression"); return e + "" }; $jscomp.ASSUME_ES5 = !1; $jscomp.ASSUME_NO_NATIVE_MAP = !1; $jscomp.ASSUME_NO_NATIVE_SET = !1;
	$jscomp.defineProperty = $jscomp.ASSUME_ES5 || "function" == typeof Object.defineProperties ? Object.defineProperty : function (e, g, k) { e != Array.prototype && e != Object.prototype && (e[g] = k.value) }; $jscomp.getGlobal = function (e) { return "undefined" != typeof window && window === e ? e : "undefined" != typeof global && null != global ? global : e }; $jscomp.global = $jscomp.getGlobal(this);
	$jscomp.polyfill = function (e, g, k, h) { if (g) { k = $jscomp.global; e = e.split("."); for (h = 0; h < e.length - 1; h++) { var f = e[h]; f in k || (k[f] = {}); k = k[f] } e = e[e.length - 1]; h = k[e]; g = g(h); g != h && null != g && $jscomp.defineProperty(k, e, { configurable: !0, writable: !0, value: g }) } };
	$jscomp.polyfill("String.prototype.startsWith", function (e) { return e ? e : function (e, k) { var h = $jscomp.checkStringArgs(this, e, "startsWith"); e += ""; var f = h.length, g = e.length; k = Math.max(0, Math.min(k | 0, h.length)); for (var q = 0; q < g && k < f;)if (h[k++] != e[q++]) return !1; return q >= g } }, "es6", "es3");
	var BrowserPrint = function () {
	    function e(a, c) { var b = new XMLHttpRequest; "withCredentials" in b ? b.open(a, c, !0) : "undefined" != typeof XDomainRequest ? (b = new XDomainRequest, b.open(a, c)) : b = null; return b } function g(a, c, b, d) { void 0 !== a && (void 0 === b && (b = a.sendFinishedCallback), void 0 === d && (d = a.sendErrorCallback)); return h(c, b, d) } function k(a, c, b) { void 0 === c && (c = f.defaultSuccessCallback); void 0 === b && (b = f.defaultErrorCallback); return h(a, c, b) } function h(a, c, b) {
	        a.onreadystatechange = function () {
	            a.readyState === XMLHttpRequest.DONE &&
	                200 === a.status ? "" === a.responseType ? c(a.responseText) : c(a.response) : a.readyState === XMLHttpRequest.DONE && (b ? b(a.response) : console.log("error occurred with no errorCallback set."))
	        }; return a
	    } var f = {}, p = {}, q = /^((?!chrome|android).)*safari/i.test(navigator.userAgent); navigator.userAgent.indexOf("Trident/7.0"); var m = "http://127.0.0.1:9100/"; q && "https:" === location.protocol && (m = "https://127.0.0.1:9101/"); f.Device = function (a) {
	        var c = this; this.name = a.name; this.deviceType = a.deviceType; this.connection = a.connection;
	        this.uid = a.uid; this.version = 2; this.provider = a.provider; this.manufacturer = a.manufacturer; this.readRetries = "bluetooth" === this.connection ? 1 : 0; this.sendErrorCallback = function (b) { }; this.sendFinishedCallback = function (b) { }; this.readErrorCallback = function (b) { }; this.readFinishedCallback = function (b) { }; this.send = function (b, a, l) {
	            var d = e("POST", m + "write"); d && (g(c, d, a, l), d.send(JSON.stringify({
	                device: {
	                    name: this.name, uid: this.uid, connection: this.connection, deviceType: this.deviceType, version: this.version, provider: this.provider,
	                    manufacturer: this.manufacturer
	                }, data: b
	            })))
	        }; this.sendUrl = function (b, a, l, r) { var d = e("POST", m + "write"); d && (g(c, d, a, l), b = { device: { name: this.name, uid: this.uid, connection: this.connection, deviceType: this.deviceType, version: this.version, provider: this.provider, manufacturer: this.manufacturer }, url: b }, null != r && void 0 != r && (b.options = r), d.send(JSON.stringify(b))) }; this.sendFile = function (b, a, l) {
	            if ("string" === typeof b) f.loadFileFromUrl(b, function (b) { c.sendFile(b, a, l) }, l); else {
	                var d = e("POST", m + "write"); if (d) {
	                    d.responseType =
	                        "text"; k(d, a, l); var n = new FormData, g = {}; g.device = c; n.append("json", JSON.stringify(g)); n.append("blob", b); d.send(n)
	                }
	            }
	        }; this.convertAndSendFile = function (b, a, l, c) { c || (c = {}); c.action || (c.action = "print"); f.convert(b, this, c, a, l) }; this.read = function (b, a) {
	            var d = e("POST", m + "read"); d && (void 0 !== c && (void 0 === b && (b = c.readFinishedCallback), void 0 === a && (a = c.readErrorCallback)), h(d, b, a), d.send(JSON.stringify({
	                device: {
	                    name: this.name, uid: this.uid, connection: this.connection, deviceType: this.deviceType, version: this.version,
	                    provider: this.provider, manufacturer: this.manufacturer
	                }
	            })))
	        }; this.readUntilStringReceived = function (a, d, c, e, f) { f || (f = ""); void 0 === e && (e = this.readRetries); d = function (b, d, c, l, e) { return function (f) { if (f && 0 !== f.length) l = 0; else if (0 >= l) { d(e); return } f = e + f; "" !== a && -1 < f.indexOf(a) ? d(f) : b.readUntilStringReceived(a, d, c, l - 1, f) } }(this, d, c, e, f); this.read(d, c) }; this.readAllAvailable = function (a, d, c) { this.readUntilStringReceived("", a, d, c) }; this.sendThenRead = function (a, d, c) {
	            this.send(a, function (a) {
	                return function () {
	                    a.read(d,
	                        c)
	                }
	            }(this), c)
	        }; this.sendThenReadUntilStringReceived = function (a, d, c, e, f) { this.send(a, function (a) { return function () { a.readUntilStringReceived(d, c, e, f) } }(this), e) }; this.sendThenReadAllAvailable = function (a, d, c, e) { this.send(a, function (a) { return function () { a.readUntilStringReceived("", d, c, e) } }(this), c) }
	    }; f.defaultSuccessCallback = function () { }; f.defaultErrorCallback = function () { }; f.ApplicationConfiguration = function () { this.application = { version: "1.2.0.3", build_number: 3, api_level: 2, platform: "", supportedConversions: {} } };
	    f.getLocalDevices = function (a, c, b) { var d = e("GET", m + "available"); d && (finishedFunction = function (c) { response = c; response = JSON.parse(response); for (var d in response) if (response.hasOwnProperty(d) && response[d].constructor === Array) for (arr = response[d], c = 0; c < arr.length; ++c)arr[c] = new f.Device(arr[c]); void 0 === b ? a(response) : (response.hasOwnProperty(b) || (response[b] = []), a(response[b])) }, k(d, finishedFunction, c), d.send()) }; f.getDefaultDevice = function (a, c, b) {
	        var d = "default"; void 0 !== a && null != a && (d = d + "?type=" + a);
	        if (a = e("GET", m + d)) finishedFunction = function (a) { response = a; "" === response ? c(null) : (response = JSON.parse(response), a = new f.Device(response), c(a)) }, a = k(a, finishedFunction, b), a.send()
	    }; f.getApplicationConfiguration = function (a, c) { var b = e("GET", m + "config"); b && (finishedFunction = function (b) { response = b; "" === response ? a(null) : (response = JSON.parse(response), a(response)) }, k(b, finishedFunction, c), b.send()) }; f.readOnInterval = function (a, c, b) {
	        if (void 0 === b || 0 === b) b = 1; readFunc = function () {
	            a.read(function (d) {
	                c(d); p[a] =
	                    setTimeout(readFunc, b)
	            }, function (c) { p[a] = setTimeout(readFunc, b) })
	        }; p[a] = setTimeout(readFunc, b)
	    }; f.stopReadOnInterval = function (a) { p[a] && clearTimeout(p[a]) }; f.bindFieldToReadData = function (a, c, b, d) { f.readOnInterval(a, function (a) { "" !== a && (c.value = a, void 0 !== d && null != d && d()) }, b) }; f.loadFileFromUrl = function (a, c, b) { request = e("get", a); console.log("ResponseType: " + request.responseType); request.responseType = "blob"; k(request, c, b); request.send() }; f.convert = function (a, c, b, d, l) {
	        if (a) if ("string" === typeof a) f.loadFileFromUrl(a,
	            function (e) { b.fromFormat || (b.fromFormat = a.substring(a.length - 3)); f.convert(e, c, b, d, l) }, l); else {
	            var g = e("POST", m + "convert"); a.type && (a.type.startsWith("image/") || a.type.startsWith("application/")) && (b.fromFormat = a.type.toLowerCase().replace("image/", "").replace("application/", "").replace("x-ms-", "")); if (g) {
	                g.responseType = "text"; var h = void 0; void 0 != d && (h = function (a) { d(JSON.parse(a)) }); k(g, h, l); h = new FormData; var t = {}; null != b && void 0 !== b && (t.options = b); c && (t.device = c); h.append("json", JSON.stringify(t));
	                h.append("blob", a); g.send(h)
	            }
	        } else l ? l("Resource not specified") : f.defaultErrorCallback("Resource not specified")
	    }; f.scanImage = function (a, c, b, d) {
	        if (a) if ("string" === typeof a) f.loadFileFromUrl(a, function (e) { c.format || (c.format = a.substring(a.length - 3)); f.scanImage(e, c, b, d) }, d); else {
	            var g = e("POST", m + "convert/scan"); a.type && (a.type.startsWith("image/") || a.type.startsWith("application/")) && (c.format = a.type.toLowerCase().replace("image/", "").replace("application/", "").replace("x-ms-", "")); if (g) {
	                g.responseType =
	                    "text"; var h = void 0; void 0 != b && (h = function (a) { b(JSON.parse(a)) }); k(g, h, d); h = new FormData; var n = {}; n.options = c; h.append("json", JSON.stringify(n)); h.append("blob", a); g.send(h)
	            }
	        } else d ? d("Resource not specified") : f.defaultErrorCallback("Resource not specified")
	    }; return f
	}();
BrowserPrint-Zebra-1.1.250.min.js=var $jscomp = $jscomp || {}; $jscomp.scope = {}; $jscomp.ASSUME_ES5 = !1; $jscomp.ASSUME_NO_NATIVE_MAP = !1; $jscomp.ASSUME_NO_NATIVE_SET = !1; $jscomp.defineProperty = $jscomp.ASSUME_ES5 || "function" == typeof Object.defineProperties ? Object.defineProperty : function (e, h, g) { e != Array.prototype && e != Object.prototype && (e[h] = g.value) }; $jscomp.getGlobal = function (e) { return "undefined" != typeof window && window === e ? e : "undefined" != typeof global && null != global ? global : e }; $jscomp.global = $jscomp.getGlobal(this); $jscomp.SYMBOL_PREFIX = "jscomp_symbol_";
	$jscomp.initSymbol = function () { $jscomp.initSymbol = function () { }; $jscomp.global.Symbol || ($jscomp.global.Symbol = $jscomp.Symbol) }; $jscomp.Symbol = function () { var e = 0; return function (h) { return $jscomp.SYMBOL_PREFIX + (h || "") + e++ } }();
	$jscomp.initSymbolIterator = function () { $jscomp.initSymbol(); var e = $jscomp.global.Symbol.iterator; e || (e = $jscomp.global.Symbol.iterator = $jscomp.global.Symbol("iterator")); "function" != typeof Array.prototype[e] && $jscomp.defineProperty(Array.prototype, e, { configurable: !0, writable: !0, value: function () { return $jscomp.arrayIterator(this) } }); $jscomp.initSymbolIterator = function () { } }; $jscomp.arrayIterator = function (e) { var h = 0; return $jscomp.iteratorPrototype(function () { return h < e.length ? { done: !1, value: e[h++] } : { done: !0 } }) };
	$jscomp.iteratorPrototype = function (e) { $jscomp.initSymbolIterator(); e = { next: e }; e[$jscomp.global.Symbol.iterator] = function () { return this }; return e }; $jscomp.makeIterator = function (e) { $jscomp.initSymbolIterator(); var h = e[Symbol.iterator]; return h ? h.call(e) : $jscomp.arrayIterator(e) };
	$jscomp.polyfill = function (e, h, g, l) { if (h) { g = $jscomp.global; e = e.split("."); for (l = 0; l < e.length - 1; l++) { var c = e[l]; c in g || (g[c] = {}); g = g[c] } e = e[e.length - 1]; l = g[e]; h = h(l); h != l && null != h && $jscomp.defineProperty(g, e, { configurable: !0, writable: !0, value: h }) } }; $jscomp.FORCE_POLYFILL_PROMISE = !1;
	$jscomp.polyfill("Promise", function (e) {
	    function h() { this.batch_ = null } function g(b) { return b instanceof c ? b : new c(function (a, f) { a(b) }) } if (e && !$jscomp.FORCE_POLYFILL_PROMISE) return e; h.prototype.asyncExecute = function (b) { null == this.batch_ && (this.batch_ = [], this.asyncExecuteBatch_()); this.batch_.push(b); return this }; h.prototype.asyncExecuteBatch_ = function () { var b = this; this.asyncExecuteFunction(function () { b.executeBatch_() }) }; var l = $jscomp.global.setTimeout; h.prototype.asyncExecuteFunction = function (b) {
	        l(b,
	            0)
	    }; h.prototype.executeBatch_ = function () { for (; this.batch_ && this.batch_.length;) { var b = this.batch_; this.batch_ = []; for (var a = 0; a < b.length; ++a) { var f = b[a]; delete b[a]; try { f() } catch (k) { this.asyncThrow_(k) } } } this.batch_ = null }; h.prototype.asyncThrow_ = function (b) { this.asyncExecuteFunction(function () { throw b; }) }; var c = function (b) { this.state_ = 0; this.result_ = void 0; this.onSettledCallbacks_ = []; var a = this.createResolveAndReject_(); try { b(a.resolve, a.reject) } catch (f) { a.reject(f) } }; c.prototype.createResolveAndReject_ =
	        function () { function b(b) { return function (k) { f || (f = !0, b.call(a, k)) } } var a = this, f = !1; return { resolve: b(this.resolveTo_), reject: b(this.reject_) } }; c.prototype.resolveTo_ = function (b) { if (b === this) this.reject_(new TypeError("A Promise cannot resolve to itself")); else if (b instanceof c) this.settleSameAsPromise_(b); else { a: switch (typeof b) { case "object": var a = null != b; break a; case "function": a = !0; break a; default: a = !1 }a ? this.resolveToNonPromiseObj_(b) : this.fulfill_(b) } }; c.prototype.resolveToNonPromiseObj_ = function (b) {
	            var a =
	                void 0; try { a = b.then } catch (f) { this.reject_(f); return } "function" == typeof a ? this.settleSameAsThenable_(a, b) : this.fulfill_(b)
	        }; c.prototype.reject_ = function (b) { this.settle_(2, b) }; c.prototype.fulfill_ = function (b) { this.settle_(1, b) }; c.prototype.settle_ = function (b, a) { if (0 != this.state_) throw Error("Cannot settle(" + b + ", " + a | "): Promise already settled in state" + this.state_); this.state_ = b; this.result_ = a; this.executeOnSettledCallbacks_() }; c.prototype.executeOnSettledCallbacks_ = function () {
	            if (null != this.onSettledCallbacks_) {
	                for (var b =
	                    this.onSettledCallbacks_, a = 0; a < b.length; ++a)b[a].call(), b[a] = null; this.onSettledCallbacks_ = null
	            }
	        }; var d = new h; c.prototype.settleSameAsPromise_ = function (b) { var a = this.createResolveAndReject_(); b.callWhenSettled_(a.resolve, a.reject) }; c.prototype.settleSameAsThenable_ = function (b, a) { var f = this.createResolveAndReject_(); try { b.call(a, f.resolve, f.reject) } catch (k) { f.reject(k) } }; c.prototype.then = function (b, a) {
	            function f(a, f) { return "function" == typeof a ? function (f) { try { k(a(f)) } catch (n) { d(n) } } : f } var k, d, e = new c(function (a,
	                f) { k = a; d = f }); this.callWhenSettled_(f(b, k), f(a, d)); return e
	        }; c.prototype.catch = function (b) { return this.then(void 0, b) }; c.prototype.callWhenSettled_ = function (b, a) { function f() { switch (k.state_) { case 1: b(k.result_); break; case 2: a(k.result_); break; default: throw Error("Unexpected state: " + k.state_); } } var k = this; null == this.onSettledCallbacks_ ? d.asyncExecute(f) : this.onSettledCallbacks_.push(function () { d.asyncExecute(f) }) }; c.resolve = g; c.reject = function (b) { return new c(function (a, f) { f(b) }) }; c.race = function (b) {
	            return new c(function (a,
	                f) { for (var k = $jscomp.makeIterator(b), d = k.next(); !d.done; d = k.next())g(d.value).callWhenSettled_(a, f) })
	        }; c.all = function (b) { var a = $jscomp.makeIterator(b), f = a.next(); return f.done ? g([]) : new c(function (b, d) { function k(a) { return function (f) { c[a] = f; e--; 0 == e && b(c) } } var c = [], e = 0; do c.push(void 0), e++, g(f.value).callWhenSettled_(k(c.length - 1), d), f = a.next(); while (!f.done) }) }; return c
	}, "es6", "es3"); function dbg(e) { }
	var Zebra = function () {
	    function e(c, d) { if (d instanceof g.Printer.Status && l[c.device.uid]) { if (d.offline) { if (c.errors++, c.errors < c.errorsForOffline) return } else c.errors = 0; var b = l[c.device.uid].status, a = JSON.stringify(b); c.status = d; statusStr = JSON.stringify(d); if (statusStr !== a) c.onchange(b, d) } } function h(c) { return 2 !== c.charCodeAt(0) || 3 !== c.charCodeAt(c.length - 1) ? (dbg("Response did not contain proper control characters"), !1) : !0 } var g = {}, l = {}; setInterval(function () {
	        for (var c in l) l.hasOwnProperty(c) && (c =
	            l[c], function (d) { d.device.getStatus(function (b) { e(d, b) }, function (b) { e(d, new g.Printer.Status("")) }) }(c))
	    }, 2E3); g.Printer = function (c) {
	        BrowserPrint.Device.call(this, c); g.Printer.Status = function (a) {
	            this.raw = a; this.isFlagSet = function (a) { return "1" === this.raw.charAt(a) }; this.offline = !1; a || (a = ""); a = a.trim(); h(a) ? (this.offline = !1, this.paperOut = this.isFlagSet(5), this.paused = this.isFlagSet(7), this.headOpen = this.isFlagSet(43), this.ribbonOut = this.isFlagSet(45)) : (this.offline = !0, this.ribbonOut = this.headOpen = this.paused =
	                this.paperOut = !1); this.isPrinterReady = function () { return !(this.paperOut || this.paused || this.headOpen || this.ribbonOut || this.offline) }; this.getMessage = function () { return this.isPrinterReady() ? "Ready" : this.offline ? "Offline" : this.paperOut ? "Paper Out" : this.headOpen ? "Head Open" : this.ribbonOut ? "Ribbon Out" : this.paused ? "Paused" : "Ready" }
	        }; g.Printer.Info = function (a) { if (!a) throw "Invalid Response"; this.raw = a; a = a.trim(); if (!h(a)) throw "Invalid Response"; a = a.split(","); this.model = a[0].substring(1); this.firmware = a[1] };
	        g.Printer.Configuration = function (a) {
	            if (!a) throw "Invalid Response"; this.raw = a = a.trim(); this.settings = {}; if (!h(a)) throw "Invalid Response"; a = a.replace(String.fromCharCode(2), ""); a = a.replace(String.fromCharCode(3), ""); a = a.split("\n"); for (var f = 0; f < a.length; ++f) { var b = a[f].trim(), d = b.substring(20); b = b.substring(0, 20).trim(); this.settings[d] = b } this.darkness = parseFloat(this.settings.DARKNESS); this.printSpeed = parseInt(this.settings["PRINT SPEED"].replace("IPS", "").trim()); this.printWidth = parseInt(this.settings["PRINT WIDTH"]);
	            this.labelLength = parseInt(this.settings["LABEL LENGTH"]); this.firmwareVersion = this.settings.FIRMWARE.replace("<-", "").trim(); this.linkOSVersion = this.settings.hasOwnProperty("LINK-OS VERSION") ? this.settings["LINK-OS VERSION"] : "0"
	        }; var d = this; this.configuration = void 0; this.device_request_queue = []; this.clearRequestQueue = function () { var a = this.device_request_queue[0]; this.device_request_queue = []; a && a.started && (this.device_request_queue[0] = a) }; this.Request = function (a, f, b, c, e) {
	            this.type = a; this.command = f;
	            this.received = b; this.success = c; this.error = function (a) { return function (f) { a(f); d.executeNextRequest() } }(e); this.execute = function () { this.started = !0; "info" == this.type || "config" == this.type || "status" == this.type ? d.sendThenReadUntilStringReceived(this.command, String.fromCharCode(3), this.received, this.error) : d.sendThenReadAllAvailable(this.command, this.received, this.error) }
	        }; this.executeNextRequest = function () { d.device_request_queue.shift(); d.executeRequest() }; this.executeRequest = function () {
	            dbg("Requests in queue: " +
	                d.device_request_queue.length); 0 < d.device_request_queue.length && (dbg("Executing next request..."), d.device_request_queue[0].execute())
	        }; this.queueRequest = function (a) { dbg("Queueing request " + a.type + ": " + d.device_request_queue.length); d.device_request_queue.push(a); 1 === d.device_request_queue.length && a.execute() }; this.onStatusResponse = function (a) {
	            dbg("received status response"); var f = void 0; try { f = new g.Printer.Status(a) } catch (k) { a = d.device_request_queue[0], a.error(k), d.executeNextRequest() } for (; 0 < d.device_request_queue.length;)if (a =
	                d.device_request_queue[0], "status" === a.type) dbg("delivering status..."), a.success(f), d.device_request_queue.shift(); else { dbg("delivered to all status requests."); break } d.executeRequest()
	        }; this.onResponse = function (a, f) { dbg("received info response"); var b = d.device_request_queue[0]; if (void 0 != f) try { a = new f(a) } catch (m) { b.error && b.error(m); d.executeNextRequest(); return } b.success && b.success(a); d.executeNextRequest() }; this.onSGDResponse = function (a) { dbg("received sgd response"); d.onResponse(a) }; this.onInfoResponse =
	            function (a) { dbg("received info response"); d.onResponse(a, g.Printer.Info) }; this.onConfigurationResponse = function (a) { dbg("received config response"); try { d.configuration = new g.Printer.Configuration(a) } catch (f) { } d.onResponse(a, g.Printer.Configuration) }; this.setSGD = function (a, f, b, c) { if (!b && !c) return new Promise(function (b, c) { d.setSGD(a, f, b, c) }); d.send('! U1 setvar "' + a + '" "' + f + '"\r\n', b, c) }; this.getSGD = function (a, b, c) {
	                if (!b && !c) return new Promise(function (b, f) { d.getSGD(a, b, f) }); b = new this.Request("sgd",
	                    '! U1 getvar "' + a + '"\r\n', this.onSGDResponse, b, c); this.queueRequest(b)
	            }; this.setThenGetSGD = function (a, b, c, e) { if (!c && !e) return new Promise(function (f, c) { d.setThenGetSGD(a, b, f, c) }); this.setSGD(a, b, function () { d.getSGD(a, c, e) }, e) }; this.getInfo = function (a, b) { if (!a && !b) return new Promise(function (a, b) { d.getInfo(a, b) }); a = new this.Request("info", "~hi\r\n", this.onInfoResponse, a, b); this.queueRequest(a) }; this.getConfiguration = function (a, b) {
	                if (!a && !b) return new Promise(function (a, b) { d.getConfiguration(a, b) });
	                a = new this.Request("config", "^XA^HH^XZ", this.onConfigurationResponse, a, b); this.queueRequest(a)
	            }; this.getStatus = function (a, b) { if (!a && !b) return new Promise(function (a, b) { d.getStatus(a, b) }); a = new this.Request("status", "~hs\r\n", this.onStatusResponse, a, b); d.queueRequest(a) }; this.query = function (a, b, c) { if (!b && !c) return new Promise(function (b, c) { d.query(a, b, c) }); b = new this.Request("", a, this.onResponse, b, c); this.queueRequest(b) }; this.isPrinterReady = function (a, b) {
	                if (!a && !b) return new Promise(function (a, b) {
	                    d.isPrinterReady(a,
	                        b)
	                }); this.getStatus().then(function (c) { c.isPrinterReady() ? a(c.getMessage()) : b(c.getMessage()) })
	            }; this.printImageAsLabel = function (a, c, e, g) { if (!e && !g) return new Promise(function (b, f) { d.printImageAsLabel(a, c, b, f) }); b().then(function (b) { c.fitTo = { width: b.printWidth, height: b.labelLength }; c.action = "print"; BrowserPrint.convert(a, d, c, e, g) }).catch(g) }; this.getConvertedResource = function (a, c, e, g) {
	                if (!e && !g) return new Promise(function (b, f) { d.getConvertedResource(a, c, b, f) }); b().then(function (b) {
	                    c.action = "return";
	                    BrowserPrint.convert(a, d, c, e, g)
	                }).catch(g)
	            }; this.storeConvertedResource = function (a, c, e, g) { if (!e && !g) return new Promise(function (b, e) { d.storeConvertedResource(a, c, b, e) }); b().then(function (b) { c.action = "store"; BrowserPrint.convert(a, d, c, e, g) }).catch(g) }; var b = function () { return new Promise(function (a, b) { if (d.configuration) a(d.configuration); else return d.getConfiguration().then(function (a) { d.configuration = a; return d.configuration }).catch(function (a) { b(a) }) }) }; this.configTimeout = function () {
	                d.configuration ||
	                d.getConfiguration().then(function (a) { return d.configuration = a }).catch(function () { setTimeout(d.configTimeout, 1E3) })
	            }; this.configTimeout()
	    }; g.watch = function (c, d, b) { b || (b = 2); l[c.uid] = { device: c, status: "", onchange: d, errors: 0, errorsForOffline: b } }; g.stopWatching = function (c) { delete l[c.uid] }; return g
	}();
	
embalar.css=/* embalar.css - Estilos para a p√°gina de embalagem */
	
	body {
	  background-color: #e9f1fb;
	}
	
	/* --- CABE√áALHO --- */
	.header-bar {
	  background-color: #0D6EFD;
	  color: #fff;
	  font-weight: bold;
	}
	
	.header-bar h5 {
	  font-size: 1.25rem;
	  margin-bottom: 0.5rem;
	}
	
	.header-bar strong {
	  color: #FDD484;
	}
	
	/* --- LISTA DE PRODUTOS PRINCIPAL (DIREITA) --- */
	#lista-anuncios {
	  list-style: none;
	  margin: 0;
	  padding: 0;
	  max-height: 68vh;
	  /* Aumentei um pouco para ocupar mais espa√ßo vertical */
	  overflow-y: auto;
	}
	
	#lista-anuncios .produto-item {
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  background: #fff;
	  border: 1px solid #ddd;
	  border-radius: 4px;
	  padding: 0.75rem 1rem;
	  margin-bottom: 0.5rem;
	  overflow: hidden;
	  transition: background-color 0.3s ease-in-out;
	}
	
	#lista-anuncios .produto-info {
	  flex: 1;
	  white-space: nowrap;
	  overflow: hidden;
	  text-overflow: ellipsis;
	  margin-right: 1rem;
	}
	
	#lista-anuncios .produto-meta {
	  flex-shrink: 0;
	  display: flex;
	  gap: 1rem;
	  align-items: center;
	}
	
	#lista-anuncios .produto-meta .sku {
	  color: #28a745;
	  font-weight: 400;
	}
	
	#lista-anuncios .produto-meta .sku.etiqueta {
	  color: #0D6EFD !important;
	}
	
	#lista-anuncios .produto-item.produto-concluido {
	  background-color: #198754;
	  color: white;
	  border-color: #146c43;
	}
	
	#lista-anuncios .produto-item.produto-concluido .produto-info,
	#lista-anuncios .produto-item.produto-concluido .produto-meta,
	#lista-anuncios .produto-item.produto-concluido .produto-meta .sku,
	#lista-anuncios .produto-item.produto-concluido .bi-info-circle {
	  color: white !important;
	}
	
	/* --- CAIXAS (ESQUERDA) --- */
	#caixas-container {
	  max-height: 40vh;
	  overflow-y: auto;
	  padding-right: 10px;
	}
	
	.caixa-card {
	  transition: all 0.3s ease-in-out;
	  border: 1px solid #dee2e6;
	}
	
	.caixa-aberta {
	  border-color: #0d6efd;
	  border-width: 2px;
	  box-shadow: 0 4px 12px rgba(13, 110, 253, 0.25);
	}
	
	.caixa-aberta .card-header {
	  background-color: #0d6efd;
	  color: white;
	  font-weight: bold;
	}
	
	.caixa-fechada {
	  background-color: #f8f9fa;
	}
	
	.caixa-fechada .card-header {
	  background-color: #e9ecef;
	  color: #6c757d;
	}
	
	.caixa-vazia-mensagem {
	  color: #6c757d;
	  font-style: italic;
	  text-align: center;
	  padding: 1rem;
	}
	
	.item-caixa-novo {
	  animation: flash-animation 0.7s ease;
	}
	
	@keyframes flash-animation {
	  0% {
	    background-color: #cfe2ff;
	  }
	
	  100% {
	    background-color: transparent;
	  }
	}
	
	.add-new-box {
	  margin: 0px 10px 15px 0px;
	  border: 2px dashed #6c757da1;
	  cursor: pointer;
	  transition: all 0.2s ease-in-out;
	}
	
	.add-new-box:hover {
	  background-color: #f8f9fa;
	  border-color: #0d6efdb8 !important;
	  color: #0d6dfdfd;
	}
	
	.add-new-box.bg-success:hover {
	  background-color: #146c43 !important;
	  /* Um verde mais escuro */
	  border-color: #146c43 !important;
	}
	
	.ajuste_btn_finalizar {
	  margin: 0px 10px 20px 0px;
	}
	
	/*
	--- NOVOS ESTILOS PARA O MODAL DE CONFIRMA√á√ÉO ---
	*/
	
	/* Aumenta a largura do modal de confirma√ß√£o */
	#modalConfirmeAnuncio .modal-dialog {
	  max-width: 800px;
	}
	
	/* Layout principal do modal com Flexbox */
	.modal-main-layout {
	  display: flex;
	  gap: 1.5rem;
	  /* Espa√ßo entre a imagem e a lista */
	  align-items: flex-start;
	}
	
	.modal-image-container {
	  flex: 0 0 250px;
	  /* Largura fixa para a imagem */
	  text-align: center;
	}
	
	.modal-image-container img {
	  max-width: 100%;
	  border-radius: 0.25rem;
	  border: 1px solid #dee2e6;
	}
	
	.modal-list-container {
	  flex: 1;
	  /* A lista ocupa o espa√ßo restante */
	}
	
	/* Estilo dos itens da lista de componentes */
	.lista-componentes {
	  padding: 0;
	  margin: 0;
	  list-style: none;
	}
	
	.lista-componentes .componente-item {
	  display: flex;
	  justify-content: space-between;
	  align-items: center;
	  padding: 0.75rem 0;
	  border-bottom: 1px solid #e9ecef;
	}
	
	.lista-componentes .componente-item:last-child {
	  border-bottom: none;
	}
	
	.componente-nome {
	  font-size: 0.95rem;
	  font-weight: 500;
	}
	
	.componente-status {
	  font-weight: bold;
	  white-space: nowrap;
	  margin-left: 1rem;
	}
	
	/* Input de bipagem no rodap√© do modal */
	.modal-footer-input {
	  margin-top: 1.5rem;
	}
	
	/* Cores de status din√¢micas */
	.status-pendente .componente-nome,
	.status-pendente .componente-status {
	  color: #dc3545;
	  /* Vermelho */
	}
	
	.status-progresso .componente-nome,
	.status-progresso .componente-status {
	  color: #fd7e14;
	  /* Laranja */
	}
	
	.status-concluido .componente-nome,
	.status-concluido .componente-status {
	  color: #198754;
	  /* Verde */
	}
	
	.status-concluido {
	  background-color: #f0fff0;
	  /* Fundo verde bem claro */
	}
	
	/* Modal Fechar Caixa - look & feel */
	.fechar-caixa .modal-header{
	  background: linear-gradient(135deg,#198754,#20c997);
	  color:#fff; border-bottom:none;
	}
	.fechar-caixa .modal-content{ border:0; border-radius:18px; overflow:hidden; }
	.fechar-caixa .modal-body{ padding-top:1.25rem; }
	
	.fechar-caixa-options{
	  display:grid; gap:12px; grid-template-columns:repeat(2,1fr);
	}
	@media (max-width: 576px){
	  .fechar-caixa-options{ grid-template-columns:1fr; }
	}
	.fechar-caixa-option{
	  border:2px solid var(--bs-border-color);
	  border-radius:14px; padding:12px;
	  cursor:pointer; transition:all .15s ease-in-out;
	  user-select:none; background:#fff;
	}
	.fechar-caixa-option:hover{ transform:translateY(-1px); }
	.fechar-caixa-option.active{
	  border-color:var(--bs-success);
	  box-shadow:0 0 0 4px rgba(25,135,84,.12);
	}
	.fechar-caixa-option .title{ font-weight:600; }
	.fechar-caixa-option .desc{ font-size:.925rem; color:#6c757d; margin-top:2px; }
	
	/* A11y: foco vis√≠vel nas op√ß√µes do Fechar Caixa */
	.fechar-caixa-option:focus-visible{
	  outline: 3px solid rgba(13,110,253,.35);
	  outline-offset: 2px;
	}
	
	/* Garantir contraste em itens conclu√≠dos */
	#lista-anuncios .produto-item.produto-concluido a,
	#lista-anuncios .produto-item.produto-concluido .btn{
	  color:#fff !important;
	  border-color: rgba(255,255,255,.35);
	}
	#lista-anuncios .produto-item.produto-concluido .btn:hover{
	  background: rgba(255,255,255,.08);
	}
	
	@media (max-width: 768px){
	  #lista-anuncios{ max-height: 54vh; }
	  #caixas-container{ max-height: 32vh; }
	}
	/* Empilha imagem e lista no modal de confirma√ß√£o em telas bem pequenas */
	@media (max-width: 576px){
	  .modal-main-layout{ flex-direction: column; }
	  .modal-image-container{ width:100%; }
	}
	
	@media (prefers-reduced-motion: reduce){
	  .item-caixa-novo{ animation: none !important; }
	  .caixa-card, .add-new-box, .fechar-caixa-option{
	    transition: none !important;
	  }
	}
	
embalar.js=document.addEventListener("DOMContentLoaded", async () => {
	
	  // ==== util: escapar HTML simples (para innerHTML) ====
	  const esc = (s) => String(s ?? "")
	    .replace(/&/g, "&amp;").replace(/</g, "&lt;")
	    .replace(/>/g, "&gt;").replace(/"/g, "&quot;").replace(/'/g, "&#39;");
	
	  // ==== util fetch com CSRF + timeout ====
	  const CSRF = document.querySelector('meta[name="csrf-token"]')?.content || '';
	  async function fetchJSON(url, { method = 'GET', headers = {}, body = null, timeoutMs = 10000 } = {}) {
	    const ctrl = new AbortController();
	    const t = setTimeout(() => ctrl.abort('timeout'), timeoutMs);
	    try {
	      const res = await fetch(url, {
	        method,
	        credentials: 'same-origin',
	        headers: { 'Content-Type': 'application/json', 'X-CSRFToken': CSRF, ...headers },
	        body: body && typeof body !== 'string' ? JSON.stringify(body) : body,
	        signal: ctrl.signal
	      });
	      const data = await res.json().catch(() => ({}));
	      if (!res.ok) throw new Error(data?.error || res.statusText);
	      return data;
	    } finally {
	      clearTimeout(t);
	    }
	  }
	
	  // ---- Modal de sele√ß√£o de impressoras (BrowserPrint) ----
	  (() => {
	    // Mapa das chaves persistidas por tipo
	    const KEY_BY_TIPO = { relatorio: 'printer_relatorio', caixa: 'printer_caixa', id: 'printer_id' };
	
	    let currentKey = null;
	    let selectedName = null;
	    let isFetching = false; // guarda contra requisi√ß√µes concorrentes
	
	    const modalEl = document.getElementById("printerModal");
	    const btnOk = document.getElementById("btnConfirmPrinter");
	    const loadingEl = document.getElementById("printerLoading");
	    const listWrap = document.getElementById("printerListWrap");
	    const listEl = document.getElementById("printerList");
	    const emptyEl = document.getElementById("printerEmpty");
	    const errorEl = document.getElementById("printerError");
	
	    // Exponho globalmente para voc√™ poder usar em qualquer fun√ß√£o
	    window.bsModal = modalEl ? new bootstrap.Modal(modalEl) : null;
	
	    function resetUI() {
	      btnOk.disabled = true;
	      selectedName = null;
	      loadingEl.classList.remove("d-none");
	      listWrap.classList.add("d-none");
	      emptyEl.classList.add("d-none");
	      errorEl.classList.add("d-none");
	      errorEl.textContent = "";
	      listEl.innerHTML = "";
	    }
	
	    function createItem(name, preselect = false) {
	      const item = document.createElement("button");
	      item.type = "button";
	      item.className = "list-group-item list-group-item-action d-flex justify-content-between align-items-center";
	      item.setAttribute("role", "radio");
	      item.setAttribute("aria-checked", preselect ? "true" : "false");
	      item.textContent = name;
	
	      const mark = document.createElement("span");
	      mark.className = "badge text-bg-light";
	      mark.textContent = preselect ? "Atual" : "Selecionar";
	      item.appendChild(mark);
	
	      if (preselect) {
	        item.classList.add("active");
	        selectedName = name;
	        btnOk.disabled = false;
	      }
	
	      item.addEventListener("click", () => {
	        listEl.querySelectorAll(".list-group-item").forEach(el => {
	          el.classList.remove("active");
	          el.setAttribute("aria-checked", "false");
	          const b = el.querySelector(".badge");
	          if (b) b.textContent = "Selecionar";
	        });
	        item.classList.add("active");
	        item.setAttribute("aria-checked", "true");
	        mark.textContent = "Selecionado";
	        selectedName = name;
	        btnOk.disabled = false;
	      });
	
	      return item;
	    }
	
	    function openPrinterModalForKey(key) {
	      if (!window.bsModal) { console.warn("Modal de impressoras n√£o encontrado."); return; }
	      if (isFetching) return; // evita m√∫ltiplas buscas/listagens
	
	      isFetching = true;
	      currentKey = key;
	      resetUI();
	      bsModal.show(); // abre j√° em modo "loading" e bloqueia a UI
	
	      if (!window.BrowserPrint || typeof BrowserPrint.getLocalDevices !== "function") {
	        loadingEl.classList.add("d-none");
	        errorEl.textContent = "Zebra BrowserPrint n√£o detectado. Instale/abra o BrowserPrint para listar impressoras.";
	        errorEl.classList.remove("d-none");
	        isFetching = false;
	        return;
	      }
	
	      BrowserPrint.getLocalDevices(
	        (devicesObject) => {
	          const printers = devicesObject?.printer || [];
	          const saved = localStorage.getItem(key);
	
	          loadingEl.classList.add("d-none");
	          listWrap.classList.remove("d-none");
	          listEl.innerHTML = "";
	
	          if (!printers.length) {
	            emptyEl.classList.remove("d-none");
	          } else {
	            printers.forEach(p => listEl.appendChild(createItem(p.name, saved && p.name === saved)));
	            btnOk.disabled = !listEl.querySelector(".list-group-item.active");
	          }
	
	          isFetching = false;
	        },
	        (err) => {
	          loadingEl.classList.add("d-none");
	          errorEl.textContent = "Falha ao comunicar com o BrowserPrint. Verifique a instala√ß√£o e tente novamente.";
	          errorEl.classList.remove("d-none");
	          console.error("[BrowserPrint] getLocalDevices error:", err);
	          isFetching = false;
	        }
	      );
	    }
	
	    btnOk.addEventListener("click", () => {
	      if (!currentKey || !selectedName) return;
	      localStorage.setItem(currentKey, selectedName);
	
	      // dispara evento para quem quiser ouvir e atualizar UI
	      document.dispatchEvent(new CustomEvent("printer:selected", {
	        detail: { key: currentKey, name: selectedName }
	      }));
	
	      bsModal.hide();
	    });
	
	    // Exponho uma fun√ß√£o por tipo (relatorio|caixa|id)
	    window.openPrinterModalByTipo = function (tipo) {
	      const key = KEY_BY_TIPO[tipo];
	      if (!key) return;
	      openPrinterModalForKey(key);
	    };
	  })();
	  // Para fins de DEBUG
	  // Abaixo tem o c√≥digo que quando todo o DOM √© carregado
	  // Surge um ALERTA dizendo as impressoras que est√£o salvas no localStorage /* para confer√™ncia */
	  // (pode ser removido depois de testado)
	
	  // const savedPrinters = [
	  //     { key: "printer_relatorio" },
	  //     { key: "printer_caixa" },
	  //     { key: "printer_id" },
	  // ].map(cfg => {  
	  //     const v = localStorage.getItem(cfg.key);
	  //     return `${cfg.key}: ${v ? v : "(nenhuma)"}`;
	  // }).join("\n");
	  // if (savedPrinters) {
	  //     alert("Impressoras salvas:\n" + savedPrinters);
	  // } else {
	  //     alert("Nenhuma impressora salva.");
	  // }
	  // Fim do c√≥digo de DEBUG
	  // ===================================================================
	  // 1) Dados iniciais e imagem padr√£o
	
	  // ===== Modal Fechar Caixa: estado e helpers =====
	  const LAST_PRINT_PREF_KEY = 'preferencia_impressao_caixa';
	  let modalFecharCaixa = null;
	  let selectedOpcaoImpressao = 'ambas'; // default
	  let ultimaCaixaSnapshot = null;       // guarda refer√™ncia da caixa antes de fechar
	
	  // ==== Globais usadas pelo modal de fechamento ====
	  const FKEY_TO_OPT = { F1: 'ambas', F2: 'ml', F3: 'jp', F4: 'nenhuma' };
	  let isFecharModalOpen = false; // indica se o modal de fechar caixa est√° aberto
	
	  function inicializarModalFecharCaixa() {
	    const elModal = document.getElementById('modalFecharCaixa');
	    if (!elModal) return;
	
	    // instancia (backdrop travado e sem ESC)
	    modalFecharCaixa = new bootstrap.Modal(elModal, { backdrop: 'static', keyboard: false });
	
	    const labels = Array.from(elModal.querySelectorAll('.fechar-caixa-option'));
	    const btnConfirm = elModal.querySelector('#btnConfirmarFechamento');
	    const btnCancel = elModal.querySelector('#btnCancelarFechamento');
	    const chkLembrar = elModal.querySelector('#guardarOpcaoImpressao');
	
	    function aplicarSelecao(id) {
	      selectedOpcaoImpressao = id;
	      labels.forEach(l => l.classList.toggle('active', l.dataset.value === id));
	      const input = elModal.querySelector(`input[name="optImpressao"][value="${id}"]`);
	      if (input) input.checked = true;
	    }
	    window.__aplicarSelecaoFecharCaixa = aplicarSelecao; // exporta para outros handlers
	
	    // estado de aberto/fechado (evita resets)
	    elModal.addEventListener('shown.bs.modal', () => { isFecharModalOpen = true; });
	    elModal.addEventListener('hidden.bs.modal', () => { isFecharModalOpen = false; });
	
	    // clique nas op√ß√µes
	    labels.forEach(l => l.addEventListener('click', () => aplicarSelecao(l.dataset.value)));
	
	    // carrega prefer√™ncia salva (se existir)
	    const saved = localStorage.getItem(LAST_PRINT_PREF_KEY);
	    aplicarSelecao(saved || 'ambas');
	    if (saved) chkLembrar.checked = true;
	
	    // atalhos DENTRO do modal: F1‚ÄìF4 escolhem, Enter confirma
	    elModal.addEventListener('keydown', (e) => {
	      if (FKEY_TO_OPT[e.key]) {
	        e.preventDefault();
	        aplicarSelecao(FKEY_TO_OPT[e.key]);
	      } else if (e.key === 'Enter') {
	        e.preventDefault();
	        btnConfirm.click();
	      }
	    });
	
	    // confirmar
	    btnConfirm.addEventListener('click', async () => {
	      // lembrar prefer√™ncia
	      if (chkLembrar.checked) {
	        localStorage.setItem(LAST_PRINT_PREF_KEY, selectedOpcaoImpressao);
	      }
	
	      // precisa ter caixa aberta
	      if (caixaAtivaIndex === -1 || !caixas[caixaAtivaIndex] || caixas[caixaAtivaIndex].fechada) {
	        Swal.fire("Aten√ß√£o", "Nenhuma caixa aberta para fechar.", "warning");
	        return;
	      }
	
	      // snapshot antes de fechar
	      const caixaAtual = caixas[caixaAtivaIndex];
	      ultimaCaixaSnapshot = caixaAtual;
	
	      // fecha (seta endTime, atualiza UI, zera caixaAtivaIndex)
	      fecharCaixaAtiva();
	
	      // imprime conforme a sele√ß√£o
	      try {
	        if (selectedOpcaoImpressao === 'ambas') {
	          gerarEtiquetaCustom(ultimaCaixaSnapshot); // ML inbound
	          gerarEtiquetaCaixa(ultimaCaixaSnapshot);  // JP interna
	        } else if (selectedOpcaoImpressao === 'ml') {
	          gerarEtiquetaCustom(ultimaCaixaSnapshot);
	        } else if (selectedOpcaoImpressao === 'jp') {
	          gerarEtiquetaCaixa(ultimaCaixaSnapshot);
	        } // 'nenhuma' => n√£o imprime
	      } catch (e) {
	        console.error('Erro ao imprimir etiqueta(s):', e);
	        Swal.fire("Erro", "Falha ao imprimir etiqueta(s). Verifique a impressora.", "error");
	      }
	
	      modalFecharCaixa.hide();
	      atualizarPainelEsquerdo();
	    });
	
	    // cancelar
	    btnCancel.addEventListener('click', () => modalFecharCaixa.hide());
	  }
	
	  // abre o modal (se houver caixa aberta)
	  function abrirModalFecharCaixa() {
	    if (!modalFecharCaixa) inicializarModalFecharCaixa();
	    const elModal = document.getElementById('modalFecharCaixa');
	    if (!elModal) return;
	
	    // sem caixa aberta
	    if (caixaAtivaIndex === -1 || !caixas[caixaAtivaIndex] || caixas[caixaAtivaIndex].fechada) {
	      Swal.fire("Aten√ß√£o", "Nenhuma caixa aberta para fechar.", "warning");
	      return;
	    }
	
	    // se j√° est√° aberto, n√£o reconfigura (evita reset por re-render)
	    if (elModal.classList.contains('show') || isFecharModalOpen) return;
	
	    // aplica a sele√ß√£o salva APENAS se n√£o houver uma ativa
	    const hasActive = !!elModal.querySelector('.fechar-caixa-option.active');
	    if (!hasActive) {
	      const saved = localStorage.getItem(LAST_PRINT_PREF_KEY) || 'ambas';
	      window.__aplicarSelecaoFecharCaixa?.(saved);
	      elModal.querySelector('#guardarOpcaoImpressao').checked = !!localStorage.getItem(LAST_PRINT_PREF_KEY);
	    }
	
	    modalFecharCaixa.show();
	  }
	
	  let produtos = [];
	  try {
	    const raw = document.getElementById("js-data").dataset.comps ?? "[]";
	    produtos = JSON.parse(raw);
	    if (!Array.isArray(produtos)) produtos = [];
	  } catch (e) {
	    console.error("JSON inv√°lido em #js-data:", e);
	    Swal.fire("Erro", "Falha ao preparar os produtos. Recarregue a p√°gina.", "error");
	    return;
	  }
	
	  const placeholderImage = document.getElementById("placeholder-image").dataset.url;
	  const headerBar = document.querySelector(".header-bar");
	  const idAgendMl = headerBar ? headerBar.dataset.idMl : null;
	  const idAgendBd = headerBar ? headerBar.dataset.idBd : null;
	  const idMktp = headerBar ? headerBar.dataset.idMktp : null;
	  const marketplace = { 1: "Mercado Livre", 2: "Magalu", 3: "Shopee", 4: "Amazon", 5: "Outros" }[parseInt(idMktp, 10)] || "Desconhecido";
	
	  const agendamentoCompleto = {};
	  // Crie uma fila 1-shot no escopo do arquivo
	  let pendingPrint = null
	
	  document.addEventListener("printer:selected", () => {
	    if (!pendingPrint) return;
	    const job = pendingPrint;
	    pendingPrint = null;           // evita loop/duplicidade
	    setTimeout(() => imprimirEtiqueta(job.zpl, job.tipo), 0);
	  });
	
	  // Pega os dados principais dos atributos data-* do cabe√ßalho
	  if (headerBar) {
	    agendamentoCompleto.id_agend_ml = headerBar.dataset.idMl;
	    agendamentoCompleto.id_bd = headerBar.dataset.idBd;
	    agendamentoCompleto.empresa = headerBar.dataset.empresa;
	    // LINHA NOVA: Captura o centro de distribui√ß√£o
	    agendamentoCompleto.centro_distribuicao = headerBar.dataset.centro;
	  }
	
	  // Pega os dados que est√£o como texto no cabe√ßalho
	  const divsInfo = headerBar ? headerBar.querySelectorAll(".d-flex.flex-wrap > div") : [];
	  divsInfo.forEach(div => {
	    const textContent = div.textContent.trim();
	    if (textContent.startsWith("Colaborador:")) {
	      agendamentoCompleto.colaborador = textContent.replace("Colaborador:", "").trim();
	    } else if (textContent.startsWith("Data:")) {
	      agendamentoCompleto.data = textContent.replace("Data:", "").trim();
	    } else if (textContent.startsWith("Hora:")) {
	      agendamentoCompleto.hora = textContent.replace("Hora:", "").trim();
	    }
	  });
	
	  // Adiciona a lista de produtos (que j√° inclui as composi√ß√µes)
	  agendamentoCompleto.produtos = produtos;
	
	  // Finalmente, exibe o objeto completo no console
	  console.log("Dados do Agendamento (reconstru√≠dos pelo JS):", agendamentoCompleto);
	
	  const empresa = parseInt(headerBar?.dataset?.empresa ?? "0", 10) || 0;
	  const sellerIdMap = {
	    1: '539172427',   // Ja√∫ Pesca
	    2: '1111253828',  // Ja√∫ Fishing
	    3: '491881969'    // L.T. Sports
	  };
	  const sellerId = sellerIdMap[empresa] || '';
	
	  // Vari√°veis de estado para as caixas
	  let caixas = [];
	  let caixaAtivaIndex = -1;
	  let caixaStartTime = null;
	
	  // Outra fun√ß√£o que tamb√©m ser√° descontinuada
	  // Utilize sempre a fun√ß√£o imprimirEtiqueta(zpl, tipo) (UNIVERSAL)
	  function imprimirNaImpressoraDeRede(zpl) {
	    BrowserPrint.getLocalDevices(
	      devices => {
	        // Termo de busca alterado para apenas deskjp12
	        // const termos = ['deskjp12', '192.168.15.152'];
	        // N√£o deu certo, vamos procurar pelo nome da impressora
	        // const hostComputador  = 'deskjp12';
	        const nomeExatoDaImpressora = 'Impressora Etiqueta Conferencia01 em deskjp12'.toLowerCase();
	
	        console.log("Procurando pela impressora com nome exato:", nomeExatoDaImpressora);
	        console.log('Devices encontrados ->', devices);
	        const printer = devices.find(d => {
	          // Condi√ß√£o 1: A impressora deve ser gerenciada por um driver no pc do usu√°rio
	          // const isDriver = d.connection === 'driver';
	
	          // Condi√ß√£o 2: O nome do computador host ('deskjp12') deve estar no nome ou UID da impressora.
	          // O UID de impressoras de driver compartilhadas costuma ser algo como:
	          // "\\deskjp12\ZebraPrinter" ou "Zebra (C√≥pia 1) em deskjp12"
	          // const hasHostName = d.uid.toLowerCase().includes(hostComputador);
	          // termos.some(t => d.uid.toLowerCase().includes(t))
	          // return isDriver && hasHostName;
	          return d.name.toLowerCase() === nomeExatoDaImpressora;
	        });
	        if (!printer) {
	          console.error("‚ùå Impressora compartilhada n√£o encontrada.");
	          console.log("Verifique se a impressora compartilhada a partir de 'deskjp12' est√° instalada neste computador e online.");
	          return;
	        }
	        console.log("‚úÖ Impressora compartilhada encontrada:", printer);
	        printer.send(
	          zpl,
	          () => console.log("‚úÖ Enviado via driver Windows!"),
	          err => console.error("‚ùå Erro ao imprimir via driver:", err)
	        );
	      },
	      err => console.error("‚ùå Erro ao listar dispositivos:", err),
	      "printer"
	    );
	  }
	
	  // Essa fun√ß√£o ser√° removida
	  // Ser√° usada uma outra fun√ß√£o universal que utilizar√° a impressora salva no localStorage
	  function printViaBrowserPrint(zpl) { // Para gerar as etiquetas dos produtos (Mercado Livre Full)
	    BrowserPrint.getDefaultDevice("printer", function (printer) {
	      printer.send(zpl,
	        () => console.log("enviado!"),
	        err => console.error("erro printer:", err)
	      );
	    }, err => console.error("nenhuma impressora:", err));
	  }
	
	  // Fun√ß√£o universal para a impress√£o de etiquetas
	  function imprimirEtiqueta(zpl, tipo) {
	    const keyMap = { relatorio: 'printer_relatorio', caixa: 'printer_caixa', id: 'printer_id' };
	    const key = keyMap[tipo]; if (!key) return console.error("Tipo inv√°lido:", tipo);
	
	    const saved = localStorage.getItem(key);
	    if (!saved) {
	      if (!pendingPrint) pendingPrint = { zpl, tipo };
	      window.openPrinterModalByTipo?.(tipo);
	      return;
	    }
	    if (!window.BrowserPrint || typeof BrowserPrint.getLocalDevices !== "function") {
	      Swal.fire("Impress√£o indispon√≠vel",
	        "Zebra BrowserPrint n√£o est√° dispon√≠vel. Abra/instale para continuar.",
	        "error");
	      return;
	    }
	
	    BrowserPrint.getLocalDevices(
	      (devices) => {
	        const dev = devices.find(d => d.uid === saved || d.name === saved);
	        if (!dev) {
	          console.error("Impressora salva n√£o encontrada:", saved);
	          if (!pendingPrint) pendingPrint = { zpl, tipo };
	          if (typeof window.openPrinterModalByTipo === "function") window.openPrinterModalByTipo(tipo);
	          return;
	        }
	        dev.send(zpl,
	          () => console.log("‚úÖ Enviado para:", dev.name || dev.uid),
	          err => console.error("‚ùå Erro ao imprimir:", err)
	        );
	      },
	      err => console.error("‚ùå Erro ao listar impressoras:", err),
	      "printer"
	    );
	  }
	  // Fim da fun√ß√£o universal de impress√£o
	
	
	  if (!idAgendMl) {
	    console.error("N√£o foi poss√≠vel encontrar o ID do Agendamento (id_agend_ml) no HTML.");
	    Swal.fire("Erro Cr√≠tico", "N√£o foi poss√≠vel identificar o agendamento. A p√°gina n√£o funcionar√° corretamente.", "error");
	    return;
	  }
	
	  // 2) Inst√¢ncias dos modais (Bootstrap 5)
	  const modalSelecione = new bootstrap.Modal(document.getElementById("modalSelecioneAnuncio"));
	  const modalConfirme = new bootstrap.Modal(document.getElementById("modalConfirmeAnuncio"));
	
	  // 3) Elementos da UI
	  const inputSku = document.getElementById("input-embalar");
	  const bodySelecione = document.getElementById("modalSelecioneAnuncioBody");
	  const bodyConfirme = document.getElementById("modalConfirmeAnuncioBody");
	  const btnConfirmar = document.getElementById("btnConfirmarAnuncio");
	  const caixasContainer = document.getElementById("caixas-container");
	  // NOVO: Container dos bot√µes e caixas
	  const caixaActionsContainer = document.getElementById("caixa-actions-container");
	  const contadorFinalizadosEl = document.getElementById("finalizadosP");
	  const listaPrincipalEl = document.getElementById("lista-anuncios");
	  const templateNovaCaixa = document.getElementById("template-nova-caixa");
	  // NOVO: Template do bot√£o finalizar
	  const templateFinalizar = document.getElementById("template-finalizar-embalagem");
	
	  async function carregarCaixasSalvas() {
	    try {
	      const caixasData = await fetchJSON(`/api/embalar/caixa/${idAgendMl}`);
	      caixasData.forEach(box => {
	        const num = box.caixa_num;
	        const totalItens = box.itens.reduce((s, i) => s + Number(i.quantidade || 0), 0);
	
	        const idx = caixas.length;
	        caixas.push({
	          id: num,
	          codigo: box.codigo_unico_caixa || null,
	          itens: box.itens.reduce((acc, i) => ({ ...acc, [i.sku]: Number(i.quantidade || 0) }), {}),
	          fechada: true,
	          persisted: true,
	          element: null
	        });
	
	        const caixaDiv = document.createElement("div");
	        caixaDiv.className = "card caixa-card caixa-fechada";
	        caixaDiv.innerHTML = `
	        <div class="card-header">Caixa ${esc(num)} - (${totalItens} ${totalItens > 1 ? 'itens' : 'item'})</div>
	        <div class="card-body">
	          <ul class="list-unstyled mb-0"></ul>
	        </div>`;
	        caixas[idx].element = caixaDiv;
	        caixasContainer.prepend(caixaDiv);
	
	        const ul = caixaDiv.querySelector("ul");
	        box.itens.forEach(i => {
	          const li = document.createElement("li");
	          li.className = "d-flex justify-content-between p-1";
	          li.innerHTML = `<span>${esc(i.sku)}</span><span class="fw-bold">Unidades: ${esc(i.quantidade)}</span>`;
	          ul.appendChild(li);
	        });
	      });
	      caixaAtivaIndex = -1;
	      verificarModoEtiqueta();
	    } catch (error) {
	      console.error("Erro ao carregar caixas salvas:", error);
	    }
	  }
	
	  function atualizarPainelEsquerdo() {
	    const totalProdutos = produtos.length;
	    const produtosConcluidos = listaPrincipalEl.querySelectorAll(".produto-concluido").length;
	    const existeCaixaAberta = caixaAtivaIndex !== -1 && !caixas[caixaAtivaIndex].fechada;
	
	    const btnNovaCaixa = document.getElementById('btn-nova-caixa');
	    const btnFinalizar = document.getElementById('btn-finalizar-embalagem');
	    if (btnNovaCaixa) btnNovaCaixa.remove();
	    if (btnFinalizar) btnFinalizar.remove();
	
	    if (totalProdutos === produtosConcluidos && totalProdutos > 0) {
	      // Agora abre o modal (se houver caixa aberta) e n√£o reabre se j√° estiver aberto
	      if (existeCaixaAberta) {
	        if (!isFecharModalOpen) abrirModalFecharCaixa();
	        return;
	      }
	      // Se n√£o h√° caixa aberta, mostra o bot√£o "Finalizar Embalagem"
	      const clone = templateFinalizar.content.cloneNode(true);
	      const botaoFinalizar = clone.querySelector('#btn-finalizar-embalagem');
	      botaoFinalizar.addEventListener('click', handleFinalizarEmbalagem);
	      caixaActionsContainer.prepend(clone);
	    } else {
	      const algumProdutoProntoParaEmbalar = produtos.some(p => p.bipados !== undefined);
	      if (algumProdutoProntoParaEmbalar && !existeCaixaAberta) {
	        const clone = templateNovaCaixa.content.cloneNode(true);
	        caixaActionsContainer.prepend(clone);
	        document.getElementById('btn-nova-caixa').addEventListener('click', abrirNovaCaixa);
	      }
	    }
	  }
	
	  function abrirModalConfirmacao(prod) {
	    if (!prod) {
	      console.error("Tentativa de abrir modal de confirma√ß√£o sem um produto v√°lido.");
	      return;
	    }
	
	    bodyConfirme.dataset.skuConferindo = prod.sku;
	    bodyConfirme.dataset.idMlConferindo = prod.id_ml;
	
	    const imgUrl = prod.imagemUrl || placeholderImage;
	    let lisHtml;
	
	    if (prod.composicoes && prod.composicoes.length > 0) {
	      lisHtml = prod.composicoes.map((c) => {
	        const requerido = c.unidades_por_kit || c.unidades_totais || 1;
	        return `<li class="componente-item status-pendente" data-sku-esperado="${c.sku}" data-gtin-esperado="${c.gtin}" data-requerido="${requerido}" data-bipado="0">
	                        <span class="componente-nome">${c.nome}</span>
	                        <span class="componente-status"><span class="contador-bipagem">(0/${requerido})</span></span>
	                    </li>`;
	      }).join("");
	    } else {
	      const requerido = 1;
	      lisHtml = `<li class="componente-item status-pendente" data-sku-esperado="${prod.sku}" data-gtin-esperado="${prod.gtin}" data-requerido="${requerido}" data-bipado="0">
	                       <span class="componente-nome">${prod.nome}</span>
	                       <span class="componente-status"><span class="contador-bipagem">(0/${requerido})</span></span>
	                   </li>`;
	    }
	
	    bodyConfirme.innerHTML = `
	        <div class="modal-main-layout">
	            <div class="modal-image-container"><img src="${imgUrl}" alt="${prod.nome}"></div>
	            <div class="modal-list-container"><ul class="lista-componentes">${lisHtml}</ul></div>
	        </div>
	        <div class="modal-footer-input">
	            <input type="text" id="sku-confirmacao-unico" class="form-control" placeholder="Bipar SKU do componente aqui...">
	        </div>`;
	
	    modalSelecione.hide();
	    modalConfirme.show();
	    setTimeout(() => { document.getElementById("sku-confirmacao-unico")?.focus(); }, 500);
	  }
	
	
	  // ===================================================================
	  // L√ìGICA DE GERENCIAMENTO DAS CAIXAS
	  // ===================================================================
	
	  function verificarModoEtiqueta() {
	    const algumProdutoProntoParaEmbalar = produtos.some(p => p.bipados !== undefined);
	    const existeCaixaAberta = caixaAtivaIndex !== -1 && !caixas[caixaAtivaIndex].fechada;
	    const btnNovaCaixa = document.getElementById('btn-nova-caixa');
	
	    if (algumProdutoProntoParaEmbalar && !existeCaixaAberta && !btnNovaCaixa) {
	      const clone = templateNovaCaixa.content.cloneNode(true);
	      caixaActionsContainer.prepend(clone);
	      document.getElementById('btn-nova-caixa').addEventListener('click', abrirNovaCaixa);
	    } else if ((!algumProdutoProntoParaEmbalar || existeCaixaAberta) && btnNovaCaixa) {
	      btnNovaCaixa.remove();
	    }
	  }
	
	  async function abrirNovaCaixa() {
	    // √≠ndice da nova caixa
	    caixaAtivaIndex = caixas.length;
	
	    // objeto base
	    const caixaObj = {
	      id: null,
	      codigo: null,        // <- vamos guardar o codigo_unico_caixa
	      itens: {},
	      fechada: false,
	      persisted: false,
	      element: null,
	    };
	    caixaObj.startTime = new Date();
	    caixas.push(caixaObj);
	
	    // cria visual no DOM
	    const numeroTemporario = caixas.length;
	    const caixaDiv = document.createElement('div');
	    caixaDiv.className = 'card caixa-card caixa-aberta';
	    caixaDiv.innerHTML = `
	    <div class="card-header">Caixa ${numeroTemporario}</div>
	    <div class="card-body"><ul class="list-unstyled mb-0"></ul></div>`;
	    caixaObj.element = caixaDiv;
	    caixasContainer.prepend(caixaDiv);
	
	    // cria imediatamente no servidor (evita ‚Äúabrir sem id‚Äù)
	    try {
	      const { caixa_num, codigo_unico_caixa } = await fetchJSON('/api/embalar/caixa', {
	        method: 'POST',
	        body: { id_agend_ml: idAgendMl }
	      });
	      caixaObj.id = caixa_num;
	      caixaObj.codigo = codigo_unico_caixa;
	      caixaObj.persisted = true;
	      caixaDiv.querySelector('.card-header').textContent = `Caixa ${caixaObj.id}`;
	    } catch (err) {
	      console.error(err);
	      Swal.fire("Erro", "N√£o foi poss√≠vel criar a caixa no servidor.", "error");
	      // volta estado
	      caixas.pop();
	      caixaAtivaIndex = -1;
	      caixaDiv.remove();
	      return;
	    }
	
	    atualizarPainelEsquerdo();
	  }
	
	  function gerarEtiquetaCustom(caixa) {
	    const idAgendamento = idAgendMl;
	    const numeroCaixa = caixa.id;
	
	    // Busca o centro de distribui√ß√£o
	    const centroRaw = agendamentoCompleto.centro_distribuicao;
	    const centro = String(centroRaw || '').toUpperCase();
	    const centroKey = (centro === 'BRSP06') ? 'SP06' : centro; // normaliza
	
	    // Configura√ß√£o por centro
	    const centerConfig = {
	      BRSP11: {
	        text: '(Endere_C3_A7o correto: Rua Concretex_2C 800 Galp_C3_A3o H_2C Cumbica_2C Guarulhos)_2C Centro log_C3_ADstico Guarulhos - BRSP11',
	        y: 965
	      },
	      BRRC02: {
	        text: 'Centro log_C3_ADstico Sumar_C3_A9 - BRRC02',
	        y: 970
	      },
	      BRRC01: {
	        text: 'Centro log_C3_ADstico Perus - BRRC01',
	        y: 970
	      },
	      BRSP10: {
	        text: 'Centro log_C3_ADstico SP10 - BRSP10',
	        y: 970
	      },
	      SP06: {
	        text: 'Centro log_C3_ADstico Ara_C3_A7ariguama - BRSP06',
	        y: 970
	      }
	    };
	    const cfg = centerConfig[centroKey] || {
	      text: `Centro log_C3_ADstico ${centro}`,
	      y: 970
	    };
	
	    // Monta o JSON interno do QR
	    const qrPayload = {
	      id: `${idAgendamento}/${numeroCaixa}`,
	      reference_id: `${idAgendamento}/${numeroCaixa}`,
	      t: "inb",
	      ops_data: {
	        source: "seller",
	        container_type: "box"
	      }
	    };
	
	    // Toda a lista de linhas ZPL, incluindo as duas din√¢micas para o centro
	    const zpl = [
	      '^XA',
	      '^MCY',
	      '^CI28',
	      '^LH5,15',
	      '^FX  HEADER  ^FS',
	      '^FX Logo_Meli ^FS',
	      '^FO20,10^GFA,800,800,10,,:::::::::::O0FF,M07JFE,L07FC003FE,K07EL07E,J01EN078,J07P0E,I01CP038,I07R0E,001CK01FK038,003L0IFK0C,0078J03803CJ0E,0187J06I07I01D8,0300F00F8J0FEFE0C,02003IFK01J06,04I01C6P02,08K0401FM01,1L08060CM083K0100C02M0C2M01001M046K0306I0CL064K0198I02L024Q01L02CR08K03CR04K03FR02K03FFQ01J07!C1FQ0C007E3C03EP0203F03C0078O010F003CI0EF1N0F8003CI070C4M06I03CI02003CL02I03CI02P02I036I03N0106I066I01J08J0C4I067J0EI08J078I0E38I03I0E00406I01C3CI01800100204I01C3CJ0FI080118I03C1EJ03800801FJ0780FK0C008018J0F,078J07C0823J01F,07EJ01C1C36J07E,03FK031C3K0FC,01FCJ01E18J01F8,00FER07F,007F8P01FE,003FFP0FFC,I0FFEN07FF,I03FFCL03FFC,J0IFCJ03IF,J07PFE,K0PF,K01NF8,L01LF8,N0JF,,:::::::::::^FS',
	      `^FO120,30^A0N,24,24^FH^FD#${sellerId}^FS`,
	      `^FO560,20^GFA,1584,1584,24,,:::::::::::::L03IFC,L07IFC,:L07IF8,L0JF8,L0JF,K01JFM0JFE007C001FI0FK07C,K01JFM0JFE007C001F001FK07C,K03IFEM0JFE007C001F001FK078,K03IFCM0JFE0078001E001FK0F8,K03IFCL01F8K0F8003E001EK0F8,K07IF8L01FL0F8003E003EK0F8,:K07IF8L01EL0F8003E003EK0F,K0JFM01EL0FI03C003EK0F,K0JFM03EK01FI03C007EJ01F,K0JFM03EK01FI07C007CJ01F,K0MFJ03EK01FI07C007CJ01F,J01MFJ03IFE001FI07C007CJ01E,J01LFEJ03IFE001EI07800FCJ01E,J03LFCJ07IFE003EI0F800FCJ03E,J03LF8J07IFE003EI0F800F8J03E,J03LFK07CK03EI0F800F8J03E,J07KFEK0FCK07E001F800F8J03E,J07KFCK0F8K07E001F001FK07C,M01FFCK0F8K07E001F001FK07C,N0FF8K0F8K07E001F001FK07C,N0FFL0F8K07E003E001FK07C,M01FEK01F8K07E007E001FK0FC,M01FCK01FL03F80FC001F8J0FC,M01F8K01FL01JF8003JF80JFE,M03FL01FM0JFI03JF80JFE,M03FL01EM07FFEI03JF00JFC,M03EV0FF,M07C,M078,M07,M0E,:M0C,L018,L01,,:::::::::^FS`,
	      `^FO120,60^A0N,24,24^FH^FB550,2,0,L^FDEnvio: ${idAgendamento}/${numeroCaixa}^FS`,
	      `^FO300,150^GB500,45,3^FS`,
	      `^FO325,163^A0N,27,27^FB460,1,0,C^FR^FH^FDENTREGAR NA FULL^FS`,
	      `^FO325,210^A0N,27,27^FB460,1,0,C^FR^FH^FDN_c3_83O V_c3_81LIDA PARA COLETA^FS`,
	      `^FO400,235^GB127,0,2^FS`,
	      `^FX  QR Code  ^FS`,
	      `^FO280,320^BY2,2,1^BQN,2,6^FDLA,${JSON.stringify(qrPayload)}^FS`,
	      `^FO0,590^A0N,35,35^FB800,1,0,C^FD${idAgendamento}/${numeroCaixa}^FS`,
	      // ‚Üê Linhas din√¢micas por centro:
	      `^FO0,670^A0N,150,150^FB810,1,0,C^FD${centro}^FS`,
	      `^FO30,${cfg.y}^A0N,30,30^FB550,3,5,L^FH^FD${cfg.text}^FS`,
	      '^FX  END CUSTOM_DATA  ^FS',
	      '^FO0,900^GB800,0,2^FS',
	      '^FO30,930^A0N,30,30^FB551,2,0,L^FH^FDVOLUMES^FS',// Exemplo est√°tico se precisar como fallback
	      `^FO30,1070^A0N,30,30^FH^FDEnvio: ${idAgendamento}/${numeroCaixa}^FS`,
	      '^FX  END_FOOTER  ^FS',
	      '^XZ'
	    ].join('\n');
	
	    console.log(zpl);
	    imprimirEtiqueta(zpl, 'caixa');
	  }
	
	
	
	  window.addEventListener('keydown', (e) => {
	    if (!['F1', 'F2', 'F3', 'F4', 'Enter'].includes(e.key)) return;
	
	    const elModal = document.getElementById('modalFecharCaixa');
	    const modalAberto = !!(elModal && elModal.classList.contains('show'));
	
	    // Se o modal de fechar caixa est√° ABERTO:
	    if (modalAberto) {
	      if (FKEY_TO_OPT[e.key]) {
	        e.preventDefault();
	        window.__aplicarSelecaoFecharCaixa?.(FKEY_TO_OPT[e.key]); // seleciona op√ß√£o
	        return;
	      }
	      if (e.key === 'Enter') {
	        e.preventDefault();
	        elModal.querySelector('#btnConfirmarFechamento')?.click(); // Enter confirma
	        return;
	      }
	    }
	
	    // Se QUALQUER outro modal Bootstrap estiver aberto, ignora atalhos
	    if (document.body.classList.contains('modal-open')) return;
	
	    // ===== Fluxo r√°pido fora do modal: F1‚ÄìF4 fecham a caixa ativa e imprimem =====
	    if (!['F1', 'F2', 'F3', 'F4'].includes(e.key)) return;
	    e.preventDefault();
	
	    const idx = caixaAtivaIndex;
	    const caixa = caixas[idx];
	    if (!caixa || caixa.fechada) {
	      Swal.fire("Aten√ß√£o", "Nenhuma caixa aberta para fechar.", "warning");
	      return;
	    }
	
	    // 1) fecha a caixa (sem imprimir)
	    fecharCaixaAtiva();
	
	    // 2) imprime conforme a tecla
	    if (e.key === 'F1') {           // ML + JP
	      gerarEtiquetaCaixa(caixa);
	      gerarEtiquetaCustom(caixa);
	    } else if (e.key === 'F2') {    // s√≥ ML
	      gerarEtiquetaCustom(caixa);
	    } else if (e.key === 'F3') {    // s√≥ JP
	      gerarEtiquetaCaixa(caixa);
	    } else if (e.key === 'F4') {
	      // nenhuma
	    }
	
	    // 3) atualiza UI
	    atualizarPainelEsquerdo();
	  });
	
	  function gerarEtiquetaCaixa(caixa) {
	    const headerBar = document.querySelector('.header-bar');
	    const freteId = headerBar.dataset.idMl;
	    const dataStr = caixa.startTime.toLocaleDateString('pt-BR');
	    const horaIni = caixa.startTime.toLocaleTimeString('pt-BR', { hour12: false });
	    const horaFim = caixa.endTime.toLocaleTimeString('pt-BR', { hour12: false });
	
	    const linhas = [
	      '^XA^CI28',
	      '^LH0,0',
	      `^FO30,30^BQN,2,15^FDLA,Frete:${freteId} - Data: ${dataStr} - Inicio: ${horaIni} - Termino: ${horaFim}^FS`,
	      `^FO390,40^A0N,32,32^FDFrete: ${freteId}^FS`,
	      `^FO390,90^A0N,32,32^FDData: ${dataStr}^FS`,
	      `^FO390,140^A0N,32,32^FDInicio: ${horaIni}^FS`,
	      `^FO390,190^A0N,32,32^FDTermino: ${horaFim}^FS`,
	
	      // Logo do mercado livre
	      '^FO620,225^GFA,0,4150,30,,::::::::::::::::::::::::::::::::::::::::::Y03KFE,W01OF8,V01JF800JFC,U01FFEM03FFC,U0FF8O01FF8,T07F8Q01FF,S03FCS01FC,S0FEU03F8,R07FW07E,R0F8W01F8,Q03EY07E,Q0F8Y01F8,P03EgG07C,P078gG01F,O01FP03IFO078,O03CO01KFN03C,O07CO07F807FCN0F,O0FF8M01F8I03F8M0F8,N03CFFM03EK0FEL07FC,N0781FEK03F8K01FCJ03F8E,N0F003FEI03FEM07FE007FE07,M01EI07FE03FFCN0LF0038,M03CJ0LF8N01JFI01C,M038K0IF87X0E,M07P0EI03F8R07,M0EO01CI0FFER07,L01CO038003F1FR038,L01CO07I07807CQ01C,L038O0E001E001ER0C,L03O01C003CI0FR0E,L07O0380078I038Q06,L06O03001EJ01CQ07,L0EO03003CK0FQ03,L0CO03C0F8K078P038,K01CO01FFEL03CP018,K018P07F8M0EP018,K018g07P01C,K038g03CP0C,K038g01EP0C,K03CgG0FP0C,K03FCg078N07E,K03FFCY01CM07FE,K031FFCY0EL07FFE,K0301FF8X07K03FF0E,K03001FFX03CI01FF80E,K03I01FCW01EI0FF800E,K03J03F8W0F003FCI0E,K03K0FEW0381FEJ0E,K03K01F8FCQ04001C7FK0E,K038K07IF7FO06I0FF8K0E,K038K01F87FFCN03I07CL0E,K038L0E03C1EN0180038K01E,K038L0E01807FN0E001CK01E,K03CL0E01007FCM07001CK01C,K03CL0EJ031EM03801CK01C,K03CL0EL07M01C01CK03C,K01EL06L03N0E01CK03C,K01EL07L038I03I07038K078,K01FL03FCJ018I018003FFL078,L0FL01FCJ018J0C001FEL0F8,L0F8L07CJ03FJ0E001F8K01F8,L0FCM0EJ03FCI070018L01F,L07CM06J031EI038038L03F,L07EM078K07I01C038L07E,L03FM03EEJ031800E0FM07E,L03F8L01FEJ038C007FEM0FC,L01FCM07FJ0187007FCL01FC,L01FEN07J0183803FM03F8,M0FFN03C700181C07N07F,M07F8M01FF00380E0FN0FF,M03FCN07F003007BEM03FE,M03FEO03807807FCM07FC,M01FF8N01C0FE0FFN0FF8,N0FFCO0KFEN03FF8,N07FFO07F87F8N07FF,N03FF8N01EQ01FFE,N01FFEgG03FFC,O0IF8g0IF8,O07FFEY03FFE,O03IF8W01IFC,P0IFEW07IF8,P07IFCU03IFE,P01JF8S01JFC,Q0KF8R0KF,Q03KF8P0KFE,R0LFCM01LF8,R03MFCI03MFE,S0YF,S01WFC,T07UFE,U0UF,V0SF8,W0QF,X03MFE,gG0IF8,,:::::::::::::::::::::::::::::::::::::::::^FS',
	
	      '^FO30,380^GB750,2,2^FS',
	      '^FO30,400^A0N,40,40^FDEtiqueta/UN^FS',
	      `^FO600,400^A0N,40,40^FDCaixa: ${caixa.id}^FS`,
	      '^FO30,450^GB750,2,2^FS'
	    ];
	
	    // agora renderiza cada SKU/qtde na sequ√™ncia
	    let y = 480;
	    const step = 50;
	    Object.entries(caixa.itens).forEach(([sku, qtd]) => {
	      linhas.push(`^FO25,${y}^A0N,30,30^FD ${sku} / ${qtd}^FS`);
	      y += step;
	    });
	
	    linhas.push('^XZ');
	
	    const zpl = linhas.join('\n');
	    console.log(zpl)
	    imprimirEtiqueta(zpl, 'caixa');
	  }
	
	
	
	  function fecharCaixaAtiva() {
	    if (caixaAtivaIndex === -1 || caixas[caixaAtivaIndex].fechada) {
	      return;
	    }
	
	    const caixa = caixas[caixaAtivaIndex];
	    const caixaEl = caixa.element;
	    const totalItens = Object.values(caixa.itens).reduce((sum, count) => sum + count, 0);
	
	    if (totalItens === 0) {
	      Swal.fire({
	        icon: 'warning',
	        title: 'A√ß√£o Inv√°lida',
	        text: 'Voc√™ n√£o pode fechar uma caixa vazia.'
	      });
	      return;
	    }
	
	    // 1) marca a caixa como fechada no front
	    caixa.fechada = true;
	    caixaEl.classList.remove('caixa-aberta');
	    caixaEl.classList.add('caixa-fechada');
	
	    // 2) atualiza o header com n√∫mero e total de itens
	    const header = caixaEl.querySelector('.card-header');
	    header.textContent = `Caixa ${caixa.id} - (${totalItens} ${totalItens > 1 ? 'itens' : 'item'})`;
	
	    // 3) registra o timestamp de t√©rmino
	    caixa.endTime = new Date();
	
	    // 4) ‚Äúdesativa‚Äù a caixa atual antes de gerar a etiqueta
	    caixaAtivaIndex = -1;
	
	    // 5) gera uma ZPL s√≥ para esta caixa (use o startTime que voc√™ j√° setou em abrirNovaCaixa)
	
	    // 6) atualiza bot√µes (‚ÄúNova Caixa‚Äù / ‚ÄúFinalizar‚Äù) conforme o estado
	    atualizarPainelEsquerdo();
	  }
	
	  let scanBusy = false; // trava simples contra double-enter
	  async function adicionarItemNaCaixa(etiqueta) {
	    if (caixaAtivaIndex === -1 || caixas[caixaAtivaIndex].fechada) {
	      Swal.fire("Aten√ß√£o", "Nenhuma caixa aberta. Crie uma nova caixa antes.", "warning");
	      throw new Error("Nenhuma caixa aberta.");
	    }
	    if (scanBusy) return; // evita duplicidade
	    scanBusy = true;
	
	    const caixa = caixas[caixaAtivaIndex];
	
	    // garante que a caixa exista no BD (se algu√©m mudou sua fun√ß√£o abrirNovaCaixa)
	    if (!caixa.persisted) {
	      try {
	        const { caixa_num, codigo_unico_caixa } = await fetchJSON('/api/embalar/caixa', {
	          method: 'POST',
	          body: { id_agend_ml: idAgendMl }
	        });
	        caixa.id = caixa_num;
	        caixa.codigo = codigo_unico_caixa;
	        caixa.persisted = true;
	        caixa.element.querySelector('.card-header').textContent = `Caixa ${caixa.id}`;
	      } catch (err) {
	        scanBusy = false;
	        console.error(err);
	        Swal.fire("Erro", "N√£o foi poss√≠vel criar a caixa no servidor.", "error");
	        return;
	      }
	    }
	
	    try {
	      // CHAMADA AT√îMICA: bipados + item da caixa de uma vez
	      const resp = await fetchJSON('/api/embalar/scan', {
	        method: 'POST',
	        body: {
	          id_agend_ml: idAgendMl,
	          id_prod_ml: etiqueta,                   // etiqueta do an√∫ncio
	          sku: etiqueta,                          // o que grava na caixa (pode ser a pr√≥pria etiqueta)
	          codigo_unico_caixa: caixa.codigo,       // prefer√≠vel ao n√∫mero
	          caixa_num: caixa.id                     // redundante, mas √∫til
	        }
	      });
	
	      // Atualiza estado e DOM com o que o servidor confirmou
	      caixa.itens[etiqueta] = resp.quantidade_caixa;
	
	      const ul = caixa.element.querySelector('ul');
	      let li = ul.querySelector(`li[data-etiqueta="${etiqueta}"]`);
	      if (!li) {
	        li = document.createElement('li');
	        li.dataset.etiqueta = etiqueta;
	        li.className = 'd-flex justify-content-between p-1';
	        ul.appendChild(li);
	      }
	      li.innerHTML = `<span>${esc(etiqueta)}</span><span class="fw-bold">Unidades: ${esc(caixa.itens[etiqueta])}</span>`;
	      li.classList.add('item-caixa-novo');
	      setTimeout(() => li.classList.remove('item-caixa-novo'), 700);
	
	      // atualiza contador do produto (bipados) a partir do valor garantido do banco
	      atualizarStatusProduto(resp.id_prod_ml, resp.bipados);
	
	      return resp; // caso o chamador queira usar
	
	    } catch (err) {
	      console.error("Erro ao bipar:", err);
	      Swal.fire("Erro", err.message || "Falha ao bipar", "error");
	    } finally {
	      scanBusy = false;
	    }
	  }
	
	  async function iniciarEmbalagem(idProdMl) {
	    try {
	      const response = await fetch("/api/embalar/iniciar", {
	        method: "POST",
	        headers: { "Content-Type": "application/json" },
	        body: JSON.stringify({ id_agend_ml: idAgendMl, id_prod_ml: idProdMl }),
	      });
	      if (!response.ok) {
	        const errorData = await response.json();
	        throw new Error(errorData.error || "Falha ao iniciar embalagem no servidor");
	      }
	      return await response.json();
	    } catch (error) {
	      console.error("Erro ao iniciar embalagem:", error);
	      Swal.fire("Erro", "N√£o foi poss√≠vel registrar o in√≠cio da embalagem no banco de dados.", "error");
	      throw error; // Lan√ßa o erro para que a fun√ß√£o que chamou saiba que falhou
	    }
	  }
	
	  function atualizarStatusProduto(idMlParaAtualizar, bipadosAtuais) {
	    const produtoData = produtos.find(p => p.id_ml === idMlParaAtualizar);
	    if (!produtoData) return;
	
	    const itemLi = listaPrincipalEl.querySelector(`li[data-id-ml="${idMlParaAtualizar}"]`);
	    if (!itemLi) return;
	
	    const totalNec = produtoData.unidades;
	    const bipadosCapped = Math.min(bipadosAtuais, totalNec);
	
	    // --- IN√çCIO DA CORRE√á√ÉO ---
	    // A propriedade 'bipados' no objeto em mem√≥ria s√≥ √© definida aqui.
	    // Se for 0, significa que acabamos de validar o SKU.
	    if (produtoData.bipados === undefined && bipadosCapped === 0) {
	      produtoData.bipados = 0; // Define como 0 para marcar como "iniciado"
	    } else {
	      produtoData.bipados = bipadosCapped;
	    }
	
	    const skuSpan = itemLi.querySelector(".sku");
	    const unidadesSpan = itemLi.querySelector(".unidades");
	
	    // Condi√ß√£o corrigida: troca para etiqueta assim que o produto √© iniciado (bipados >= 0)
	    if (typeof produtoData.bipados === "number") {
	      itemLi.dataset.sku = produtoData.id_ml; // Muda o SKU do item para a etiqueta
	      skuSpan.textContent = produtoData.id_ml;
	      skuSpan.classList.add("etiqueta");
	    }
	
	    unidadesSpan.textContent = `Bipados: ${produtoData.bipados}/${totalNec}`;
	    // --- FIM DA CORRE√á√ÉO ---
	
	    if (produtoData.bipados >= totalNec) {
	      itemLi.classList.add("produto-concluido");
	      if (!itemLi.querySelector("i.bi-check-circle-fill")) {
	        itemLi.querySelector(".produto-info").insertAdjacentHTML("afterbegin", '<i class="bi bi-check-circle-fill me-2"></i>');
	      }
	    } else {
	      itemLi.classList.remove("produto-concluido");
	      itemLi.querySelector("i.bi-check-circle-fill")?.remove();
	    }
	
	    atualizarContadorFinalizados();
	    atualizarPainelEsquerdo();
	  }
	
	  // VERS√ÉO CORRIGIDA
	  function atualizarContadorFinalizados() {
	    const contagem = listaPrincipalEl.querySelectorAll(".produto-concluido").length;
	    if (contadorFinalizadosEl) {
	      contadorFinalizadosEl.innerHTML = `<strong>‚úÖ Finalizados:</strong> ${contagem}`;
	    }
	    // A chamada para atualizarPainelEsquerdo() foi removida daqui.
	  }
	
	  inputSku.addEventListener("keydown", async (e) => {
	    if (e.key !== "Enter") return;
	    e.preventDefault();
	
	    const valor = inputSku.value.trim();
	    if (!valor) return;
	
	    console.clear();
	    console.log(`--- BIP REGISTRADO: "${valor}" ---`);
	
	    // 1) √© uma etiqueta de produto j√° iniciado?
	    const produtoPorEtiqueta = produtos.find(p => p.id_ml === valor);
	    inputSku.value = "";
	
	    if (produtoPorEtiqueta) {
	      if (produtoPorEtiqueta.bipados >= produtoPorEtiqueta.unidades) {
	        Swal.fire({ icon: "info", title: "An√∫ncio j√° finalizado!", timer: 1800, showConfirmButton: false });
	        return;
	      }
	      // chama a fun√ß√£o at√¥mica (j√° atualiza UI)
	      try {
	        await adicionarItemNaCaixa(valor);
	      } catch { /* erros j√° tratados internamente */ }
	      return;
	    }
	
	    // 2) N√£o √© etiqueta em andamento: procura SKU/GTIN em produtos PENDENTES
	    const candidatos = produtos.filter(prod => {
	      if (prod.bipados !== undefined) return false;
	      if (prod.sku === valor || prod.gtin === valor) return true;
	      return prod.composicoes?.some(item => item.sku === valor || item.gtin === valor);
	    });
	
	    if (candidatos.length === 0) {
	      Swal.fire("N√£o Encontrado", `Nenhum an√∫ncio PENDENTE para: "${valor}"`, "warning");
	      return;
	    }
	    if (candidatos.length === 1) {
	      abrirModalConfirmacao(candidatos[0]);
	      return;
	    }
	
	    // m√∫ltiplos ‚Äî abrir modal de sele√ß√£o
	    bodySelecione.innerHTML = candidatos.map(prod => {
	      const imgUrl = prod.imagemUrl || placeholderImage;
	      return `<div class="card mb-3" data-sku="${prod.sku}" data-id-ml="${prod.id_ml}" style="cursor: pointer;">
	              <div class="row g-0">
	                <div class="col-3 d-flex align-items-center justify-content-center p-2">
	                  <img src="${imgUrl}" class="img-fluid rounded-start" alt="${prod.nome}">
	                </div>
	                <div class="col-9">
	                  <div class="card-body">
	                    <h6 class="card-title">An√∫ncio: ${prod.nome}</h6>
	                    <p class="card-text mb-1"><strong>Etiqueta:</strong> ${prod.id_ml}</p>
	                    <p class="card-text mb-1"><strong>Qtd Etiquetas:</strong> ${prod.unidades}</p>
	                    <p class="card-text mb-0"><strong>Tipo:</strong> ${prod.is_kit ? "Kit" : "Simples"}</p>
	                  </div>
	                </div>
	              </div>
	            </div>`;
	    }).join("");
	    modalSelecione.show();
	  });
	
	  // ===================================================================
	  // FUN√á√ïES ORIGINAIS
	  // ===================================================================
	
	  function inicializarPopoversDeImagem() {
	    const todos = document.querySelectorAll("#lista-anuncios .bi-info-circle");
	    todos.forEach((icon) => {
	      const itemLi = icon.closest(".produto-item");
	      if (!itemLi) return;
	      const idMl = itemLi.dataset.idMl || produtos.find(p => p.sku === itemLi.dataset.sku)?.id_ml;
	      const produto = produtos.find((p) => p.id_ml === idMl);
	      if (!produto) return;
	      const imagemUrl = produto.imagemUrl || placeholderImage;
	      const popoverContent = `<img src="${esc(imagemUrl)}" class="img-fluid rounded" style="max-width: 150px;">`;
	      new bootstrap.Popover(icon, {
	        html: true,
	        trigger: "hover",
	        placement: "left",
	        content: popoverContent,
	        container: "body",
	        customClass: "produto-popover"
	      });
	    });
	  }
	
	  bodySelecione.addEventListener("click", (e) => {
	    const card = e.target.closest(".card[data-id-ml]");
	    if (!card) return;
	
	    const idMl = card.dataset.idMl;
	    const prod = produtos.find((p) => p.id_ml === idMl);
	
	    if (prod) {
	      abrirModalConfirmacao(prod);
	    } else {
	      console.error("Produto n√£o encontrado para o id_ml clicado:", idMl);
	      modalSelecione.hide();
	    }
	  });
	
	  bodyConfirme.addEventListener("keydown", (e) => {
	    if (e.key !== "Enter" || e.target.id !== "sku-confirmacao-unico") return;
	    e.preventDefault();
	    const inputUnico = e.target;
	    const valorDigitado = inputUnico.value.trim();
	    if (!valorDigitado) return;
	    const itemLi = Array.from(bodyConfirme.querySelectorAll('.componente-item')).find(li => {
	      const okSku = li.dataset.skuEsperado === valorDigitado;
	      const okGtin = li.dataset.gtinEsperado === valorDigitado;
	      const ainda = +li.dataset.bipado < +li.dataset.requerido;
	      return (okSku || okGtin) && ainda;
	    });
	    if (itemLi) {
	      let contagemBipada = parseInt(itemLi.dataset.bipado) + 1;
	      const contagemRequerida = parseInt(itemLi.dataset.requerido);
	      itemLi.dataset.bipado = contagemBipada;
	      const contadorSpan = itemLi.querySelector(".contador-bipagem");
	      contadorSpan.textContent = `(${contagemBipada}/${contagemRequerida})`;
	
	      itemLi.classList.remove('status-pendente');
	      if (contagemBipada < contagemRequerida) {
	        itemLi.classList.add('status-progresso');
	      } else {
	        itemLi.classList.add('status-concluido');
	      }
	
	      if (!bodyConfirme.querySelector(".componente-item:not(.status-concluido)")) {
	        inputUnico.disabled = true;
	        inputUnico.placeholder = "Todos os itens foram conferidos!";
	        btnConfirmar.focus();
	      }
	    } else {
	      Swal.fire({ icon: "error", title: "SKU Inv√°lido!", timer: 2000, showConfirmButton: false });
	      inputUnico.classList.add("animate__animated", "animate__shakeX");
	      setTimeout(() => { inputUnico.classList.remove("animate__animated", "animate__shakeX"); }, 800);
	    }
	    inputUnico.value = "";
	  });
	
	  btnConfirmar.addEventListener("click", async () => {
	    const itemPendente = bodyConfirme.querySelector(".componente-item:not(.status-concluido)");
	    if (itemPendente) {
	      Swal.fire("Aten√ß√£o!", "Ainda existem itens pendentes na lista.", "warning");
	      return;
	    }
	    const idMlConferido = bodyConfirme.dataset.idMlConferindo;
	    if (!idMlConferido) {
	      console.error("Erro Cr√≠tico: idMlConferindo n√£o foi encontrado no dataset do modal.");
	      return;
	    }
	    modalConfirme.hide();
	    const produtoParaEtiqueta = produtos.find(p => p.id_ml === idMlConferido);
	    if (produtoParaEtiqueta) {
	      gerarEtiqueta(produtoParaEtiqueta.sku);
	    }
	    try {
	      await iniciarEmbalagem(idMlConferido);
	      atualizarStatusProduto(idMlConferido, 0);
	    } catch (error) {
	      console.error("N√£o foi poss√≠vel iniciar o produto, a UI n√£o ser√° alterada.");
	    }
	  });
	
	  async function buscarDadosEmbalagem() {
	    if (!idAgendMl) return;
	    try {
	      const data = await fetchJSON(`/api/embalar/bipados/${idAgendMl}`);
	      data.forEach(item => atualizarStatusProduto(item.id_prod_ml, Number(item.bipados || 0)));
	    } catch (error) {
	      console.warn("Sincroniza√ß√£o falhou:", error.message || error);
	    }
	  }
	
	  function gerarEtiqueta(sku) {
	    console.log('[ LOG ] Marketplace ID:', idMktp);
	    switch (parseInt(idMktp)) {
	      case 1: // Mercado Livre
	        gerarEtiquetaMeLi(sku);
	        console.log('Mercado Livre');
	        break;
	      case 3: // Shopee
	        gerarEtiquetaShopee(sku);
	        console.log('Shopee');
	        break;
	      default:
	        gerarEtiquetaMeLi(sku); // Padr√£o para outros marketplaces (SOMENTE ENQUANTO EU N√ÉO FA√áO AS OUTRAS)
	        console.log('Qualquer outro Marketplace ainda n√£o implementado, usando padr√£o MeLi');
	        break;
	    }
	  }
	
	  function gerarEtiquetaMeLi(sku) {
	    const anuncio = produtos.find((p) => p.sku === sku);
	    if (!anuncio) return;
	
	    // POSI√á√ïES FIXAS
	    const xColunaEsquerda = 15;    // ^FO15,15
	    const xColunaDireita = 350;   // ^FO350,15
	
	    // OFFSETS PARA TEXTO DO C√ìDIGO DE BARRAS
	    const textoOffEsq = 95 - xColunaEsquerda; // 80
	    const textoOffDir = 420 - xColunaDireita;  // 70
	
	    // POSI√á√ïES (X/Y) PARA NOME E SKU
	    const nomeXLeft = 15;   // ^FO15,110
	    const skuXLeft = 15;   // ^FO15,175
	    const nomeXRight = 350;  // ^FO350,110
	    const skuXRight = 350;  // ^FO350,175
	    const nomeY = 110;
	    const skuY = 175;
	
	    // LARGURA DO BLOCO DE TEXTO
	    const nomeWidth = 280;  // ^FB280,...
	
	    let etiquetasGeradas = 0;
	    const linhasNecessarias = Math.ceil(anuncio.unidades / 2);
	    const zplAndamento = [];
	
	    for (let linha = 0; linha < linhasNecessarias; linha++) {
	      zplAndamento.push("^XA");
	      zplAndamento.push("^CI28");
	      zplAndamento.push("^LH0,0");
	
	      // Coluna esquerda
	      if (etiquetasGeradas < anuncio.unidades) {
	        zplAndamento.push(
	          `^FO${xColunaEsquerda},15^BY2,,0^BCN,54,N,N^FD${anuncio.id_ml}^FS`
	        );
	        zplAndamento.push(
	          `^FO${xColunaEsquerda + textoOffEsq},80^A0N,20,25^FH^FD${anuncio.id_ml}^FS`
	        );
	        zplAndamento.push(
	          `^FO${nomeXLeft},${nomeY}^A0N,18,18^FB${nomeWidth},3,2,L^FH^FD${anuncio.nome}^FS`
	        );
	        zplAndamento.push(
	          `^FO${skuXLeft},${skuY}^A0N,18,18^FH^FDSKU: ${anuncio.sku}^FS`
	        );
	        etiquetasGeradas++;
	      }
	
	      // Coluna direita
	      if (etiquetasGeradas < anuncio.unidades) {
	        zplAndamento.push(
	          `^FO${xColunaDireita},15^BY2,,0^BCN,54,N,N^FD${anuncio.id_ml}^FS`
	        );
	        zplAndamento.push(
	          `^FO${xColunaDireita + textoOffDir},80^A0N,20,25^FH^FD${anuncio.id_ml}^FS`
	        );
	        zplAndamento.push(
	          `^FO${nomeXRight},${nomeY}^A0N,18,18^FB${nomeWidth},3,2,L^FH^FD${anuncio.nome}^FS`
	        );
	        zplAndamento.push(
	          `^FO${skuXRight},${skuY}^A0N,18,18^FH^FDSKU: ${anuncio.sku}^FS`
	        );
	        etiquetasGeradas++;
	      }
	
	      zplAndamento.push("^XZ");
	    }
	
	    const zpl = zplAndamento.join("\n");
	    console.log(zpl);
	    imprimirEtiqueta(zpl, "id");
	  }
	
	  function gerarEtiquetaShopee(sku) {
	    const anuncio = produtos.find((p) => p.sku === sku);
	    if (!anuncio) return;
	
	    const nomeAnuncio = anuncio.nome;
	    const etiqueta = anuncio.id_ml;
	
	    console.log("LOG: Gerando etiqueta Shopee para o SKU:", sku, anuncio);
	
	    const zplConstructor = []; // Array para armazenar as etiquetas (cada √≠ndice ser√° separado por quebra de linha "\n")
	
	    console.log('anuncio:', anuncio);
	    console.log('Quantidade:', anuncio.unidades);
	
	    for (let i = 0; i < anuncio.unidades; i++) {
	      zplConstructor.push("^XA");
	      zplConstructor.push("^CI28");
	
	      zplConstructor.push("^FO15,10");
	      zplConstructor.push("^A0N,20,20");
	      zplConstructor.push("^FB450,3,0,C,0");
	      zplConstructor.push(`^FD${nomeAnuncio}^FS`);
	
	      zplConstructor.push("^FO165,70");
	      zplConstructor.push("^BQN,2,7");
	      zplConstructor.push(`^FDLA,${etiqueta}^FS`);
	
	      zplConstructor.push("^FO80,250");
	      zplConstructor.push("^A0N,20,20");
	      zplConstructor.push("^FB450,1,0,L,0");
	      zplConstructor.push(`^FDbarcode:${etiqueta}^FS`);
	
	      zplConstructor.push("^FO80,280");
	      zplConstructor.push("^A0N,20,20");
	      zplConstructor.push("^FB450,1,0,L,0");
	      zplConstructor.push(`^FDwhs skuid:${etiqueta}^FS`);
	
	      zplConstructor.push("^XZ");
	    }
	
	    const zpl = zplConstructor.join("\n");
	    console.log(zpl);
	    imprimirEtiqueta(zpl, "id");
	  }
	
	  // Inicializa√ß√£o
	  inicializarPopoversDeImagem();
	  await carregarCaixasSalvas();
	  await buscarDadosEmbalagem(); // Busca inicial
	  const SYNC_MS = 2000; // em vez de 1000
	  const syncId = setInterval(buscarDadosEmbalagem, SYNC_MS);
	  window.addEventListener('beforeunload', () => clearInterval(syncId));
	
	
	  async function handleFinalizarEmbalagem(event) {
	    event.preventDefault();
	
	    const headerBar = document.querySelector('.header-bar');
	    const idAgendamento = headerBar.dataset.idBd; // Pega o ID do agendamento do header da p√°gina
	
	    // Pede confirma√ß√£o ao usu√°rio
	    const result = await Swal.fire({
	      title: 'Finalizar Embalagem?',
	      text: "O relat√≥rio ser√° gerado e o pedido movido para a Expedi√ß√£o. Deseja continuar?",
	      icon: 'question',
	      showCancelButton: true,
	      confirmButtonColor: '#28a745',
	      cancelButtonColor: '#6c757d',
	      confirmButtonText: 'Sim, finalizar!',
	      cancelButtonText: 'Cancelar'
	    });
	
	    if (!result.isConfirmed) {
	      return;
	    }
	
	    // **1) Gera uma etiqueta ZPL para cada caixa j√° fechada**
	    //    (supondo que cada objeto em `caixas` tenha `startTime` e `endTime` definidos)
	    caixas
	      .filter(cx => cx.fechada && cx.startTime && cx.endTime)
	      .forEach(cx => gerarEtiquetaCaixa(cx));
	
	    // 2) Mostra o loading
	    Swal.fire({
	      title: 'Processando...',
	      text: 'Gerando relat√≥rio e atualizando o status.',
	      allowOutsideClick: false,
	      didOpen: () => Swal.showLoading()
	    });
	
	    // 3) Envia para o backend finalizar o agendamento
	    try {
	      const response = await fetch(`/embalar/finalizar/${idAgendamento}`, {
	        method: 'POST',
	        headers: { 'Content-Type': 'application/json' }
	      });
	      const data = await response.json();
	      if (response.ok && data.success) {
	        await Swal.fire({
	          icon: 'success',
	          title: 'Sucesso!',
	          text: data.message,
	          timer: 2000,
	          timerProgressBar: true,
	        });
	        window.location.href = '/agendamentos/ver?atualizado=ok';
	      } else {
	        throw new Error(data.message || 'Ocorreu um erro no servidor.');
	      }
	    } catch (error) {
	      Swal.fire({
	        icon: 'error',
	        title: 'Erro',
	        text: `Falha ao finalizar a embalagem: ${error.message}`,
	      });
	    }
	  }
	  // Sincroniza a cada 1 segundos
	
	  function funcoesDisponiveis() {
	    console.log('======= IDENTIFICA√á√ÉO =======');
	    console.log('gerarEtiquetaShopee(\"sku\");');
	    console.log('gerarEtiquetaMeLi(\"sku\");\n\n');
	
	
	    console.log('=========== VOLUME ===========');
	    console.log('Etiqueta Mercado Livre');
	    console.log('gerarEtiquetaCustom(\"nCaixa\");');
	    console.log('gerarEtiquetaCustom(caixas[0]); // passe o OBJETO da caixa\n\n');
	
	    console.log('Etiqueta Ja√∫ Pesca');
	    console.log('gerarEtiquetaCaixa(\"nCaixa\");');
	    console.log('gerarEtiquetaCaixa(caixas[0]); // passe o OBJETO da caixa\n');
	  }
	
	  // üëâ Expor no console:
	  window.gerarEtiquetaShopee = gerarEtiquetaShopee;
	  window.funcoesDisponiveis = funcoesDisponiveis;
	  window.gerarEtiquetaMeLi = gerarEtiquetaMeLi;
	  window.gerarEtiquetaCustom = gerarEtiquetaCustom; // ML
	  window.gerarEtiquetaCaixa = gerarEtiquetaCaixa; // JP
	  inicializarModalFecharCaixa();
	});
	
	

[static/agendamentos]
agendamentos.css=body {
	    background-color: #e9f1fb;
	}
	
	.status-limpeza {
	    background-color: #4da6ff;
	    color: white;
	}
	
	/* .status-separacao {
	    background-color: #b266ff;
	    color: white;
	} */
	
	.status-finalizado {
	    background-color: #6c757d;  /* cinza */
	    color: white;
	}
	
	.status-conferencia {
	    background-color: #ff9933;
	    color: white;
	}
	
	.status-embalar {
	    background-color: #66cc66;
	    color: white;
	}
	
	.status-expedicao {
	    background-color: #ff6666;
	    color: white;
	}
	
	.empresa-jaupesca {
	    background-color: #1abc9c;
	    color: white;
	}
	
	.empresa-jaufishing {
	    background-color: #2c3e50;
	    color: white;
	}
	
	.empresa-ltsports {
	    background-color: #f1c40f;
	    color: #333;
	}
	
	.empresa-nenhuma {
	    background-color: #bdc3c7;
	    /* cinza claro */
	    color: #2c3e50;
	    /* azul escuro para bom contraste */
	    padding: 2px 8px;
	    border-radius: 5px;
	    font-size: 0.85rem;
	}
	
	.id_mktp-magalu {
	    background-color: #0086FF;
	    color: #FFFFFF;
	}
	
	.id_mktp-mercadolivre {
	    background-color: #FFE600;
	    color: #2B3276;
	}
	
	.id_mktp-amazon {
	    background-color: #131921;
	    color: #E3E3E4;
	}
	
	.id_mktp-shopee {
	    background-color: #FA5330;
	    color: #FFFFFF;
	}
	
	.pedido-numero {
	    color: #2c3e50;
	    font-weight: 600;
	    font-size: 16px;
	    letter-spacing: 2px;
	}
	
	.badge {
	    font-weight: 600;
	    padding: 5px 5px;
	}
	
	.hidden-class {
	    display: none;
	}
	
	/* classe para o card de novo agendamento */
	.add-new-agendamento {
	    border: 2px dashed #6c757da1;
	    background-color: #ffffff;
	    cursor: pointer;
	    transition: background-color .2s;
	}
	
	.add-new-agendamento:hover {
	    background-color: #f8f9fa;
	    border: 2px dashed #0d6efdb8;
	    /* leve clar√£o ao passar o mouse */
	}
	
	/* remove underline e for√ßa o <a> ocupar todo o card */
	.add-new-agendamento {
	    display: block;
	    color: inherit;
	}
	
	/* suaviza a anima√ß√£o de abrir/fechar o painel */
	#filterPanel.collapse {
	    transition: height 0.3s ease;
	}
	
	.list-scroll {
	    max-height: 55vh;
	    overflow-y: auto;
	}
	
	@media (max-width: 576px) {
	
	    /* modal Upload de PDF */
	    #modalUploadPdf .modal-dialog {
	        max-width: 95%;
	        /* evita que ocupe 100% da tela */
	        margin: 0.5rem;
	        /* espa√ßamento nas laterais */
	    }
	
	    #modalUploadPdf .modal-dialog {
	        max-width: 95%;
	        margin: 0.5rem;
	    }
	
	    .list-scroll {
	        max-height: 70vh;
	        font-size: 1.3rem;
	    }
	
	    .card-body>div:first-child {
	        flex-direction: column;
	        align-items: flex-start;
	        /* Alinha o texto √† esquerda */
	        margin-bottom: 1rem;
	        /* Adiciona um espa√ßo entre o texto e os bot√µes */
	    }
	
	    .card-body>div:first-child>span {
	        margin-bottom: 0.2rem;
	        /* Espa√ßamento entre cada linha de informa√ß√£o */
	    }
	
	    .card-body>div:last-child {
	        width: 100%;
	        /* Faz com que os bot√µes ocupem a largura total */
	        justify-content: center !important;
	        /* Centraliza os bot√µes */
	    }
	
	    .btn-group-sm>.btn,
	    .btn-sm {
	        padding: .25rem .5rem;
	        font-size: 1.2rem;
	        border-radius: .2rem;
	    }
	
	    .pedido-numero, .new-agend {
	        font-size: 1.3rem;
	    }
	
	}
agendamentos.js=// -----------------------------
	// Helpers de Modal (globais)
	// -----------------------------
	function showModal(id) {
	    new bootstrap.Modal(document.getElementById(id)).show();
	}
	function hideModal(id) {
	    const instance = bootstrap.Modal.getInstance(document.getElementById(id));
	    if (instance) instance.hide();
	}
	
	// #################################
	
	// Ao clicar em ‚Äú+ Novo Agendamento‚Äù
	(() => {
	    const btn = document.querySelector('.add-new-agendamento');
	    if (!btn) return;
	    btn.addEventListener('click', (e) => {
	        e.preventDefault();
	        const idFake = Math.floor(Math.random() * 100000);
	        $('#inp_id_pedido').val(idFake);
	        showModal('modalSelecionarEmpresa');
	    });
	})();
	
	// Etapa 1: Empresa ‚Üí chama Marketplace
	function abrirModalMarketplace() {
	    const empresa = $('#nome_empresa').val();
	    if (!empresa) return alert("Selecione a empresa!");
	    $('#inp_nome_emp').val(empresa);
	    hideModal('modalSelecionarEmpresa');
	    setTimeout(() => {
	        new bootstrap.Modal(document.getElementById('modalSelecionarMarketplace')).show();
	    }, 300);
	}
	
	
	// Etapa 2: Marketplace ‚Üí chama Tipo (ou Centro no Meli)
	function abrirModalAgendamento() {
	    const marketplace = $('#nome_marketplace').val();
	
	    if (!marketplace) return alert("Selecione o marketplace!");
	    $('#inp_mktp_pedido').val(marketplace);
	
	    if (marketplace !== '1') {
	        $('#inp_centro_distribuicao').val(''); // evita centro ‚Äúfantasma‚Äù
	    }
	
	    const modalMkt = bootstrap.Modal.getInstance(document.getElementById('modalSelecionarMarketplace'));
	    if (modalMkt) modalMkt.hide();
	
	    setTimeout(() => {
	        if (marketplace === '1') {
	            new bootstrap.Modal(document.getElementById('modalCentroDistribuicao')).show();
	        } else {
	            new bootstrap.Modal(document.getElementById('modalTipoAgendamento')).show();
	        }
	    }, 300);
	}
	
	function confirmarCentro() {
	    const centro = $('#nome_centro_distribuicao').val();
	    if (!centro) return alert("Selecione um centro!");
	    $('#inp_centro_distribuicao').val(centro);
	
	    const modalCentro = bootstrap.Modal.getInstance(document.getElementById('modalCentroDistribuicao'));
	    if (modalCentro) modalCentro.hide();
	
	    setTimeout(() => {
	        new bootstrap.Modal(document.getElementById('modalTipoAgendamento')).show();
	    }, 300);
	}
	
	// Etapa 3: Tipo ‚Üí chama Colaborador
	function abrirModalColaborador() {
	    const tipo = $('#nome_tipo').val();
	    if (!tipo) return alert("Selecione o tipo de agendamento!");
	    $('#inp_tipo_pedido').val(tipo);
	
	    const modalTipo = bootstrap.Modal.getInstance(document.getElementById('modalTipoAgendamento'));
	    if (modalTipo) modalTipo.hide();
	
	    setTimeout(() => {
	        new bootstrap.Modal(document.getElementById('modalNomeColaborador')).show();
	    }, 300);
	}
	
	// Continua agendamento j√° iniciado
	function continuePhase(ele) {
	    const [_, id, tipo] = ele.id.split('--');
	    window.location.href = `/retirado?id=${id}&tipo=${tipo}&mudar=True`;
	}
	// function continuePhase(ele) {
	//     const [_, id, tipo] = ele.id.split('--');
	
	//     // se for modo Embalar (tipo 4), dispara o SweetAlert2 em loading
	//     if (tipo === '4') {
	//         Swal.fire({
	//             title: 'Carregando',
	//             html: 'Aguarde, preparando a tela de embalagem.',
	//             allowOutsideClick: false,
	//             allowEscapeKey: false,
	//             didOpen: () => {
	//                 Swal.showLoading();
	//                 // redireciona imediatamente ‚Äî o usu√°rio continua vendo o modal at√© a p√°gina carregar
	//                 window.location.href = `/retirado?id=${id}&tipo=${tipo}&mudar=True`;
	//             }
	//         });
	//     } else {
	//         // fluxo padr√£o para os outros tipos
	//         window.location.href = `/retirado?id=${id}&tipo=${tipo}&mudar=True`;
	//     }
	// }
	
	// Define ID do agendamento nos modais (caso use "Come√ßar")
	function changeIdAgendamento(element) {
	    const [_, idAgend, tipo] = element.id.split('--');
	    $('#inp_id_pedido').val(idAgend);
	    $('#inp_tipo_pedido').val(tipo);
	
	    // preserva textos dos modais (se existirem no DOM)
	    const txt = `Agendamento n¬∫${idAgend}`;
	    const elEmp = document.getElementById('modal-emp-agend');
	    const elCol = document.getElementById('modal-col-agend');
	    if (elEmp) elEmp.textContent = txt;
	    if (elCol) elCol.textContent = txt;
	}
	
	// Filtro visual da tabela de agendamentos (vers√£o nova, sem helpers)
	function setFiltros() {
	    const cards = document.querySelectorAll('.agendamento-container');
	
	    // limpa qualquer filtro anterior
	    cards.forEach(card => card.classList.remove('hidden-class'));
	
	    const emp = $('#inp_emp_pedido').val();
	    const status = $('#inp_status_pedido').val();
	    const mktp = $('#inp_mktp_pedido').val();
	    const num = ($('#inp_num_pedido').val() || '').trim();
	
	    cards.forEach(card => {
	        const classes = card.classList;
	
	        // s√≥ filtra quem tem metadados de classe esperados
	        const isFilterable = [...classes].some(c =>
	            c.startsWith('emp-') || c.startsWith('tipo-') || c.startsWith('id_mktp-') || c.startsWith('id-')
	        );
	        if (!isFilterable) return; // ignora placeholders
	
	        if (emp !== 'Todas' && !classes.contains(`emp-${emp}`)) {
	            return card.classList.add('hidden-class');
	        }
	        if (status !== 'Todos' && !classes.contains(`tipo-${status}`)) {
	            return card.classList.add('hidden-class');
	        }
	        if (mktp !== 'Todas' && !classes.contains(`id_mktp-${mktp}`)) {
	            return card.classList.add('hidden-class');
	        }
	        if (num) {
	            const textoPedido = card.querySelector('.pedido-numero')?.textContent.trim() || '';
	            if (!textoPedido.includes(num)) {
	                return card.classList.add('hidden-class');
	            }
	        }
	    });
	}
	
	// Upload (PDF/Excel)
	function abrirModalUpload() {
	    const colaborador = $('#nome_colaborador').val();
	
	    // l√™ do <select> com fallback para os hiddens (fluxo por bot√µes)
	    const empresa = $('#nome_empresa').val() || $('#inp_nome_emp').val();
	    const marketplace = $('#nome_marketplace').val() || $('#inp_mktp_pedido').val();
	    const tipo = $('#nome_tipo').val() || $('#inp_tipo_pedido').val();
	
	    // s√≥ grava centro se for Meli; caso contr√°rio, zera
	    const centro = (String(marketplace) === '1') ? ($('#nome_centro_distribuicao').val() || '') : '';
	    $('#inp_centro_distribuicao').val(centro);
	
	    const form = $('#form_upload_pdf');
	    const fileInput = form.find('input[type="file"]');
	    const btn = form.find('button[type="submit"]');
	    const label = $('#modalUploadPdfLabel');
	    const helpText = $('#upload_help_text');
	
	    if (marketplace === '2' || marketplace === '3') {
	        form.attr('action', '/upload-excel');
	        fileInput.attr({ name: 'file', accept: '.xlsx,.xls,.csv' });
	        btn.text('Enviar Excel');
	        label.text('Upload do Excel');
	        helpText.text('Selecione o arquivo Excel (.xlsx) do pedido:');
	    } else {
	        form.attr('action', '/upload-pdf');
	        fileInput.attr({ name: 'path', accept: 'application/pdf' });
	        btn.text('Enviar PDF');
	        label.text('Upload do PDF');
	        helpText.text('Selecione o arquivo PDF do pedido:');
	    }
	
	    $('#upload_colaborador').val(colaborador);
	    $('#upload_empresa').val(empresa);
	    $('#upload_marketplace').val(marketplace);
	    $('#upload_tipo').val(tipo);
	
	    const modalTipo = bootstrap.Modal.getInstance(document.getElementById('modalTipoAgendamento'));
	    if (modalTipo) modalTipo.hide();
	
	    setTimeout(() => {
	        new bootstrap.Modal(document.getElementById('modalUploadPdf')).show();
	    }, 300);
	}
	
	
	// Loader no submit do upload (com guard)
	(() => {
	    const form = document.getElementById("form_upload_pdf");
	    if (!form) return;
	    form.addEventListener("submit", function (e) {
	        const fileInput = this.querySelector('input[type="file"]');
	        if (!fileInput || !fileInput.files || fileInput.files.length === 0) {
	            // sem arquivo: deixe o browser validar/avisar; n√£o abre o loader
	            return;
	        }
	        const isExcel = this.action.includes("/upload-excel");
	        Swal.fire({
	            title: isExcel ? "Enviando Excel..." : "Enviando PDF...",
	            text: "Aguarde o processamento.",
	            allowOutsideClick: false,
	            allowEscapeKey: false,
	            didOpen: () => { Swal.showLoading(); },
	        });
	    });
	})();
	
	
	// P√≥s-redirect (mensagens)
	window.addEventListener("load", () => {
	    const urlParams = new URLSearchParams(window.location.search);
	    const upload = urlParams.get("upload");
	    const erro = urlParams.get("erro");
	    const pedido = urlParams.get("pedido");
	
	    if (Swal.isVisible()) Swal.close();
	
	    const clearQS = () => window.history.replaceState({}, document.title, window.location.pathname);
	
	    if (upload === "ok_excel") {
	        Swal.fire({ icon: 'success', title: 'Excel processado!', text: 'O agendamento foi criado com sucesso.', confirmButtonText: 'OK' })
	            .then(clearQS);
	        return;
	    }
	    if (upload === "ok_pdf") {
	        Swal.fire({ icon: 'success', title: 'PDF processado!', text: 'O agendamento foi criado com sucesso.', confirmButtonText: 'OK' })
	            .then(clearQS);
	        return;
	    }
	    if (urlParams.get("alterado") === "ok") {
	        Swal.fire({ icon: 'success', title: 'Altera√ß√µes salvas!', text: 'O agendamento foi atualizado com sucesso.', confirmButtonText: 'OK' })
	            .then(clearQS);
	        return;
	    }
	    if (upload === "fail" && erro === "duplicado") {
	        Swal.fire({ icon: 'warning', title: 'Pedido j√° existente', text: `J√° existe um agendamento com o n√∫mero ${pedido}.`, confirmButtonText: 'OK' })
	            .then(clearQS);
	        return;
	    }
	    if (upload === "fail") {
	        Swal.fire({ icon: 'error', title: 'Erro', text: 'Ocorreu um erro ao processar o pedido. Por favor, tente novamente.', confirmButtonText: 'OK' })
	            .then(clearQS);
	        return;
	    }
	});
	
	// -----------------------------
	// Sele√ß√£o r√°pida (compatibilidade)
	// -----------------------------
	function setMarketplace(idMktp) {
	    $('#inp_mktp_pedido').val(idMktp);
	    if (String(idMktp) !== '1') {
	        $('#inp_centro_distribuicao').val('');
	    }
	    hideModal('modalSelecionarMarketplace');
	    setTimeout(() => {
	        if (String(idMktp) === '1') {
	            showModal('modalCentroDistribuicao');
	        } else {
	            showModal('modalTipoAgendamento');
	        }
	    }, 300);
	}
	
	function setTipoAgendamento(idTipo) {
	    $('#inp_tipo_pedido').val(idTipo);
	    hideModal('modalTipoAgendamento');
	    setTimeout(() => showModal('modalNomeColaborador'), 300);
	}
	
	// -----------------------------
	// Modais diversos
	// -----------------------------
	function abrirModalAlteracoes(id) {
	    const modal = new bootstrap.Modal(document.getElementById('modalEditarAgendamento'));
	    const content = $('#editarAgendamentoContent');
	    content.html('<p>Carregando...</p>');
	    $.get(`/alterar-agendamento?id=${id}&modal=true`, function (data) {
	        content.html(data);
	        modal.show();
	    }).fail(() => {
	        content.html('<div class="alert alert-danger">Erro ao carregar o conte√∫do.</div>');
	    });
	}
	
	function abrirModalAtualizarPDF(id_bd, id_agend_ml) {
	    const form = document.getElementById('form_upload_pdf');
	    const modal = new bootstrap.Modal(document.getElementById('modalUploadPdf'));
	    const modalLabel = document.getElementById('modalUploadPdfLabel');
	    const infoParaUsuario = document.getElementById('info-atualizacao-pdf');
	
	    form.action = '/upload-pdf';
	    if (!document.getElementById('upload_id_bd')) {
	        const hiddenInput = document.createElement('input');
	        hiddenInput.type = 'hidden';
	        hiddenInput.name = 'id_bd';
	        hiddenInput.id = 'upload_id_bd';
	        form.appendChild(hiddenInput);
	    }
	    document.getElementById('upload_id_bd').value = id_bd;
	
	    const botao = document.getElementById(`btn-modal--${id_bd}--`);
	    const card = botao.closest('.agendamento-container');
	
	    const getClassValue = (prefix) => {
	        const cls = [...card.classList].find(c => c.startsWith(prefix));
	        return cls ? cls.replace(prefix, '') : '';
	    };
	
	    const centroDistribuicao = card.dataset.centro || '';
	
	    document.getElementById('upload_colaborador').value = card.querySelector('.text-primary')?.innerText || '';
	    document.getElementById('upload_empresa').value = getClassValue('emp-');
	    document.getElementById('upload_marketplace').value = getClassValue('id_mktp-');
	    document.getElementById('upload_tipo').value = getClassValue('tipo-');
	    document.getElementById('inp_centro_distribuicao').value = centroDistribuicao;
	
	    modalLabel.textContent = 'Atualizar PDF do Pedido';
	    infoParaUsuario.innerHTML = `Atualizando o agendamento do pedido: <strong>${id_agend_ml}</strong>`;
	    infoParaUsuario.style.display = 'block';
	
	    modal.show();
	}
	
	function iniciarExclusao(idAgendamento) {
	    Swal.fire({
	        title: 'Voc√™ tem certeza?',
	        text: "Esta a√ß√£o n√£o pode ser revertida! Todos os produtos e dados associados a este agendamento ser√£o permanentemente exclu√≠dos.",
	        icon: 'warning',
	        showCancelButton: true,
	        confirmButtonColor: '#d33',
	        cancelButtonColor: '#3085d6',
	        confirmButtonText: 'Sim, excluir!',
	        cancelButtonText: 'Cancelar'
	    }).then((result) => {
	        if (!result.isConfirmed) return;
	
	        Swal.fire({
	            title: 'Excluindo...',
	            text: 'Por favor, aguarde.',
	            allowOutsideClick: false,
	            didOpen: () => { Swal.showLoading(); }
	        });
	
	        fetch(`/agendamento/excluir/${idAgendamento}`, { method: 'DELETE' })
	            .then(response => response.json())
	            .then(data => {
	                if (data.success) {
	                    Swal.fire('Exclu√≠do!', 'O agendamento foi exclu√≠do com sucesso.', 'success');
	                    const card = document.querySelector(`.agendamento-container.id-${idAgendamento}`);
	                    if (card) {
	                        card.style.transition = 'opacity 0.5s ease';
	                        card.style.opacity = '0';
	                        setTimeout(() => { card.remove(); location.reload(); }, 300);
	                    } else {
	                        location.reload();
	                    }
	                } else {
	                    Swal.fire('Erro!', 'N√£o foi poss√≠vel excluir o agendamento. ' + (data.message || ''), 'error');
	                }
	            })
	            .catch(() => Swal.fire('Erro de Rede!', 'N√£o foi poss√≠vel se comunicar com o servidor.', 'error'));
	    });
	}
	
	
	function abrirModalRelatorio(idAgendamentoML) {
	    const modalElement = document.getElementById('modalVerRelatorio');
	    const modal = new bootstrap.Modal(modalElement);
	    const conteudoDiv = document.getElementById('conteudo-relatorio');
	
	    conteudoDiv.innerHTML = `
	    <div class="d-flex justify-content-center align-items-center">
	      <div class="spinner-border text-primary" role="status">
	        <span class="visually-hidden">Loading...</span>
	      </div>
	      <span class="ms-3">Carregando relat√≥rio...</span>
	    </div>`;
	    modal.show();
	
	    fetch(`/relatorio/${idAgendamentoML}`)
	        .then(response => {
	            if (!response.ok) throw new Error('Erro de rede ao buscar o relat√≥rio.');
	            return response.text();
	        })
	        .then(html => { conteudoDiv.innerHTML = html; })
	        .catch(() => {
	            conteudoDiv.innerHTML = '<div class="alert alert-danger">N√£o foi poss√≠vel carregar o relat√≥rio. Tente novamente mais tarde.</div>';
	        });
	}

[static/resources]
caixa.png=<ARQUIVO MUITO GRANDE: 1171.39 KB>
caixa2.png=<ARQUIVO MUITO GRANDE: 1152.64 KB>
caixa_jp.png=<ARQUIVO MUITO GRANDE: 1076.79 KB>
caixa_ml.png=<ARQUIVO MUITO GRANDE: 1183.47 KB>
logo.png=<ARQUIVO BIN√ÅRIO>
sem_img.webp=<ARQUIVO BIN√ÅRIO>
seta_baixo.png=<ARQUIVO BIN√ÅRIO>
wallpaper_jaupesca.svg=<svg width="726" height="267" viewBox="0 0 726 267" fill="none" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink">
	<rect width="726" height="267" fill="url(#pattern0_2_7)"/>
	<defs>
	<pattern id="pattern0_2_7" patternContentUnits="objectBoundingBox" width="1" height="1">
	<use xlink:href="#image0_2_7" transform="scale(0.00137741 0.00374532)"/>
	</pattern>
	<image id="image0_2_7" width="726" height="267" preserveAspectRatio="none" xlink:href="data:image/png;base64,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"/>
	</defs>
	</svg>
	

[static/homepage]
homepage.css=body{
	    background-color: white;
	}
homepage.js=

[static/limpeza]
limpeza.css=body {
	    background-color: #e9f1fb;
	}
	
	.display-hidden {
	    display: none;
	}
	
	a {
	    text-decoration: underline;
	    color: black;
	}
	
	.rotated {
	    transform: rotate(180deg);
	}
	
	.header-bar {
	    background-color: #007bff;
	    color: white;
	    padding: 10px;
	    font-weight: bold;
	    border-radius: 4px 4px 0 0;
	    margin-bottom: 10px;
	}
limpeza.js=document.addEventListener('DOMContentLoaded', () => {
	    const detalhes = document.getElementById('detalhesAgendamento');
	    const coll = bootstrap.Collapse.getOrCreateInstance(detalhes, { toggle: false });
	    const toggleBtn = document.getElementById('btnToggleDetalhes');
	    const icon = toggleBtn.querySelector('i');
	
	    function ajustarCollapse() {
	        if (window.innerWidth < 768) {
	            coll.hide();
	        } else {
	            coll.show();
	        }
	    }
	
	    // **Aqui**: troca o √≠cone ao abrir
	    detalhes.addEventListener('show.bs.collapse', () => {
	        icon.classList.replace('bi-chevron-down', 'bi-chevron-up');
	        toggleBtn.setAttribute('aria-expanded', 'true');
	    });
	
	    // **E aqui** ao fechar
	    detalhes.addEventListener('hide.bs.collapse', () => {
	        icon.classList.replace('bi-chevron-up', 'bi-chevron-down');
	        toggleBtn.setAttribute('aria-expanded', 'false');
	    });
	
	    window.addEventListener('resize', ajustarCollapse);
	    ajustarCollapse();
	});
	
	
	
	function getEleToCorrection(ele) {
	    let id_prod = parseInt(ele.id.split('btn-corr-')[1]) - 1
	    let checked_values_alt = []
	    let checked_values_com = []
	    let id_agend_bd = parseInt(dados['id_bd'])
	    let id_prod_bd = dados['produtos'][parseInt(id_prod)]['id_bd']
	
	    Array.from($('.corr-' + id_prod.toString())).forEach(x => {
	        if (x.checked && x.classList.contains('alterar')) {
	            checked_values_alt.push(
	                dados['produtos'][parseInt(id_prod)]['composicao'][x.id.split('-')[3]]);
	        }
	    })
	    if (checked_values_alt.length == 0) {
	        console.log("Nenhum item de composi√ß√£o selecionado!");
	    } else {
	        console.log(checked_values_alt);
	    }
	
	    Array.from($('.corr-' + id_prod.toString())).forEach(x => {
	        if (x.checked && x.classList.contains('comprar')) {
	            checked_values_com.push(
	                dados['produtos'][parseInt(id_prod)]['composicao'][x.id.split('-')[3]]);
	        }
	    })
	    if (checked_values_com.length == 0) {
	        console.log("Nenhum item de composi√ß√£o selecionado!");
	    } else {
	        console.log(checked_values_com);
	    }
	
	    post_alterar_data = { 'id_agend': id_agend_bd, 'id_prod': id_prod_bd, 'itens': checked_values_alt }
	    post_comprar_data = { 'id_agend': id_agend_bd, 'id_prod': id_prod_bd, 'itens': checked_values_com }
	
	    console.log("Dados para altera√ß√£o: ")
	    console.log(post_alterar_data)
	    console.log("Dados para compra: ")
	    console.log(post_comprar_data)
	
	    if (post_alterar_data['itens'].lenght > 0) {
	        makeFetchForCorrection(post_alterar_data, 'alterar')
	    }
	    if (post_comprar_data['itens'].length > 0) {
	        makeFetchForCorrection(post_comprar_data, 'comprar')
	    }
	}
	
	function makeFetchForCorrection(post_data, url_path) {
	    url = 'https://agendamento.jaupesca.com.br/alteracoes/' + url_path  //TODO - Localiza√ß√£o do endere√ßo
	    fetch(url, {
	        mode: 'cors',
	        headers: {
	            'Content-Type': 'application/json',
	            'Access-Control-Allow-Origin': '*'
	        },
	        method: 'POST',
	        body: JSON.stringify(post_data)
	    }).then((response) => {
	        if (response.ok) {
	            console.log("Fetch foi feito");
	        } else {
	            throw Error('Erro');
	        }
	    }).catch(function (error) {
	        console.log(error)
	    })
	}
	
	function activateBtn(ele) {
	    let class_name = Array.from(ele.classList)[1];
	    let id = parseInt(class_name.split('corr-')[1]) + 1;
	    if (Array.from($('.' + Array.from(ele.classList)[0])).some(x => x.checked)) {
	        $('#btn-corr-' + id.toString()).prop('disabled', false);
	    } else {
	        $('#btn-corr-' + id.toString()).prop('disabled', true);
	    }
	}
	
	function showTable(ele) {
	    $('#table-' + parseInt(ele.id.split('show-more-arrow-')[1])).toggleClass('display-hidden');
	    $(ele).toggleClass('rotated')
	}
	
	function makeTables() {
	    Array.from($('.table-comp')).forEach((ele, index) => {
	        ele.innerHTML = `
	            <table class="table table-light table-striped">
	                <thead>
	                    <tr>
	                        <th>Nome</th>
	                        <th>SKU</th>
	                        <th>ID Tiny</th>
	                        <th>GTIN</th>
	                        <th>Un./kit</th>
	                        <th>Total un.</th>
	                        <th>Estoque</th>
	                        <th>A√ß√µes</th>
	                    </tr>
	                </thead>
	                <tbody>
	                    ${tableBodyData(index)}
	                </tbody>
	            </table>
	        `
	    });
	}
	
	function tableBodyData(index) {
	    let tableBody = '';
	    dados['produtos'][index].composicao.forEach((x, index_comp) => {
	        console.log(x.nome, x.sku, x.localizacao)
	        let ele_class = '';
	        if (x.estoque_error_flag == 'green') {
	            ele_class = 'success';
	        } else if (x.estoque_error_flag == 'yellow') {
	            ele_class = 'warning';
	        } else {
	            ele_class = 'danger';
	        }
	        tableBody += `
	            <tr class='table-${ele_class}'>
	                <td><a href="https://erp.tiny.com.br/produtos#edit/${x.id_tiny}" target="_blank">${x.nome}</a></td>
	                <td>${x.sku}</td>
	                <td>${x.id_tiny}</td>
	                <td>${x.gtin}</td>
	                <td>${x.unidades_por_kit}</td>
	                <td>${x.unidades_totais}</td>
	                <td>${x.estoque_tiny}</td>
	                <td>
	                    <div class="form-check">
	                        <input id='enviar-corr-${index}-${index_comp}' class='form-check-input corr-${index} alterar' type='checkbox' onchange='activateBtn(this)'>
	                        <label class='form-check-label' for='enviar-corr-${index}-${index_comp}'>Alterar</label>
	                    </div>
	                    <div class="form-check">
	                        <input id='enviar-comp-${index}-${index_comp}' class='form-check-input corr-${index} comprar' type='checkbox' onchange='activateBtn(this)'>
	                        <label class='form-check-label' for='enviar-comp-${index}-${index_comp}'>Comprar</label>
	                    </div>
	                </td>
	            </tr>
	        `
	    })
	
	    return tableBody;
	}
	
	makeTables()
	
	function altBtn(x) {
	    var win = window.open(`https://erp.tiny.com.br/produtos#edit/${dados['produtos'][x.id.split('btn-alt-')[1] - 1].id_tiny}`)
	    if (win) {
	        win.focus();
	    } else {
	        alert('Por favor, habilite popups nesse p√°gina!');
	    }
	    Swal.fire({
	        template: "#my-template"
	    }).then(alert => {
	        if (alert.isConfirmed) {
	            console.log('CONFIRMADO');
	            console.log(alert);
	            window.open(window.origin + `/atualizar?prod_id=${dados['produtos'][x.id.split('btn-alt-')[1] - 1].id_bd}&id=${agend_id}&tipo=${agend_tipo}`, '_self')
	        } else if (alert.isDenied) {
	            console.log('NEGADO');
	            console.log(alert);
	        } else if (alert.isDismissed) {
	            console.log('CANCELADO');
	            console.log(alert);
	        }
	    }
	    )
	}

[static/novoAgendamento]
novoAgend.css=.btn-outline-primary {
	    background-color: #0d6efd !important;
	    border-color: #0d6efd !important;
	    color: #fff !important;
	    transition: color .2s ease, background-color .2s ease;
	}
	
	.btn-outline-primary:hover,
	.btn-outline-primary:focus {
	    background-color: transparent !important;
	    color: #0d6efd !important;
	    text-decoration: none;
	}

[static/alteracoes]
alteracoes.css=body {
	    font-weight: 500;
	}
	
	/* Card Wrapper */
	.card {
	    border: none;
	    border-radius: 0.5rem;
	}
	
	.card-body {
	    padding: 0;
	}
	
	/* Table Base Styles */
	.table {
	    font-size: 0.95rem;
	    margin-bottom: 0;
	}
	
	.table-responsive {
	    overflow-x: auto;
	    /* permite scroll lateral sempre que necess√°rio */
	    border-radius: 0.5rem;
	}
	
	.table-responsive table {
	    border-collapse: separate;
	    border-radius: 0.5rem 0.5rem 0 0;
	}
	
	/* Header: blue background + white text */
	.table thead {
	    background-color: #007bff;
	}
	
	.table thead th {
	    color: #fff;
	    border: none;
	    font-weight: 600;
	    padding: 0.75rem 1rem;
	}
	
	/* Zebra stripes & hover */
	.table tbody tr:nth-child(even) {
	    background-color: #fbfcfd;
	}
	
	.table tbody tr:hover {
	    background-color: #f1f5f9;
	}
	
	.table td,
	.table th {
	    padding: 0.75rem 1rem;
	    vertical-align: middle;
	}
	
	/* ‚ÄúAbrir no Tiny‚Äù link */
	.tiny-link {
	    color: #4da6ff;
	    text-decoration: none;
	    font-weight: 500;
	    display: inline-flex;
	    align-items: center;
	}
	
	.tiny-link i {
	    margin-right: 4px;
	    font-size: 1em;
	}
	
	.tiny-link:hover {
	    text-decoration: underline;
	    color: #4091e8;
	}
	
	/* REMOVIDO: bloco @media que transformava em cards no mobile */
	
	/* Garante que a tabela permita cantos arredondados */
	.table-responsive table {
	    border-collapse: separate;
	    border-spacing: 0;
	}
	
	/* Aplica raio apenas nos cantos superiores */
	.table thead th:first-child {
	    border-top-left-radius: 0.5rem;
	}
	
	.table thead th:last-child {
	    border-top-right-radius: 0.5rem;
	}
	
	/* Para que o wrapper "corte" corretamente os cantos da tabela */
	.table-responsive {
	    overflow: hidden;
	    border-radius: 0.5rem;
	}
	
	@media (max-width: 768px) {
	    .table thead {
	        display: none;
	        /* esconde os headers */
	    }
	
	    .table tbody,
	    .table tr,
	    .table td {
	        display: block;
	        width: 100%;
	    }
	
	    .table tr {
	        margin-bottom: 1rem;
	        background: #fff;
	        border-radius: 0.5rem;
	        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
	        padding: 0.75rem;
	    }
	
	    .table td {
	        padding: 0.5rem 1rem;
	        border: none;
	        text-align: left;
	        position: relative;
	    }
	
	    .table td::before {
	        content: attr(data-label);
	        position: absolute;
	        left: 1rem;
	        top: 0.5rem;
	        font-weight: bold;
	        color: #6c757d;
	        font-size: 0.85rem;
	        color: #0D6EFD;
	    }
	
	    .table td {
	        padding-left: 7rem;
	        /* espa√ßo para o label */
	    }
	}
alteracoes.js=

[static/retiradoEstoque]
retiradoEstoque.css=/* ===== Core ===== */
	body {
	  background-color: #e9f1fb;
	}
	
	.titulo-vermelho {
	  color: #e63946 !important;
	}
	
	.produto-item,
	.produto-item-modal {
	  background-color: #f8f9fa;
	  border: 1px solid #ccc;
	  padding: 10px;
	  margin-bottom: 6px;
	  border-radius: 4px;
	  font-size: 0.95rem;
	}
	
	.header-bar {
	  background-color: #007bff;
	  color: white;
	  padding: 10px;
	  font-weight: bold;
	  border-radius: 4px 4px 0 0;
	  margin-bottom: 10px;
	}
	
	.info-box {
	  background-color: #f8f9fa;
	  border: 1px solid #ccc;
	  padding: 10px;
	  border-radius: 4px;
	  font-size: 0.9rem;
	}
	
	.input-equivalente-off {
	  display: none;
	}
	
	/* ===== Toasts ===== */
	.toast-container {
	  position: fixed;
	  inset: auto 16px 16px auto;
	  /* bottom-right */
	  display: flex;
	  flex-direction: column;
	  align-items: flex-end;
	  gap: 10px;
	  z-index: 9999;
	  pointer-events: none;
	  /* s√≥ o toast recebe clique */
	}
	
	.toast {
	  pointer-events: auto;
	  background: #fff;
	  color: #0f172a;
	  border: 1px solid #e5e7eb;
	  border-left: 6px solid var(--accent, #3b82f6);
	  border-radius: 12px;
	  box-shadow: 0 10px 30px rgba(2, 6, 23, 0.15);
	  padding: 12px 14px;
	  max-width: min(420px, calc(100vw - 40px));
	  width: fit-content;
	  font: 14px/1.4 system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial, "Noto Sans", "Apple Color Emoji", "Segoe UI Emoji";
	  position: relative;
	  overflow: hidden;
	}
	
	.toast--info {
	  --accent: #3b82f6;
	}
	
	/* azul */
	.toast--success {
	  --accent: #16a34a;
	}
	
	/* verde */
	.toast--warning {
	  --accent: #f59e0b;
	}
	
	/* amarelo */
	.toast--error {
	  --accent: #ef4444;
	}
	
	/* vermelho */
	
	.toast__message {
	  white-space: pre-wrap;
	  /* mant√©m \n */
	  word-wrap: break-word;
	}
	
	.toast__close {
	  position: absolute;
	  top: 6px;
	  right: 8px;
	  border: 0;
	  background: transparent;
	  font-size: 16px;
	  line-height: 1;
	  color: #64748b;
	  cursor: pointer;
	  padding: 4px;
	  border-radius: 6px;
	}
	
	.toast__close:hover {
	  background: rgba(100, 116, 139, .1);
	}
	
	/* barra de progresso reversa (100% -> 0%) */
	.toast__progress {
	  position: absolute;
	  left: 0;
	  right: 0;
	  bottom: 0;
	  height: 3px;
	  background: var(--accent, #3b82f6);
	  transform-origin: left;
	  animation: toastShrink var(--dur, 2s) linear forwards;
	}
	
	@keyframes toastShrink {
	  from {
	    transform: scaleX(1);
	  }
	
	  to {
	    transform: scaleX(0);
	  }
	}
	
	/* Dark mode autom√°tico */
	@media (prefers-color-scheme: dark) {
	  .toast {
	    background: #0b1020;
	    color: #e5e7eb;
	    border-color: #1f2937;
	    box-shadow: 0 10px 30px rgba(0, 0, 0, .35);
	  }
	
	  .toast__close {
	    color: #94a3b8;
	  }
	
	  .toast__close:hover {
	    background: rgba(148, 163, 184, .12);
	  }
	}
	
	/* ===== Modal custom (n√£o-Bootstrap) ===== */
	/* Overlay */
	.modal {
	  display: none;
	  /* come√ßa escondido */
	  position: fixed;
	  inset: 0;
	  /* top/right/bottom/left: 0 */
	  background: rgba(0, 0, 0, .5);
	  z-index: 10000;
	  /* acima de tudo */
	  overflow: hidden;
	}
	
	/* Caixa */
	.modal-content {
	  background: #fff;
	  color: #000;
	  /* garante contraste */
	  margin: 8% auto;
	  /* centraliza */
	  padding: 20px;
	  border-radius: 8px;
	  width: 90%;
	  height: 70%;
	  max-width: 1000px;
	  max-height: 700px;
	  box-shadow: 0 10px 30px rgba(0, 0, 0, .3);
	}
	
	.close {
	  float: right;
	  cursor: pointer;
	  font-size: 24px;
	}
	
	.close:hover {
	  opacity: .7;
	}
	
	/* Grid interno: coluna info (esq) + lista (dir) */
	.modal-grid {
	  display: grid;
	  grid-template-columns: 420px 1fr;
	  gap: 20px;
	}
	
	/* Coluna direita com rolagem vertical quando exceder */
	.produtos-scroll {
	  max-height: 600px;
	  /* mesmo alto do painel esquerdo */
	  overflow-y: auto;
	  padding-right: 6px;
	  /* respiro para a barra */
	}
	
	/* Badge simples (se n√£o estiver usando Bootstrap) */
	.badge {
	  display: inline-block;
	  padding: 2px 8px;
	  border-radius: 999px;
	  background: #e5e7eb;
	  color: #111827;
	  font-size: 0.8rem;
	  vertical-align: middle;
	}
	
	/* Rodap√© do modal com bot√£o fixo/vis√≠vel */
	.modal-actions {
	  position: sticky;
	  bottom: 0;
	  margin: 16px -20px -20px;
	  /* encosta nas bordas do modal-content */
	  padding: 12px 50px;
	  background: linear-gradient(#ffffffcc, #ffffff);
	  /* leve destaque */
	  border-top: 1px solid #e5e7eb;
	  display: flex;
	  gap: 12px;
	  justify-content: flex-end;
	  align-items: center;
	  z-index: 1;
	}
	
	/* ===== Bot√µes b√°sicos (se n√£o estiver usando Bootstrap) ===== */
	.btn {
	  appearance: none;
	  border: 1px solid transparent;
	  border-radius: 8px;
	  padding: 5px 14px;
	  font-weight: 600;
	  cursor: pointer;
	  transition: filter .15s ease, transform .02s ease;
	}
	
	.btn:active {
	  transform: translateY(1px);
	}
	
	.btn-primary {
	  background: #0d6efd;
	  /* azul */
	  color: #fff;
	}
	
	.btn-primary:hover {
	  filter: brightness(1.05);
	}
	
	.btn-outline {
	  background: #fff;
	  color: #111827;
	  border-color: #d1d5db;
	}
	
	.btn-outline:hover {
	  filter: brightness(0.98);
	}
	
	/* Bot√£o de lixeira (√≠cone vermelho) */
	.btn-icon {
	  display: inline-flex;
	  align-items: center;
	  justify-content: center;
	  width: 34px;
	  height: 34px;
	  border-radius: 8px;
	  border: 1px solid #fecaca;
	  background: #fff;
	  color: #ef4444;
	  /* vermelho */
	  cursor: pointer;
	}
	
	.btn-icon:hover {
	  background: #fff1f1;
	}
	
	/* ===== Layout dos cards do modal ===== */
	.produto-item-modal {
	  position: relative;
	}
	
	/* Linha de controles do card */
	.produto-item-modal .controls {
	  display: flex;
	  align-items: center;
	  gap: 8px;
	}
	
	/* Conjunto lixeira + texto, ancorado √† direita */
	.controls .last-action-wrap {
	  display: flex;
	  align-items: center;
	  gap: 6px;
	  /* espa√ßo entre lixeira e texto */
	  margin-left: auto;
	  /* empurra o grupo para a direita */
	  font-size: 0.85rem;
	  color: #6b7280;
	  min-width: 0;
	  /* evita overflow em flex */
	}
	
	/* S√≥ o texto pode encolher/expandir, a lixeira mant√©m tamanho fixo */
	.controls .last-action-wrap .status {
	  min-width: 0;
	  white-space: nowrap;
	  /* n√£o quebra em v√°rias linhas */
	  text-overflow: ellipsis;
	  /* retic√™ncias em casos extremos */
	  overflow: hidden;
	}
	
	/* Bot√£o de lixeira (override no contexto das controls) */
	.controls .btn-icon {
	  display: flex;
	  align-items: center;
	  justify-content: center;
	  width: 34px;
	  height: 34px;
	  border-radius: 8px;
	  border: 1px solid #fecaca;
	  background: #fff;
	  color: #ef4444;
	  cursor: pointer;
	  transition: background 0.15s ease;
	}
	
	.controls .btn-icon:hover {
	  background: #fff1f1;
	}
retiradoEstoque.js=const urlParams = new URLSearchParams(window.location.search);
	const idAgend = parseInt(urlParams.get('id'), 10);
	
	let inicioTimestamp = null;
	let intervaloTempo = null;
	let tempoEstimadoSegundos = 0;
	
	const sleep = (ms) => new Promise(res => setTimeout(res, ms));
	
	document.addEventListener('DOMContentLoaded', () => {
	  // ‚îÄ‚îÄ‚îÄ Collapse responsivo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	  const detalhes = document.getElementById('detalhesRetirada');
	  const coll = bootstrap.Collapse.getOrCreateInstance(detalhes, { toggle: false });
	  const toggleBtn = document.getElementById('btnToggleRetirada');
	  const icon = toggleBtn.querySelector('i');
	  function ajustarCollapse() {
	    window.innerWidth < 768 ? coll.hide() : coll.show();
	  }
	  detalhes.addEventListener('show.bs.collapse', () => {
	    icon.classList.replace('bi-chevron-down', 'bi-chevron-up');
	  });
	  detalhes.addEventListener('hide.bs.collapse', () => {
	    icon.classList.replace('bi-chevron-up', 'bi-chevron-down');
	  });
	  window.addEventListener('resize', ajustarCollapse);
	  ajustarCollapse();
	
	  // ‚îÄ‚îÄ‚îÄ inicia polling e contador ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	  carregarProgressoServer();
	  iniciarContadorTempo();
	  setInterval(carregarProgressoServer, 20000);
	
	  // ‚îÄ‚îÄ‚îÄ atalho Enter nos inputs ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	  ['skuInput', 'quantidadeInput'].forEach(id =>
	    document.getElementById(id)
	      .addEventListener('keydown', e => { if (e.key === 'Enter') biparProduto(); })
	  );
	
	  // Aqui ele pega as informa√ß√µes que est√£o no HTML e transforma em vari√°veis us√°veis no JS
	  const raw = document.getElementById("js-data").dataset.comps;
	  const produtos = JSON.parse(raw);
	  console.log('>', produtos);
	
	  const empresaId = parseInt(document.getElementById("infoAgend").dataset.empresa, 10);
	  const empresaNome =
	    empresaId === 1 ? "Ja√∫ Pesca" :
	      empresaId === 2 ? "Ja√∫ Fishing" :
	        empresaId === 3 ? "L.T. Sports" :
	          "Nenhuma";
	
	  const numeroAgendamento = document.getElementById("infoAgend").dataset.agendamento;
	  const nomeColaborador = document.getElementById("infoAgend").dataset.colaborador;
	  const marketplaceAgendamento = document.getElementById("infoAgend").dataset.marketplace;
	
	  // Testa as vari√°veis
	  console.log('Empresa>', empresaNome);
	  console.log('N¬∫ Agendamento>', numeroAgendamento);
	  console.log('Colaborador>', nomeColaborador);
	  console.log('Marketplace>', marketplaceAgendamento);
	
	  console.log('Produtos>', produtos);
	
	  let obj = [];
	
	  //! ISSO AQUI N√ÉO PODE SER DELETADO, ELE DETERMINA OS PRODUTOS QUE SER√ÉO USADOS NA TRANSFER√äNCIA DE ESTOQUE
	  //? No caso ele usa TODOS os produtos (por isso s√≥ funciona quando o agendamento est√° finalizado)
	  //* Ent√£o lembre-se de alterar todo o agendamento antes de finalizar, se n√£o ele vai transferir errado.
	  // produtos.forEach(p => {
	  //   console.log(p);
	  //   const composicoes = p.composicoes;
	  //   composicoes.forEach(c => {
	  //     console.log(c);
	  //     if (c.sku === "JP12324") {
	  //       let produto = {
	  //         nome: c.nome,
	  //         sku: c.sku,
	  //         id_tiny: c.id_tiny,
	  //         gtin: c.gtin,
	  //         unidades_de_kits: c.unidades_de_kits,
	  //         unidades_por_kit: c.unidades_por_kit,
	  //         unidades_totais: c.unidades_totais
	  //       }
	  //       obj.push(produto);
	  //     }
	  //   });
	  // });
	  // console.log('>', obj);
	
	  const resultado = produtos.filter(p =>
	    p.composicoes.some(c => c.sku === "JP12324")
	  );
	
	  console.log('Esse aqui √© o resultado askdaldkajsdl >', resultado);
	
	  carregarGtinComposicoes();
	});
	
	function carregarGtinComposicoes() {
	  let composicoes = [];
	  let vistos = new Set();
	
	
	}
	
	// ‚îÄ‚îÄ‚îÄ busca estado no servidor e atualiza UI ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	async function carregarProgressoServer() {
	  try {
	    const resp = await fetch(`/api/bipados-total/${idAgend}`);
	    if (!resp.ok) throw new Error(resp.statusText);
	    const dados = await resp.json();
	    console.log('Kelvinhoooo >', dados);
	    // const mapa = Object.fromEntries(dados.map(x => [x.sku, x.bipados]));
	    const mapa = Object.fromEntries(dados.map(x => [x.sku_original, x.bipados_total]));
	
	    document.querySelectorAll('.produto-item').forEach(item => {
	      const bip = mapa[item.dataset.sku] || 0;
	      item.dataset.bipados = bip;
	      atualizarUI(item, bip);
	    });
	
	    atualizarContadores();
	    const completos = verificarSeFinalizouTudo();
	    // se n√£o estiver tudo conclu√≠do, reordena pendentes/conclu√≠dos normalmente
	    if (!completos) distribuirItens();
	
	  } catch (e) {
	    console.error('Falha ao carregar progresso:', e);
	  }
	}
	
	
	// ‚îÄ‚îÄ‚îÄ atualiza cores, barra e texto de um item ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	function atualizarUI(item, bip) {
	  const total = +item.dataset.total;
	  const barra = item.querySelector('.progress-bar');
	
	  item.querySelector('.bipados').textContent = `Bipados: ${bip}`;
	  const pct = total > 0 ? (bip / total) * 100 : 0;
	  barra.style.width = `${pct}%`;
	  barra.setAttribute('aria-valuenow', bip);
	  barra.textContent = `${Math.round(pct)}%`;
	
	  if (bip >= total) {
	    item.classList.add('bg-success', 'text-white');
	    barra.classList.replace('bg-warning', 'bg-success');
	  } else {
	    item.classList.remove('bg-success', 'text-white');
	    barra.classList.replace('bg-success', 'bg-warning');
	  }
	}
	
	
	// ‚îÄ‚îÄ‚îÄ separa e ordena pendentes/conclu√≠dos ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	function distribuirItens() {
	  const concl = document.getElementById('concluidosContainer');
	  const pend = document.getElementById('pendentesContainer');
	  if (!concl || !pend) {
	    console.warn('Distribui√ß√£o: containers n√£o encontrados');
	    return;
	  }
	
	  // move cada item pro container correto
	  document.querySelectorAll('.produto-item').forEach(item => {
	    const bip = +item.dataset.bipados;
	    const tot = +item.dataset.total;
	    if (bip >= tot) concl.appendChild(item);
	    else pend.appendChild(item);
	  });
	
	  // ordena pendentes (desc por bipados)
	  Array.from(pend.querySelectorAll('.produto-item'))
	    .sort((a, b) => +b.dataset.bipados - +a.dataset.bipados)
	    .forEach(el => pend.appendChild(el));
	
	  // (opcional) ordenar concluidos tamb√©m, se desejar:
	  // Array.from(concl.querySelectorAll('.produto-item'))
	  //   .sort((a, b) => +b.dataset.bipados - +a.dataset.bipados)
	  //   .forEach(el => concl.appendChild(el));
	}
	
	
	// ‚îÄ‚îÄ‚îÄ contador de tempo ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	function iniciarContadorTempo() {
	  const tempoP = document.getElementById('tempoP');
	  const estP = document.getElementById('estimadoP');
	  if (estP) {
	    const [, h, m, s] = estP.textContent.match(/(\d{2})h (\d{2})m (\d{2})s/);
	    tempoEstimadoSegundos = (+h * 3600) + (+m * 60) + (+s);
	  }
	  inicioTimestamp = Date.now();
	  intervaloTempo = setInterval(() => {
	    const secDec = Math.floor((Date.now() - inicioTimestamp) / 1000);
	    const hh = String(Math.floor(secDec / 3600)).padStart(2, '0');
	    const mm = String(Math.floor((secDec % 3600) / 60)).padStart(2, '0');
	    const ss = String(secDec % 60).padStart(2, '0');
	    tempoP.innerHTML = `<strong>üïí Tempo:</strong> ${hh}h ${mm}m ${ss}s`;
	  }, 1000);
	}
	function pararContadorTempo() {
	  clearInterval(intervaloTempo);
	}
	
	
	// ‚îÄ‚îÄ‚îÄ envio de bipagem ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	async function biparProduto() {
	  const skuEl = document.getElementById('skuInput');
	  const qtdEl = document.getElementById('quantidadeInput');
	
	  let sku = (skuEl?.value || '').trim();
	  let qtd = Number(qtdEl?.value);
	
	  if (!sku || !Number.isFinite(qtd) || qtd <= 0) return;
	
	  const esc = (s) => (window.CSS && CSS.escape) ? CSS.escape(s) : s;
	  const onlyDigits = (v) => String(v ?? '').replace(/\D+/g, '');
	  const toNum = (v, def = 0) => {
	    const n = Number(v);
	    return Number.isFinite(n) ? n : def;
	  };
	
	  // 1) Tenta achar o item pelo SKU informado (SKU original no DOM)
	  let item = document.querySelector(`.produto-item[data-sku="${esc(sku)}"]`);
	
	  // 2) Se n√£o achou, tenta mapear pelo SKU/GTIN das composi√ß√µes e ajustar para o SKU da composi√ß√£o
	  if (!item) {
	    const raw = document.getElementById('js-data')?.dataset?.comps || '[]';
	    let produtos = [];
	    try { produtos = JSON.parse(raw); } catch { }
	
	    let foundComp = null;
	    outer:
	    for (const produto of produtos) {
	      const comps = Array.isArray(produto.composicoes) ? produto.composicoes : [];
	      for (const c of comps) {
	        if (String(c.sku ?? '').trim() === sku || (c.gtin && onlyDigits(c.gtin) === onlyDigits(sku))) {
	          foundComp = c;
	          break outer;
	        }
	      }
	    }
	    if (foundComp) {
	      sku = String(foundComp.sku ?? '').trim(); // ajusta p/ SKU real da composi√ß√£o
	      item = document.querySelector(`.produto-item[data-sku="${esc(sku)}"]`);
	    }
	  }
	
	  // 3) Busca equivalentes do agendamento
	  const listaEquivalentes = await listarEquivalentes(idAgend); // deve retornar { bruto: [...] }
	  let produtoBipado = null;
	  for (const prod of (listaEquivalentes?.bruto || [])) {
	    if (prod.sku_bipado === sku || onlyDigits(prod.gtin_bipado) === onlyDigits(sku)) {
	      produtoBipado = prod;
	      break;
	    }
	  }
	
	  // 4) Determinar o item "original" no DOM para c√°lculo de total:
	  // - Se veio por equivalente, o original √© produtoBipado.sku_original
	  // - Caso contr√°rio, √© o pr√≥prio `item` encontrado pelo SKU original
	  let itemOriginal = item;
	  let skuOriginalParaValidar = item?.getAttribute('data-sku') || sku;
	
	  if (produtoBipado) {
	    skuOriginalParaValidar = String(produtoBipado.sku_original || '').trim();
	    itemOriginal = document.querySelector(`.produto-item[data-sku="${esc(skuOriginalParaValidar)}"]`);
	  }
	
	  if (!itemOriginal) {
	    // Ele vai tentar buscar como se fosse uma caixa fechada 
	    // (Pega o KIT verifica se tem apenas um produto como composi√ß√£o e se esse produto est√° no agendamento)
	    const prod = await verificarSeECaixaFechada(skuOriginalParaValidar);
	
	    if (prod) {
	      qtd = prod.un;
	      sku = prod.sku;
	      // Muito importante: agora o ‚Äúoriginal‚Äù passa a ser o SKU do componente
	      skuOriginalParaValidar = prod.sku;
	      itemOriginal = document.querySelector(`.produto-item[data-sku="${esc(sku)}"]`);
	
	      if (!itemOriginal) {
	        Swal.fire({ icon: 'error', title: 'SKU n√£o encontrado!', timer: 2500, showConfirmButton: false });
	        return;
	      }
	    }
	  }
	
	  // 5) Valores do DOM (fallback local)
	  let atualDom = toNum(itemOriginal.dataset?.bipados, 0); // total j√° bipado (diretos + equivalentes)
	  let totalDom = toNum(itemOriginal.dataset?.total, 0);
	
	  // 6) (Recomendado) Consultar o total atual FRESCO no servidor (diretos + equivalentes)
	  let atualServidor = null;
	  try {
	    const qs = new URLSearchParams({ id_agend_ml: String(idAgend), sku: skuOriginalParaValidar });
	    const resp = await fetch(`/api/bipagem/detalhe?${qs.toString()}`);
	    if (resp.ok) {
	      const j = await resp.json();
	      const t = j?.totais?.bipados_total;
	      if (Number.isFinite(Number(t))) atualServidor = Number(t);
	      // Se quiser, tamb√©m pode sincronizar o DOM aqui:
	      // itemOriginal.dataset.bipados = String(atualServidor);
	    }
	  } catch (e) {
	    console.warn('Falha ao consultar totais no servidor:', e);
	  }
	
	  const atual = Number.isFinite(atualServidor) ? atualServidor : atualDom;
	  const total = totalDom;
	
	  // 7) Checagem robusta
	  if (!Number.isFinite(atual) || !Number.isFinite(total)) {
	    Swal.fire({ icon: 'error', title: 'Dados inv√°lidos para valida√ß√£o de total.', timer: 3000, showConfirmButton: false });
	    return;
	  }
	
	  if (atual + qtd > total) {
	    Swal.fire({
	      icon: 'error',
	      title: 'Total excedido!',
	      html: `Bipagem de <b>${qtd}</b> excede o total permitido para <b>${esc(skuOriginalParaValidar)}</b>.<br>
	             Atual: <b>${atual}</b> ‚Ä¢ Total: <b>${total}</b>`,
	      timer: 5000,
	      showConfirmButton: false
	    });
	    return;
	  }
	
	  // 8) Executar a bipagem (direto vs equivalente)
	  try {
	    if (!produtoBipado) {
	      // Direto (SKU original)
	      const resp = await fetch('/api/bipar', {
	        method: 'POST',
	        headers: { 'Content-Type': 'application/json' },
	        body: JSON.stringify({ id_agend: idAgend, sku: skuOriginalParaValidar, quant: qtd })
	      });
	      if (!resp.ok) throw new Error(await resp.text());
	      const data = await resp.json(); // { sku, bipados, ... } -> bipados = total (diretos + equivalentes)
	      const itm = document.querySelector(`.produto-item[data-sku="${esc(data.sku)}"]`);
	      if (itm) {
	        itm.dataset.bipados = String(toNum(data.bipados, atual) /* seguran√ßa */);
	        atualizarUI(itm, toNum(data.bipados, atual));
	        atualizarContadores();
	        const completos = verificarSeFinalizouTudo();
	        if (!completos) distribuirItens();
	      }
	    } else {
	      // Equivalente
	      const add = await addUnidadesEquivalentes(produtoBipado, qtd);
	      // add.bipados_total = total acumulado (diretos + equivalentes) do SKU ORIGINAL
	      const itm = document.querySelector(`.produto-item[data-sku="${esc(produtoBipado.sku_original)}"]`);
	      if (itm) {
	        itm.dataset.bipados = String(toNum(add?.bipados_total, atual + qtd));
	        atualizarUI(itm, toNum(add?.bipados_total, atual + qtd));
	        atualizarContadores();
	        const completos = verificarSeFinalizouTudo();
	        if (!completos) distribuirItens();
	      }
	    }
	  } catch (err) {
	    console.error('Erro ao registrar bipagem:', err);
	    Swal.fire({ icon: 'error', title: 'Erro ao registrar bipagem', text: String(err?.message || err) });
	    return;
	  }
	
	  // 9) Reset UI
	  skuEl.value = '';
	  qtdEl.value = 1;
	  skuEl.focus();
	}
	
	// ‚îÄ‚îÄ‚îÄ atualiza "Em andamento" e "Finalizados" ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	function atualizarContadores() {
	  let emAnd = 0, fin = 0;
	  document.querySelectorAll('.produto-item').forEach(item => {
	    const tot = +item.dataset.total;
	    const bi = +item.dataset.bipados;
	    if (bi > 0 && bi < tot) emAnd++;
	    if (bi >= tot) fin++;
	  });
	  document.getElementById('andamentoP').innerHTML = `<strong>üîÑ Em andamento:</strong> ${emAnd}`;
	  document.getElementById('finalizadosP').innerHTML = `<strong>‚úÖ Finalizados:</strong> ${fin}`;
	}
	
	
	// ‚îÄ‚îÄ‚îÄ move tudo de ‚ÄúConclu√≠dos‚Äù de volta para ‚ÄúPendentes‚Äù ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	function voltarTodosPendentes() {
	  const pend = document.getElementById('pendentesContainer');
	  const concl = document.getElementById('concluidosContainer');
	  Array.from(concl.querySelectorAll('.produto-item')).forEach(item => {
	    // reset de estilo
	    item.classList.remove('bg-success', 'text-white');
	    const barra = item.querySelector('.progress-bar');
	    barra.classList.replace('bg-success', 'bg-warning');
	    pend.appendChild(item);
	  });
	}
	
	
	// ‚îÄ‚îÄ‚îÄ checa se tudo foi bipado, mostra bot√£o e retorna um flag ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
	function verificarSeFinalizouTudo() {
	  const todos = [...document.querySelectorAll('.produto-item')]
	    .every(item => +item.dataset.bipados >= +item.dataset.total);
	  if (todos) {
	    pararContadorTempo();
	    document.getElementById('skuInput').disabled = true;
	    document.getElementById('quantidadeInput').disabled = true;
	    document.getElementById('finalizarContainer').classList.remove('d-none');
	    // retorna todos para pendentes assim que completa
	    voltarTodosPendentes();
	  }
	  return todos;
	}
	
	async function finalizarAgendamento() {
	  const urlParams = new URLSearchParams(window.location.search);
	  const idAgend = parseInt(urlParams.get('id'), 10);
	
	  const { isConfirmed } = await Swal.fire({
	    title: "Confirmar",
	    text: "Deseja realmente finalizar a confer√™ncia deste agendamento?",
	    icon: "question",
	    showCancelButton: true,
	    confirmButtonColor: "#28a745",
	    cancelButtonColor: "#6c757d",
	    confirmButtonText: "Sim, finalizar!",
	    cancelButtonText: "Cancelar"
	  });
	  if (!isConfirmed) return;
	
	  Swal.fire({
	    title: 'Finalizando‚Ä¶',
	    html: 'Gerando relat√≥rio e encerrando confer√™ncia.',
	    allowOutsideClick: false,
	    didOpen: () => Swal.showLoading()
	  });
	
	  try {
	    const resp = await fetch(`/relatorio/finalizar/${idAgend}`, { method: 'POST' });
	    const data = await resp.json();
	    if (!resp.ok || !data.success) throw new Error(data?.message || `HTTP ${resp.status}`);
	
	    // ‚úÖ primeiro finaliza, depois dispara a transfer√™ncia
	    await agendamentoFinalizadoChamarTransferencia();
	
	    await Swal.fire({
	      icon: 'success',
	      title: 'Sucesso!',
	      text: 'Confer√™ncia finalizada e movimenta√ß√£o enfileirada.',
	      timer: 1500,
	      showConfirmButton: false
	    });
	    window.location.href = '/agendamentos/ver?finalizado=conferencia_ok';
	  } catch (err) {
	    console.error(err);
	    Swal.fire('Erro!', String(err?.message || err), 'error');
	  }
	}
	
	
	// Rotaciona o c√≥digo utilizando a chave
	function dec(b64, key) {
	  const bytes = Uint8Array.from(atob(b64), c => c.charCodeAt(0));
	  const k = new TextEncoder().encode(key);
	  for (let i = 0; i < bytes.length; i++) bytes[i] ^= k[i % k.length];
	  return new TextDecoder().decode(bytes);
	}
	
	async function getTinyToken(empresa, marketplace) {
	  const PATH_KEY = 'tP2TTtorDkG6sxdA7UTkg2ErxBHQ7fRvQfpDLRSbBu2fswYxxmkZpf7pBusDpVJWiWCBrdsPU5rsDQfU3DB72ZiB5eJ3W7QtvAgUdRopfDDtbdijak2tP3PJmDyK3PzaQgD7gi6MtoPP3Y8QeF7VuYq4zEVHYGURCkXJxo3uEu48bbKWnQzhoyNvpzANfiFTJ7ZMsY58v9rSKZk88yLvMMhyBmoYg7zmfbqSjWJPsrBca7uSsjaNTT4qPRddkky956W7BvkaGPcmZAzSmCriGmCBwBwxFT49uxf6hhDcTq8unsbfSLjLzikxTji9dtNZ7DkvAfEYAcJBq7HoPug9E9HNPiEy9gSc5qys2zHBGQ9ez8iKGLegQCom3Km6T8zyMamMdPb29BYRutwaRd5TzhccD5Vzm2KxeoKNZzxdvgLaKCm9HgPLTb5pdDdWLAcmXqJK6iHk5kdgXCAzsnKKoieFxVNAWRiUMJYYmyvsX5ACBSPsnW8f4QAT6ohVSGMC';
	  const PASS_KEY = 'GE7bKeydUk8zEmqMoXM2uSF3i8PYXVAXh5nvQM7UwGbjWmxkFRYdr7HUbzP8WUSJkUF4AxFTooNqReDYqPUoLRG75ypxij88tZ2MWNzciWyAwZ4c68F2GHYQNirS4L7kVQhMMqgTdqX2sJmF2PvtukmvZ4AjieP3cnvJZ6zRPqYPV3RzNeT35rmT3mU4ob4hUeagosEz4m5rNEHKv9ni26PBZYyPVyqycoYn3gvxAM5Vaz2L88cLxUqsfwaAJtNdxeBwUuJRQfrW6qFV4aa39EWFkDaMisizZnEGQhc5AGDzJXmApoQE55W4fm6L67wY6PTmQpoeio9vfNdawhXetDg8PE2ZRCkDZTQeXunL9z4YFwEeFghQ6T4gtKr8647VaRKDL4rV4twKfyUrAjyHSiEJNPNaehzET3koczEToJnE3EJxv5z8gPsMMgZe5ChNQDADKeydspxEALbraQqLw3zxUsBAJFfmKPmpDA3cbsrL93gvLCbabeiYx8BmoEd5';
	  const PATH_COD = 'GTNjMDAXJwcsJR1YRxUTDHIdEBsjUxcnMiQZYnM1OCU+PEc2OCY3LwBGZSQbQRg/KwMKYxMoDjp0DQMAOD4wDR04dzI3AgkVBU0dFCVlVWxwKnRgXCIvIFIkI3cxYikAQyI3bSVhDkIlcTQyVFBeECoEXRVjShUtAhVLH2AnGw9lHXx0CABuPD8lBGJgGFMGMQt6YUANNQ1OKmECOCoCO3YTCHMvOX4Bc0FiUCwJIRQJCx0eHAMjHgIQLAQ+UBVnOAQuKUcBBnkffBNqDTBTf3YRCAAvIipNNho7FxdBKzVSVzMHGiMpNABLNyFZfCZnGDksKBkiZDQbIzw3HjlLfQZUBw41Gy8jAQNWHzU2CDgdNCEcPTgOIUQzMBB0O2VBLRksTCI5FwYSJVMPPzY4VDsLJgkbPwQIYxAGeiAHJDJZFClPKlI/I3kOMAA2ZRo6EwEzaRF4AgAFKzE+TggJAEI9DypXIBs6BiNtMUkPHRESCCM2MwBcVWcMVU8XXAM/ARULeA0CUXF9ADo/MD8GBxNQQRZJAysCfFwTTlpTLBJXFxMWL0JBHCcrI1UKAglKOCMTODIqZgIgAQUzChITAwsGMBNlMC4ODC4GDjo7CwsUHRMhWCsgKC07HCkbMBg8dTwtEj86LysKUCxxehUTEAY0UC5xOHg/YiosFSFxKxA='
	  const PASS_COD = 'A2ZWLwoEMgMbXFkRLDo5Cko9CH9BdgV2Sg9nKm5gBTsMUAsVCD9CDCVhAQMkDD8hHzZ9ChhWMCRET3QMJSAnPxIsBgEoHzEQOhw6EjsKZxcACTs+LRpkXWAqOxspXXJtRjdmO3IQGwRKGwsfIxF0GQIZGH8Lay0BDyw5dV4+fD4/FT4VLEYkO1Y8AgA1DDofcA4RGUwzLBg0Yy8MJzE4EiImMihtRjBxOQUROTNUYSw/RjF+ZDBfBHQfdgMiQ1cMcwo5Dkkecx5bC20mGHMSMi4aBwtCdxcqFAwnFwE4VA9HDREMCxcCOSw9cw82T3cnC00gKgFtRTYoBwkJCDUCQSAREidhMSACFCQRPXdDMSJ4VVdySDQtEQ5gFQwcCgASCB0jdSYjIBE4LiMkfDIIEUUjAh8HYj1yF1tYJVhzDzpnIRwzKRUfQSw5DgIFKjcSFUl+CjgxURwqH0NtDBE1Im4lPhUvVh0dYShdawIVcEAiLF8LRxVbIRckBGICQ30CP2sFFj8RFwJGASQAEE9gGgM4LDg1OCd9e2I2U10ZTxADXhw+UQgBBjg7KTBZJBkfLgcwVhQoNx4KAzUQfxA2AhRgNyMIOyBdARkoAnImNBc/OjR5IVwOPD4ZKSwpAD8KDxoJJAoSQFYbKRRqcUkCBgwEUDEsURsfPQ8YLwgSDV0=';
	
	  const path = dec(PATH_COD, PATH_KEY).trim();
	  const pass = dec(PASS_COD, PASS_KEY).trim();
	  // console.log('Senha:', pass);
	  const url = 'https://n8n.jaupesca.com.br/webhook/' + path + `?empresa=${empresa}&marketplace=${marketplace}`;
	
	  try {
	    // const response = await fetch(url, {
	    //   method: 'POST',
	    //   headers: {
	    //     'Content-Type': 'application/json',
	    //     'Authorization': `${pass}`
	    //   },
	    //   body: JSON.stringify({
	    //     empresa: empresa,
	    //     marketplace: marketplace,
	    //     agendamento: agendamento,
	    //     colaborador: colaborador,
	    //     produtos_agendamento: obj
	    //   })
	    // });
	
	    // if (!response.ok) {
	    //   const txt = await response.text().catch(() => '');
	    //   throw new Error(`HTTP ${response.status} ‚Äì ${txt}`);
	    // }
	
	
	    // const data = await response.json();
	    // console.log('Resposta do n8n:', data);
	    // return data;
	
	    const resp = await fetch(url, {
	      method: 'GET',
	      headers: {
	        'Authorization': `${pass}`
	      }
	    });
	
	    if (!resp.ok) {
	      throw new Error(`HTTP ${resp.json}`);
	    }
	
	    const data = await resp.json();
	    console.log('Resposta do n8n:', data);
	    return data;
	
	  } catch (error) {
	    console.error('Erro na requisi√ß√£o:', error);
	  }
	}
	
	function adicionarEquivalente(sku) {
	  const box = document.getElementById(`equivalente-${sku}`);           // div container
	  const field = document.getElementById(`inputEquivalente-${sku}`);    // o <input> de fato
	  const btn = document.getElementById(`btnEquivalente-${sku}`);
	
	  const estavaOff = box.classList.contains("input-equivalente-off");
	
	  // toggle de visibilidade
	  box.classList.toggle("input-equivalente-off");
	  btn.textContent = estavaOff ? "-" : "+";
	
	  if (estavaOff) {
	    // foca depois de exibir
	    requestAnimationFrame(() => {
	      field.focus({ preventScroll: true });
	      field.select();
	    });
	
	    // evita listeners duplicados
	    if (!field._enterHandler) {
	      field._enterHandler = (e) => {
	        if (e.key === "Enter") {
	          e.preventDefault();
	          const valorBipado = field.value.trim();
	          if (valorBipado) {
	            addDbEquivalente(sku, valorBipado);
	            field.value = "";
	            // opcional: esconder e devolver foco ao bot√£o
	            box.classList.add("input-equivalente-off");
	            btn.textContent = "+";
	            btn.focus();
	          }
	        }
	      };
	      field.addEventListener("keydown", field._enterHandler);
	    }
	  } else {
	    // opcional: ao esconder, remova o handler
	    if (field._enterHandler) {
	      field.removeEventListener("keydown", field._enterHandler);
	      field._enterHandler = null;
	    }
	  }
	}
	
	async function verificaAdicaoProdutoEquivalentePermitido(valorBipado) {
	  const raw = document.getElementById("js-data").dataset.comps;
	  const anunciosOriginais = JSON.parse(raw);
	
	  // normalizadores
	  const normSku = (v) => String(v ?? '').trim().toLowerCase();
	  const normGtin = (v) => String(v ?? '').replace(/\D+/g, '');
	
	  const valorSku = normSku(valorBipado);
	  const valorGtin = normGtin(valorBipado);
	
	  let produtosComposicoes = [];
	  let vistos = new Set(); // dedup por SKU normalizado
	
	  console.log('TODOS OS AN√öNCIOS EXEMPLO AGENDAMENTO ATUAL >', anunciosOriginais);
	
	  anunciosOriginais.forEach(p => {
	    const i = Array.isArray(p.composicoes) ? p.composicoes : [];
	    i.forEach(c => {
	      const keySku = normSku(c.sku);
	      if (vistos.has(keySku)) return; // evita duplicatas por caixa alta/baixa
	      vistos.add(keySku);
	      produtosComposicoes.push({
	        nome: c.nome,
	        sku: keySku,               // j√° normalizado
	        gtin: normGtin(c.gtin),    // d√≠gitos
	        id_tiny: c.id_tiny
	      });
	    });
	  });
	
	  console.log('Todas as composi√ß√µes normalizadas >', produtosComposicoes);
	
	  // 1) bloquear se tentar usar algo que j√° √© do agendamento (SKU ou GTIN)
	  for (const p of produtosComposicoes) {
	    const clashSku = p.sku === valorSku;
	    const clashGtin = !!valorGtin && p.gtin === valorGtin;
	
	    if (clashSku || clashGtin) {
	      console.log(`Para ${p.nome}: conflito ‚Äî SKU(${p.sku}) ou GTIN(${p.gtin}) bate com ${valorBipado}`);
	      return {
	        result: 1,
	        message: 'Voc√™ n√£o pode definir um produto do agendamento como Equivalente'
	      };
	    }
	    console.log(`Para ${p.nome}: OK ‚Äî SKU(${p.sku}) / GTIN(${p.gtin}) n√£o batem com ${valorBipado}`);
	  }
	
	  // 2) checar duplicata no BD (case-insensitive para SKU e d√≠gitos para GTIN)
	  let data = [];
	  try {
	    const resp = await fetch(`/api/equiv/${idAgend}`);
	    data = await resp.json();
	  } catch (e) {
	    console.warn('Falha ao consultar equivalentes do BD:', e);
	    // Em caso de erro, n√£o bloqueia aqui ‚Äî deixa seguir e o backend validar√° tamb√©m.
	  }
	
	  console.log('Resultado da busca de produtos equivalentes do BD >', data);
	
	  for (const p of data) {
	    const skuEq = normSku(p.sku_bipado);
	    const gtinEq = normGtin(p.gtin_bipado);
	
	    if (skuEq === valorSku || (!!valorGtin && gtinEq === valorGtin)) {
	      console.log(`Duplicado no BD: ${valorBipado} j√° equivale a ${p.sku_original}.`);
	      return {
	        result: 2,
	        message: `Refer√™ncia duplicada: ${valorBipado} j√° est√° cadastrada como equivalente de ${p.sku_original} e n√£o pode ser registrada novamente.`
	      };
	    }
	    console.log(`Este produto ${p.sku_original} possui ${p.sku_bipado} como refer√™ncia. Valor bipado n√£o confere: ${valorBipado} (esperado)`);
	  }
	
	  return null;
	}
	
	async function buscaProdutoEquivalente(valorBipado, token) {
	  const urlDefault = 'https://api.tiny.com.br/public-api/v3';
	  // const urlSku = urlDefault + `/produtos?codigo=${valorBipado}`; // Assumi que √© um SKU
	  // const urlGtin = urlDefault + `/produtos?gtin=${valorBipado}`; // Assumi que √© um GTIN/EAN
	  const isLikelyGTIN = (v) => /^\d{8}$|^\d{12}$|^\d{13}$|^\d{14}$/.test(v);
	  let result = null;
	
	  const permitidoAddEquivalente = await verificaAdicaoProdutoEquivalentePermitido(valorBipado);
	
	  if (permitidoAddEquivalente !== null) {
	    // messageBuscaEquivalenteTiny(permitidoAddEquivalente);
	    if (permitidoAddEquivalente.result === 1) {
	      notify.error(permitidoAddEquivalente.message, { type: 'info', duration: 5000 });
	      result = 1;
	      console.log('Result para adi√ß√£o do bagulho equivalente >', result);
	      return result;
	    } else if (permitidoAddEquivalente.result === 2) {
	      notify.error(permitidoAddEquivalente.message, { type: 'info', duration: 5000 });
	      result = 2;
	      console.log('Result para adi√ß√£o do bagulho equivalente >', result);
	      return result;
	    } else {
	      console.log('Result para adi√ß√£o do bagulho equivalente > N√£o retornou nada a√≠ vai voltar nulo');
	      return; // N√£o consigo imaginar que caso pode cair...
	    }
	  }
	
	  try {
	    // const tinySku = await fetch(urlSku, {
	    //   method: 'GET',
	    //   headers: {
	    //     'Authorization': `Bearer ${token}`
	    //   }
	    // });
	
	    // const data = await tinySku.json();
	
	    // Ex.: buscar produto pelo c√≥digo (SKU)
	
	    if (isLikelyGTIN(valorBipado)) {
	      // Se determinado como GTIN, tenta por GTIN
	      console.log('DETERMINADO COMO GTIN >', valorBipado);
	
	      // BUSCA POR GTIN/EAN
	      const tentativaGtin = await fetch(`/api/tiny-proxy?gtin=${encodeURIComponent(valorBipado)}`, {
	        method: 'GET',
	        headers: {
	          'Path': '/public-api/v3/produtos',
	          'Authorization': 'Bearer ' + token
	        }
	      });
	
	      const dataGtin = await tentativaGtin.json();
	      console.log('Resultado por GTIN:', dataGtin);
	
	      if (dataGtin.itens.length === 0) {
	        console.log('NENHUM PRODUTO ENCONTRADO POR GTIN');
	        console.log('Tentando como SKU');
	
	        // BUSCA POR SKU
	        const url = `/api/tiny-proxy?codigo=${encodeURIComponent(valorBipado)}`;
	        const tentativaSku = await fetch(url, {
	          method: 'GET',
	          headers: {
	            'Path': '/public-api/v3/produtos',
	            'Authorization': 'Bearer ' + token
	          }
	        });
	        const dataSku = await tentativaSku.json();
	        console.log('RESULT POR SKU: ', dataSku);
	
	        if (dataSku.itens.length === 0) {
	          console.log('INFELIZMENTE N√ÉO FOI POSS√çVEL ENCONTRAR NENHUM PRODUTO NEM COM SKU NEM COM GTIN');
	          result = 3;
	          return result;
	        } else {
	          result = dataSku;
	        }
	      } else {
	        result = dataGtin;
	      }
	      return result;
	    }
	    else {
	      // Caso contr√°rio faz como SKU primeiro
	
	      console.log('DETERMINADO COMO SKU >', valorBipado);
	
	      // BUSCA POR SKU
	      const url = `/api/tiny-proxy?codigo=${encodeURIComponent(valorBipado)}`;
	      const tentativaSku = await fetch(url, {
	        method: 'GET',
	        headers: {
	          'Path': '/public-api/v3/produtos',
	          'Authorization': 'Bearer ' + token
	        }
	      });
	      const dataSku = await tentativaSku.json();
	      console.log('RESULT POR SKU: ', dataSku);
	
	      if (dataSku.itens.length === 0) {
	        console.log('NADA ENCONTRADO');
	        console.log('Tentando agora a pesquisa por GTIN/EAN');
	
	        // BUSCA POR GTIN/EAN
	        const tentativaGtin = await fetch(`/api/tiny-proxy?gtin=${encodeURIComponent(valorBipado)}`, {
	          method: 'GET',
	          headers: {
	            'Path': '/public-api/v3/produtos',
	            'Authorization': 'Bearer ' + token
	          }
	        });
	
	        console.log(tentativaGtin.status);
	
	        let data = null;
	        let text = null;
	
	        // Tenta JSON; se falhar, l√™ como texto
	        try {
	          data = await tentativaGtin.clone().json();
	        } catch {
	          text = await tentativaGtin.text();
	        }
	
	        if (!tentativaGtin.ok) {
	          // 4xx/5xx
	          const msg =
	            (data && data.detalhes && data.detalhes[0] && data.detalhes[0].mensagem) ||
	            (data && data.error) || // caso o seu proxy retorne {error: "..."}
	            text ||
	            'Erro ao consultar Tiny \nCOD Err: #j3uY3c6FC8Sd';
	
	          console.log(`Erro ${tentativaGtin.status}:`, msg);
	          throw new Error(`Erro ${tentativaGtin.status}:`, msg);
	        } else {
	          // Sucesso 2xx
	          console.log('OK:', data);
	        }
	
	
	        const dataGtin = await tentativaGtin.json();
	        console.log('Resultado por GTIN:', dataGtin);
	
	        if (dataGtin.itens.length === 0) {
	          console.log('INFELIZMENTE N√ÉO FOI POSS√çVEL ENCONTRAR NENHUM PRODUTO NEM COM SKU NEM COM GTIN');
	          result = 3;
	          return result;
	        } else {
	          result = dataGtin;
	        }
	      } else {
	        result = dataSku;
	      }
	
	      return result;
	    }
	  } catch (error) {
	    console.log(`Deu erro na requisi√ß√£o TINY com SKU: ${error}`);
	    const erro = error.toString();
	    if (erro.includes("400")) {
	      result = 3;
	      return result;
	    } else {
	      notify.error(error, { type: 'info', duration: 5000 })
	    }
	  }
	}
	
	async function messageBuscaEquivalenteTiny(message) {
	  const erroDiv = document.getElementById('erroBuscaEquivalenteDiv');
	
	  erroDiv.classList.remove('input-equivalente-off');
	  erroDiv.innerHTML = message;
	  await sleep(2000);
	  erroDiv.classList.add('input-equivalente-off');
	}
	
	// Pequeno utilit√°rio para requisi√ß√µes JSON com timeout
	async function fetchJSON(url, { method = 'GET', headers = {}, body, timeoutMs = 10000 } = {}) {
	  const ctrl = new AbortController();
	  const t = setTimeout(() => ctrl.abort(), timeoutMs);
	
	  const res = await fetch(url, {
	    method,
	    headers: { 'Content-Type': 'application/json', ...headers },
	    body: body ? JSON.stringify(body) : undefined,
	    signal: ctrl.signal
	  });
	  clearTimeout(t);
	
	  if (!res.ok) {
	    let msg = `HTTP ${res.status}`;
	    try { const j = await res.json(); if (j?.error) msg += ` ‚Äì ${j.error}`; } catch { }
	    throw new Error(msg);
	  }
	  return res.json();
	}
	
	async function listarEquivalentes(idAgend) {
	  const data = await fetchJSON(`/api/equiv/${idAgend}`);
	  console.table(data);
	  // Dica: agrupar por sku_original para montar UI
	  const agrupado = data.reduce((acc, r) => {
	    (acc[r.sku_original] ||= []).push({ sku: r.sku_bipado, bipados: r.bipados, atualizado_em: r.atualizado_em });
	    return acc;
	  }, {});
	  return { bruto: data, porOriginal: agrupado };
	}
	
	async function addUnidadesEquivalentes(produtoBipado, qtd) {
	  const payload = {
	    id_agend: idAgend,
	    sku_original: produtoBipado.sku_original,
	    sku_bipado: produtoBipado.sku_bipado,
	    quant: qtd
	  };
	
	  const requestAdd = await fetch('/api/equiv/add-unidades', {
	    method: 'POST',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify(payload)
	  });
	
	  // ‚ö†Ô∏è aqui era `res.status` ‚Äî CORRIGIDO:
	  if (!requestAdd.ok) {
	    const txt = await requestAdd.text().catch(() => '');
	    throw new Error(`HTTP ${requestAdd.status} ‚Äì ${txt}`);
	  }
	  return requestAdd.json();
	}
	
	// exemplo
	async function addDbEquivalente(sku, valorBipado) {
	  const raw = document.getElementById("js-data").dataset.comps;
	  const produtos = JSON.parse(raw);
	  const nomeColaborador = document.getElementById("infoAgend").dataset.colaborador;
	
	  // 1) Localiza o produto de refer√™ncia (case-insensitive)
	  let prodRef = null;
	  for (const p of produtos) {
	    for (const c of (p.composicoes || [])) {
	      if (String(c.sku).toLowerCase() === String(sku).toLowerCase()) {
	        prodRef = c;
	        break;
	      }
	    }
	    if (prodRef) break;
	  }
	  if (!prodRef) {
	    notify.error(`SKU de refer√™ncia n√£o encontrado: ${sku}`, { type: 'info', duration: 4000 });
	    return;
	  }
	
	  // 2) Token Tiny
	  let token;
	  try {
	    const result = await getTinyToken("jaupesca", "tiny");
	    token = result[0].access_token;
	  } catch (err) {
	    notify.error('Falha ao obter token do Tiny.', { type: 'info', duration: 5000 });
	    return;
	  }
	
	  // 3) Busca no Tiny (respeita teus c√≥digos de retorno 1/2/3)
	  const produtoEquivalente = await buscaProdutoEquivalente(valorBipado, token);
	  if (produtoEquivalente === 1 || produtoEquivalente === 2) return;
	  if (produtoEquivalente === 3) {
	    notify.error('Nenhum produto encontrado (GTIN ou SKU inv√°lidos)', { type: 'info', duration: 5000 });
	    return;
	  }
	
	  // 4) Confirma√ß√£o do usu√°rio
	  const confirmed = await confirmaProdutoEquivalente(produtoEquivalente.itens[0], sku, token);
	  if (confirmed.respostaUser === false) {
	    notify('Adi√ß√£o de produto equivalente foi cancelada com sucesso!');
	    return;
	  }
	
	  // 5) Payload e grava√ß√£o
	  const equivalente = produtoEquivalente.itens[0];
	  const payload = {
	    id_agend: idAgend,
	    sku_original: prodRef.sku,
	    gtin_original: prodRef.gtin,
	    id_tiny_original: prodRef.id_tiny,
	    nome_equivalente: equivalente.descricao,
	    sku_bipado: equivalente.sku,
	    gtin_bipado: equivalente.gtin,
	    id_tiny_equivalente: equivalente.id,
	    usuario: nomeColaborador || 'Desconhecido',
	    observacao: confirmed.obs ?? "N√£o informado"
	  };
	
	  try {
	    await fetchJSON('/api/equiv/bipar', { method: 'POST', body: payload });
	    notify.success('Produto equivalente adicionado com sucesso!', { type: 'info', duration: 2000 });
	  } catch (e) {
	    notify.error(`Erro ao gravar equivalente: ${e}`, { type: 'info', duration: 5000 });
	  }
	}
	
	async function confirmaProdutoEquivalente(prod, sku, accessToken) {
	  const painel = document.getElementById('confirmaEquivalente');
	  const raw = document.getElementById("js-data").dataset.comps;
	  const produtos = JSON.parse(raw);
	  let comp = {};
	
	  painel.classList.remove('input-equivalente-off');
	  console.log('Esse √© o objeto do produto que vai aparecer na confirma√ß√£o para o Equivalente >', prod);
	  console.log('Sku ORIGINAL >', sku);
	  console.log('Obj >', produtos);
	
	  console.log('Fazendo La√ßo de repeti√ß√£o para buscar o produto refer√™ncia');
	  const skuNorm = String(sku).toLowerCase();
	  outer:
	  for (const p of produtos) {
	    const i = Array.isArray(p.composicoes) ? p.composicoes : [];
	    for (const c of i) {
	      if (String(c.sku).toLowerCase() === skuNorm) {
	        comp = c;
	        break outer;
	      }
	    }
	  }
	  console.log('Terminou o la√ßo de repeti√ß√£o');
	  console.log('Produto Refer√™ncia >', comp);
	
	  let data = {};
	  try {
	    const response = await fetch('/api/tiny-proxy', {
	      method: 'GET',
	      headers: {
	        'Path': `/public-api/v3/produtos/${prod.id}`,
	        'Authorization': 'Bearer ' + accessToken
	      }
	    });
	    data = await response.json();
	  } catch (e) {
	    console.warn('Falha ao buscar anexos do Tiny:', e);
	  }
	  console.log('Result de chamada para GET da imagem >', data);
	
	  let urlImagem = '../static/resources/sem_img.webp';
	  if (Array.isArray(data?.anexos) && data.anexos.length > 0) {
	    urlImagem = data.anexos[0].url;
	  }
	  console.log('Aqui est√° a url da imagem >', urlImagem);
	
	  painel.innerHTML = `
	      <p id="confirmaEquivalente-nome">Nome: <strong>${prod.descricao}</strong></p>
	      <p id="confirmaEquivalente-sku">SKU: <strong>${prod.sku}</strong></p>
	      <p id="confirmaEquivalente-gtin">GTIN: <strong>${prod.gtin}</strong></p>
	      <img id="confirmaEquivalente-img" style="max-width: 480px; max-height: 280px" src="${urlImagem}" alt="Imagem do produto">
	
	      <p>Deseja adicionar este produto como equivalente para</p>
	      <p>${sku} - ${comp?.nome ?? '(produto original n√£o encontrado)'}</p>
	      <input id="inputObs" type="text" placeholder="Observa√ß√£o (Opcional)"> <br><br>
	      <div id="btnSim" style="border: 5px solid green; color: white; background-color: green;">SIM</div><br>
	      <div id="btnNao" style="border: 5px solid red; color: white; background-color: red;">N√ÉO</div>
	    `;
	
	  const resposta = await perguntarConfirmacao();
	  const inputObs = document.getElementById('inputObs');
	  const observacao = (inputObs && inputObs.value !== "") ? inputObs.value : null;
	
	  console.log('Este √© o valor do campo de observa√ß√µes >', observacao);
	  painel.classList.add('input-equivalente-off');
	  console.log('Resposta do usu√°rio para Equivalente >', resposta);
	
	  return { respostaUser: resposta, obs: observacao };
	}
	
	function perguntarConfirmacao() {
	  return new Promise((resolve) => {
	    const btnSim = document.getElementById('btnSim');
	    const btnNao = document.getElementById('btnNao');
	
	    // garante que os listeners sejam adicionados s√≥ 1 vez
	    btnSim.onclick = () => resolve(true);
	    btnNao.onclick = () => resolve(false);
	  });
	}
	
	async function agendamentoFinalizadoChamarTransferencia() {
	  const urlParams = new URLSearchParams(window.location.search);
	  const idAgend = parseInt(urlParams.get('id'), 10);
	
	  // Ajuste esses IDs conforme seu mapeamento atual (ou traga do expedicao.js para 1 fonte s√≥)
	  const DEPOSITO_ORIGEM = 822208355; // Produ√ß√£o
	  const DEPOSITO_DESTINO = 785301556; // Exemplo: Mercado Livre
	
	  const toInt = v => {
	    const n = Number(v);
	    return Number.isFinite(n) ? Math.trunc(n) : null;
	  };
	
	  // l√™ composi√ß√µes do <div id="js-data" data-comps="...">
	  let comps = [];
	  try {
	    const raw = document.getElementById('js-data')?.dataset?.comps || '[]';
	    comps = JSON.parse(raw);
	  } catch { }
	
	  // Para cada SKU do agendamento, traz totais (originais + equivalentes)
	  const mapaTotais = new Map(); // sku_original -> total bipado (direto + equiv)
	  for (const p of comps) {
	    const skuOriginal = String(p.sku || '').trim();
	    if (!skuOriginal) continue;
	
	    const qs = new URLSearchParams({ id_agend_ml: String(idAgend), sku: skuOriginal });
	    try {
	      const resp = await fetch(`/api/bipagem/detalhe?${qs}`);
	      if (!resp.ok) continue;
	      const j = await resp.json();
	      const total = toInt(j?.totais?.bipados_total) || 0;
	      mapaTotais.set(skuOriginal, total);
	    } catch { }
	  }
	
	  // Resolve id_tiny de cada sku_original (ou do equivalente quando aplic√°vel)
	  const todosProdutos = (() => {
	    try {
	      const raw = document.getElementById('js-data-produtos')?.dataset?.produtos;
	      return raw ? JSON.parse(raw) : [];
	    } catch { return []; }
	  })();
	
	  const resolverIdTiny = (sku) => {
	    const d = String(sku || '');
	    const bySku = todosProdutos.find(p => String(p.sku) === d);
	    if (bySku && (bySku.id_tiny || bySku.id)) return bySku.id_tiny || bySku.id;
	    const digits = d.replace(/\D+/g, '');
	    if (digits) {
	      const byGtin = todosProdutos.find(p => String(p.gtin || '').replace(/\D+/g, '') === digits);
	      if (byGtin && (byGtin.id_tiny || byGtin.id)) return byGtin.id_tiny || byGtin.id;
	    }
	    return null;
	  };
	
	  // Monta movimentos somando por id_produto
	  const somaPorId = new Map();
	  for (const [skuOriginal, unidades] of mapaTotais.entries()) {
	    const idTiny = toInt(resolverIdTiny(skuOriginal));
	    const un = toInt(unidades);
	    if (!idTiny || !un || un <= 0) continue;
	    somaPorId.set(idTiny, (somaPorId.get(idTiny) || 0) + un);
	  }
	
	  const movimentos = Array.from(somaPorId.entries()).map(([id_produto, unidades]) => ({
	    id_produto,
	    de: DEPOSITO_ORIGEM,
	    para: DEPOSITO_DESTINO,
	    unidades,
	    preco_unitario: 0
	  }));
	
	  if (!movimentos.length) {
	    await Swal.fire('Aten√ß√£o', 'Nenhuma movimenta√ß√£o v√°lida foi encontrada.', 'warning');
	    return;
	  }
	
	  // Enfileira no backend
	  const observacoes = `Confer√™ncia ${idAgend} ‚Äì sa√≠da Prod. e entrada no destino`;
	  const r = await fetch('/estoque/mover', {
	    method: 'POST',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify({ observacoes, preco_unitario: 0, movimentos })
	  });
	  const payload = await r.json().catch(() => ({}));
	
	  if (!r.ok || !payload.ok) {
	    const msg = payload?.error || payload?.detalhe || r.statusText;
	    throw new Error(msg);
	  }
	}
	
	async function moverEstoque(movimentos, meta = {}) {
	  // movimentos: [{ sku?, id_produto, de, para, unidades, preco_unitario? }, ...]
	  // meta: { empresa?, observacoes?, preco_unitario? }
	
	  const payload = {
	    empresa: meta.empresa || null,
	    observacoes: meta.observacoes || null,
	    preco_unitario: meta.preco_unitario ?? 0,
	    movimentos
	  };
	
	  const resp = await fetch('/estoque/mover', {
	    method: 'POST',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify(payload),
	    credentials: 'include' // garante cookie de sess√£o
	  });
	
	  let data = {};
	  try { data = await resp.json(); } catch { }
	  if (!resp.ok || data.ok === false) {
	    const msg = data?.error || `Falha ao mover estoque (HTTP ${resp.status})`;
	    throw new Error(msg);
	  }
	  return data; // { ok:true, tasks:[...] }
	}
	
	// Fun√ß√£o que faz a transfer√™ncia de estoque
	async function transferirEstoque(id_deposito, id_prod, un_prod, tipo, token, observacoes) {
	  // Aqui agora vai vir a fun√ß√£o que vai fazer a requisi√ß√£o para o Python onde o mesmo far√° a transfer√™ncia de estoque
	  // Como o Python vai colocar meio que em fila, ent√£o ser√° poss√≠vel usar outro endpoint para saber o status do processo
	
	
	  // Dep√≥sitos 
	
	  // "id": 888484781,
	  // "nome": "Amazon FULL Silvio",
	
	  // "id": 789951727,
	  // "nome": "Americanas FULL PESCAJAU",
	
	  // "id": 813254602,
	  // "nome": "Avarias (Defeito)",
	
	  // "id": 822208355,
	  // "nome": "Deposito 141 Produ√ß√£o",
	
	  // "id": 785301556,
	  // "nome": "Deposito 151 Inferior",
	
	  // "id": 894837591,
	  // "nome": "Deposito 151 Mesanino",
	
	  // "id": 894837619,
	  // "nome": "Deposito 177 Cx Fechado",
	
	  // "id": 897682013,
	  // "nome": "Deposito Caixas",
	
	  // "id": 814366386,
	  // "nome": "Empresa CT Fishing",
	
	  // "id": 814366459,
	  // "nome": "Empresa LT SPORTS",
	
	  // "id": 888484630,
	  // "nome": "Estudio",
	
	  // "id": 789951567,
	  // "nome": "Magalu FULL PESCAJAU",
	
	  // "id": 888526350,
	  // "nome": "Mercado Livre Full CT FISHING",
	
	  // "id": 888526346,
	  // "nome": "Mercado Livre Full LT SPORTS",
	
	  // "id": 787964633,
	  // "nome": "Mercado Livre Full PESCAJAU",
	
	  // "id": 889339924,
	  // "nome": "Monstruario Leandro Turatti",
	
	  // "id": 889339919,
	  // "nome": "Monstruario Marcos",
	
	  // "id": 813254664,
	  // "nome": "Servico de Terceiros",
	
	  // "id": 895899591,
	  // "nome": "Shopee Full JAUFISHING",
	
	  // "id": 895899584,
	  // "nome": "Shopee Full LT SPORTS",
	
	  // "id": 895899410,
	  // "nome": "Shopee Full S de Alencar",
	
	  // notify('Processando...\n Transfer√™ncia de estoque sendo feita. Por favor aguarde üòâ', { type: 'info', duration: 3000 });
	
	  const payload = {
	    id_deposito: id_deposito,
	    id_produto: id_prod,
	    unidades: un_prod,
	    tipo: tipo, // tamb√©m aceita "Sa√≠da"
	    auth_token: token,
	    observacoes: observacoes
	  };
	
	  console.log('Este √© o payload >', payload);
	
	  const resp = await fetch('/transf-estoque', {
	    method: 'POST',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify(payload)
	  });
	
	
	  const data = await resp.json();
	  console.log('Resultado da transfer√™ncia de estoque >', data);
	  // const taskId = data.task_id;
	
	  // if (!taskId) {
	  //   throw new Error('task_id ausente na resposta do servidor');
	  // }
	
	  // try {
	  //   const resultado = await acompanharStatus(taskId, 5000, 180000); // verifica a cada 5s, timeout 3min
	  //   console.log("Transfer√™ncia finalizada com sucesso:", resultado);
	  // } catch (err) {
	  //   console.error("Falha na transfer√™ncia:", err);
	  // }
	}
	
	// /**
	//  * Faz polling do status da transfer√™ncia de estoque.
	//  * @param {string} taskId - ID da tarefa retornado pelo Python.
	//  * @param {number} intervalo - Intervalo entre checagens (ms).
	//  * @param {number} timeout - Tempo m√°ximo para aguardar (ms).
	//  * @returns {Promise<object>} - Resolve com o resultado final ou rejeita com erro.
	//  */
	// function acompanharStatus(taskId, intervalo = 5000, timeout = 120000) {
	//   return new Promise((resolve, reject) => {
	//     const inicio = Date.now();
	
	//     const timer = setInterval(async () => {
	//       try {
	//         const resp = await fetch(`/transf-estoque/status/${taskId}`);
	//         if (!resp.ok) throw new Error(`Falha na consulta: ${resp.status}`);
	
	//         const data = await resp.json();
	//         console.log(`Status atual da task ${taskId}:`, data.status);
	//         console.log('Resposta inteira >', data);
	//         if (data.status === "concluido") {
	//           clearInterval(timer);
	//           resolve(data); // { status: "concluido", result: {...} }
	//         } else if (data.status === "falhou") {
	//           clearInterval(timer);
	//           reject(data.error); // Detalhes do erro
	//         } else if (Date.now() - inicio >= timeout) {
	//           clearInterval(timer);
	//           reject(new Error("Tempo limite excedido para concluir a transfer√™ncia"));
	//         }
	//       } catch (err) {
	//         clearInterval(timer);
	//         reject(err);
	//       }
	//     }, intervalo);
	//   });
	// }
	
	(() => {
	  const STATE = { ready: false, container: null, queue: [] };
	
	  // garante DOM pronto
	  function onReady() {
	    STATE.ready = true;
	    STATE.container = ensureContainer();
	    // entrega toasts que chegaram antes do DOM
	    for (const { msg, opts, resolve } of STATE.queue.splice(0)) {
	      resolve(_notify(msg, opts));
	    }
	  }
	  if (document.readyState === 'loading') {
	    document.addEventListener('DOMContentLoaded', onReady, { once: true });
	  } else {
	    onReady();
	  }
	
	  // cria ou reutiliza o container (.toast-container)
	  function ensureContainer() {
	    let el = document.querySelector('.toast-container');
	    if (!el) {
	      el = document.createElement('div');
	      el.className = 'toast-container';
	      document.body.appendChild(el);
	    }
	    return el;
	  }
	
	  // cria a estrutura do toast e controla vida/animacoes
	  function _notify(message, { type = 'info', duration = 2000 } = {}) {
	    const container = STATE.container || ensureContainer();
	
	    const toast = document.createElement('div');
	    toast.className = `toast toast--${type}`;
	    toast.setAttribute('role', 'status');
	    toast.setAttribute('aria-live', 'polite');
	
	    const btnClose = document.createElement('button');
	    btnClose.className = 'toast__close';
	    btnClose.type = 'button';
	    btnClose.setAttribute('aria-label', 'Fechar notifica√ß√£o');
	    btnClose.textContent = '√ó';
	
	    const msg = document.createElement('div');
	    msg.className = 'toast__message';
	    msg.textContent = String(message ?? '');
	
	    const progress = document.createElement('div');
	    progress.className = 'toast__progress';
	
	    toast.appendChild(btnClose);
	    toast.appendChild(msg);
	    toast.appendChild(progress);
	    container.prepend(toast);
	
	    // anima entrada
	    requestAnimationFrame(() => {
	      toast.style.opacity = '1';
	      toast.style.transform = 'translateY(0)';
	    });
	
	    // barra de progresso reversa controlada por JS (independe de @keyframes)
	    let removed = false;
	    let start = Date.now();
	    let remaining = Math.max(0, duration);
	
	    function setProgressWidth(msRemaining) {
	      const pct = Math.max(0, Math.min(100, (msRemaining / duration) * 100));
	      progress.style.width = `${pct}%`;
	    }
	
	    // estado inicial
	    progress.style.transition = 'none';
	    setProgressWidth(remaining);
	    // dispara transi√ß√£o -> 0%
	    requestAnimationFrame(() => {
	      progress.style.transition = `width ${remaining}ms linear`;
	      setProgressWidth(0);
	    });
	
	    const remove = () => {
	      if (removed) return;
	      removed = true;
	      toast.style.transition = 'transform .18s ease, opacity .18s ease';
	      toast.style.transform = 'translateY(-6px)';
	      toast.style.opacity = '0';
	      setTimeout(() => toast.remove(), 180);
	    };
	
	    let timer = setTimeout(remove, remaining);
	
	    // fechar manual
	    btnClose.addEventListener('click', () => {
	      clearTimeout(timer);
	      remove();
	    });
	
	    // pausar/resumir no hover
	    let paused = false;
	    const pause = () => {
	      if (paused || removed) return;
	      paused = true;
	      clearTimeout(timer);
	      const elapsed = Date.now() - start;
	      remaining = Math.max(0, remaining - elapsed);
	      // congela barra
	      const nowPct = (remaining / duration) * 100;
	      progress.style.transition = 'none';
	      setProgressWidth(remaining);
	    };
	    const resume = () => {
	      if (!paused || removed) return;
	      paused = false;
	      start = Date.now();
	      // retoma transi√ß√£o do ponto atual
	      requestAnimationFrame(() => {
	        progress.style.transition = `width ${remaining}ms linear`;
	        setProgressWidth(0);
	      });
	      timer = setTimeout(remove, remaining);
	    };
	
	    toast.addEventListener('mouseenter', pause);
	    toast.addEventListener('mouseleave', resume);
	
	    return toast;
	  }
	
	  // API p√∫blica: retorna o elemento do toast
	  function notify(message, opts) {
	    if (STATE.ready) return _notify(message, opts);
	    // se chamado antes do DOM, enfileira e devolve uma pseudo-promise de elemento
	    return new Promise((resolve) => STATE.queue.push({ msg: message, opts, resolve }));
	  }
	
	  // helpers
	  notify.success = (m, o = {}) => notify(m, { ...o, type: 'success' });
	  notify.error = (m, o = {}) => notify(m, { ...o, type: 'error' });
	  notify.info = (m, o = {}) => notify(m, { ...o, type: 'info' });
	  notify.warn = (m, o = {}) => notify(m, { ...o, type: 'warning' });
	
	  // exp√µe global
	  window.notify = notify;
	
	  // notify('Opera√ß√£o conclu√≠da!');
	  // notify.success('Estoque transferido!', { duration: 3000 });
	  // notify.error('Saldo insuficiente para Sa√≠da.');
	  // notify('Processando...\nAguarde.', { type: 'info', duration: 5000 });
	})();
	
	async function editarProdutoCompLapis(sku) {
	  // Se precisar popular algo dinamicamente:
	  // document.querySelector('#conteudoModalEditarProduto p:nth-child(2) strong').textContent = sku;
	
	  const listaProdutos = document.getElementById('listaProdutos');
	  const bipados = document.querySelector(`[data-sku="${sku}"]`).dataset.bipados;
	
	  console.log('listaProdutos >', listaProdutos);
	
	  const raw = document.getElementById("js-data").dataset.comps;
	  const produtos = JSON.parse(raw);
	
	  console.log('Produtos >', produtos);
	
	  const comp = produtos.flatMap(p => p.composicoes ?? []).find(c => c.sku === sku);
	
	
	  console.log('Este √© o produto composi√ß√£o >', comp);
	
	  const response = await fetch(`/api/bipagem/detalhe?id_agend_ml=${idAgend}&sku=${sku}`);
	  const data = await response.json();
	  console.log('data >', data);
	  let totalBipadosOriginal = 0;
	
	  if (data.bipagem === null || data.bipagem === undefined) {
	    totalBipadosOriginal = 0;
	  } else {
	    totalBipadosOriginal = data.bipagem.bipados;
	  }
	
	  const porcento = comp.unidades_totais > 0 ? Math.min(100, Math.round((totalBipadosOriginal / comp.unidades_totais) * 100)) : 0;
	
	  console.log('Total Bipados Original >', totalBipadosOriginal);
	  const nomeProdOrigView = document.getElementById('master-nome');
	  const skuView = document.getElementById('master-sku-view');
	  const gtinView = document.getElementById('master-gtin');
	  const img = document.getElementById('master-img');
	
	  console.log('Valor de comp.nome:', comp.nome);
	  nomeProdOrigView.innerHTML = comp.nome;
	  skuView.innerHTML = comp.sku;
	  gtinView.innerHTML = comp.gtin;
	
	  // Exemplo para mudar a imagem
	  // img.src = "https://blog.abler.com.br/wp-content/uploads/2022/08/Teste-de-Perfil-Comportamental.jpg"
	
	  console.log('Total Bipados original 2>', data);
	  console.log('Total Bipados original 3>', totalBipadosOriginal);
	  listaProdutos.innerHTML = `
	  <!-- ============ PRODUTO ORIGINAL (o primeiro da lista) ============ -->
	          <div id="produto-ORIGINAL-${comp.id_tiny}" class="produto-item-modal" data-role="original">
	            <div class="d-flex" style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
	              <div>
	                <strong id="nome-${sku}">${comp.nome}</strong>
	                <span id="sku-${sku}" class="badge">${sku}</span>
	                <span id="tipo-${sku}" class="badge">Original</span>
	              </div>
	              <div class="small" style="font-size:.85rem; color:#6b7280;">
	                Bipado: <strong id="bipado-${sku}">${totalBipadosOriginal}</strong> /
	                Total: <strong id="total-${sku}">${comp.unidades_totais}</strong>
	                (<span id="percent-${sku}">${porcento}</span>%)
	              </div>
	            </div>
	
	            <!-- Barra de progresso -->
	            <div id="progressWrap-${sku}" class="progress"
	              style="height:10px; background:#e5e7eb; border-radius:6px; overflow:hidden; margin:8px 0;">
	              <div id="progressFill-${sku}" class="progress-bar" role="progressbar"
	                style="width:0%; background:#f59e0b; height:10px;" aria-valuenow="0" aria-valuemin="0"
	                aria-valuemax="100"></div>
	            </div>
	
	            <!-- Controles de quantidade -->
	            <div class="controls" style="display:flex; align-items:center; gap:8px;">
	              <button id="menos-${sku}" class="btn btn-outline" onclick="removeUnEditarProduto('${sku}');" type="button">‚àí</button>
	              <input id="quantidade-${sku}" type="number" value="${totalBipadosOriginal}" min="0" step="1" style="width:100px;">
	              <button id="mais-${sku}" class="btn btn-outline" onclick="addUnEditarProduto('${sku}');" type="button">+</button>
	
	              <div class="ms-auto" style="margin-left:auto; font-size:.85rem; color:#6b7280;">
	                √öltima a√ß√£o: <strong id="status-${sku}">‚Äî</strong>
	              </div>
	            </div>
	          </div>
	          `;
	
	
	  console.log('Req to DB | View EQUIVALENTES >', data);
	
	  const fill = document.getElementById(`progressFill-${sku}`);
	  fill.style.width = `${porcento}%`;
	  fill.setAttribute('aria-valuenow', bipados);
	  fill.setAttribute('aria-valuemax', comp.unidades_totais);
	
	
	
	  data.equivalentes.forEach(p => {
	    console.log('data,equivalentes <', p);
	
	    const porcentoEquiv = comp.unidades_totais > 0 ? Math.min(100, Math.round((p.bipados / comp.unidades_totais) * 100)) : 0;
	
	    listaProdutos.innerHTML += `
	      <!-- ============ PRODUTO EQUIVALENTE ============ -->
	      <div id="produto-EQV-${p.id_tiny_equivalente}" class="produto-item-modal" data-role="equivalente">
	        <!-- lixeira no canto direito -->
	
	        <div class="d-flex" style="display:flex; align-items:center; justify-content:space-between; gap:8px;">
	          <div>
	            <strong id="nome-${p.sku_bipado}">${p.nome_equivalente}</strong>
	            <span id="sku-${p.sku_bipado}" class="badge">${p.sku_bipado}</span>
	            <span id="tipo-${p.sku_bipado}" class="badge">Equivalente</span>
	          </div>
	          <div class="small" style="font-size:.85rem; color:#6b7280;">
	            Bipado: <strong id="bipado-${p.sku_bipado}">${p.bipados}</strong> /
	            Total: <strong id="total-${p.sku_bipado}">${comp.unidades_totais}</strong>
	            (<span id="percent-${p.sku_bipado}">${porcentoEquiv}</span>%)
	          </div>
	        </div>
	
	        <!-- Barra de progresso -->
	        <div id="progressWrap-${p.sku_bipado}" class="progress"
	          style="height:10px; background:#e5e7eb; border-radius:6px; overflow:hidden; margin:8px 0;">
	          <div id="progressFill-${p.sku_bipado}" class="progress-bar" role="progressbar"
	            style="width:0%; background:#3b82f6; height:10px;" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100">
	          </div>
	        </div>
	
	        <!-- Controles de quantidade -->
	        <div class="controls" style="display:flex; align-items:center; gap:8px;">
	          <button id="menos-${p.sku_bipado}" onclick="removeUnEditarProduto('${p.sku_bipado}');" type="button" class="btn btn-outline">‚àí</button>
	          <input id="quantidade-${p.sku_bipado}" type="number" value="${p.bipados}" min="0" step="1" style="width:100px;">
	          <button id="mais-${p.sku_bipado}" onclick="addUnEditarProduto('${p.sku_bipado}');" type="button" class="btn btn-outline">+</button>
	
	
	          <div class="last-action-wrap">
	            <button id="excluir-${p.sku_bipado}" class="btn-icon"
	                    aria-label="Excluir equivalente"
	                    title="Excluir equivalente"
	                    data-sku-original="${sku}"
	                    data-sku-equivalente="${p.sku_bipado}"
	                    data-id-tiny="${p.id_tiny_equivalente}"
	                    onclick="excluirEquivalente(this)">
	              <svg width="18" height="18" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
	                <path d="M9 3h6a1 1 0 0 1 1 1v1h4v2H4V5h4V4a1 1 0 0 1 1-1Zm2 5h2v11h-2V8Zm-4 0h2v11H7V8Zm8 0h2v11h-2V8Z"/>
	              </svg>
	            </button>
	
	            <span class="status">
	              √öltima a√ß√£o: <strong id="status-${p.sku_bipado}">‚Äî</strong>
	            </span>
	          </div>
	
	
	        </div>
	      </div>
	            `;
	
	
	    const fillEquiv = document.getElementById(`progressFill-${p.sku_bipado}`);
	    fillEquiv.style.width = `${porcentoEquiv}%`;
	    fillEquiv.setAttribute('aria-valuenow', p.bipados);
	    fillEquiv.setAttribute('aria-valuemax', comp.unidades_totais);
	
	  });
	
	  // Mostra o modal
	  document.getElementById('modal-editar-produto').style.display = 'block';
	
	  // Evita o scroll de fundo (opcional)
	  document.body.style.overflow = 'hidden';
	}
	
	async function excluirEquivalente(obj) {
	  console.log('Este √© o OBJETO √† ser exclu√≠do:', obj);
	  const skuExcloi = obj.id.replace("excluir-", "");
	  const skuOriginal = obj.dataset.skuOriginal;
	  console.log('Este √© o SKU do objeto:', skuExcloi);
	  console.log('Este √© o SKU Original do objeto:', skuOriginal);
	
	
	  const payload = {
	    id_agend: idAgend,
	    sku_original: skuOriginal,
	    sku_bipado: skuExcloi
	  };
	
	  const resp = await fetch('/api/equiv/delete', {
	    method: 'DELETE',
	    headers: { 'Content-Type': 'application/json' },
	    body: JSON.stringify(payload)
	  });
	
	  const data = await resp.json();
	  console.log('Resposta da exclus√£o:', data);
	
	  if (data.ok) {
	    notify.success(`O produto com o SKU "${skuExcloi}" foi exclu√≠do com sucesso!`);
	
	    const id_tiny_equivalente = obj.dataset.idTiny;
	    const div = document.getElementById(`produto-EQV-${id_tiny_equivalente}`);
	
	    div.remove();
	  } else {
	    notify.error(`Ocorreu um erro ao tentar excluir o produto. Contate um Desenvolvedor.`);
	    console.log('Erro ao tentar excluir produto equivalente do agendamento:', data);
	  }
	
	}
	
	function addUnEditarProduto(sku) {
	  const input = document.getElementById(`quantidade-${sku}`);
	  let value = Number(input.value)
	  value++;
	  let totalBipados = 0;
	  const produtos = document.querySelectorAll('#listaProdutos [id^="produto-"]');
	  const totalPermitido = Number(produtos[0].querySelector('[id^="total-"]').textContent.trim());
	  console.log(produtos);
	
	  produtos.forEach(prod => {
	    const bipadoElement = prod.querySelector('[id^="quantidade-"]');
	
	    if (bipadoElement) {
	      const bipadoValue = Number(bipadoElement.value.trim());
	      console.log(`Produto: Sla ‚Üí Bipado: ${bipadoValue}`);
	      totalBipados += bipadoValue;
	    }
	  });
	  console.log('Total Existente:', totalBipados);
	  console.log('Total Permitido', totalPermitido);
	
	  if (++totalBipados <= totalPermitido) {
	    input.value = value;
	  } else {
	    notify.error('Voc√™ n√£o pode adicionar mais produtos do que o agendamento est√° pedindo.');
	  }
	}
	
	function removeUnEditarProduto(sku) {
	  const input = document.getElementById(`quantidade-${sku}`);
	  let value = Number(input.value)
	  value--;
	
	  if (value >= 0) {
	    input.value = value;
	  } else {
	    notify.error('N√£o √© poss√≠vel adicionar unidades negativas ao agendamento! \nPor favor, nem tente ;-)');
	  }
	}
	
	async function salvarAlteracoes() {
	  // Aqui, para otimizar a quantidade de requisi√ß√µes feitas ao banco  
	  // Ele deve verificar o que houve mudan√ßas, para isso, verifica se os valores s√£o iguais 
	  // ou seja, se bipados e a quantidade que est√° no input s√£o iguais, se sim ent√£o ignora, caso contr√°rio faz a altera√ß√£o
	
	  const confirmado = await salvarAlteracoesConfirmacaoGerente();
	  const listaProdutos = document.querySelectorAll('#listaProdutos [id^="produto-"]');
	  const listaEditados = [];
	
	  for (let i = 0; i < listaProdutos.length; i++) {
	    const bipadosOriginal = Number(listaProdutos[i].querySelector('[id^="bipado-"]').textContent.trim());
	    // console.log(`Bipados de cada um #${i+1}>`, bipadosOriginal);
	    const bipadosEditado = listaProdutos[i].querySelector('[id^="quantidade-"]').value;
	    // console.log(`Bipados editado >`, bipadosEditado);
	
	    if (Number(bipadosOriginal) !== Number(bipadosEditado)) {
	      console.log(`√çndice ${i} foi editado`);
	      listaEditados.push(listaProdutos[i]);
	    }
	  }
	  console.log('Estes foram editados >', listaEditados);
	
	  console.log('listaProdutos >', listaProdutos);
	
	  if (listaEditados.length > 0) {
	    for (const prod of listaEditados) {
	      console.log('>', prod);
	
	      if (prod.id.includes("EQV")) {
	        console.log('EQV');
	        const input = prod.querySelector('[id^="quantidade-"]');
	        const skuOriginal = document.getElementById('master-sku-view').textContent.trim();
	        const skuBipado = input.id.replace("quantidade-", "");
	        console.log('Esse √© o SKU >', skuOriginal);
	
	
	        const bipadosOriginal = Number(prod.querySelector('[id^="bipado-"]').textContent.trim());
	        const bipadosEditado = prod.querySelector('[id^="quantidade-"]').value;
	        const delta = bipadosEditado - bipadosOriginal;
	
	        const payload = {
	          id_agend: idAgend,
	          sku_original: skuOriginal,
	          sku_bipado: skuBipado,
	          quant: delta
	        }
	
	        console.log('Este ser√° o payload >', payload);
	
	        console.log('Fazendo requisi√ß√£o');
	        const req = await fetch('/api/equiv/add-unidades', {
	          method: 'POST',
	          headers: { 'Content-Type': 'application/json' },
	          body: JSON.stringify(payload)
	        });
	        const data = await req.json();
	
	        console.log('Essa foi a resposta da requisi√ß√£o de edit >', data);
	        if (data.ok) {
	          notify.success(`Edi√ß√£o do produto: ${skuBipado}               \nRealizado com sucesso!`);
	        } else {
	          notify.success(`Ocorreu um erro ao editar o produto: ${skuBipado}               \n`);
	          console.log('Erro >', data);
	        }
	      } else if (prod.id.includes("ORIGINAL")) {
	        console.log('ORIGINAL');
	        const skuOriginal = document.getElementById('master-sku-view').textContent.trim();
	        const input = prod.querySelector(`[id^="quantidade-${skuOriginal}"]`);
	
	        console.log('Esse √© o SKU >', skuOriginal);
	        console.log(`bipado-${skuOriginal}`);
	
	
	        const bipadosOriginal = Number(document.getElementById(`bipado-${skuOriginal}`).textContent.trim());
	        const bipadosEditado = document.getElementById(`quantidade-${skuOriginal}`).value;
	
	        const delta = bipadosEditado - bipadosOriginal;
	        console.log('Delta T>', delta);
	
	        const payload = {
	          id_agend: idAgend,
	          sku: skuOriginal,
	          quant: delta
	        };
	        console.log('Payload ORiginal >', payload);
	
	        const req = await fetch('/api/bipar', {
	          method: 'POST',
	          headers: { 'Content-Type': 'application/json' },
	          body: JSON.stringify(payload)
	        });
	
	        const data = await req.json();
	        console.log('Data Resposta para o produto original >', data);
	
	        if (data.ok) {
	          notify.success(`Edi√ß√£o do produto original: ${skuOriginal}           \nRealizado com sucesso!`);
	        } else {
	          notify.success(`Ocorreu um erro ao editar o produto: ${skuOriginal}               \n`);
	          console.log('Erro >', data);
	        }
	      }
	    };
	    fecharModal();
	  } else {
	    fecharModal();
	    notify('N√£o houve nenhuma altera√ß√£o no produto.');
	  }
	}
	
	async function verificarSeECaixaFechada(valorLido) {
	  try {
	    const resp = await fetch(`/api/tiny/composicao-auto?valor=${encodeURIComponent(valorLido)}`, {
	      method: 'GET',
	      headers: { 'Accept': 'application/json' },
	      credentials: 'include' // sess√£o
	    });
	
	    if (!resp.ok) return null;
	
	    const composicao = await resp.json();
	    if (!composicao || composicao.ok === false) return null;
	    if (!Array.isArray(composicao.kit) || composicao.kit.length !== 1) return null;
	
	    const k = composicao.kit[0];
	    if (!k || !k.produto) return null;
	
	    return {
	      id_tiny: k.produto.id,
	      sku: k.produto.sku,
	      nome: k.produto.descricao,
	      un: k.quantidade
	    };
	  } catch (e) {
	    console.error('verificarSeECaixaFechada (auto) erro:', e);
	    return null;
	  }
	}
	
	async function salvarAlteracoesConfirmacaoGerente() {
	
	  return true
	}
	
	function fecharModal() {
	  document.getElementById('modal-editar-produto').style.display = 'none';
	  document.body.style.overflow = '';
	}
	
	// Fecha clicando fora
	window.addEventListener('click', (e) => {
	  const modal = document.getElementById('modal-editar-produto');
	  if (e.target === modal) fecharModal();
	});
	
	// Fecha com ESC
	window.addEventListener('keydown', (e) => {
	  if (e.key === 'Escape') fecharModal();
	});

[static/alterar_agendamento]
alt_agend.css=body {
	  background-color: #e9f1fb;
	}
	
	.card-form {
	  background-color: #fff;
	  padding: 25px;
	  border-radius: 10px;
	  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.1);
	  margin-top: 20px;
	}
	
	.btn-primary-custom {
	  background-color: #4da6ff;
	  border-color: #4da6ff;
	  color: #fff;
	}
	
	.btn-primary-custom:hover {
	  background-color: #4091e8;
	  border-color: #4091e8;
	}
	
	
	select {
	  background-image:
	    linear-gradient(45deg, transparent 50%, gray 50%),
	    linear-gradient(135deg, gray 50%, transparent 50%),
	    linear-gradient(to right, #ccc, #ccc);
	  background-position:
	    calc(100% - 20px) calc(1em + 2px),
	    calc(100% - 15px) calc(1em + 2px),
	    calc(100% - 2.5em) 0.5em;
	  background-size:
	    5px 5px,
	    5px 5px,
	    1px 1.5em;
	  background-repeat: no-repeat;
	}
	
	select:focus {
	  background-image:
	    linear-gradient(45deg, green 50%, transparent 50%),
	    linear-gradient(135deg, transparent 50%, green 50%),
	    linear-gradient(to right, #ccc, #ccc);
	  background-position:
	    calc(100% - 15px) 1em,
	    calc(100% - 20px) 1em,
	    calc(100% - 2.5em) 0.5em;
	  background-size:
	    5px 5px,
	    5px 5px,
	    1px 1.5em;
	  background-repeat: no-repeat;
	  border-color: green;
	  outline: 0;
	}
	
	
	select:-moz-focusring {
	  color: transparent;
	  text-shadow: 0 0 0 #000;
	}
	
alt_agend.js=

[static/compras]
compras.css=body {
	    font-weight: 500;
	}
	
	/* --- Card Wrapper --- */
	.card {
	    border: none;
	    border-radius: 0.5rem;
	}
	
	.card-body {
	    padding: 0;
	}
	
	/* --- Estilos gerais de tabela --- */
	.table {
	    font-size: 0.95rem;
	    margin-bottom: 0;
	}
	
	.table-hover tbody tr:hover {
	    background-color: #f1f5f9;
	}
	
	/* --- Wrapper responsivo com cantos arredondados --- */
	.table-responsive {
	    overflow: hidden;
	    border-radius: 0.5rem;
	}
	
	.table-responsive table {
	    width: 100%;
	    border-collapse: separate;
	    border-spacing: 0;
	}
	
	/* --- Cabe√ßalho azul + branco --- */
	.table thead {
	    background-color: #007bff;
	}
	
	.table thead th {
	    color: #fff;
	    border: none;
	    font-weight: 600;
	    padding: 0.75rem 1rem;
	}
	
	/* --- Arredonda s√≥ o topo do thead --- */
	.table thead th:first-child {
	    border-top-left-radius: 0.5rem;
	}
	
	.table thead th:last-child {
	    border-top-right-radius: 0.5rem;
	}
	
	/* --- Listras ‚Äúzebra‚Äù e c√©lulas --- */
	.table tbody tr:nth-child(even) {
	    background-color: #fbfcfd;
	}
	
	.table td,
	.table th {
	    padding: 0.75rem 1rem;
	    vertical-align: middle;
	}
	
	/* Melhorias visuais do dropdown */
	.dropdown-menu {
	    min-width: 200px;
	    font-size: 0.95rem;
	}
	
	.dropdown-menu .dropdown-item {
	    padding: 0.6rem 1rem;
	    transition: background 0.2s ease;
	}
	
	.dropdown-menu .dropdown-item:hover {
	    background-color: #f1f5f9;
	}
	
	input[type="number"] {
	    width: 70px;
	    padding: 4px 8px;
	    margin-top: 5px;
	    border: 1px solid #ccc;
	    border-radius: 6px;
	    text-align: center;
	    font-weight: bold;
	    color: #333;
	    background-color: #f9f9f9;
	    transition: border-color 0.3s, box-shadow 0.3s;
	}
	
	input[type="number"]:focus {
	    border-color: #007bff;
	    box-shadow: 0 0 0 2px rgba(0, 123, 255, 0.25);
	    outline: none;
	    background-color: #fff;
	}
	
	
	/* --- Responsividade para telas pequenas --- */
	@media screen and (max-width: 1024px) {
	    .table thead {
	        display: none;
	    }
	
	    .table tbody,
	    .table tr,
	    .table td {
	        display: block;
	        width: 100%;
	    }
	
	    .table tr {
	        margin-bottom: 1rem;
	        background: #fff;
	        border-radius: 0.5rem;
	        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
	        padding: 0.75rem;
	    }
	
	    .table td {
	        padding: 1.5rem 1rem 0.5rem 1rem;
	        border: none;
	        text-align: left;
	        position: relative;
	    }
	
	    .table td::before {
	        content: attr(data-label);
	        position: absolute;
	        left: 1rem;
	        top: 0.5rem;
	        font-weight: bold;
	        color: #6c757d;
	        font-size: 0.85rem;
	        display: block;
	        width: 100%;
	        margin-bottom: 0.25rem;
	        color: #0D6EFD;
	    }
	}
	
	.input-wrapper {
	    display: inline-block;
	    position: relative;
	    max-width: 100%;
	}
	
	.input-wrapper input[type="number"] {
	    width: auto;
	    min-width: 60px;
	    max-width: 100px;
	    box-sizing: content-box;
	}
	
	.input-wrapper .input-mirror {
	    position: absolute;
	    top: 0;
	    left: 0;
	    visibility: hidden;
	    white-space: pre;
	    font-weight: bold;
	    font-family: inherit;
	    font-size: inherit;
	    padding: 4px 8px;
	}
	
	@media print {
	    body * {
	        visibility: hidden;
	    }
	
	    #container-table,
	    #container-table * {
	        visibility: visible;
	    }
	
	    #container-table {
	        position: absolute;
	        top: 0;
	        left: 0;
	        width: 100%;
	        overflow: visible !important;
	        max-height: none !important;
	    }
	
	    .table-responsive {
	        overflow: visible !important;
	        max-height: none !important;
	    }
	
	    input[type="number"] {
	        border: none !important;
	        background: transparent !important;
	        font-weight: normal;
	        width: auto !important;
	    }
	
	    .input-wrapper .input-mirror {
	        display: none !important;
	    }
	}
	
	/* Esconde o cabe√ßalho de impress√£o na tela normal */
	.print-header {
	    display: none;
	}
	
	/* Estiliza o cabe√ßalho apenas na impress√£o */
	@media print {
	    .print-header {
	        display: block;
	        text-align: center;
	        margin-bottom: 2rem;
	    }
	
	    .print-logo {
	        max-width: 150px;
	        margin-bottom: 1rem;
	    }
	
	    .print-title {
	        font-size: 1.5rem;
	        font-weight: bold;
	    }
	}
	
	@media print {
	    .print-meta {
	        font-size: 0.9rem;
	        margin-top: -1rem;
	        margin-bottom: 2rem;
	        color: #444;
	    }
	
	    .print-meta span {
	        font-weight: bold;
	    }
	}
compras.js=async function getTinyData(ele) {
	    let id = ele.id.split('row-')[1]
	    let quant_total = $(`#qnt-total-${id}`).text()
	    console.log(quant_total)
	    const response = await fetch(`https://agendamento.jaupesca.com.br/dados-compra-tiny/${id}`, { mode: 'cors' }) // TODO: Mudar para o IP correto
	    if (!response.ok) {
	        throw new Error(`Response status: ${response.status}`)
	    }
	    const texto = await response.json()
	    console.log(texto['fornecedores'])
	    if (texto['fornecedores'].length > 0) {
	        $(`#fornecedor-${id}`).text(texto['fornecedores'][0]['nome'] != '' ? texto['fornecedores'][0]['nome'] : "N√£o achado")
	        $(`#cod-fornecedor-${id}`).text(texto['fornecedores'][0]['codigoProdutoNoFornecedor'] != '' ? texto['fornecedores'][0]['codigoProdutoNoFornecedor'] : "N√£o achado")
	    } else {
	        $(`#fornecedor-${id}`).text("N√£o achado")
	        $(`#cod-fornecedor-${id}`).text("N√£o achado")
	    }
	    $(`#qnt-faltante-${id}`).text(Math.max(0, quant_total - parseInt(texto['estoque']['quantidade'])))
	    $(`#estoque-tiny-${id}`).text(texto['estoque']['quantidade'])
	    $(`#qnt-compra-${id}`).val(0)
	}
	
	Array.from($('.tr-class')).forEach((x, index, arr) => {
	    
	   getTinyData(x) // TODO Reativar
	})
	
	function turnTableDataToJson(extensao) {
	    let allData = []
	    Array.from($('.tr-class')).forEach((produto) => {
	        let children = $(produto).children()
	        allData.push(JSON.stringify(
	            {
	                nome: children[0].textContent,
	                fornecedor: children[1].textContent,
	                cod_fornecedor: children[2].textContent,
	                qnt_total: children[3].textContent,
	                estoque_tiny: children[4].textContent,
	                qnt_faltante: children[5].textContent,
	                qnt_compra: $(children[6]).children()[0].value
	            }))
	    })
	    let data = new FormData()
	    data.append('dados', allData)
	    fetch(`https://agendamento.jaupesca.com.br/compra-planilha/${extensao}`, { // TODO: Mudar para o IP correto
	        mode: 'cors',
	        method: 'POST',
	        body: data
	    }).then((response) => {
	        window.location.replace(response.url);
	    })
	}
	
	function autoResizeInput(input) {
	    const mirror = input.nextElementSibling;
	    mirror.textContent = input.value || "0";
	    input.style.width = mirror.offsetWidth + "px";
	}
	
	function removeComprado(input) {
	    quant = Array.from(input.parentElement.parentElement.children[0].children)[0].value
	    id = input.id.split('remover-')[1]
	
	    fetch(`https://agendamento.jaupesca.com.br/remover-compra/${id}/${quant}`, {mode: 'cors'}) //TODO - Localiza√ß√£o do endere√ßo
	}
	
	// Aplica ao carregar a tabela
	window.addEventListener("load", () => {
	    document.querySelectorAll(".input-wrapper input[type='number']").forEach(input => autoResizeInput(input));
	});
	
	window.addEventListener("load", () => {
	    const hoje = new Date();
	    const dataFormatada = hoje.toLocaleDateString('pt-BR') + ' ' + hoje.toLocaleTimeString('pt-BR');
	    const spanData = document.getElementById("data-hoje");
	    if (spanData) {
	        spanData.innerText = dataFormatada;
	    }
	});
	

[static/reservados]
reservados.css=
reservados.js=

[static/erro]
erro.css=.erro-container {
	    height: 80vh;
	    display: flex;
	    flex-direction: column;
	    justify-content: center;
	    align-items: center;
	    text-align: center;
	    background-color: #fff;
	}
	
	.erro-titulo {
	    text-shadow: -5px 5px 0px #0E2C76;
	    font-size: 10rem;
	    font-weight: bold;
	    color: #fbbf24;
	    border-radius: 8px;
	    display: flex;
	    align-items: center;
	    gap: 1rem;
	}
	
	.erro-mensagem {
	    font-size: 1.8rem;
	    color: #0d2d75;
	    font-weight: 700;
	}
	
	#err-title {
	    color: black;
	
	}
	
	#err-msg-pri {
	    font-weight: bold;
	}
	
	#err-msg-sec {
	    font-weight: bold;
	}
	
	#err-code {
	    font-weight: 400;
	}
erro.js=

[static/config]
config.css=.printer-card {
	    background-color: #ffffff;
	    border-radius: 12px;
	    padding: 16px;
	    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
	    max-width: 700px;
	    margin: 20px auto;
	    display: flex;
	    align-items: center;
	    gap: 15px;
	}
	
	.perfil-card {
	    padding-bottom: 3.25rem;
	    padding-top: 3rem;
	    background-color: #ffffff;
	    border-radius: 12px;
	    box-shadow: 0 4px 8px rgba(0, 0, 0, 0.1);
	    margin: 20px auto;
	    text-align: center;
	}
	
	.perfil-card .perfil-avatar {
	    width: 100px;
	    height: 100px;
	    border-radius: 50%;
	    border: 3px solid #002B5C;
	    object-fit: cover;
	    display: block;
	    margin: 0 auto 12px;
	}
	
	/* Bot√£o de sair no perfil */
	.perfil-card .btn-logout {
	    margin-top: 12px;
	    display: inline-flex;
	    align-items: center;
	    gap: 6px;
	    color: #F64650;
	    border: 1px solid #F64650;
	    background: transparent;
	    padding: 6px 12px;
	    border-radius: 4px;
	    font-weight: bold;
	    text-decoration: none;
	}
	
	.perfil-card .btn-logout:hover {
	    background: rgba(246,70,80,0.1);
	}
	
config.js=document.addEventListener("DOMContentLoaded", () => {
	    const PRINTER_MAP = {
	        btnImpressoraRelatorio: { key: "printer_relatorio" },
	        btnImpressoraCx: { key: "printer_caixa" },
	        btnImpressoraId: { key: "printer_id" },
	    };
	
	    // Para fins de DEBUG
	    // Abaixo tem o c√≥digo que quando todo o DOM √© carregado
	    // Surge um ALERTA dizendo as impressoras que est√£o salvas no localStorage /* para confer√™ncia */
	    // (pode ser removido depois de testado)
	    /*
	    const savedPrinters = Object.values(PRINTER_MAP).map(cfg => {
	        const v = localStorage.getItem(cfg.key);
	        return `${cfg.key}: ${v ? v : "(nenhuma)"}`;
	    }).join("\n");
	    if (savedPrinters) {
	        alert("Impressoras salvas:\n" + savedPrinters);
	    } else {
	        alert("Nenhuma impressora salva.");
	    }
	    */
	
	    // Elementos do modal
	    const modalEl = document.getElementById("printerModal");
	    const btnOk = document.getElementById("btnConfirmPrinter");
	    const loadingEl = document.getElementById("printerLoading");
	    const listWrap = document.getElementById("printerListWrap");
	    const listEl = document.getElementById("printerList");
	    const emptyEl = document.getElementById("printerEmpty");
	    const errorEl = document.getElementById("printerError");
	    const bsModal = modalEl ? new bootstrap.Modal(modalEl) : null;
	
	    // Labels de impressora selecionada
	    const lblRelatorio = document.getElementById("lblImpressoraRelatorio");
	    const lblCaixa = document.getElementById("lblImpressoraCx");
	    const lblId = document.getElementById("lblImpressoraId");
	
	    // Atualiza os labels com o que est√° salvo
	    const updateLabels = () => {
	        if (lblRelatorio) {
	            const v = localStorage.getItem("printer_relatorio");
	            lblRelatorio.textContent = v ? v : "Nenhuma impressora selecionada";
	        }
	        if (lblCaixa) {
	            const v = localStorage.getItem("printer_caixa");
	            lblCaixa.textContent = v ? v : "Nenhuma impressora selecionada";
	        }
	        if (lblId) {
	            const v = localStorage.getItem("printer_id");
	            lblId.textContent = v ? v : "Nenhuma impressora selecionada";
	        }
	    };
	    updateLabels();
	
	    // Atualiza os labels quando uma impressora √© selecionada
	    document.addEventListener("printer:selected", (e) => {
	        const { key } = e.detail || {};
	        if (key && Object.values(PRINTER_MAP).some(cfg => cfg.key === key)) {
	            updateLabels();
	        }
	    });
	
	    // NOVO: flag de guarda + helpers
	    let isFetchingPrinters = false;
	    const triggerButtons = Object.keys(PRINTER_MAP)
	        .map(id => document.getElementById(id))
	        .filter(Boolean);
	
	    const disableTriggers = (state) => {
	        triggerButtons.forEach(b => b.disabled = state);
	    };
	
	    const getSaved = (key) => localStorage.getItem(key);
	    const setSaved = (key, name) => localStorage.setItem(key, name);
	
	    let currentKey = null;
	    let selectedName = null;
	
	    function createPrinterItem(name, preselect = false) {
	        const item = document.createElement("button");
	        item.type = "button";
	        item.className = "list-group-item list-group-item-action d-flex justify-content-between align-items-center";
	        item.setAttribute("role", "radio");
	        item.setAttribute("aria-checked", preselect ? "true" : "false");
	        item.textContent = name;
	
	        const mark = document.createElement("span");
	        mark.className = "badge text-bg-light";
	        mark.textContent = preselect ? "Atual" : "Selecionar";
	        item.appendChild(mark);
	
	        if (preselect) {
	            item.classList.add("active");
	            selectedName = name;
	            btnOk.disabled = false;
	        }
	
	        item.addEventListener("click", () => {
	            listEl.querySelectorAll(".list-group-item").forEach(el => {
	                el.classList.remove("active");
	                el.setAttribute("aria-checked", "false");
	                const b = el.querySelector(".badge");
	                if (b) b.textContent = "Selecionar";
	            });
	            item.classList.add("active");
	            item.setAttribute("aria-checked", "true");
	            mark.textContent = "Selecionado";
	            selectedName = name;
	            btnOk.disabled = false;
	        });
	
	        return item;
	    }
	
	    function resetModalUI() {
	        btnOk.disabled = true;
	        selectedName = null;
	        // Garantir ‚Äúloading vis√≠vel‚Äù e lista limpa
	        loadingEl.classList.remove("d-none");
	        listWrap.classList.add("d-none");
	        emptyEl.classList.add("d-none");
	        errorEl.classList.add("d-none");
	        errorEl.textContent = "";
	        listEl.innerHTML = "";
	    }
	
	    function openPrinterModal(key) {
	        // NOVO: guarda anti-bounce
	        if (isFetchingPrinters) return;
	        isFetchingPrinters = true;
	        disableTriggers(true);
	
	        currentKey = key;
	        resetModalUI();
	
	        // Abre o modal J√Å em carregamento (bloqueia a UI)
	        bsModal?.show();
	
	        if (!window.BrowserPrint || typeof BrowserPrint.getLocalDevices !== "function") {
	            loadingEl.classList.add("d-none");
	            errorEl.textContent = "Zebra BrowserPrint n√£o detectado. Instale/abra o BrowserPrint para listar impressoras.";
	            errorEl.classList.remove("d-none");
	            isFetchingPrinters = false;
	            disableTriggers(false);
	            return;
	        }
	
	        BrowserPrint.getLocalDevices(
	            (devicesObject) => {
	                const printers = devicesObject?.printer || [];
	                loadingEl.classList.add("d-none");
	                listWrap.classList.remove("d-none");
	
	                const saved = getSaved(key);
	
	                if (!printers.length) {
	                    emptyEl.classList.remove("d-none");
	                } else {
	                    // limpa sempre antes de popular (evita duplicar se algo der reload no modal)
	                    listEl.innerHTML = "";
	                    printers.forEach(p => {
	                        listEl.appendChild(createPrinterItem(p.name, saved && p.name === saved));
	                    });
	                    btnOk.disabled = !listEl.querySelector(".list-group-item.active");
	                }
	
	                isFetchingPrinters = false;
	                disableTriggers(false);
	            },
	            (err) => {
	                loadingEl.classList.add("d-none");
	                errorEl.textContent = "Falha ao comunicar com o BrowserPrint. Verifique a instala√ß√£o e tente novamente.";
	                errorEl.classList.remove("d-none");
	                console.error("[BrowserPrint] getLocalDevices error:", err);
	                isFetchingPrinters = false;
	                disableTriggers(false);
	            }
	        );
	    }
	
	    document.getElementById("btnConfirmPrinter").addEventListener("click", () => {
	        if (!currentKey || !selectedName) return;
	        setSaved(currentKey, selectedName);
	        document.dispatchEvent(new CustomEvent("printer:selected", {
	            detail: { key: currentKey, name: selectedName }
	        }));
	        bsModal?.hide();
	    });
	
	    // Liga os bot√µes de abrir
	    Object.entries(PRINTER_MAP).forEach(([btnId, cfg]) => {
	        const btn = document.getElementById(btnId);
	        if (!btn) return;
	        btn.addEventListener("click", () => openPrinterModal(cfg.key));
	    });
	});

[templates]
agendamentos.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='agendamentos/agendamentos.css') }}
	{% endblock %}
	
	{% block content %}
	<!-- Colaborador j√° logado -->
	<input type="hidden" id="nome_colaborador" value="{{ session.nome_display_usuario }}">
	<div class="container pt-4">
	
	  <!-- 1) Bot√£o ‚ÄúFiltros‚Äù ‚Äî s√≥ aparece em telas < md -->
	  <div class="d-md-none text-end mb-3">
	    <button class="btn btn-outline-primary new-agend" type="button" data-bs-toggle="collapse"
	            data-bs-target="#filterPanel" aria-expanded="false" aria-controls="filterPanel">
	      <i class="bi bi-funnel-fill"></i> Filtros
	    </button>
	  </div>
	
	  <!-- 2) Painel de filtros -->
	  <div class="collapse d-md-block card mb-4 p-3" id="filterPanel">
	    <div class="row g-3 row-cols-1 row-cols-sm-2 row-cols-md-4 new-agend mb-2">
	      <div class="col">
	        <label class="form-label">Status</label>
	        <select id="inp_status_pedido" class="form-select" onchange="setFiltros()">
	          <option selected>Todos</option>
	          <option value="1">Limpeza</option>
	          <option value="3">Confer√™ncia</option>
	          <option value="4">Embalar</option>
	          <option value="5">Expedi√ß√£o</option>
	          <option value="2">Finalizado</option>
	        </select>
	      </div>
	      <div class="col">
	        <label class="form-label">Empresa</label>
	        <select id="inp_emp_pedido" class="form-select" onchange="setFiltros()">
	          <option selected>Todas</option>
	          <option value="0">Nenhuma</option>
	          <option value="1">Ja√∫ Pesca</option>
	          <option value="2">Ja√∫ Fishing</option>
	          <option value="3">L.T. Sports</option>
	        </select>
	      </div>
	      <div class="col">
	        <label class="form-label">Loja</label>
	        <select id="inp_mktp_pedido" class="form-select" onchange="setFiltros()">
	          <option selected>Todas</option>
	          <option value="1">Mercado Livre</option>
	          <option value="2">Magalu</option>
	          <option value="3">Shopee</option>
	          <option value="4">Amazon</option>
	        </select>
	      </div>
	      <div class="col">
	        <label class="form-label">N¬∫ Pedido</label>
	        <input id="inp_num_pedido" type="text" class="form-control" placeholder="Digite o n√∫mero do pedido"
	               oninput="setFiltros()">
	      </div>
	    </div>
	  </div>
	
	  <!-- Bot√£o ‚ÄúNovo Agendamento‚Äù -->
	  <a href="/agendamentos/criar" class="card add-new-agendamento mb-3 text-center text-decoration-none">
	    <div class="card-body new-agend">
	      <i class="bi bi-plus-circle me-2"></i> Novo Agendamento
	    </div>
	  </a>
	
	  <div class="container p-1 list-scroll">
	    {% for agendamento in dados %}
	    <div
	      class="card mb-3 agendamento-container emp-{{ agendamento.empresa }} tipo-{{ agendamento.id_tipo }} id-{{ agendamento.id_agend_ml }} id_mktp-{{ agendamento.id_mktp }}"
	      data-centro="{{ agendamento.centro_distribuicao or '' }}"
	    >
	      <div class="card-body d-block d-sm-flex justify-content-between align-items-center">
	        <div>
	          <span class="badge
	            {% if agendamento.id_tipo == 1 %} status-limpeza
	            {% elif agendamento.id_tipo == 2 %} status-finalizado
	            {% elif agendamento.id_tipo == 3 %} status-conferencia
	            {% elif agendamento.id_tipo == 4 %} status-embalar
	            {% elif agendamento.id_tipo == 5 %} status-expedicao
	            {% else %} bg-dark
	            {% endif %}">
	            {% if agendamento.id_tipo == 1 %} LIMPEZA
	            {% elif agendamento.id_tipo == 2 %} FINALIZADO
	            {% elif agendamento.id_tipo == 3 %} CONFER√äNCIA
	            {% elif agendamento.id_tipo == 4 %} EMBALAR
	            {% elif agendamento.id_tipo == 5 %} EXPEDI√á√ÉO
	            {% else %} ERRO
	            {% endif %}
	          </span> |
	
	          <strong>Pedido:</strong> <span class="pedido-numero">{{ agendamento.id_agend_ml }}</span> |
	
	          {% if agendamento.empresa is none %}
	            <span class="text-primary">Nenhuma</span> |
	          {% else %}
	            <span class="badge
	              {% if agendamento.empresa == 0 %}empresa-nenhuma
	              {% elif agendamento.empresa == 1 %}empresa-jaupesca
	              {% elif agendamento.empresa == 2 %}empresa-jaufishing
	              {% elif agendamento.empresa == 3 %}empresa-ltsports
	              {% else %}bg-dark{% endif %}">
	              {% if agendamento.empresa == 0 %}Nenhuma
	              {% elif agendamento.empresa == 1 %}Ja√∫ Pesca
	              {% elif agendamento.empresa == 2 %}Ja√∫ Fishing
	              {% elif agendamento.empresa == 3 %}L.T. Sports
	              {% else %}Erro{% endif %}
	            </span> |
	          {% endif %}
	
	          {% if agendamento.id_mktp is none %}
	            <span class="text-primary">Nenhuma</span> |
	          {% else %}
	            <span class="badge
	              {% if agendamento.id_mktp == 1 %}id_mktp-mercadolivre
	              {% elif agendamento.id_mktp == 2 %}id_mktp-magalu
	              {% elif agendamento.id_mktp == 3 %}id_mktp-shopee
	              {% elif agendamento.id_mktp == 4 %}id_mktp-amazon
	              {% else %}bg-dark{% endif %}">
	              {% if agendamento.id_mktp == 1 %}Mercado Livre
	              {% elif agendamento.id_mktp == 2 %}Magalu
	              {% elif agendamento.id_mktp == 3 %}Shopee
	              {% elif agendamento.id_mktp == 4 %}Amazon
	              {% else %}Erro{% endif %}
	            </span> |
	          {% endif %}
	
	          <strong>Colaborador:</strong>
	          {% if agendamento.colaborador == '' %}
	            <span class="text-primary">Nenhum</span>
	          {% else %}
	            {% set my_list = agendamento.colaborador.split(' ') %}
	            {% if my_list|length >= 2 %}
	              <span class="text-primary">{{ my_list[0] }} {{ my_list[1][0] }}.</span>
	            {% else %}
	              <span class="text-primary">{{ my_list[0] }}</span>
	            {% endif %}
	          {% endif %}
	        </div>
	
	        <div class="d-flex flex-wrap justify-content-end flex-md-nowrap flex-md-row gap-2">
	
	          <!-- Bot√£o excluir -->
	          <button class="btn btn-outline-danger btn-sm" onclick="iniciarExclusao('{{ agendamento.id_bd }}')"
	                  title="Excluir Agendamento">
	            <i class="bi bi-eraser"></i>
	          </button>
	
	          <!-- Bot√£o composi√ß√£o -->
	          <a class="btn btn-outline-secondary btn-sm" href="/imprimir-comp/{{ agendamento.id_bd }}"
	             title="Imprimir composi√ß√£o">
	            <i class="bi bi-box-seam"></i>
	          </a>
	
	          <!-- Bot√£o visualizar -->
	          <a class="btn btn-outline-secondary btn-sm"
	             href="/retirado?id={{ agendamento.id_bd }}&tipo={{ agendamento.id_tipo }}&mudar=False"
	             title="Visualizar">
	            <i class="bi bi-eye"></i>
	          </a>
	
	          <!-- Bot√£o editar -->
	          <button class="btn btn-outline-secondary btn-sm"
	                  onclick="abrirModalAlteracoes('{{ agendamento.id_bd }}')" title="Editar">
	            <i class="bi bi-pencil"></i>
	          </button>
	
	          <!-- Bot√£o atualizar PDF -->
	          <button class="btn btn-outline-secondary btn-sm"
	                  onclick="abrirModalAtualizarPDF('{{ agendamento.id_bd }}', '{{ agendamento.id_agend_ml }}')"
	                  id="btn-modal--{{ agendamento.id_bd }}--" title="Atualizar PDF do Pedido">
	            <i class="bi bi-arrow-repeat"></i>
	          </button>
	
	          {# AQUI: prioridade para Finalizado -> mostra Relat√≥rio; caso contr√°rio, Come√ßar/Continuar #}
	          {% if agendamento.id_tipo == 2 %}
	            <!-- Finalizado: ver relat√≥rio -->
	            <button type="button" class="btn btn-secondary btn-sm"
	                    onclick="abrirModalRelatorio('{{ agendamento.id_agend_ml }}')" title="Ver Relat√≥rio">
	              <i class="bi bi-file-text-fill"></i> Relat√≥rio
	            </button>
	          {% elif agendamento.empresa == 0 and agendamento.colaborador == '' %}
	            <!-- Ainda n√£o configurado: Come√ßar -->
	            <button type="button" id="btn-modal--{{ agendamento.id_bd }}--{{ agendamento.id_tipo }}"
	                    class="btn btn-primary btn-sm" data-bs-toggle="modal" data-bs-target="#modalSelecionarEmpresa"
	                    onclick="changeIdAgendamento(this)">
	              Come√ßar
	            </button>
	          {% else %}
	            <!-- Configurado: Continuar -->
	            <button type="button" id="btn-modal--{{ agendamento.id_bd }}--{{ agendamento.id_tipo }}"
	                    class="btn btn-primary btn-sm" onclick="continuePhase(this)">
	              Continuar
	            </button>
	          {% endif %}
	        </div>
	
	      </div>
	    </div>
	    {% endfor %}
	  </div>
	
	  <!-- MODAL 1: Selecionar empresa -->
	  <div class="modal fade" id="modalSelecionarEmpresa" tabindex="-1" aria-labelledby="modalSelecionarEmpresaLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered modal-lg">
	      <div class="modal-content text-center">
	        <div class="modal-header justify-content-between">
	          <h5 class="modal-title" id="modalSelecionarEmpresaLabel">Selecione a empresa</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	        </div>
	        <div class="modal-body">
	          <select id="nome_empresa" class="form-select mb-3">
	            <option selected disabled>Selecione a empresa</option>
	            <option value="2">Ja√∫ Fishing</option>
	            <option value="3">L.T. Sports</option>
	            <option value="1">Pesca Ja√∫</option>
	          </select>
	          <button class="btn btn-secondary" onclick="abrirModalMarketplace()">OK</button>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- MODAL 2: Selecionar Marketplace -->
	  <div class="modal fade" id="modalSelecionarMarketplace" tabindex="-1">
	    <div class="modal-dialog modal-dialog-centered">
	      <div class="modal-content text-center">
	        <div class="modal-header">
	          <h5 class="modal-title">Selecione o Marketplace</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
	        </div>
	        <div class="modal-body">
	          <select id="nome_marketplace" class="form-select mb-3">
	            <option selected disabled>Selecione o Marketplace</option>
	            <option value="4">Amazon</option>
	            <option value="2">Magalu</option>
	            <option value="1">Mercado Livre</option>
	            <option value="3">Shopee</option>
	          </select>
	          <button class="btn btn-secondary" onclick="abrirModalAgendamento()">OK</button>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- MODAL: Centro de Distribui√ß√£o (com COLETA) -->
	  <div class="modal fade" id="modalCentroDistribuicao" tabindex="-1" aria-labelledby="modalCentroDistribuicaoLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered">
	      <div class="modal-content text-center">
	        <div class="modal-header">
	          <h5 class="modal-title" id="modalCentroDistribuicaoLabel">Escolher Centro de Distribui√ß√£o</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
	        </div>
	        <div class="modal-body">
	          <select id="nome_centro_distribuicao" class="form-select mb-3">
	            <option selected disabled>Selecione o centro</option>
	            <option value="BRSP11">Guarulhos ‚Äì BRSP11</option>
	            <option value="BRRC02">Sumar√© ‚Äì BRRC02</option>
	            <option value="BRRC01">Perus ‚Äì BRRC01</option>
	            <option value="BRSP10">SP10 ‚Äì BRSP10</option>
	            <option value="SP06">Ara√ßariguama ‚Äì SP06</option>
	            <option value="COLETA">Coleta Full</option>
	          </select>
	          <button class="btn btn-secondary" onclick="confirmarCentro()">OK</button>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- MODAL 3: Tipo de Agendamento -->
	  <div class="modal fade" id="modalTipoAgendamento" tabindex="-1">
	    <div class="modal-dialog modal-dialog-centered">
	      <div class="modal-content text-center">
	        <div class="modal-header">
	          <h5 class="modal-title">Tipo de Agendamento</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
	        </div>
	        <div class="modal-body">
	          <select id="nome_tipo" class="form-select mb-3">
	            <option selected disabled>Selecione o agendamento</option>
	            <option value="1">Limpeza</option>
	            <option value="3">Confer√™ncia</option>
	            <option value="4">Embalar</option>
	            <option value="5">Expedi√ß√£o</option>
	          </select>
	          <button class="btn btn-secondary" onclick="abrirModalUpload()">OK</button>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- MODAL 5: Upload (PDF ou Excel) -->
	  <div class="modal fade" id="modalUploadPdf" tabindex="-1" aria-labelledby="modalUploadPdfLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered">
	      <div class="modal-content text-center">
	        <div class="modal-header justify-content-between">
	          <h5 class="modal-title" id="modalUploadPdfLabel">Upload do Pedido</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	        </div>
	        <div class="modal-body">
	          <p class="text-muted small" id="upload_help_text">Selecione o arquivo para upload:</p>
	          <div id="info-atualizacao-pdf" class="mb-2 text-start text-muted small" style="display: none;"></div>
	          <form id="form_upload_pdf" action="/upload-pdf" method="POST" enctype="multipart/form-data">
	            <input type="file" name="path" accept="application/pdf" class="form-control mb-3" required>
	            <!-- hidden inputs preenchidos pelos modais anteriores -->
	            <input type="hidden" name="id_bd" id="upload_id_bd">
	            <input type="hidden" name="colaborador" id="upload_colaborador" value="{{ session.nome_display_usuario }}">
	            <input type="hidden" name="empresa" id="upload_empresa">
	            <input type="hidden" name="marketplace" id="upload_marketplace">
	            <input type="hidden" name="centro_distribuicao" id="inp_centro_distribuicao">
	            <input type="hidden" name="tipo" id="upload_tipo">
	            <button type="submit" class="btn btn-primary w-100">Enviar PDF</button>
	          </form>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- Modal: Edi√ß√£o de Agendamento -->
	  <div class="modal fade" id="modalEditarAgendamento" tabindex="-1">
	    <div class="modal-dialog modal-dialog-centered modal-lg">
	      <div class="modal-content">
	        <div class="modal-body text-center">
	          <div id="editarAgendamentoContent">Carregando...</div>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- Form oculto (mantive sua vers√£o completa) -->
	  <form id="form_retirado" action="/agendamentos/criar" method="POST" style="display: none;">
	    <input type="text" id="inp_id_pedido" name="inp_id_pedido">
	    <input type="text" id="inp_tipo_pedido" name="inp_tipo_pedido">
	    <input type="text" id="inp_nome_emp" name="inp_nome_emp">
	    <input type="text" id="inp_nome_col" name="inp_nome_col">
	    <input type="text" id="inp_mktp_pedido" name="inp_mktp_pedido">
	  </form>
	
	  <!-- Modal: Ver Relat√≥rio (reintroduzido) -->
	  <div class="modal fade" id="modalVerRelatorio" tabindex="-1" aria-labelledby="modalVerRelatorioLabel" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
	      <div class="modal-content">
	        <div class="modal-header">
	          <h5 class="modal-title" id="modalVerRelatorioLabel">Relat√≥rio do Agendamento</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	        </div>
	        <div class="modal-body" id="conteudo-relatorio">
	          <p>Carregando relat√≥rio...</p>
	        </div>
	        <div class="modal-footer">
	          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
	        </div>
	      </div>
	    </div>
	  </div>
	
	</div> <!-- /.container -->
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='agendamentos/agendamentos.js') }}
	{% endblock %}
alteracoes.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='alteracoes/alteracoes.css') }}
	{% endblock %}
	
	{% block content %}
	
	
	
	<div class="container p-4">
	    <div class="header-bar bg-primary text-white p-3 rounded mb-2">
	        <div class="d-flex justify-content-between align-items-center">
	            <!-- T√≠tulo sempre vis√≠vel -->
	            <h5 class="mb-0">Altera√ß√µes</h5>
	        </div>
	    </div>
	    <div class="card shadow-sm mb-4">
	        <div class="card-body p-0">
	            <div class="table-responsive" style="max-height:70vh; overflow-y:auto;">
	                <table class="table table-hover mb-0 align-middle">
	                    <thead>
	                        <tr>
	                            <th>ID Tiny</th>
	                            <th>Produto</th>
	                            <th>GTIN/EAN</th>
	                            <th>A√ß√µes</th>
	                        </tr>
	                    </thead>
	                    <tbody>
	                        {% for composicao in dados %}
	                        <tr>
	                            <td data-label="ID Tiny">{{ composicao.id_tiny }}</td>
	                            <td data-label="Produto">{{ composicao.comp_origem[0].nome }}</td>
	                            <td data-label="GTIN/EAN">
	                                {% if composicao.comp_origem[0].gtin %}
	                                {{ composicao.comp_origem[0].gtin }}
	                                {% else %}
	                                <span class="text-muted fst-italic">n√£o encontrado</span>
	                                {% endif %}
	                            </td>
	                            <td data-label="A√ß√µes">
	                                <a class="tiny-link"
	                                    href="https://erp.tiny.com.br/produtos#edit/{{ composicao.id_tiny }}"
	                                    target="_blank">
	                                    <i class="bi bi-box-arrow-up-right"></i> Abrir no Tiny
	                                </a>
	                            </td>
	                        </tr>
	                        {% endfor %}
	                    </tbody>
	                </table>
	            </div>
	        </div>
	    </div>
	</div>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='alteracoes/alteracoes.js') }}
	{% endblock %}
alterar_agendamento.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='alterar_agendamento/alt_agend.css') }}
	{% endblock %}
	
	{% block content %}
	<form id="form_alt" method="post" action="/alterar-agendamento">
	    <div class="row g-3">
	        <!-- <div class="col-md-6">
	            <label for="inp_col" class="form-label">Nome do colaborador:</label>
	            <input name="inp_col" id="inp_col" class="form-control" type="text" value="{{ dados.colaborador }}">
	        </div> -->
	
	        <input name="inp_ml" type="hidden" value="{{ dados.id_agend_ml }}">
	
	        <div class="col-md-6">
	            <label for="inp_mktp" class="form-label">Loja do agendamento:</label>
	            <select name="inp_mktp" id="inp_mktp" class="form-control">
	                <option value="4" {% if dados.id_mktp==4 %} selected {% endif %}>Amazon</option>
	                <option value="2" {% if dados.id_mktp==2 %} selected {% endif %}>Magalu</option>
	                <option value="1" {% if dados.id_mktp==1 %} selected {% endif %}>Mercado Livre</option>
	                <option value="3" {% if dados.id_mktp==3 %} selected {% endif %}>Shopee</option>
	            </select>
	        </div>
	
	        <div class="col-md-6">
	            <label for="inp_emp" class="form-label">Empresa do agendamento:</label>
	            <select name="inp_emp" id="inp_emp" class="form-control">
	                <option value="2" {% if dados.empresa==2 %} selected {% endif %}>Ja√∫ Fishing</option>
	                <option value="3" {% if dados.empresa==3 %} selected {% endif %}>L.T. Sports</option>
	                <option value="1" {% if dados.empresa==1 %} selected {% endif %}>Ja√∫ Pesca</option>
	            </select>
	        </div>
	
	        <div class="col-md-6">
	            <label for="inp_tipo" class="form-label">Fase do agendamento:</label>
	            <select name="inp_tipo" id="inp_tipo" class="form-control">
	                <option value="1" {% if dados.id_tipo==1 %} selected {% endif %}>Limpeza</option>
	                <option value="3" {% if dados.id_tipo==3 %} selected {% endif %}>Confer√™ncia</option>
	                <option value="4" {% if dados.id_tipo==4 %} selected {% endif %}>Embalar</option>
	                <option value="5" {% if dados.id_tipo==5 %} selected {% endif %}>Expedi√ß√£o</option>
	                <option value="2" {% if dados.id_tipo==2 %} selected {% endif %}>Finalizado</option>
	            </select>
	        </div>
	    </div>
	
	    <input name="inp_id" type="hidden" value="{{ dados.id_bd }}">
	
	    <div class="row mt-4">
	        <div class="col">
	            <input type="submit" class="btn btn-primary-custom w-100" value="Salvar Altera√ß√µes"
	                style="background: #0B5ED7; color: white">
	        </div>
	    </div>
	</form>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='alterar_agendamento/alt_agend.js') }}
	{% endblock %}
base_template.html=<!DOCTYPE html>
	<html lang="pt-br">
	
	<head>
	  <meta charset="UTF-8">
	  <meta name="viewport" content="width=device-width, initial-scale=1.0">
	  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/css/bootstrap.min.css" rel="stylesheet"
	    integrity="sha384-EVSTQN3/azprG1Anm3QDgpJLIm9Nao0Yz1ztcQTwFspd3yD65VohhpuuCOmLASjC" crossorigin="anonymous">
	  <link rel="stylesheet" href="{{ url_for('static', filename='global.css') }}">
	  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
	  <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet" />
	  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css" rel="stylesheet">
	  <link rel="stylesheet" href="{% block stylepath %} {% endblock %}">
	  <link rel="shortcut icon" href="https://cdn-icons-png.flaticon.com/512/7092/7092001.png" type="image/x-icon">
	  <title>{% block title %}Agendamentos Web{% endblock %}</title>
	</head>
	
	<body>
	  <nav class="navbar navbar-expand-lg navbar-light bg-light">
	    <div class="container-fluid justify-content-between align-items-center">
	
	      <!-- Menu Hamburguer (Mobile) -->
	      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
	        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
	        <span class="navbar-toggler-icon"></span>
	      </button>
	
	      <!-- Conte√∫do √† esquerda -->
	      <div class="collapse navbar-collapse" id="navbarSupportedContent">
	        <ul class="navbar-nav me-auto mb-2 mb-lg-0 fs-6">
	          <!-- Agendamentos -->
	          <li class="nav-item px-2">
	            <a class="nav-link" href="{{ url_for('agendamentos', acao='ver') }}">
	              Agendamentos
	            </a>
	          </li>
	
	
	          <!-- Corre√ß√µes -->
	          <li class="nav-item dropdown px-2">
	            <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown2" role="button" data-bs-toggle="dropdown"
	              aria-expanded="false">
	              Corre√ß√µes
	            </a>
	            <ul class="dropdown-menu" aria-labelledby="navbarDropdown2">
	              <li><a class="dropdown-item" href="{{ url_for('alteracoes', acao='alterar') }}">Altera√ß√µes</a></li>
	              <li><a class="dropdown-item" href="{{ url_for('alteracoes', acao='comprar') }}">Compras</a></li>
	            </ul>
	          </li>
	
	          <!-- Reservados -->
	          <li class="nav-item px-2">
	            <a class="nav-link" href="{{ url_for('reservados') }}">
	              Reservados
	            </a>
	          </li>
	
	          <!-- Config -->
	          <li class="nav-item">
	            <a class="nav-link" href="{{ url_for('config') }}">
	              Configura√ß√µes
	            </a>
	          </li>
	
	        </ul>
	      </div>
	
	      <!-- Logo √† direita -->
	      <a class="navbar-brand ms-auto" href="{{ url_for('homepage') }}">
	        <img src="{{ url_for('static', filename='/resources/logo.png') }}" alt="Logo Ja√∫ Pesca"
	          style="max-height: 40px;">
	      </a>
	
	    </div>
	  </nav>
	
	
	  {% block content %}
	  {% endblock %}
	
	  <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
	    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
	    crossorigin="anonymous"></script>
	  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
	    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
	    crossorigin="anonymous"></script>
	  <script src="https://code.jquery.com/jquery-3.7.1.min.js"
	    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
	  <script src="{% block scriptpath %} {% endblock %}"></script>
	  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
	  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	  <script>Swal.bindClickHandler();</script>
	  <script src="../static/embalar/BrowserPrint-3.1.250.min.js"></script>
	</body>
	
	</html>
compras.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='compras/compras.css') }}
	{% endblock %}
	
	{% block content %}
	<div class="container p-4">
	    <div class="header-bar bg-primary text-white p-3 rounded mb-2">
	        <div class="d-flex justify-content-between align-items-center">
	            <!-- T√≠tulo sempre vis√≠vel -->
	            <h5 class="mb-0">Composi√ß√£o do agendamento</h5>
	            <div class="dropdown">
	                <button class="btn btn-outline-light d-flex align-items-center gap-2 dropdown-toggle px-3 py-2"
	                    type="button" id="dropdownMenuDownload" data-bs-toggle="dropdown" aria-expanded="false">
	                    <i class="bi bi-download"></i> Baixar
	                </button>
	                <ul class="dropdown-menu dropdown-menu-end shadow-sm rounded-3 animate__animated animate__fadeIn"
	                    aria-labelledby="dropdownMenuDownload">
	                    <li>
	                        <button class="dropdown-item d-flex align-items-center gap-2" href="#"
	                            onclick="turnTableDataToJson('csv')">
	                            <i class="bi bi-filetype-csv"></i> CSV
	                        </button>
	                    </li>
	                    <li>
	                        <button class="dropdown-item d-flex align-items-center gap-2" href="#"
	                            onclick="turnTableDataToJson('excel')">
	                            <i class="bi bi-file-earmark-excel"></i> Excel
	                        </button>
	                    </li>
	                    <li>
	                        <button class="dropdown-item d-flex align-items-center gap-2" href="#" onclick="window.print()">
	                            <i class="bi bi-printer"></i> Imprimir
	                        </button>
	                    </li>
	                </ul>
	            </div>
	            <!-- src="{{ url_for('static', filename='/resources/logo.png') }}" -->
	        </div>
	    </div>
	    <div class="card shadow-sm mb-4" id="container-table">
	        <div class="print-header">
	            <img src="{{ url_for('static', filename='/resources/logo.png') }}" alt="Logo" class="print-logo">
	            <h2 class="print-title" style="margin-bottom: 15px;">Lista de Compras</h2>
	            <div class="print-meta" style="margin-bottom: 10px;">
	                <span id="data-hoje"></span> &nbsp;&nbsp;
	            </div>
	        </div>
	        <div class="card-body p-0">
	            <div class="table-responsive" style="max-height:70vh; overflow-y:auto;">
	                <table class="table table-hover align-middle">
	                    <thead>
	                        <tr>
	                            <th>Produto</th>
	                            <th>Fornecedor</th>
	                            <th>C√≥digo</th>
	                            <th>Total</th>
	                            <th>Tiny</th>
	                            <th>Faltam</th>
	                            <th>Comprar</th>
	                        </tr>
	                    </thead>
	                    <tbody>
	                        {% for compra in dados %}
	                        <tr>
	                            <td data-label="Produto">{{ compra[6] }}</td>
	                            <td data-label="Fornecedor" id="fornecedor-{{ compra[3] }}">Buscando‚Ä¶</td>
	                            <td data-label="C√≥digo" id="cod-fornecedor-{{ compra[3] }}">Buscando‚Ä¶</td>
	                            <td data-label="Total" id="qnt-total-{{ compra[3] }}">{{
	                                compra[7] }}</td>
	                            <td data-label="Tiny" id="estoque-tiny-{{ compra[3] }}">Buscando‚Ä¶</td>
	                            <td data-label="Faltam" id="qnt-faltante-{{ compra[3] }}">Buscando‚Ä¶</td>
	                            <td data-label="Comprar" id="qnt-compra-{{ compra[3] }}">
	                                <div class="input-wrapper">
	                                    <input type="number" value="0" min="0" oninput="autoResizeInput(this)">
	                                    <span class="input-mirror"></span>
	                                </div>
	                                <div>
	                                    <button id="remover-{{ compra[0] }}" type="button" onclick="removeComprado(this)">
	                                        Remover </button>
	                                </div>
	                            </td>
	                        </tr>
	                        {% endfor %}
	                    </tbody>
	                </table>
	            </div>
	        </div>
	    </div>
	</div>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='compras/compras.js') }}
	{% endblock %}
config.html={% extends "base_template.html" %}
	
	{% block title %}Configura√ß√µes{% endblock %}
	
	{% block stylepath %}
	{{ url_for('static', filename='config/config.css') }}
	{% endblock %}
	
	{% block content %}
	<div class="container py-5">
	  <div class="row">
	    <!-- Coluna do Usu√°rio -->
	    <div class="col-lg-4 mb-4 text-center">
	      <div class="card perfil-card mx-auto">
	        <img
	          src="https://cdn-icons-png.flaticon.com/512/17468/17468680.png"
	          class="perfil-avatar mt-4"
	          alt="Avatar de {{ session.nome_display_usuario }}"
	        >
	        <div class="card-body">
	          <h4 class="card-title">{{ session.nome_display_usuario }}</h4>
	          <a href="{{ url_for('auth.logout') }}"
	             class="btn btn-outline-danger btn-sm mt-2 d-inline-flex align-items-center">
	            <i class="bi bi-box-arrow-right me-2"></i> Sair
	          </a>
	        </div>
	      </div>
	    </div>
	
	    <!-- Coluna das Impressoras -->
	    <div class="col-lg-8">
	      <!-- Impressora de Relat√≥rio -->
	      <div class="printer-card mb-4 d-flex align-items-center gap-3">
	        <video width="128" height="128" preload="none"
	               style="background: transparent url('https://cdn-icons-png.flaticon.com/512/6172/6172550.png') 50% 50% / contain no-repeat;"
	               autoplay loop muted playsinline>
	          <source src="https://cdn-icons-mp4.flaticon.com/512/6172/6172550.mp4" type="video/mp4">
	        </video>
	        <div>
	          <strong>Impressora relat√≥rio</strong><br>
	          <span id="lblImpressoraRelatorio">Nenhuma impressora selecionada</span><br>
	          <button id="btnImpressoraRelatorio" class="btn btn-outline-secondary btn-sm mt-1 pt-2">
	            Escolher impressora
	          </button>
	        </div>
	      </div>
	
	      <!-- Impressora etiqueta de volume (Caixa) -->
	      <div class="printer-card mb-4 d-flex align-items-center gap-3">
	        <video width="128" height="128" preload="none"
	               style="background: transparent url('https://cdn-icons-png.flaticon.com/512/8717/8717997.png') 50% 50% / contain no-repeat;"
	               autoplay loop muted playsinline>
	          <source src="https://cdn-icons-mp4.flaticon.com/512/9820/9820037.mp4" type="video/mp4">
	        </video>
	        <div>
	          <strong>Impressora etiqueta de volume (CAIXA)</strong><br>
	          <span id="lblImpressoraCx">Nenhuma impressora selecionada</span><br>
	          <button id="btnImpressoraCx" class="btn btn-outline-secondary btn-sm mt-1 pt-2">
	            Escolher impressora
	          </button>
	        </div>
	      </div>
	
	      <!-- Impressora etiqueta de identifica√ß√£o (Produto) -->
	      <div class="printer-card mb-4 d-flex align-items-center gap-3">
	        <video width="128" height="128" preload="none"
	               style="background: transparent url('https://cdn-icons-png.flaticon.com/512/8717/8717997.png') 50% 50% / contain no-repeat;"
	               autoplay loop muted playsinline>
	          <source src="https://cdn-icons-mp4.flaticon.com/512/8717/8717997.mp4" type="video/mp4">
	        </video>
	        <div>
	          <strong>Impressora etiqueta de identifica√ß√£o (Produto)</strong><br>
	          <span id="lblImpressoraId">Nenhuma impressora selecionada</span><br>
	          <button id="btnImpressoraId" class="btn btn-outline-secondary btn-sm mt-1 pt-2">
	            Escolher impressora
	          </button>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- Modal: Escolher Impressora -->
	  <div class="modal fade" id="printerModal" tabindex="-1"
	       data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered" style="max-width: 520px">
	      <div class="modal-content shadow-lg">
	        <div class="modal-header">
	          <h5 class="modal-title">Escolher impressora</h5>
	          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	        </div>
	
	        <div class="modal-body">
	          <!-- Loading -->
	          <div id="printerLoading" class="d-flex align-items-center gap-2">
	            <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
	            <span>Procurando impressoras instaladas‚Ä¶</span>
	          </div>
	
	          <!-- Lista -->
	          <div id="printerListWrap" class="d-none">
	            <div class="list-group" id="printerList" role="radiogroup" aria-label="Lista de impressoras">
	              {# itens injetados via JS (config.js) #}
	            </div>
	
	            <!-- Estado vazio -->
	            <div id="printerEmpty" class="alert alert-warning mt-3 d-none mb-0">
	              Nenhuma impressora foi detectada pelo BrowserPrint neste computador.
	            </div>
	          </div>
	
	          <!-- Erro -->
	          <div id="printerError" class="alert alert-danger d-none mb-0"></div>
	        </div>
	
	        <div class="modal-footer">
	          <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
	          <button type="button" id="btnConfirmPrinter" class="btn btn-primary" disabled>Usar esta</button>
	        </div>
	      </div>
	    </div>
	  </div>
	</div>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='config/config.js') }}
	{% endblock %}
	
embalar.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for("static", filename="embalar/embalar.css") }}
	{% endblock %}
	
	{% block content %}
	{# CSRF meta (se usar via fetch) #}
	<meta name="csrf-token" content="{{ csrf_token() if csrf_token is defined else '' }}">
	
	<br>
	<div class="container">
	  <div class="header-bar mb-3 p-3 rounded"
	       data-id-ml="{{ dados_agend.id_agend_ml }}"
	       data-id-bd="{{ dados_agend.id_bd }}"
	       data-empresa="{{ dados_agend.empresa }}"
	       data-id-mktp="{{ dados_agend.id_mktp }}"
	       data-centro="{{ dados_agend.centro_distribuicao or '' }}">
	    <h5 class="mb-2">Embalagem</h5>
	    <div class="d-flex flex-wrap align-items-center gap-3 mt-3">
	      <div><strong>Empresa:</strong>
	        {% if dados_agend.empresa == 0 %}Nenhuma
	        {% elif dados_agend.empresa == 1 %}Ja√∫ Pesca
	        {% elif dados_agend.empresa == 2 %}Ja√∫ Fishing
	        {% elif dados_agend.empresa == 3 %}L.T. Sports
	        {% endif %}
	      </div>
	      <div><strong>Agendamento:</strong> {{ dados_agend.id_agend_ml }}</div>
	      <div><strong>Colaborador:</strong> {{ dados_agend.colaborador or 'Nenhum' }}</div>
	      {% set data = dados_agend.entrada %}
	      <div><strong>Data:</strong> {{ data.strftime('%d/%m/%y') }}</div>
	      <div><strong>Hora:</strong> {{ data.strftime('%Hh%M') }}</div>
	      <div><strong>Centro:</strong> {{ dados_agend.centro_distribuicao }}</div>
	    </div>
	  </div>
	
	  <div class="row">
	    <!-- Coluna esquerda -->
	    <div class="col-md-5">
	      <div class="mb-3" style="padding-right: 10px;">
	        <div class="d-flex justify-content-between align-items-center">
	          <label for="input-embalar" class="form-label fw-bold mb-0">C√≥digo ou SKU</label>
	        </div>
	        <input type="text" id="input-embalar" class="form-control" placeholder="Digite aqui o GTIN ou SKU">
	
	        <div class="mt-2">
	          <div class="d-flex justify-content-between">
	            <label class="form-label mb-0"><span class="fw-semibold">F1</span> = Etiqueta ML + JP</label>
	            <label class="form-label mb-0"><span class="fw-semibold">F2</span> = Etiqueta ML</label>
	            <label class="form-label mb-0"><span class="fw-semibold">F3</span> = Etiqueta JP</label>
	          </div>
	          <div class="d-flex justify-content-between">
	            <label class="form-label mb-0"><span class="fw-semibold">F4</span> = Fechar caixa s/ Etiqueta</label>
	          </div>
	        </div>
	      </div>
	
	      <div class="d-flex justify-content-between flex-wrap gap-3 p-3 mb-3 border rounded bg-white" style="margin-right: 10px;">
	        <p id="tempoP" class="mb-0"><strong>üïí Tempo:</strong> 00h 00m 00s</p>
	        <p id="finalizadosP" class="mb-0"><strong>‚úÖ Finalizados:</strong> 0</p>
	      </div>
	
	      <div id="caixa-actions-container">
	        <template id="template-nova-caixa">
	          <div id="btn-nova-caixa" class="card add-new-box text-center text-decoration-none">
	            <div class="card-body nova_caixa">
	              <i class="bi bi-plus-circle me-2"></i> Nova Caixa
	            </div>
	          </div>
	        </template>
	
	        <template id="template-finalizar-embalagem">
	          <a href="#" id="btn-finalizar-embalagem"
	             class="card add-new-box text-center text-decoration-none bg-success text-white ajuste_btn_finalizar">
	            <div class="card-body nova_caixa">
	              <i class="bi bi-check-circle-fill me-2"></i> Finalizar Embalagem
	            </div>
	          </a>
	        </template>
	
	        <div>
	          <div id="caixas-container" class="mb-4 d-flex flex-column gap-3"></div>
	        </div>
	      </div>
	    </div>
	
	    <!-- Coluna direita -->
	    <div class="col-md-7">
	      <ul id="lista-anuncios">
	        {% for produto in dados.produtos %}
	        <li class="produto-item"
	            data-original-sku="{{ produto.sku }}"
	            data-sku="{{ produto.sku }}"
	            data-id-ml="{{ produto.id_ml }}"
	            data-gtin="{{ produto.gtin }}"
	            data-id-tiny="{{ produto.id_tiny }}"
	            data-unidades="{{ produto.unidades }}">
	          <div class="produto-info">{{ produto.nome }}</div>
	          <div class="produto-meta">
	            <span class="sku">{{ produto.sku }}</span>
	            <i class="bi bi-info-circle"></i>
	            <span class="unidades">Unidades: {{ produto.unidades }}</span>
	          </div>
	        </li>
	        {% endfor %}
	      </ul>
	
	      <div id="window-right">
	        <ul id="lista-anuncio-selecionado"></ul>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Modal: Selecionar an√∫ncio -->
	<div class="modal fade" id="modalSelecioneAnuncio" tabindex="-1" aria-labelledby="modalSelecioneAnuncioLabel" aria-hidden="true">
	  <div class="modal-dialog modal-lg modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="modalSelecioneAnuncioLabel">Selecione o an√∫ncio</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	      </div>
	      <div class="modal-body" id="modalSelecioneAnuncioBody"></div>
	    </div>
	  </div>
	</div>
	
	<!-- Modal: Confirmar an√∫ncio -->
	<div class="modal fade" id="modalConfirmeAnuncio" tabindex="-1" aria-labelledby="modalConfirmeAnuncioLabel" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered">
	    <div class="modal-content">
	      <div class="modal-header">
	        <h5 class="modal-title" id="modalConfirmeAnuncioLabel">Confirme o an√∫ncio selecionado</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	      </div>
	      <div class="modal-body" id="modalConfirmeAnuncioBody"></div>
	      <div class="modal-footer">
	        <button type="button" id="btnConfirmarAnuncio" class="btn btn-primary">Confirmar</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Modal: Escolher impressora (compat√≠vel com BrowserPrint) -->
	<div class="modal fade" id="printerModal" tabindex="-1" data-bs-backdrop="static" data-bs-keyboard="false" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered" style="max-width: 520px">
	    <div class="modal-content shadow-lg">
	      <div class="modal-header">
	        <h5 class="modal-title">Escolher impressora</h5>
	        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	      </div>
	
	      <div class="modal-body">
	        <!-- Loading -->
	        <div id="printerLoading" class="d-flex align-items-center gap-2">
	          <div class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></div>
	          <span>Procurando impressoras instaladas‚Ä¶</span>
	        </div>
	
	        <!-- Lista -->
	        <div id="printerListWrap" class="d-none">
	          <div class="list-group" id="printerList" role="radiogroup" aria-label="Lista de impressoras"></div>
	
	          <!-- Estado vazio -->
	          <div id="printerEmpty" class="alert alert-warning mt-3 d-none mb-0">
	            Nenhuma impressora foi detectada pelo BrowserPrint neste computador.
	          </div>
	        </div>
	
	        <!-- Erro -->
	        <div id="printerError" class="alert alert-danger d-none mb-0"></div>
	      </div>
	
	      <div class="modal-footer">
	        <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancelar</button>
	        <button type="button" id="btnConfirmPrinter" class="btn btn-primary" disabled>Usar esta</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Modal: Fechar caixa e imprimir -->
	<div class="modal fade" id="modalFecharCaixa" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="modalFecharCaixaLabel" aria-hidden="true">
	  <div class="modal-dialog modal-dialog-centered">
	    <div class="modal-content fechar-caixa">
	      <div class="modal-header">
	        <h5 class="modal-title" id="modalFecharCaixaLabel">
	          <i class="bi bi-box-seam me-2"></i>Fechar a √∫ltima caixa?
	        </h5>
	      </div>
	      <div class="modal-body">
	        <p class="text-muted mb-3">
	          N√£o h√° mais itens para este agendamento. Deseja fechar a caixa e imprimir etiquetas?
	        </p>
	
	        <div class="fechar-caixa-options">
	          <label class="fechar-caixa-option" data-value="ambas">
	            <input type="radio" name="optImpressao" class="visually-hidden" value="ambas">
	            <div class="title"><i class="bi bi-printer me-1"></i>Ja√∫ Pesca + Mercado Livre</div>
	            <div class="desc">Imprime as duas etiquetas (interna + inbound ML)</div>
	          </label>
	
	          <label class="fechar-caixa-option" data-value="ml">
	            <input type="radio" name="optImpressao" class="visually-hidden" value="ml">
	            <div class="title"><i class="bi bi-qr-code me-1"></i>S√≥ Mercado Livre</div>
	            <div class="desc">Imprime apenas a etiqueta inbound ML</div>
	          </label>
	
	          <label class="fechar-caixa-option" data-value="jp">
	            <input type="radio" name="optImpressao" class="visually-hidden" value="jp">
	            <div class="title"><i class="bi bi-box me-1"></i>S√≥ Ja√∫ Pesca</div>
	            <div class="desc">Imprime apenas a etiqueta interna (JP)</div>
	          </label>
	
	          <label class="fechar-caixa-option" data-value="nenhuma">
	            <input type="radio" name="optImpressao" class="visually-hidden" value="nenhuma">
	            <div class="title"><i class="bi bi-slash-circle me-1"></i>Nenhuma</div>
	            <div class="desc">Apenas fecha a caixa, sem imprimir</div>
	          </label>
	        </div>
	      </div>
	
	      <div class="modal-footer">
	        <div class="form-check me-auto">
	          <input class="form-check-input" type="checkbox" id="guardarOpcaoImpressao">
	          <label class="form-check-label" for="guardarOpcaoImpressao">Lembrar minha escolha</label>
	        </div>
	        <button type="button" class="btn btn-outline-secondary" id="btnCancelarFechamento">Cancelar</button>
	        <button type="button" class="btn btn-success" id="btnConfirmarFechamento">Fechar caixa</button>
	      </div>
	    </div>
	  </div>
	</div>
	
	<!-- Dados para JS -->
	<div id="js-data" data-comps='{{ comps | tojson | safe }}' style="display:none;"></div>
	<div id="placeholder-image" data-url="{{ url_for('static', filename='resources/sem_img.webp') }}"></div>
	
	<script>
	  // Bloqueia o "Localizar" do navegador pelo F3, liberando para seu atalho
	  document.addEventListener("keydown", function (event) {
	    if (event.key === "F3") {
	      event.preventDefault();
	    }
	  });
	</script>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for("static", filename="embalar/embalar.js") }}
	{% endblock %}
	
erro.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	    {{ url_for('static', filename='erro/erro.css') }}
	{% endblock %}
	
	{% block content %}
	
	<div class="erro-container">
	    <div id="erro-titulo">
	        <h2 id="err-title">{{ erro_title }}</h2> 
	        <span>
	            <video width="256" height="256" preload="none"
	                style="background: transparent  url('https://cdn-icons-png.flaticon.com/512/11201/11201846.png') 50% 50% / fit no-repeat;"
	                autoplay="autoplay" muted="muted" playsinline="">
	                <source src="https://cdn-icons-mp4.flaticon.com/512/11201/11201846.mp4" type="video/mp4">
	            </video>
	        </span>
	    </div>
	    <div id="erro-mensagem" class="mb-4">
	        <p id="err-msg-pri">{{ erro_msg_primary }}</p>
	        <p id="err-msg-sec">{{ erro_msg_secondary }}</p>
	    </div>
	    <div>
	        <p id="err-code">C√≥digo de erro: {{ erro_code }}</p>
	    </div>
	</div>
	
	<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.9.2/dist/umd/popper.min.js"
	    integrity="sha384-IQsoLXl5PILFhosVNubq5LC7Qb9DXgDA9i+tQ8Zj3iwWAwPtgFTxbJ8NT4GN1R8p"
	    crossorigin="anonymous"></script>
	<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.min.js"
	    integrity="sha384-cVKIPhGWiC2Al4u+LWgxfKTRIcfu0JTxR+EQDz/bgldoEyl4H0zUF0QKbrJ0EcQF"
	    crossorigin="anonymous"></script>
	{% endblock %}
	
	{% block scriptpath %}
	    {{ url_for('static', filename='erro/erro.css') }}
	{% endblock %}
expedicao.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='expedicao/expedicao.css') }}
	{% endblock %}
	
	{% block content %}
	<div class="container pt-4">
	
	    <div
	    class="panel-control mb-4"
	    data-id-ml="{{ dados_agend.id_agend_ml }}"
	    data-id-bd="{{ dados_agend.id_bd }}"
	    data-empresa="{{ dados_agend.empresa }}"
	    data-mktp="{{ dados_agend.id_mktp or '' }}"
	    data-inicio-exp="{{ dados_agend.expedicao_inicio.isoformat() if dados_agend.expedicao_inicio else '' }}"
	    data-fim-exp="{{ dados_agend.expedicao_fim.isoformat() if dados_agend.expedicao_fim else '' }}">
	
	
	        <div class="panel-title">
	            <h5 class="mb-0">Expedi√ß√£o</h5>
	        </div>
	
	        <div class="panel-content">
	            <div class="row align-items-center">
	                <div class="col-lg-7 border-end-lg">
	                    <div class="d-flex flex-wrap align-items-center gap-3" style="font-weight: bold;">
	                        <div>
	                            <strong style="color: #FDD484;">Empresa:</strong>
	                            {% if dados_agend.empresa == 1 %}Ja√∫ Pesca
	                            {% elif dados_agend.empresa == 2 %}Ja√∫ Fishing
	                            {% elif dados_agend.empresa == 3 %}L.T. Sports
	                            {% else %}Nenhuma{% endif %}
	                        </div>
	                        <div><strong style="color: #FDD484;">Agendamento:</strong> {{ dados_agend.id_agend_ml }}</div>
	                        <div><strong style="color: #FDD484;">Colaborador:</strong> {{ dados_agend.colaborador or
	                            'Nenhum' }}</div>
	                        {% set data = dados_agend.entrada %}
	                        <div><strong style="color: #FDD484;">Data:</strong> {{ data.strftime('%d/%m/%y') }}</div>
	                        <div><strong style="color: #FDD484;">Hora:</strong> {{ data.strftime('%Hh%M') }}</div>
	                    </div>
	                </div>
	
	                <div class="col-lg-5 mt-3 mt-lg-0 ps-lg-4">
	                    <div id="container-inicio" {% if dados_agend.expedicao_inicio %}style="display: none;" {% endif %}>
	                        <label class="form-label fw-bold">&nbsp;</label> <button id="btn-iniciar-expedicao"
	                            class="btn btn-primary btn-lg w-100">
	                            <i class="bi bi-play-circle-fill me-2"></i> Iniciar Expedi√ß√£o
	                        </button>
	                    </div>
	
	                    <div id="container-bipagem" {% if not dados_agend.expedicao_inicio or dados_agend.expedicao_fim
	                        %}style="display: none;" {% endif %}>
	                        <label for="input-bip-caixa" class="form-label fw-bold">Bipar QR Code da Caixa</label>
	                        <input type="text" id="input-bip-caixa" class="form-control form-control-lg"
	                            placeholder="Aguardando leitura do QR Code...">
	                    </div>
	
	                    <div id="container-finalizacao" {% if not dados_agend.expedicao_fim %}style="display: none;" {%
	                        endif %}>
	                        <label class="form-label fw-bold">&nbsp;</label> <button id="btn-finalizar-expedicao"
	                            class="btn btn-success btn-lg w-100">
	                            <i class="bi bi-check-circle-fill me-2"></i> Finalizar Expedi√ß√£o
	                        </button>
	                    </div>
	                </div>
	            </div>
	        </div>
	    </div>
	
	    <div class="d-flex justify-content-between align-items-center mb-2">
	        <h4>Caixas para Expedir</h4>
	        <div class="d-flex align-items-center">
	            <span id="cronometro-expedicao" class="fw-bold fs-5 text-primary me-3"
	                title="Tempo de expedi√ß√£o">00:00:00</span>
	            <span id="contador-caixas" class="fw-bold fs-5 text-secondary">0 / {{ caixas|length }}</span>
	        </div>
	    </div>
	
	    {% if caixas %}
	    <div id="container-lista-caixas" class="row row-cols-1 row-cols-md-4 g-4 mt-1"
	        style="max-height: 55vh !important; overflow-y: auto !important; padding-bottom: 1rem;">
	        {% for caixa in caixas %}
	        <div class="col caixa-card-container" data-codigo-unico="{{ caixa.codigo_unico }}">
	            <div class="card h-100 shadow-sm caixa-card status-pendente position-relative">
	                <div class="check-overlay">
	                    <i class="bi bi-check-circle-fill"></i>
	                </div>
	                <div class="card-header d-flex justify-content-between align-items-center">
	                    <h6 class="mb-0">Caixa #{{ caixa.caixa_num }}</h6>
	                    <img class="card-icon" src="{{ url_for('static', filename='resources/caixa.png') }}" width="32"
	                        height="32" alt="√çcone da caixa">
	                </div>
	                <div class="card-body d-flex flex-column justify-content-center align-items-center text-center">
	                    <div class="info-item mb-2">
	                        <span class="badge bg-secondary rounded-pill fs-6">{{ caixa.itens|length }} tipo(s) de
	                            produto</span>
	                    </div>
	                    <div class="info-item">
	                        <span class="badge bg-primary rounded-pill fs-6">{{ caixa.total_unidades }} unidade(s) no
	                            total</span>
	                    </div>
	                </div>
	                <div class="card-footer text-end bg-white border-top-0 pt-0">
	                    <button class="btn btn-outline-secondary btn-sm js-visualizar-itens"
	                        data-caixa='{{ caixa | tojson | safe }}'>
	                        <i class="bi bi-eye"></i> Visualizar Itens
	                    </button>
	                </div>
	            </div>
	        </div>
	        {% endfor %}
	    </div>
	    {% else %}
	    <div class="alert alert-warning text-center" role="alert">
	        <i class="bi bi-info-circle-fill me-2"></i>
	        Nenhuma caixa foi registrada para este agendamento no processo de embalagem.
	    </div>
	    {% endif %}
	</div>
	
	<div class="modal fade" id="modalDetalhesCaixa" tabindex="-1" aria-labelledby="modalDetalhesCaixaLabel"
	    aria-hidden="true">
	    <div class="modal-dialog modal-dialog-centered modal-lg modal-dialog-scrollable">
	        <div class="modal-content">
	            <div class="modal-header">
	                <h5 class="modal-title" id="modalDetalhesCaixaLabel">Detalhes da Caixa</h5>
	                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
	            </div>
	            <div class="modal-body" id="modalDetalhesCaixaBody">
	            </div>
	        </div>
	    </div>
	</div>
	<div id="js-data-produtos" data-produtos='{{ todos_os_produtos_json | safe }}' style="display: none;"></div>
	<div id="js-data-placeholder" data-url="{{ url_for('static', filename='resources/sem_img.webp') }}"
	    style="display: none;"></div>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='expedicao/expedicao.js') }}
	{% endblock %}
imprimir_composicoes.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='imprimir_composicoes/imprimir_composicoes.css') }}
	{% endblock %}
	
	{% block content %}
	<div class="container p-4">
	    <div class="header-bar bg-primary text-white p-3 rounded mb-2">
	        <div class="d-flex justify-content-between align-items-center">
	            <!-- T√≠tulo sempre vis√≠vel -->
	            <h5 class="mb-0 id-{{ agendamento.id_agend_ml }}">Composi√ß√£o - Pedido {{ agendamento.id_agend_ml }}</h5>
	            <div class="dropdown">
	                <button class="btn btn-outline-light d-flex align-items-center gap-2 dropdown-toggle px-3 py-2"
	                    type="button" id="dropdownMenuDownload" data-bs-toggle="dropdown" aria-expanded="false">
	                    <i class="bi bi-download"></i> Baixar
	                </button>
	                <ul class="dropdown-menu dropdown-menu-end shadow-sm rounded-3 animate__animated animate__fadeIn"
	                    aria-labelledby="dropdownMenuDownload">
	                    <li>
	                        <button class="dropdown-item d-flex align-items-center gap-2" href="#"
	                            onclick="turnTableDataToJson('csv')">
	                            <i class="bi bi-filetype-csv"></i> CSV
	                        </button>
	                    </li>
	                    <li>
	                        <button class="dropdown-item d-flex align-items-center gap-2" href="#"
	                            onclick="turnTableDataToJson('excel')">
	                            <i class="bi bi-file-earmark-excel"></i> Excel
	                        </button>
	                    </li>
	                    <li>
	                        <button class="dropdown-item d-flex align-items-center gap-2" href="#" onclick="window.print()">
	                            <i class="bi bi-printer"></i> Imprimir
	                        </button>
	                    </li>
	                </ul>
	            </div>
	            <!-- src="{{ url_for('static', filename='/resources/logo.png') }}" -->
	        </div>
	    </div>
	    <div id="container-table" class="card-body p-0">
	        <div class="print-header">
	            <img src="{{ url_for('static', filename='/resources/logo.png') }}" alt="Logo" class="print-logo">
	            <h2 class="print-title id-{{ agendamento.id_agend_ml }}" style="margin-bottom: 15px;">Composi√ß√£o - Pedido {{
	                agendamento.id_agend_ml }}</h2>
	            <div class="print-meta" style="margin-bottom: 10px;">
	                <span id="data-hoje"></span> &nbsp;|&nbsp;
	                <span id="nome-colaborador">{{ agendamento.colaborador }}</span>
	            </div>
	        </div>
	        <div class="table-responsive" style="max-height:70vh; overflow-y:auto;">
	            <table class="table table-hover align-middle">
	                <thead>
	                    <tr>
	                        <th>SKU</th>
	                        <th>Nome</th>
	                        <th>Total</th>
	                        <th class="hdr-loc">Localiza√ß√£o</th>
	                        <th class="hdr-151i">Inferior</th>
	                        <th class="hdr-151m">Mezanino</th>
	                        <th class="hdr-cx">Caixa</th>
	                    </tr>
	                </thead>
	                <tbody>
	                    {% for composicao in comps %}
	                    <tr>
	                        <td class="print-font">{{ composicao.sku }}</td>
	                        <td class="print-font" id_tiny="{{ composicao.id_tiny }}">{{ composicao.comp_origem[0].nome }}
	                        </td>
	                        <td class="print-position">{{ composicao.unidades_totais }}</td>
	
	                        {% if composicao.comp_origem[0].localizacao == "" %}
	                        <td class="print-font">Nenhum</td>
	                        {% else %}
	                        <td class="print-position  print-font">{{ composicao.comp_origem[0].localizacao }}</td>
	                        {% endif %}
	
	                        <td class="print-position" id="qnt-151i">Buscando...</td>
	                        <td class="print-position" id="qnt-151m">Buscando...</td>
	                        <td class="print-position" id="qnt-177">Buscando...</td>
	                    </tr>
	                    {% endfor %}
	                </tbody>
	            </table>
	        </div>
	    </div>
	    {% endblock %}
	
	    {% block scriptpath %}
	    {{ url_for('static', filename='imprimir_composicoes/imprimir_composicoes.js') }}
	    {% endblock %}
index.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	    {{ url_for('static', filename='homepage/homepage.css') }}
	{% endblock %}
	
	{% block content %}
	
	    <br><br><br>
	    <div class="container pt-5">
	    <br><br><br>
	        <div class="row marcador align-items-center">
	            <div class="col mx-auto text-center">
	                <img class="img-fluid" src="{{ url_for('static', filename='resources/wallpaper_jaupesca.svg') }}">
	            </div>
	        </div>
	
	    </div>
	
	{% endblock %}
	
limpeza.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='limpeza/limpeza.css') }}
	{% endblock %}
	
	{% block content %}
	<br>
	<div class="container">
	    <!-- cabe√ßalho principal -->
	    <div class="header-bar bg-primary text-white p-3 rounded">
	        <div class="d-flex justify-content-between align-items-center">
	            <!-- sempre vis√≠vel -->
	            <h5 class="mb-0">Limpeza do agendamento</h5>
	
	            <!-- bot√£o s√≥ em sm -->
	            <button id="btnToggleDetalhes" class="btn btn-link text-white p-0 d-block d-md-none" type="button"
	                data-bs-toggle="collapse" data-bs-target="#detalhesAgendamento" aria-expanded="false"
	                aria-controls="detalhesAgendamento">
	                <i class="bi bi-chevron-down fs-4"></i>
	            </button>
	
	
	        </div>
	
	        <!-- detalhes: collapsible -->
	        <div id="detalhesAgendamento" class="collapse d-md-block mt-2" data-bs-parent=".header-bar">
	            <div class="d-flex flex-wrap align-items-center gap-3">
	                {% if dados.empresa == 0 %}
	                <div><strong style="color: #FDD484;">Empresa:</strong> Nenhuma</div>
	                {% elif dados.empresa == 1 %}
	                <div><strong style="color: #FDD484;">Empresa:</strong> Ja√∫ Pesca</div>
	                {% elif dados.empresa == 2 %}
	                <div><strong style="color: #FDD484;">Empresa:</strong> Ja√∫ Fishing</div>
	                {% elif dados.empresa == 3 %}
	                <div><strong style="color: #FDD484;">Empresa:</strong> L.T. Sports</div>
	                {% endif %}
	
	                <div><strong style="color: #FDD484;">Agendamento:</strong> {{ dados.id_agend_ml }}</div>
	                <div><strong style="color: #FDD484;">Colaborador:</strong> {{ dados.colaborador or 'Nenhum' }}</div>
	
	                {% set data_formatada = dados.entrada.strftime('%d/%m/%y') %}
	                {% set hora_formatada = dados.entrada.strftime('%Hh%M') %}
	
	                <div><strong style="color: #FDD484;">Data:</strong> {{ data_formatada }}</div>
	                <div><strong style="color: #FDD484;">Hora:</strong> {{ hora_formatada }}</div>
	            </div>
	        </div>
	
	    </div>
	</div>
	
	
	<div class="container pt-4">
	    <div class="overflow-auto" style="max-height: 70vh;">
	
	        {% for produto in dados.produtos %}
	        <div class="produto-item d-flex flex-column me-2" data-sku="{{ produto.sku }}"
	            data-total="{{ produto.unidades }}">
	            <div class="card border-2 mb-3
	                {% if produto.estoque_error_flag == 'green' %} border-success
	                {% elif produto.estoque_error_flag == 'yellow' %} border-warning
	                {% elif produto.estoque_error_flag == 'red' %} border-danger
	                {% endif %}">
	
	                <div class="card-body">
	                    <div class="row w-100">
	                        <div class="col-12 col-md-4 mb-2">
	                            <span class="text-truncate d-block" style="color: #007A85; max-width: 100%;"
	                                title="{{ produto.nome }}">
	                                Nome: <span style="color: black;">{{ produto.nome }}</span>
	                            </span>
	                            <span style="color: #007A85;">
	                                SKU: <span style="color: black;">{{ produto.sku }}</span>
	                            </span>
	                        </div>
	
	                        <div class="col-12 col-md-2 mb-2">
	                            <span style="color: #007A85;">ID Tiny: <span style="color: black;">{{ produto.id_tiny
	                                    }}</span></span><br>
	                            <span style="color: #007A85;">GTIN: <span style="color: black;">{{ produto.gtin
	                                    }}</span></span>
	                        </div>
	
	                        <div class="col-12 col-md-2 mb-2">
	                            <span style="color: #007A85;">Etiqueta: <span style="color: black;">{{ produto.id_ml
	                                    }}</span></span><br>
	                            <span style="color: #007A85;">Unidades: <span style="color: black;">{{ produto.unidades
	                                    }}</span></span>
	                        </div>
	
	                        <div
	                            class="d-flex justify-content-md-end justify-content-start align-items-start gap-3 mb-2 col-12 col-md-4">
	
	                            <div id="show-more-arrow-{{ loop.index }}" onclick="showTable(this)">
	                                <img src="{{ url_for('static', filename='resources/seta_baixo.png') }}"
	                                    alt="Seta para baixo" class="img-fluid" style="max-width: 25px; height: auto;">
	                            </div>
	                            <button id="btn-alt-{{ loop.index }}" onclick="altBtn(this)" class="btn btn-primary btn-sm">
	                                <i class="bi bi-pencil"></i>
	                            </button>
	
	                            <button id="btn-corr-{{ loop.index }}" onclick="getEleToCorrection(this)"
	                                class="btn btn-success btn-sm shadow-sm" disabled>
	                                <i class="bi bi-check2-square"></i>
	                            </button>
	                        </div>
	
	                    </div>
	                </div>
	            </div>
	
	            <div id="table-{{ loop.index }}" class="table-comp table-responsive display-hidden shadow-sm p-2 bg-white"
	                style="margin: -1rem 0rem 1rem 0rem;">
	            </div>
	        </div>
	        {% endfor %}
	
	    </div>
	</div>
	
	<template id="my-template">
	    <swal-title>
	        Como continuar agora?
	    </swal-title>
	    <swal-icon type="warning" color="red"></swal-icon>
	    <swal-button type="confirm">Salvar agora</swal-button>
	    <swal-button type="cancel">Salvar depois</swal-button>
	    <swal-button type="deny">Cancelar</swal-button>
	    <swal-param name="allowEscapeKey" value="false" />
	    <swal-param name="customClass" value='{ "popup": "my-popup" }' />
	    <swal-function-param name="didOpen" value="popup => console.log(popup)" />
	</template>
	
	<script>
	    agend_id = JSON.parse('{{ request.url | tojson }}').split('?')[1].split('&')[0].split('=')[1]
	    agend_tipo = JSON.parse('{{ request.url | tojson }}').split('?')[1].split('&')[1].split('=')[1]
	    dados = JSON.parse('{{ comps | tojson }}')
	</script>
	
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='limpeza/limpeza.js') }}
	{% endblock %}
login.html={% extends "base_template.html" %}
	
	{% block title %}Login{% endblock %}
	
	{% block stylepath %}
	{{ url_for('static', filename='login/login.css') }}
	{% endblock %}
	
	{% block content %}
	<div class="container vh-100">
	    <div class="row h-100 justify-content-center align-items-center">
	        <div class="col-12 col-sm-8 col-md-6 col-lg-4">
	            <div class="card shadow login-card">
	                <div class="card-body p-4">
	                    <div class="text-center mb-4">
	                        <img src="https://cdn-icons-png.flaticon.com/512/17468/17468680.png" class="avatar"
	                            alt="Avatar do usu√°rio">
	                    </div>
	                    <form action="" method="post" novalidate>
	                        <div class="mb-3">
	                            <label for="usuario" class="form-label">Usu√°rio</label>
	                            <input type="text" class="form-control" id="usuario" name="usuario"
	                                placeholder="Digite seu usu√°rio" required>
	                        </div>
	                        <div class="mb-3">
	                            <label for="senha" class="form-label">Senha</label>
	                            <div class="input-group">
	                                <input type="password" class="form-control" id="senha" name="senha"
	                                    placeholder="Digite sua senha" required>
	                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
	                                    <i class="bi bi-eye"></i>
	                                </button>
	                            </div>
	                        </div>
	                        <div class="d-grid">
	                            <button type="submit" class="btn btn-success">Entrar</button>
	                        </div>
	                    </form>
	                </div>
	            </div>
	        </div>
	    </div>
	</div>
	{% endblock %}
	
	{% block scriptpath %}
	<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
	<script src="{{ url_for('static', filename='login/login.js') }}"></script>
	
	{% if login_error %}
	<script>
	    document.addEventListener('DOMContentLoaded', () => {
	        Swal.fire({
	            icon: 'error',
	            title: 'Falha no login',
	            text: '{{ login_error }}',
	            confirmButtonText: 'Ok'
	        });
	    });
	</script>
	{% endif %}
	{% endblock %}
mostra_planilha.html={% extends "base_template.html" %}
	
	{% block content %}
	<div class="container pt-4">
	    <h2>Visualiza√ß√£o da Planilha Excel</h2>
	    <div class="table-responsive">
	        {{ html_table | safe }}
	    </div>
	    <a href="{{ url_for('index') }}" class="btn btn-secondary mt-4">Voltar</a>
	</div>
	{% endblock %}
	
novoAgendamento.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='novoAgendamento/novoAgend.css') }}
	{% endblock %}
	
	{% block content %} <br><br>
	<div class="container">
	  <div class="container">
	    <div class="row">
	
	      <div class="col-md-3 text-center">
	        <button class="btn btn-outline-primary w-100 mb-2" onclick="mostrarPainel('limpeza')">Limpeza</button>
	        <button class="btn btn-outline-primary w-100 mb-2" onclick="mostrarPainel('conferencia')">Confer√™ncia</button>
	        <button class="btn btn-outline-primary w-100 mb-2" onclick="mostrarPainel('embalar')">Embalar</button>
	        <button class="btn btn-outline-primary w-100 mb-2" onclick="mostrarPainel('expedicao')">Expedi√ß√£o</button>
	      </div>
	
	      <div class="col-md-9">
	        <div id="conteudoPainel" class="d-none p-4 border border-primary rounded"
	          style="min-height: 300px; background-color: white;">
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <script>
	    function mostrarPainel(etapa) {
	      const painel = document.getElementById("conteudoPainel");
	      painel.classList.remove("d-none");
	
	      let titulo = '';
	      let imagem = '';
	      let tipo = 0;
	
	      if (etapa == 'limpeza') {
	        titulo = "Limpeza";
	        imagem = "https://cdn-icons-png.flaticon.com/512/2897/2897785.png";
	        tipo = 1
	      }
	      else if (etapa === "conferencia") {
	        titulo = "Confer√™ncia";
	        imagem = "https://cdn-icons-png.flaticon.com/512/5164/5164023.png";
	        tipo = 3;
	      } else if (etapa === "embalar") {
	        titulo = "Embalar";
	        imagem = "https://cdn-icons-png.flaticon.com/512/3638/3638887.png";
	        tipo = 4;
	      } else if (etapa === "expedicao") {
	        titulo = "Expedi√ß√£o";
	        imagem = "https://cdn-icons-png.flaticon.com/512/11344/11344700.png";
	        tipo = 5;
	      }
	
	      painel.innerHTML = `
	              <div class="text-center">
	                <div class="mb-4 d-flex justify-content-center align-items-center gap-3">
	                  <img src="${imagem}" alt="${titulo}" style="width: 50px;">
	                  <h4 class="mb-0">${titulo}</h4>
	                </div>
	        
	                <div class="border border-primary border-dashed p-4 rounded" style="border-style: dashed;">
	                  <label for="path" class="d-block text-center" style="cursor: pointer;">
	                    <img src="https://cdn-icons-png.flaticon.com/512/337/337946.png" alt="Upload" style="width: 40px; opacity: 0.6;"><br>
	                    <span class="mt-2 d-inline-block">
	                      <span class="text-primary text-decoration-underline">Fa√ßa upload do PDF </span>
	                      e clique no bot√£o abaixo para continuar.
	                    </span>
	                    <br>
	                    <br>
	                  </label>
	                  <form method="post" action="/upload-pdf" enctype=multipart/form-data>
	                    <input type="hidden" id="type" name="type" value=${tipo}>
	                    <input type="file" id="path" name="path" accept="application/pdf" hidden>
	                    <input type="submit">
	                  </form>
	                </div>
	              </div>
	            `;
	    }
	  </script>
	  {% endblock %}
reservados.html={% extends "base_template.html" %}
	
	{% block content %}
	
	<h6>Teste reservados</h6>
	
	{% endblock %}
	
retiradoEstoque.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{{ url_for('static', filename='retiradoEstoque/retiradoEstoque.css') }}
	{% endblock %}
	
	{% block content %}
	<br>
	<div class="container">
	  <!-- Header -->
	  <div>
	    <div class="header-bar bg-primary text-white p-3 rounded mb-3">
	      <div class="d-flex justify-content-between align-items-center">
	        <h5 class="mb-0">Retirada do estoque</h5>
	        <button id="btnToggleRetirada" class="btn btn-link text-white p-0 d-block d-md-none" type="button"
	          data-bs-toggle="collapse" data-bs-target="#detalhesRetirada" aria-expanded="false"
	          aria-controls="detalhesRetirada">
	          <i class="bi bi-chevron-down fs-4"></i>
	        </button>
	      </div>
	      <div id="detalhesRetirada" class="collapse d-md-block mt-3">
	        <div class="d-flex flex-wrap align-items-center gap-3">
	          <div>
	            <strong style="color: #FDD484;">Empresa:</strong>
	            {% if dados_agend.empresa == 0 %}Nenhuma
	            {% elif dados_agend.empresa == 1 %}Ja√∫ Pesca
	            {% elif dados_agend.empresa == 2 %}Ja√∫ Fishing
	            {% elif dados_agend.empresa == 3 %}L.T. Sports
	            {% endif %}
	          </div>
	          <div><strong style="color: #FDD484;">Agendamento:</strong> {{ dados_agend.id_agend_ml }}</div>
	          <div><strong style="color: #FDD484;">Colaborador:</strong> {{ dados_agend.colaborador or 'Nenhum' }}</div>
	          {% set data = dados_agend.entrada %}
	          <div><strong style="color: #FDD484;">Data:</strong> {{ data.strftime('%d/%m/%y') }}</div>
	          <div><strong style="color: #FDD484;">Hora:</strong> {{ data.strftime('%Hh%M') }}</div>
	        </div>
	      </div>
	    </div>
	  </div>
	
	  <!-- Main row -->
	  <div class="row">
	    <!-- Coluna de inputs e indicadores -->
	    <div class="col-md-5">
	      <div class="mb-3">
	        <div class="row">
	          <div class="col">
	            <label class="form-label fw-bold">C√≥digo ou SKU</label>
	            <input type="text" id="skuInput" class="form-control" placeholder="Digite aqui" {% if not pode_mudar %}disabled{% endif %}>
	          </div>
	          <div class="col">
	            <label class="form-label fw-bold">Insira a quantidade</label>
	            <input type="number" id="quantidadeInput" class="form-control" value="1" min="1" {% if not pode_mudar %}disabled{% endif %}>
	          </div>
	        </div>
	      </div>
	
	      <div class="d-flex justify-content-between flex-wrap gap-3 p-3 mb-3 border rounded bg-white">
	        <p id="tempoP" class="mb-0"><strong>üïí Tempo:</strong> 00h 00m 00s</p>
	        <p id="andamentoP" class="mb-0"><strong>üîÑ Em andamento:</strong> Nenhum</p>
	        <p id="estimadoP" class="mb-0"><strong>‚è≥ Estimado:</strong> 00h 45m 00s</p>
	        <p id="finalizadosP" class="mb-0"><strong>‚úÖ Finalizados:</strong> Nenhum</p>
	        <div id="finalizarContainer" class="d-none mt-2 w-100">
	          <button id="btnFinalizar" class="btn btn-outline-success btn-lg w-100" onclick="finalizarAgendamento()">
	            <i class="bi bi-check-circle me-2"></i>Finalizar Agendamento
	          </button>
	        </div>
	      </div>
	
	      <!-- Bloco para itens conclu√≠dos -->
	      <div id="concluidosContainer" class="info-box mb-3 overflow-auto" style="max-height: 30vh;">
	        <!-- JS injeta aqui os itens com bipados >= total -->
	      </div>
	    </div>
	
	    <!-- Lista de produtos pendentes -->
	    <div class="col-md-7">
	      <div id="pendentesContainer" class="overflow-auto" style="max-height: 70vh;">
	        {% for composicao in dados %}
	        <div class="produto-item d-flex flex-column mb-3 me-2"
	             data-sku="{{ composicao.sku }}"
	             data-gtin=""
	             data-total="{{ composicao.unidades_totais }}"
	             data-bipados="0">
	          <div class="d-flex justify-content-between align-items-center">
	            <span class="text-truncate d-inline-block w-100" style="max-width: 400px;" title="{{ composicao.nome }}">
	              {{ composicao.comp_origem[0].nome }}
	            </span>
	
	            <!-- Editar (l√°pis) -->
	            <div id="editarProdutoComp-id[{{ composicao.sku }}]"
	                 onclick="editarProdutoCompLapis('{{ composicao.sku }}')"
	                 style="margin-left: 70px; cursor: pointer;">‚úèÔ∏è</div>
	
	            <!-- Adicionar equivalente (+) -->
	            <div id="btnEquivalente-{{ composicao.sku }}"
	                 onclick="adicionarEquivalente('{{ composicao.sku }}');"
	                 style="width: 25px; height: 25px; font-size: 40px; color: red; margin-top: -40px; cursor: pointer;">+</div>
	
	            <!-- Campo de equivalente (toggle) -->
	            <div id="equivalente-{{ composicao.sku }}" class="input-equivalente-off"
	                 style="width: 300px; height: 30px; border: 2px solid red;">
	              <input id="inputEquivalente-{{ composicao.sku }}" type="text">
	            </div>
	
	            <div class="d-flex align-items-center gap-3">
	              <span class="text-success">{{ composicao.sku }}</span>
	              <span class="bipados text-nowrap">Bipados: 0</span>
	            </div>
	          </div>
	
	          <div class="progress mt-2" style="height: 12px;">
	            <div class="progress-bar bg-warning text-secondary"
	                 role="progressbar"
	                 style="width: 0%;"
	                 aria-valuenow="0"
	                 aria-valuemin="0"
	                 aria-valuemax="{{ composicao.unidades_totais }}">
	              0%
	            </div>
	          </div>
	        </div>
	        {% endfor %}
	      </div>
	    </div>
	  </div>
	
	  <!-- Modal de edi√ß√£o de produto (custom, usa CSS pr√≥prio) -->
	  <div id="modal-editar-produto" class="modal" aria-hidden="true">
	    <div class="modal-content" role="dialog" aria-modal="true" aria-labelledby="tituloModalEditarProduto">
	      <h2 id="tituloModalEditarProduto" class="titulo-vermelho">Editar Produto</h2>
	
	      <!-- Layout do modal: esquerda (master) | direita (lista) -->
	      <div id="modalEditorWrap" class="modal-grid">
	        <!-- Painel esquerdo -->
	        <aside id="conteudoModalEditarProduto" class="info-box">
	          <p>Produto: <strong id="master-nome">‚Äî</strong></p>
	          <p>SKU: <strong id="master-sku-view">‚Äî</strong></p>
	          <p>GTIN/EAN: <strong id="master-gtin">‚Äî</strong></p>
	          <img id="master-img" style="max-width:100%;height:auto" src="{{ url_for('static', filename='resources/sem_img.webp') }}" alt="Imagem do produto">
	        </aside>
	
	        <!-- Lista (original + equivalentes) -->
	        <section id="listaProdutos" class="produtos-scroll">
	          <div class="header-bar">Produtos neste conjunto</div>
	          {# JS popula aqui os cards .produto-item-modal com lixeira e controles #}
	        </section>
	      </div>
	
	      <!-- Rodap√© -->
	      <div class="modal-actions">
	        <button type="button" class="btn btn-outline" onclick="fecharModal()">Cancelar</button>
	        <button id="btn-salvar-edicoes" type="button" class="btn btn-primary" onclick="salvarAlteracoes()">
	          Salvar Altera√ß√µes
	        </button>
	      </div>
	    </div>
	  </div>
	
	  <!-- Overlay de erro da busca de equivalente (usado pelo JS) -->
	  <div id="erroBuscaEquivalenteDiv" class="input-equivalente-off"
	       style="position: fixed; border: 1px solid red; width: 100px; height: 100px;"></div>
	
	  <!-- Painel de confirma√ß√£o do equivalente (substitui modal bootstrap) -->
	  <div id="confirmaEquivalente" class="input-equivalente-off"
	       style="border: 3px solid red; width: 500px; height: 650px; position: fixed; top: 25%; left: 40%; background-color: white;">
	  </div>
	</div>
	
	<!-- Dados para o JS -->
	<div id="js-data" data-comps='{{ comps | tojson | safe }}' data-dados="{{ dados }}" style="display:none;"></div>
	<div id="infoAgend"
	     data-empresa='{{ dados_agend.empresa }}'
	     data-agendamento='{{ dados_agend.id_agend_ml }}'
	     data-colaborador='{{ dados_agend.colaborador or "Nenhum" }}'
	     data-marketplace='{{ marketplace_nome }}'
	     style="display:none;"></div>
	{% endblock %}
	
	{% block scriptpath %}
	{{ url_for('static', filename='retiradoEstoque/retiradoEstoque.js') }}
	{% endblock %}
teste.html={% extends "base_template.html" %}
	
	{% block content %}
	    {% for i in dados %}
	        {{ i.id_bd}} // {{ i.id_agend_ml }}
	        <br>
	        {% for produto in i.produtos  %}
	            {% for composicao in produto.composicao %}
	                {{ composicao.nome }}
	                <br>
	            {% endfor %}
	            <br>
	        {% endfor %}
	        <br>
	        <br>
	        <br>
	    {% endfor %}
	    
	{% endblock %}
view_excel.html={% extends "base_template.html" %}
	
	{% block stylepath %}
	{# Voc√™ pode adicionar um CSS espec√≠fico se precisar #}
	<style>
	    .table-container { 
	        max-height: 80vh; 
	        overflow: auto; 
	        box-shadow: 0 4px 8px rgba(0,0,0,0.1);
	        background-color: white;
	        padding: 1rem;
	        border-radius: 8px;
	    }
	    h1 {
	        border-bottom: 2px solid #dee2e6; 
	        padding-bottom: 10px; 
	        margin-bottom: 20px;
	    }
	</style>
	{% endblock %}
	
	{% block content %}
	<div class="container-fluid pt-4">
	    <div class="d-flex justify-content-between align-items-center">
	        <h1>Conte√∫do do Arquivo: <span class="text-primary">{{ filename }}</span></h1>
	        <a href="{{ url_for('agendamentos', acao='ver') }}" class="btn btn-secondary">Voltar aos Agendamentos</a>
	    </div>
	
	    <div class="table-container my-3">
	        {{ data_table|safe }}
	    </div>
	</div>
	{% endblock %}
	
	{% block scriptpath %}
	{# Voc√™ pode adicionar um JS espec√≠fico se precisar #}
	{% endblock %}

[templates/partials]
form_editar_agendamento.html=<form id="form_alt" method="post" action="/alterar-agendamento">
	    <div class="row g-3">
	        <!-- <div class="col-md-6">
	            <label for="inp_col" class="form-label">Nome do colaborador:</label>
	            <input name="inp_col" id="inp_col" class="form-control" type="text" value="{{ dados.colaborador }}">
	        </div> -->
	
	        <input name="inp_ml" type="hidden" value="{{ dados.id_agend_ml }}">
	
	        <div class="col-md-6">
	            <label for="inp_mktp" class="form-label">Loja do agendamento:</label>
	            <select name="inp_mktp" id="inp_mktp" class="form-control">
	                <option value="4" {% if dados.id_mktp==4 %} selected {% endif %}>Amazon</option>
	                <option value="2" {% if dados.id_mktp==2 %} selected {% endif %}>Magalu</option>
	                <option value="1" {% if dados.id_mktp==1 %} selected {% endif %}>Mercado Livre</option>
	                <option value="3" {% if dados.id_mktp==3 %} selected {% endif %}>Shopee</option>
	            </select>
	        </div>
	
	        <div class="col-md-6">
	            <label for="inp_emp" class="form-label">Empresa do agendamento:</label>
	            <select name="inp_emp" id="inp_emp" class="form-control">
	                <option value="2" {% if dados.empresa==2 %} selected {% endif %}>Ja√∫ Fishing</option>
	                <option value="3" {% if dados.empresa==3 %} selected {% endif %}>L.T. Sports</option>
	                <option value="1" {% if dados.empresa==1 %} selected {% endif %}>Ja√∫ Pesca</option>
	            </select>
	        </div>
	
	        <div class="col-md-6">
	            <label for="inp_tipo" class="form-label">Fase do agendamento:</label>
	            <select name="inp_tipo" id="inp_tipo" class="form-control">
	                <option value="1" {% if dados.id_tipo==1 %} selected {% endif %}>Limpeza</option>
	                <option value="3" {% if dados.id_tipo==3 %} selected {% endif %}>Confer√™ncia</option>
	                <option value="4" {% if dados.id_tipo==4 %} selected {% endif %}>Embalar</option>
	                <option value="5" {% if dados.id_tipo==5 %} selected {% endif %}>Expedi√ß√£o</option>
	                <option value="2" {% if dados.id_tipo==2 %} selected {% endif %}>Finalizado</option>
	            </select>
	        </div>
	    </div>
	
	    <input name="inp_id" type="hidden" value="{{ dados.id_bd }}">
	
	    <div class="row mt-4">
	        <div class="col">
	            <input type="submit" class="btn btn-primary-custom w-100" value="Salvar Altera√ß√µes"
	                style="background: #0B5ED7; color: white">
	        </div>
	    </div>
	</form>
modal_relatorio_conteudo.html={% if relatorio %}
	
	<div class="card mb-3">
	    <div class="card-header bg-light">
	        <strong><i class="bi bi-info-circle-fill me-2"></i>Informa√ß√µes Gerais</strong>
	    </div>
	    <ul class="list-group list-group-flush">
	        <li class="list-group-item"><strong>Agendamento:</strong> {{ relatorio.Informacoes.Agendamento }}</li>
	        <li class="list-group-item"><strong>Empresa:</strong> {{ relatorio.Informacoes.Empresa }}</li>
	        <li class="list-group-item"><strong>Colaborador(es):</strong>
	            {% for item in relatorio.Colaboradores %}
	            <span class="badge bg-secondary">{{ item.Colaborador }}</span>
	            {% endfor %}
	        </li>
	    </ul>
	</div>
	
	<ul class="nav nav-tabs nav-fill" id="relatorioTab" role="tablist">
	    {% if relatorio.RelatorioConferencia %}
	    <li class="nav-item" role="presentation">
	        <button class="nav-link active" id="conferencia-tab" data-bs-toggle="tab" data-bs-target="#conferencia-content"
	            type="button" role="tab">
	            <i class="bi bi-card-checklist me-1"></i> Confer√™ncia
	        </button>
	    </li>
	    {% endif %}
	    {% if relatorio.RelatorioEmbalagem %}
	    <li class="nav-item" role="presentation">
	        <button class="nav-link {% if not relatorio.RelatorioConferencia %}active{% endif %}" id="embalagem-tab"
	            data-bs-toggle="tab" data-bs-target="#embalagem-content" type="button" role="tab">
	            <i class="bi bi-box-seam me-1"></i> Embalagem
	        </button>
	    </li>
	    {% endif %}
	</ul>
	
	<div class="tab-content border border-top-0 rounded-bottom p-3" id="relatorioTabContent">
	
	    {% if relatorio.RelatorioConferencia %}
	    <div class="tab-pane fade show active" id="conferencia-content" role="tabpanel">
	        <div class="d-flex justify-content-between align-items-center mb-2">
	            <h6 class="mb-0">Itens Conferidos</h6>
	            <span class="badge bg-light text-dark">Dura√ß√£o: {{ relatorio.Informacoes.Permanencia }}</span>
	        </div>
	        <div class="table-responsive" style="max-height: 40vh;">
	            <table class="table table-sm table-striped table-hover mb-0">
	                <thead>
	                    <tr>
	                        <th>SKU</th>
	                        <th>Nome</th>
	                        <th class="text-end">Unidades</th>
	                    </tr>
	                </thead>
	                <tbody>
	                    {% for item in relatorio.RelatorioConferencia %}
	                    <tr>
	                        <td><code>{{ item.sku }}</code></td>
	                        <td>{{ item.nome }}</td>
	                        <td class="text-end fw-bold">{{ item.unidades_totais }}</td>
	                    </tr>
	                    {% endfor %}
	                </tbody>
	            </table>
	        </div>
	    </div>
	    {% endif %}
	
	    {% if relatorio.RelatorioEmbalagem %}
	    <div class="tab-pane fade {% if not relatorio.RelatorioConferencia %}show active{% endif %}" id="embalagem-content"
	        role="tabpanel">
	        <div class="d-flex justify-content-between align-items-center mb-2">
	            <h6 class="mb-0">Itens Embalados ({{ relatorio.RelatorioEmbalagem.detalhes_embalagem.total_caixas }} Caixas)
	            </h6>
	            <span class="badge bg-light text-dark">Finalizado em: {{
	                relatorio.RelatorioEmbalagem.termino_embalagem.split(' ')[0] }}</span>
	        </div>
	        <div class="accordion accordion-flush" id="accordionCaixasEmbalagem"
	            style="max-height: 40vh; overflow-y: auto;">
	            {% for caixa in relatorio.RelatorioEmbalagem.detalhes_embalagem.caixas %}
	            <div class="accordion-item">
	                <h2 class="accordion-header">
	                    <button class="accordion-button collapsed py-2" type="button" data-bs-toggle="collapse"
	                        data-bs-target="#collapse-caixa-embalagem-{{ loop.index }}">
	                        <strong>Caixa #{{ caixa.caixa_numero }}</strong>
	                    </button>
	                </h2>
	                <div id="collapse-caixa-embalagem-{{ loop.index }}" class="accordion-collapse collapse"
	                    data-bs-parent="#accordionCaixasEmbalagem">
	                    <div class="accordion-body p-0">
	                        <ul class="list-group list-group-flush">
	                            {% for item in caixa.itens %}
	                            <li class="list-group-item d-flex justify-content-between align-items-center py-1">
	                                <code>{{ item.sku }}</code>
	                                <span class="badge bg-primary rounded-pill">{{ item.quantidade }} un</span>
	                            </li>
	                            {% else %}
	                            <li class="list-group-item">Nenhum item nesta caixa.</li>
	                            {% endfor %}
	                        </ul>
	                    </div>
	                </div>
	            </div>
	            {% endfor %}
	        </div>
	    </div>
	    {% endif %}
	
	</div>
	
	{% if not relatorio.RelatorioConferencia and not relatorio.RelatorioEmbalagem %}
	<div class="alert alert-info mt-3">Nenhum detalhe de confer√™ncia ou embalagem encontrado neste relat√≥rio.</div>
	{% endif %}
	
	{% else %}
	<p>N√£o foi poss√≠vel carregar os dados do relat√≥rio.</p>
	{% endif %}

