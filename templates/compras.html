{% extends "base_template.html" %}

{% block stylepath %}
{{ url_for('static', filename='compras/compras.css') }}
{% endblock %}

{% block content %}
<div class="container p-4">
    <div class="header-bar bg-primary text-white p-3 rounded mb-2">
        <div class="d-flex justify-content-between align-items-center">
            <!-- Título sempre visível -->
            <h5 class="mb-0">Composição do agendamento</h5>
            <div class="dropdown">
                <button class="btn btn-outline-light d-flex align-items-center gap-2 dropdown-toggle px-3 py-2"
                    type="button" id="dropdownMenuDownload" data-bs-toggle="dropdown" aria-expanded="false">
                    <i class="bi bi-download"></i> Baixar
                </button>
                <ul class="dropdown-menu dropdown-menu-end shadow-sm rounded-3 animate__animated animate__fadeIn"
                    aria-labelledby="dropdownMenuDownload">
                    <li>
                        <button class="dropdown-item d-flex align-items-center gap-2" href="#"
                            onclick="turnTableDataToJson('csv')">
                            <i class="bi bi-filetype-csv"></i> CSV
                        </button>
                    </li>
                    <li>
                        <button class="dropdown-item d-flex align-items-center gap-2" href="#"
                            onclick="turnTableDataToJson('excel')">
                            <i class="bi bi-file-earmark-excel"></i> Excel
                        </button>
                    </li>
                    <li>
                        <button class="dropdown-item d-flex align-items-center gap-2" href="#" onclick="window.print()">
                            <i class="bi bi-printer"></i> Imprimir
                        </button>
                    </li>
                </ul>
            </div>
            <!-- src="{{ url_for('static', filename='/resources/logo.png') }}" -->
        </div>
    </div>
    <div class="card shadow-sm mb-4" id="container-table">
        <div class="print-header">
            <img src="{{ url_for('static', filename='/resources/logo.png') }}" alt="Logo" class="print-logo">
            <h2 class="print-title" style="margin-bottom: 15px;">Lista de Compras</h2>
            <div class="print-meta" style="margin-bottom: 10px;">
                <span id="data-hoje"></span> &nbsp;&nbsp;
            </div>
        </div>
        <div class="card-body p-0">
            <div class="table-responsive" style="max-height:70vh; overflow-y:auto;">
                <table class="table table-hover align-middle">
                    <thead>
                        <tr>
                            <th>Produto</th>
                            <th>Fornecedor</th>
                            <th>Código</th>
                            <th>Total</th>
                            <th>Tiny</th>
                            <th>Faltam</th>
                            <th>Comprar</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for compra in dados %}
                        <tr>
                            <td data-label="Produto">{{ compra[6] }}</td>
                            <td data-label="Fornecedor" id="fornecedor-{{ compra[3] }}">Buscando…</td>
                            <td data-label="Código" id="cod-fornecedor-{{ compra[3] }}">Buscando…</td>
                            <td data-label="Total" id="qnt-total-{{ compra[3] }}">{{
                                compra[7] }}</td>
                            <td data-label="Tiny" id="estoque-tiny-{{ compra[3] }}">Buscando…</td>
                            <td data-label="Faltam" id="qnt-faltante-{{ compra[3] }}">Buscando…</td>
                            <td data-label="Comprar" id="qnt-compra-{{ compra[3] }}">
                                <div class="input-wrapper">
                                    <input type="number" value="0" min="0" oninput="autoResizeInput(this)">
                                    <span class="input-mirror"></span>
                                </div>
                                <div>
                                    <button id="remover-{{ compra[0] }}" type="button" onclick="removeComprado(this)">
                                        Remover </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scriptpath %}
{{ url_for('static', filename='compras/compras.js') }}
{% endblock %}