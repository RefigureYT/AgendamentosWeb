{% extends "base_template.html" %}

{% block stylepath %}
{{ url_for('static', filename='alteracoes/alteracoes.css') }}
{% endblock %}

{% block content %}
<div class="container-fluid px-3 py-3">

  <div class="header-bar bg-primary text-white py-2 px-3 rounded mb-3">
    <div class="d-flex justify-content-between align-items-center gap-2 flex-wrap">
      <h5 class="mb-0">Alterações (Reports)</h5>

      <button id="btnReload" class="btn btn-light btn-sm">
        <i class="bi bi-arrow-clockwise"></i> Recarregar
      </button>
    </div>
  </div>

  <div id="altMsg" class="alert d-none mb-3"></div>

  <div class="card shadow-sm">
    <div class="card-body">

      <div class="d-flex justify-content-between align-items-center flex-wrap gap-2 p-3">
        <div class="d-flex align-items-center gap-2 flex-wrap">
          <input
            id="qSearch"
            class="form-control form-control-sm"
            style="width: min(520px, 92vw);"
            placeholder="Buscar (empresa, mktp, sku, ean, etiqueta, report, obs...)"
          />

          <div class="form-check form-switch ms-2">
            <input class="form-check-input" type="checkbox" id="chkFeitos">
            <label class="form-check-label" for="chkFeitos">Mostrar feitos</label>
          </div>
        </div>

        <span class="text-muted small">Total: <b id="lblCount">0</b></span>
      </div>

      <div class="table-responsive">
        <table class="table table-hover table-sm mb-0 align-middle alt-reports-table">
          <thead>
            <tr>
              <th>Data</th>
              <th>Empresa</th>
              <th>MKTP</th>
              <th>Etiqueta/ID</th>
              <th>Produto</th>
              <th>SKU</th>
              <th>EAN</th>
              <th>Tipo</th>
              <th>Report</th>
              <th>Colaborador</th>
              <th class="alt-col-obs">Obs</th>
              <th>Status</th>
              <th class="text-end alt-col-acoes">Ações</th>
            </tr>
          </thead>

          <tbody id="altBody">
            <tr>
              <td colspan="13" class="text-muted">Carregando...</td>
            </tr>
          </tbody>
        </table>
      </div>

    </div>
  </div>
</div>

<!-- MODAL: apenas para ENGANO (obs obrigatória) -->
<div class="modal fade" id="modalReport" tabindex="-1" aria-hidden="true">
  <div class="modal-dialog modal-dialog-centered">
    <div class="modal-content">

      <div class="modal-header">
        <h5 class="modal-title" id="modalTitle">Marcar como engano</h5>
        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Fechar"></button>
      </div>

      <div class="modal-body">
        <input type="hidden" id="modalReportId" />

        <div class="mb-2">
          <label class="form-label fw-bold">Observação (obrigatória)</label>
          <textarea id="modalObs" class="form-control" rows="4" placeholder="Explique por que foi engano..."></textarea>
          <div class="form-text" id="modalHint">Será salvo como <b>ENGANO</b> (a menos que você marque como FEITO).</div>
        </div>

        <div class="form-check form-switch">
          <input class="form-check-input" type="checkbox" id="modalFeito">
          <label class="form-check-label" for="modalFeito">Marcar como FEITO</label>
        </div>
      </div>

      <div class="modal-footer">
        <button class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
        <button id="btnModalConfirm" class="btn btn-danger">Confirmar engano</button>
      </div>

    </div>
  </div>
</div>
{% endblock %}

{% block scriptpath %}
{{ url_for('static', filename='alteracoes/alteracoes.js') }}
{% endblock %}